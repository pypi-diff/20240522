# Comparing `tmp/kimimaro-3.7.0.tar.gz` & `tmp/kimimaro-4.0.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "kimimaro-3.7.0.tar", last modified: Sun May 12 00:21:13 2024, max compression
+gzip compressed data, was "kimimaro-4.0.0.tar", last modified: Wed May 22 21:18:42 2024, max compression
```

## Comparing `kimimaro-3.7.0.tar` & `kimimaro-4.0.0.tar`

### file list

```diff
@@ -1,32 +1,33 @@
-drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-12 00:21:13.620470 kimimaro-3.7.0/
--rw-r--r--   0 wms        (501) staff       (20)       88 2021-01-11 02:21:49.000000 kimimaro-3.7.0/AUTHORS
--rw-r--r--   0 wms        (501) staff       (20)    35149 2021-01-11 02:21:49.000000 kimimaro-3.7.0/LICENSE
--rw-r--r--   0 wms        (501) staff       (20)       39 2021-01-11 02:21:49.000000 kimimaro-3.7.0/MANIFEST.in
--rw-r--r--   0 wms        (501) staff       (20)    45784 2024-05-12 00:21:13.620099 kimimaro-3.7.0/PKG-INFO
--rw-r--r--   0 wms        (501) staff       (20)    43959 2024-04-28 09:53:03.000000 kimimaro-3.7.0/README.md
-drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-12 00:21:13.596438 kimimaro-3.7.0/ext/
-drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-12 00:21:13.610487 kimimaro-3.7.0/ext/skeletontricks/
--rw-r--r--   0 wms        (501) staff       (20)    94949 2022-10-16 02:32:57.000000 kimimaro-3.7.0/ext/skeletontricks/robinhood.hpp
--rw-r--r--   0 wms        (501) staff       (20)  4102457 2024-04-06 06:50:50.000000 kimimaro-3.7.0/ext/skeletontricks/skeletontricks.cpp
--rw-r--r--   0 wms        (501) staff       (20)    12249 2023-01-29 09:55:10.000000 kimimaro-3.7.0/ext/skeletontricks/skeletontricks.hpp
--rw-r--r--   0 wms        (501) staff       (20)     3943 2022-10-16 02:33:33.000000 kimimaro-3.7.0/ext/skeletontricks/skeletontricks.pxd
--rw-r--r--   0 wms        (501) staff       (20)    26546 2024-01-23 06:25:47.000000 kimimaro-3.7.0/ext/skeletontricks/skeletontricks.pyx
--rw-r--r--   0 wms        (501) staff       (20)      518 2021-01-11 02:21:49.000000 kimimaro-3.7.0/ext/skeletontricks/test.cpp
-drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-12 00:21:13.617522 kimimaro-3.7.0/kimimaro/
--rw-r--r--   0 wms        (501) staff       (20)      919 2024-04-28 09:53:03.000000 kimimaro-3.7.0/kimimaro/__init__.py
--rw-r--r--   0 wms        (501) staff       (20)    25910 2024-04-06 00:15:42.000000 kimimaro-3.7.0/kimimaro/intake.py
--rw-r--r--   0 wms        (501) staff       (20)    19101 2022-03-02 04:56:57.000000 kimimaro-3.7.0/kimimaro/postprocess.py
--rw-r--r--   0 wms        (501) staff       (20)    14248 2024-01-27 20:57:44.000000 kimimaro-3.7.0/kimimaro/trace.py
--rw-r--r--   0 wms        (501) staff       (20)     9743 2024-05-11 23:13:46.000000 kimimaro-3.7.0/kimimaro/utility.py
-drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-12 00:21:13.619598 kimimaro-3.7.0/kimimaro.egg-info/
--rw-r--r--   0 wms        (501) staff       (20)    45784 2024-05-12 00:21:13.000000 kimimaro-3.7.0/kimimaro.egg-info/PKG-INFO
--rw-r--r--   0 wms        (501) staff       (20)      675 2024-05-12 00:21:13.000000 kimimaro-3.7.0/kimimaro.egg-info/SOURCES.txt
--rw-r--r--   0 wms        (501) staff       (20)        1 2024-05-12 00:21:13.000000 kimimaro-3.7.0/kimimaro.egg-info/dependency_links.txt
--rw-r--r--   0 wms        (501) staff       (20)       47 2024-05-12 00:21:13.000000 kimimaro-3.7.0/kimimaro.egg-info/entry_points.txt
--rw-r--r--   0 wms        (501) staff       (20)      194 2024-05-12 00:21:13.000000 kimimaro-3.7.0/kimimaro.egg-info/requires.txt
--rw-r--r--   0 wms        (501) staff       (20)       22 2024-05-12 00:21:13.000000 kimimaro-3.7.0/kimimaro.egg-info/top_level.txt
-drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-12 00:21:13.619117 kimimaro-3.7.0/kimimaro_cli/
--rw-r--r--   0 wms        (501) staff       (20)     8072 2023-01-29 09:55:10.000000 kimimaro-3.7.0/kimimaro_cli/__init__.py
--rw-r--r--   0 wms        (501) staff       (20)       94 2023-12-19 05:31:04.000000 kimimaro-3.7.0/pyproject.toml
--rw-r--r--   0 wms        (501) staff       (20)       38 2024-05-12 00:21:13.620538 kimimaro-3.7.0/setup.cfg
--rw-r--r--   0 wms        (501) staff       (20)     2591 2024-05-11 23:06:24.000000 kimimaro-3.7.0/setup.py
+drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-22 21:18:42.067842 kimimaro-4.0.0/
+-rw-r--r--   0 wms        (501) staff       (20)       88 2021-01-11 02:21:49.000000 kimimaro-4.0.0/AUTHORS
+-rw-r--r--   0 wms        (501) staff       (20)    35149 2021-01-11 02:21:49.000000 kimimaro-4.0.0/LICENSE
+-rw-r--r--   0 wms        (501) staff       (20)       39 2021-01-11 02:21:49.000000 kimimaro-4.0.0/MANIFEST.in
+-rw-r--r--   0 wms        (501) staff       (20)    45811 2024-05-22 21:18:42.067503 kimimaro-4.0.0/PKG-INFO
+-rw-r--r--   0 wms        (501) staff       (20)    43959 2024-04-28 09:53:03.000000 kimimaro-4.0.0/README.md
+drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-22 21:18:42.048183 kimimaro-4.0.0/ext/
+drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-22 21:18:42.060042 kimimaro-4.0.0/ext/skeletontricks/
+-rw-r--r--   0 wms        (501) staff       (20)    11931 2024-05-22 18:36:01.000000 kimimaro-4.0.0/ext/skeletontricks/dijkstra_invalidation.hpp
+-rw-r--r--   0 wms        (501) staff       (20)   127994 2024-05-22 18:36:01.000000 kimimaro-4.0.0/ext/skeletontricks/libdivide.h
+-rw-r--r--   0 wms        (501) staff       (20)    94949 2022-10-16 02:32:57.000000 kimimaro-4.0.0/ext/skeletontricks/robinhood.hpp
+-rw-r--r--   0 wms        (501) staff       (20)  4150650 2024-05-22 18:26:53.000000 kimimaro-4.0.0/ext/skeletontricks/skeletontricks.cpp
+-rw-r--r--   0 wms        (501) staff       (20)    12248 2024-05-22 18:36:01.000000 kimimaro-4.0.0/ext/skeletontricks/skeletontricks.hpp
+-rw-r--r--   0 wms        (501) staff       (20)     3943 2022-10-16 02:33:33.000000 kimimaro-4.0.0/ext/skeletontricks/skeletontricks.pxd
+-rw-r--r--   0 wms        (501) staff       (20)    27493 2024-05-22 18:36:01.000000 kimimaro-4.0.0/ext/skeletontricks/skeletontricks.pyx
+drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-22 21:18:42.064886 kimimaro-4.0.0/kimimaro/
+-rw-r--r--   0 wms        (501) staff       (20)      919 2024-04-28 09:53:03.000000 kimimaro-4.0.0/kimimaro/__init__.py
+-rw-r--r--   0 wms        (501) staff       (20)    25924 2024-05-22 18:36:01.000000 kimimaro-4.0.0/kimimaro/intake.py
+-rw-r--r--   0 wms        (501) staff       (20)    19101 2022-03-02 04:56:57.000000 kimimaro-4.0.0/kimimaro/postprocess.py
+-rw-r--r--   0 wms        (501) staff       (20)    14302 2024-05-22 18:36:01.000000 kimimaro-4.0.0/kimimaro/trace.py
+-rw-r--r--   0 wms        (501) staff       (20)     9914 2024-05-22 18:36:01.000000 kimimaro-4.0.0/kimimaro/utility.py
+drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-22 21:18:42.067004 kimimaro-4.0.0/kimimaro.egg-info/
+-rw-r--r--   0 wms        (501) staff       (20)    45811 2024-05-22 21:18:41.000000 kimimaro-4.0.0/kimimaro.egg-info/PKG-INFO
+-rw-r--r--   0 wms        (501) staff       (20)      683 2024-05-22 21:18:42.000000 kimimaro-4.0.0/kimimaro.egg-info/SOURCES.txt
+-rw-r--r--   0 wms        (501) staff       (20)        1 2024-05-22 21:18:41.000000 kimimaro-4.0.0/kimimaro.egg-info/dependency_links.txt
+-rw-r--r--   0 wms        (501) staff       (20)       47 2024-05-22 21:18:41.000000 kimimaro-4.0.0/kimimaro.egg-info/entry_points.txt
+-rw-r--r--   0 wms        (501) staff       (20)      206 2024-05-22 21:18:41.000000 kimimaro-4.0.0/kimimaro.egg-info/requires.txt
+-rw-r--r--   0 wms        (501) staff       (20)       22 2024-05-22 21:18:41.000000 kimimaro-4.0.0/kimimaro.egg-info/top_level.txt
+drwxr-xr-x   0 wms        (501) staff       (20)        0 2024-05-22 21:18:42.066434 kimimaro-4.0.0/kimimaro_cli/
+-rw-r--r--   0 wms        (501) staff       (20)     8072 2023-01-29 09:55:10.000000 kimimaro-4.0.0/kimimaro_cli/__init__.py
+-rw-r--r--   0 wms        (501) staff       (20)       94 2023-12-19 05:31:04.000000 kimimaro-4.0.0/pyproject.toml
+-rw-r--r--   0 wms        (501) staff       (20)       38 2024-05-22 21:18:42.067902 kimimaro-4.0.0/setup.cfg
+-rw-r--r--   0 wms        (501) staff       (20)     2610 2024-05-22 19:14:23.000000 kimimaro-4.0.0/setup.py
```

### Comparing `kimimaro-3.7.0/LICENSE` & `kimimaro-4.0.0/LICENSE`

 * *Files identical despite different names*

### Comparing `kimimaro-3.7.0/PKG-INFO` & `kimimaro-4.0.0/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: kimimaro
-Version: 3.7.0
+Version: 4.0.0
 Summary: Skeletonize densely labeled image volumes.
 Home-page: https://github.com/seung-lab/kimimaro/
 Author: William Silversmith, Alex Bae, Forrest Collman, Peter Li
 Author-email: ws9@princeton.edu
 License: License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)
 Keywords: volumetric-data numpy teasar skeletonization centerline medial-axis-transform centerline-extraction computer-vision-alogithms connectomics image-processing biomedical-image-processing voxel
 Classifier: Intended Audience :: Developers
@@ -18,30 +18,31 @@
 Classifier: Programming Language :: Python :: 3.11
 Classifier: Programming Language :: Python :: 3.12
 Classifier: Topic :: Scientific/Engineering
 Classifier: Intended Audience :: Science/Research
 Classifier: Operating System :: POSIX
 Classifier: Operating System :: MacOS
 Classifier: Operating System :: Microsoft :: Windows :: Windows 10
-Requires-Python: >=3.6.0,<4.0.0
+Requires-Python: >=3.8.0,<4.0.0
 Description-Content-Type: text/markdown
 License-File: LICENSE
 License-File: AUTHORS
 Requires-Dist: click
-Requires-Dist: connected-components-3d>=1.5.0
+Requires-Dist: connected-components-3d>=3.16.0
 Requires-Dist: cloud-volume>=0.57.6
-Requires-Dist: dijkstra3d>=1.9.0
+Requires-Dist: dijkstra3d>=1.15.0
 Requires-Dist: fill-voids>=2.0.0
 Requires-Dist: edt>=2.1.0
 Requires-Dist: fastremap>=1.10.2
 Requires-Dist: networkx
 Requires-Dist: numpy>=1.16.1
 Requires-Dist: pathos
+Requires-Dist: pytest
 Requires-Dist: scipy>=1.1.0
-Requires-Dist: xs3d>=0.2.0
+Requires-Dist: xs3d<2,>=1.2.0
 Provides-Extra: tif
 Requires-Dist: tifffile; extra == "tif"
 
 [![Build Status](https://travis-ci.org/seung-lab/kimimaro.svg?branch=master)](https://travis-ci.org/seung-lab/kimimaro) [![PyPI version](https://badge.fury.io/py/kimimaro.svg)](https://badge.fury.io/py/kimimaro)  
 
 # Kimimaro: Skeletonize Densely Labeled Images
```

### Comparing `kimimaro-3.7.0/README.md` & `kimimaro-4.0.0/README.md`

 * *Files identical despite different names*

### Comparing `kimimaro-3.7.0/ext/skeletontricks/robinhood.hpp` & `kimimaro-4.0.0/ext/skeletontricks/robinhood.hpp`

 * *Files identical despite different names*

### Comparing `kimimaro-3.7.0/ext/skeletontricks/skeletontricks.cpp` & `kimimaro-4.0.0/ext/skeletontricks/skeletontricks.cpp`

 * *Files 0% similar despite different names*

```diff
@@ -1,29 +1,30 @@
-/* Generated by Cython 3.0.10 */
+/* Generated by Cython 3.0.8 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
-            "/private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h",
-            "/private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/core/include/numpy/arrayscalars.h",
-            "/private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h",
-            "/private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h",
-            "/private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/core/include/numpy/ufuncobject.h",
+            "/Users/wms/.virtualenvs/kimi/lib/python3.11/site-packages/numpy/core/include/numpy/arrayobject.h",
+            "/Users/wms/.virtualenvs/kimi/lib/python3.11/site-packages/numpy/core/include/numpy/arrayscalars.h",
+            "/Users/wms/.virtualenvs/kimi/lib/python3.11/site-packages/numpy/core/include/numpy/ndarrayobject.h",
+            "/Users/wms/.virtualenvs/kimi/lib/python3.11/site-packages/numpy/core/include/numpy/ndarraytypes.h",
+            "/Users/wms/.virtualenvs/kimi/lib/python3.11/site-packages/numpy/core/include/numpy/ufuncobject.h",
+            "ext/skeletontricks/dijkstra_invalidation.hpp",
             "ext/skeletontricks/robinhood.hpp",
             "ext/skeletontricks/skeletontricks.hpp"
         ],
         "extra_compile_args": [
             "-std=c++11",
             "-O3",
             "-ffast-math"
         ],
         "include_dirs": [
             "./ext/skeletontricks",
-            "/private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/core/include"
+            "/Users/wms/.virtualenvs/kimi/lib/python3.11/site-packages/numpy/core/include"
         ],
         "language": "c++",
         "name": "kimimaro.skeletontricks",
         "sources": [
             "./ext/skeletontricks/skeletontricks.pyx"
         ]
     },
@@ -68,18 +69,18 @@
     #error Cython requires Python 2.7+ or Python 3.3+.
 #else
 #if defined(CYTHON_LIMITED_API) && CYTHON_LIMITED_API
 #define __PYX_EXTRA_ABI_MODULE_NAME "limited"
 #else
 #define __PYX_EXTRA_ABI_MODULE_NAME ""
 #endif
-#define CYTHON_ABI "3_0_10" __PYX_EXTRA_ABI_MODULE_NAME
+#define CYTHON_ABI "3_0_8" __PYX_EXTRA_ABI_MODULE_NAME
 #define __PYX_ABI_MODULE_NAME "_cython_" CYTHON_ABI
 #define __PYX_TYPE_MODULE_PREFIX __PYX_ABI_MODULE_NAME "."
-#define CYTHON_HEX_VERSION 0x03000AF0
+#define CYTHON_HEX_VERSION 0x030008F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(_WIN32) && !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -163,16 +164,14 @@
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
     #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
-  #undef CYTHON_USE_FREELISTS
-  #define CYTHON_USE_FREELISTS 0
 #elif defined(PYPY_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_LIMITED_API 0
   #define CYTHON_COMPILING_IN_GRAAL 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #undef CYTHON_USE_TYPE_SLOTS
@@ -226,16 +225,14 @@
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
     #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
-  #undef CYTHON_USE_FREELISTS
-  #define CYTHON_USE_FREELISTS 0
 #elif defined(CYTHON_LIMITED_API)
   #ifdef Py_LIMITED_API
     #undef __PYX_LIMITED_VERSION_HEX
     #define __PYX_LIMITED_VERSION_HEX Py_LIMITED_API
   #endif
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_CPYTHON 0
@@ -289,83 +286,60 @@
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
     #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
-  #undef CYTHON_USE_FREELISTS
-  #define CYTHON_USE_FREELISTS 0
 #elif defined(Py_GIL_DISABLED) || defined(Py_NOGIL)
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_CPYTHON 0
   #define CYTHON_COMPILING_IN_LIMITED_API 0
   #define CYTHON_COMPILING_IN_GRAAL 0
   #define CYTHON_COMPILING_IN_NOGIL 1
   #ifndef CYTHON_USE_TYPE_SLOTS
     #define CYTHON_USE_TYPE_SLOTS 1
   #endif
-  #ifndef CYTHON_USE_TYPE_SPECS
-    #define CYTHON_USE_TYPE_SPECS 0
-  #endif
   #undef CYTHON_USE_PYTYPE_LOOKUP
   #define CYTHON_USE_PYTYPE_LOOKUP 0
   #ifndef CYTHON_USE_ASYNC_SLOTS
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
-  #ifndef CYTHON_USE_PYLONG_INTERNALS
-    #define CYTHON_USE_PYLONG_INTERNALS 0
-  #endif
   #undef CYTHON_USE_PYLIST_INTERNALS
   #define CYTHON_USE_PYLIST_INTERNALS 0
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
   #undef CYTHON_USE_UNICODE_WRITER
   #define CYTHON_USE_UNICODE_WRITER 0
+  #undef CYTHON_USE_PYLONG_INTERNALS
+  #define CYTHON_USE_PYLONG_INTERNALS 0
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
   #endif
   #ifndef CYTHON_ASSUME_SAFE_MACROS
     #define CYTHON_ASSUME_SAFE_MACROS 1
   #endif
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
-  #undef CYTHON_FAST_GIL
-  #define CYTHON_FAST_GIL 0
-  #ifndef CYTHON_METH_FASTCALL
-    #define CYTHON_METH_FASTCALL 1
-  #endif
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #ifndef CYTHON_PEP487_INIT_SUBCLASS
-    #define CYTHON_PEP487_INIT_SUBCLASS 1
-  #endif
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT 1
   #endif
-  #ifndef CYTHON_USE_MODULE_STATE
-    #define CYTHON_USE_MODULE_STATE 0
-  #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE 1
   #endif
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
-  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
-    #define CYTHON_UPDATE_DESCRIPTOR_DOC 1
-  #endif
-  #ifndef CYTHON_USE_FREELISTS
-    #define CYTHON_USE_FREELISTS 0
-  #endif
 #else
   #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_CPYTHON 1
   #define CYTHON_COMPILING_IN_LIMITED_API 0
   #define CYTHON_COMPILING_IN_GRAAL 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
@@ -448,17 +422,14 @@
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK 1
   #endif
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
     #define CYTHON_UPDATE_DESCRIPTOR_DOC 1
   #endif
-  #ifndef CYTHON_USE_FREELISTS
-    #define CYTHON_USE_FREELISTS 1
-  #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
 #if !defined(CYTHON_VECTORCALL)
 #define CYTHON_VECTORCALL  (CYTHON_FAST_PYCCALL && PY_VERSION_HEX >= 0x030800B1)
 #endif
@@ -810,21 +781,16 @@
   #ifndef METH_FASTCALL
      #define METH_FASTCALL 0x80
   #endif
   typedef PyObject *(*__Pyx_PyCFunctionFast) (PyObject *self, PyObject *const *args, Py_ssize_t nargs);
   typedef PyObject *(*__Pyx_PyCFunctionFastWithKeywords) (PyObject *self, PyObject *const *args,
                                                           Py_ssize_t nargs, PyObject *kwnames);
 #else
-  #if PY_VERSION_HEX >= 0x030d00A4
-  #  define __Pyx_PyCFunctionFast PyCFunctionFast
-  #  define __Pyx_PyCFunctionFastWithKeywords PyCFunctionFastWithKeywords
-  #else
-  #  define __Pyx_PyCFunctionFast _PyCFunctionFast
-  #  define __Pyx_PyCFunctionFastWithKeywords _PyCFunctionFastWithKeywords
-  #endif
+  #define __Pyx_PyCFunctionFast _PyCFunctionFast
+  #define __Pyx_PyCFunctionFastWithKeywords _PyCFunctionFastWithKeywords
 #endif
 #if CYTHON_METH_FASTCALL
   #define __Pyx_METH_FASTCALL METH_FASTCALL
   #define __Pyx_PyCFunction_FastCall __Pyx_PyCFunctionFast
   #define __Pyx_PyCFunction_FastCallWithKeywords __Pyx_PyCFunctionFastWithKeywords
 #else
   #define __Pyx_METH_FASTCALL METH_VARARGS
@@ -1168,15 +1134,15 @@
   #define __Pyx_PyList_SET_ITEM(o, i, v) PyList_SetItem(o, i, v)
   #define __Pyx_PyTuple_GET_SIZE(o) PyTuple_Size(o)
   #define __Pyx_PyList_GET_SIZE(o) PyList_Size(o)
   #define __Pyx_PySet_GET_SIZE(o) PySet_Size(o)
   #define __Pyx_PyBytes_GET_SIZE(o) PyBytes_Size(o)
   #define __Pyx_PyByteArray_GET_SIZE(o) PyByteArray_Size(o)
 #endif
-#if __PYX_LIMITED_VERSION_HEX >= 0x030d00A1
+#if PY_VERSION_HEX >= 0x030d00A1
   #define __Pyx_PyImport_AddModuleRef(name) PyImport_AddModuleRef(name)
 #else
   static CYTHON_INLINE PyObject *__Pyx_PyImport_AddModuleRef(const char *name) {
       PyObject *module = PyImport_AddModule(name);
       Py_XINCREF(module);
       return module;
   }
@@ -1255,15 +1221,15 @@
 #if defined(__CYGWIN__) && defined(_LDBL_EQ_DBL)
 #define __Pyx_truncl trunc
 #else
 #define __Pyx_truncl truncl
 #endif
 
 #define __PYX_MARK_ERR_POS(f_index, lineno) \
-    { __pyx_filename = __pyx_f[f_index]; (void)__pyx_filename; __pyx_lineno = lineno; (void)__pyx_lineno; __pyx_clineno = __LINE__;  (void)__pyx_clineno; }
+    { __pyx_filename = __pyx_f[f_index]; (void)__pyx_filename; __pyx_lineno = lineno; (void)__pyx_lineno; __pyx_clineno = __LINE__; (void)__pyx_clineno; }
 #define __PYX_ERR(f_index, lineno, Ln_error) \
     { __PYX_MARK_ERR_POS(f_index, lineno) goto Ln_error; }
 
 #ifdef CYTHON_EXTERN_C
     #undef __PYX_EXTERN_C
     #define __PYX_EXTERN_C CYTHON_EXTERN_C
 #elif defined(__PYX_EXTERN_C)
@@ -1319,14 +1285,15 @@
     
 #include "numpy/arrayobject.h"
 #include "numpy/ndarrayobject.h"
 #include "numpy/ndarraytypes.h"
 #include "numpy/arrayscalars.h"
 #include "numpy/ufuncobject.h"
 #include "math.h"
+#include "dijkstra_invalidation.hpp"
 #include "skeletontricks.hpp"
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
@@ -1399,15 +1366,32 @@
 #define __Pyx_PyObject_AsSString(s)    ((const signed char*) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_AsUString(s)    ((const unsigned char*) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_FromCString(s)  __Pyx_PyObject_FromString((const char*)s)
 #define __Pyx_PyBytes_FromCString(s)   __Pyx_PyBytes_FromString((const char*)s)
 #define __Pyx_PyByteArray_FromCString(s)   __Pyx_PyByteArray_FromString((const char*)s)
 #define __Pyx_PyStr_FromCString(s)     __Pyx_PyStr_FromString((const char*)s)
 #define __Pyx_PyUnicode_FromCString(s) __Pyx_PyUnicode_FromString((const char*)s)
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const wchar_t *u)
+{
+    const wchar_t *u_end = u;
+    while (*u_end++) ;
+    return (size_t)(u_end - u - 1);
+}
+#else
+static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u)
+{
+    const Py_UNICODE *u_end = u;
+    while (*u_end++) ;
+    return (size_t)(u_end - u - 1);
+}
+#endif
 #define __Pyx_PyUnicode_FromOrdinal(o)       PyUnicode_FromOrdinal((int)o)
+#define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
+#define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
 #define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
 #define __Pyx_NewRef(obj) (Py_INCREF(obj), obj)
 #define __Pyx_Owned_Py_None(b) __Pyx_NewRef(Py_None)
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
@@ -1743,195 +1727,195 @@
   Py_ssize_t strides[8];
   Py_ssize_t suboffsets[8];
 } __Pyx_memviewslice;
 #define __Pyx_MemoryView_Len(m)  (m.shape[0])
 
 /* #### Code section: numeric_typedefs ### */
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":731
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":731
  * # in Cython to enable them only on the right systems.
  * 
  * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  */
 typedef npy_int8 __pyx_t_5numpy_int8_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":732
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":732
  * 
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t
  */
 typedef npy_int16 __pyx_t_5numpy_int16_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":733
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":733
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int64      int64_t
  * #ctypedef npy_int96      int96_t
  */
 typedef npy_int32 __pyx_t_5numpy_int32_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":734
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":734
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_int96      int96_t
  * #ctypedef npy_int128     int128_t
  */
 typedef npy_int64 __pyx_t_5numpy_int64_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":738
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":738
  * #ctypedef npy_int128     int128_t
  * 
  * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  */
 typedef npy_uint8 __pyx_t_5numpy_uint8_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":739
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":739
  * 
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t
  */
 typedef npy_uint16 __pyx_t_5numpy_uint16_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":740
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":740
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint64     uint64_t
  * #ctypedef npy_uint96     uint96_t
  */
 typedef npy_uint32 __pyx_t_5numpy_uint32_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":741
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":741
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_uint96     uint96_t
  * #ctypedef npy_uint128    uint128_t
  */
 typedef npy_uint64 __pyx_t_5numpy_uint64_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":745
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":745
  * #ctypedef npy_uint128    uint128_t
  * 
  * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_float64    float64_t
  * #ctypedef npy_float80    float80_t
  */
 typedef npy_float32 __pyx_t_5numpy_float32_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":746
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":746
  * 
  * ctypedef npy_float32    float32_t
  * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_float80    float80_t
  * #ctypedef npy_float128   float128_t
  */
 typedef npy_float64 __pyx_t_5numpy_float64_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":755
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":755
  * # The int types are mapped a bit surprising --
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t
  */
 typedef npy_long __pyx_t_5numpy_int_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":756
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":756
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   longlong_t
  * 
  */
 typedef npy_longlong __pyx_t_5numpy_long_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":757
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":757
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_ulong      uint_t
  */
 typedef npy_longlong __pyx_t_5numpy_longlong_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":759
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":759
  * ctypedef npy_longlong   longlong_t
  * 
  * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t
  */
 typedef npy_ulong __pyx_t_5numpy_uint_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":760
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":760
  * 
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulong_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":761
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":761
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_intp       intp_t
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":763
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":763
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uintp      uintp_t
  * 
  */
 typedef npy_intp __pyx_t_5numpy_intp_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":764
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":764
  * 
  * ctypedef npy_intp       intp_t
  * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_double     float_t
  */
 typedef npy_uintp __pyx_t_5numpy_uintp_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":766
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":766
  * ctypedef npy_uintp      uintp_t
  * 
  * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t
  */
 typedef npy_double __pyx_t_5numpy_float_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":767
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":767
  * 
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longdouble longdouble_t
  * 
  */
 typedef npy_double __pyx_t_5numpy_double_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":768
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":768
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cfloat      cfloat_t
  */
 typedef npy_longdouble __pyx_t_5numpy_longdouble_t;
@@ -1994,42 +1978,42 @@
  *     or the provided default value if no such value was found.
  */
 struct __pyx_opt_args_7cpython_11contextvars_get_value_no_default {
   int __pyx_n;
   PyObject *default_value;
 };
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":770
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":770
  * ctypedef npy_longdouble longdouble_t
  * 
  * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t
  */
 typedef npy_cfloat __pyx_t_5numpy_cfloat_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":771
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":771
  * 
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
  * ctypedef npy_clongdouble clongdouble_t
  * 
  */
 typedef npy_cdouble __pyx_t_5numpy_cdouble_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":772
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":772
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cdouble     complex_t
  */
 typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":774
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":774
  * ctypedef npy_clongdouble clongdouble_t
  * 
  * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  */
 typedef npy_cdouble __pyx_t_5numpy_complex_t;
@@ -3082,30 +3066,30 @@
 
 /* SetupReduce.proto */
 #if !CYTHON_COMPILING_IN_LIMITED_API
 static int __Pyx_setup_reduce(PyObject* type_obj);
 #endif
 
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto_3_0_10
-#define __PYX_HAVE_RT_ImportType_proto_3_0_10
+#ifndef __PYX_HAVE_RT_ImportType_proto_3_0_8
+#define __PYX_HAVE_RT_ImportType_proto_3_0_8
 #if defined (__STDC_VERSION__) && __STDC_VERSION__ >= 201112L
 #include <stdalign.h>
 #endif
 #if (defined (__STDC_VERSION__) && __STDC_VERSION__ >= 201112L) || __cplusplus >= 201103L
-#define __PYX_GET_STRUCT_ALIGNMENT_3_0_10(s) alignof(s)
+#define __PYX_GET_STRUCT_ALIGNMENT_3_0_8(s) alignof(s)
 #else
-#define __PYX_GET_STRUCT_ALIGNMENT_3_0_10(s) sizeof(void*)
+#define __PYX_GET_STRUCT_ALIGNMENT_3_0_8(s) sizeof(void*)
 #endif
-enum __Pyx_ImportType_CheckSize_3_0_10 {
-   __Pyx_ImportType_CheckSize_Error_3_0_10 = 0,
-   __Pyx_ImportType_CheckSize_Warn_3_0_10 = 1,
-   __Pyx_ImportType_CheckSize_Ignore_3_0_10 = 2
+enum __Pyx_ImportType_CheckSize_3_0_8 {
+   __Pyx_ImportType_CheckSize_Error_3_0_8 = 0,
+   __Pyx_ImportType_CheckSize_Warn_3_0_8 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_3_0_8 = 2
 };
-static PyTypeObject *__Pyx_ImportType_3_0_10(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_10 check_size);
+static PyTypeObject *__Pyx_ImportType_3_0_8(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_8 check_size);
 #endif
 
 /* FetchSharedCythonModule.proto */
 static PyObject *__Pyx_FetchSharedCythonABIModule(void);
 
 /* FetchCommonType.proto */
 #if !CYTHON_USE_TYPE_SPECS
@@ -3964,14 +3948,16 @@
 static PyThread_type_lock __pyx_memoryview_thread_locks[8];
 static float __pyx_f_8kimimaro_14skeletontricks_edgeness(float, float, float, float, float, float); /*proto*/
 static float __pyx_f_8kimimaro_14skeletontricks_cornerness(float, float, float, float, float, float); /*proto*/
 static float __pyx_f_8kimimaro_14skeletontricks_distsq(float, float, float, float, float, float); /*proto*/
 static PyObject *__pyx_convert_vector_to_py_int32_t(std::vector<int32_t>  const &); /*proto*/
 static std::vector<int32_t>  __pyx_convert_vector_from_py_int32_t(PyObject *); /*proto*/
 static PyObject *__pyx_convert_unordered_map_to_py_uint64_t____float(std::unordered_map<uint64_t,float>  const &); /*proto*/
+static std::vector<uint64_t>  __pyx_convert_vector_from_py_uint64_t(PyObject *); /*proto*/
+static std::vector<float>  __pyx_convert_vector_from_py_float(PyObject *); /*proto*/
 static CYTHON_INLINE PyObject *__Pyx_carray_to_py_Py_ssize_t(Py_ssize_t *, Py_ssize_t); /*proto*/
 static CYTHON_INLINE PyObject *__Pyx_carray_to_tuple_Py_ssize_t(Py_ssize_t *, Py_ssize_t); /*proto*/
 static PyObject *__pyx_convert_pair_to_py_uint64_t____uint64_t(std::pair<uint64_t,uint64_t>  const &); /*proto*/
 static int __pyx_array_allocate_buffer(struct __pyx_array_obj *); /*proto*/
 static struct __pyx_array_obj *__pyx_array_new(PyObject *, Py_ssize_t, char *, char *, char *); /*proto*/
 static PyObject *__pyx_memoryview_new(PyObject *, int, int, __Pyx_TypeInfo *); /*proto*/
 static CYTHON_INLINE int __pyx_memoryview_check(PyObject *); /*proto*/
@@ -4075,16 +4061,16 @@
 static const char __pyx_k_wz[] = "wz";
 static const char __pyx_k_x0[] = "x0";
 static const char __pyx_k_y0[] = "y0";
 static const char __pyx_k_z0[] = "z0";
 static const char __pyx_k_DBF[] = "DBF";
 static const char __pyx_k__13[] = "()";
 static const char __pyx_k__14[] = "|";
-static const char __pyx_k__60[] = "_";
-static const char __pyx_k__71[] = "?";
+static const char __pyx_k__63[] = "_";
+static const char __pyx_k__74[] = "?";
 static const char __pyx_k_abc[] = "abc";
 static const char __pyx_k_add[] = "add";
 static const char __pyx_k_and[] = " and ";
 static const char __pyx_k_cts[] = "cts";
 static const char __pyx_k_daf[] = "daf";
 static const char __pyx_k_doc[] = "__doc__";
 static const char __pyx_k_get[] = "get";
@@ -4094,14 +4080,15 @@
 static const char __pyx_k_new[] = "__new__";
 static const char __pyx_k_obj[] = "obj";
 static const char __pyx_k_pop[] = "pop";
 static const char __pyx_k_pts[] = "pts";
 static const char __pyx_k_res[] = "res";
 static const char __pyx_k_sxy[] = "sxy";
 static const char __pyx_k_sys[] = "sys";
+static const char __pyx_k_vcg[] = "vcg";
 static const char __pyx_k_PDRF[] = "PDRF";
 static const char __pyx_k_args[] = "args";
 static const char __pyx_k_base[] = "base";
 static const char __pyx_k_dict[] = "__dict__";
 static const char __pyx_k_dist[] = "dist";
 static const char __pyx_k_edge[] = "edge";
 static const char __pyx_k_init[] = "__init__";
@@ -4202,20 +4189,23 @@
 static const char __pyx_k_int32_t[] = "int32_t";
 static const char __pyx_k_int64_t[] = "int64_t";
 static const char __pyx_k_labelct[] = "labelct";
 static const char __pyx_k_maximum[] = "maximum";
 static const char __pyx_k_maxpdrf[] = "maxpdrf";
 static const char __pyx_k_memview[] = "memview";
 static const char __pyx_k_minimum[] = "minimum";
+static const char __pyx_k_ndarray[] = "ndarray";
 static const char __pyx_k_parents[] = "parents";
 static const char __pyx_k_prepare[] = "__prepare__";
 static const char __pyx_k_uint8_t[] = "uint8_t";
+static const char __pyx_k_vcg_arr[] = "vcg_arr";
 static const char __pyx_k_visited[] = "visited";
 static const char __pyx_k_Ellipsis[] = "Ellipsis";
 static const char __pyx_k_Sequence[] = "Sequence";
+static const char __pyx_k_constant[] = "constant";
 static const char __pyx_k_daf_sort[] = "daf_sort";
 static const char __pyx_k_defaults[] = "defaults";
 static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_inf2zero[] = "inf2zero";
 static const char __pyx_k_itemsize[] = "itemsize";
 static const char __pyx_k_pathview[] = "pathview";
 static const char __pyx_k_pyx_type[] = "__pyx_type";
@@ -4276,14 +4266,15 @@
 static const char __pyx_k_mask_indices[] = "mask_indices";
 static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
 static const char __pyx_k_stringsource[] = "<stringsource>";
 static const char __pyx_k_unique_nodes[] = "unique_nodes";
 static const char __pyx_k_version_info[] = "version_info";
 static const char __pyx_k_class_getitem[] = "__class_getitem__";
 static const char __pyx_k_init_subclass[] = "__init_subclass__";
+static const char __pyx_k_max_distances[] = "max_distances";
 static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
 static const char __pyx_k_return_counts[] = "return_counts";
 static const char __pyx_k_unique_counts[] = "unique_counts";
 static const char __pyx_k_unravel_index[] = "unravel_index";
 static const char __pyx_k_unsigned_char[] = "unsigned char";
 static const char __pyx_k_AssertionError[] = "AssertionError";
 static const char __pyx_k_asfortranarray[] = "asfortranarray";
@@ -4364,26 +4355,27 @@
 static const char __pyx_k_uint64_t_unsigned_char[] = "uint64_t|unsigned char";
 static const char __pyx_k_unsigned_char_uint16_t[] = "unsigned char|uint16_t";
 static const char __pyx_k_unsigned_char_uint32_t[] = "unsigned char|uint32_t";
 static const char __pyx_k_unsigned_char_uint64_t[] = "unsigned char|uint64_t";
 static const char __pyx_k_MemoryView_of_r_at_0x_x[] = "<MemoryView of %r at 0x%x>";
 static const char __pyx_k_contiguous_and_indirect[] = "<contiguous and indirect>";
 static const char __pyx_k_kimimaro_skeletontricks[] = "kimimaro.skeletontricks";
+static const char __pyx_k_voxel_connectivity_graph[] = "voxel_connectivity_graph";
 static const char __pyx_k_CachedTargetFinder___init[] = "CachedTargetFinder.__init__";
 static const char __pyx_k_Dimension_d_is_not_direct[] = "Dimension %d is not direct";
 static const char __pyx_k_compute_tiebreaker_maxima[] = "compute_tiebreaker_maxima";
 static const char __pyx_k_Index_out_of_bounds_axis_d[] = "Index out of bounds (axis %d)";
 static const char __pyx_k_No_matching_signature_found[] = "No matching signature found";
 static const char __pyx_k_Step_may_not_be_zero_axis_d[] = "Step may not be zero (axis %d)";
 static const char __pyx_k_itemsize_0_for_cython_array[] = "itemsize <= 0 for cython.array";
 static const char __pyx_k_unsigned_char_unsigned_char[] = "unsigned char|unsigned char";
 static const char __pyx_k_unable_to_allocate_array_data[] = "unable to allocate array data.";
 static const char __pyx_k_CachedTargetFinder_find_target[] = "CachedTargetFinder.find_target";
 static const char __pyx_k_strided_and_direct_or_indirect[] = "<strided and direct or indirect>";
-static const char __pyx_k_Certain_operations_have_to_be_f[] = "\nCertain operations have to be fast for the skeletonization\nprocedure. The ones that didn't fit elsewhere have a home here.\n\nAuthor: William Silversmith\nAffiliation: Seung Lab, Princeton Neuroscience Institute\nDate: August 2018 - August 2021\n\n*****************************************************************\nThis file is part of Kimimaro.\n\nKimimaro is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nKimimaro is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with Kimimaro.  If not, see <https://www.gnu.org/licenses/>.\n*****************************************************************\n";
+static const char __pyx_k_Certain_operations_have_to_be_f[] = "\nCertain operations have to be fast for the skeletonization\nprocedure. The ones that didn't fit elsewhere have a home here.\n\nAuthor: William Silversmith\nAffiliation: Seung Lab, Princeton Neuroscience Institute\nDate: August 2018 - May 2024\n\n*****************************************************************\nThis file is part of Kimimaro.\n\nKimimaro is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nKimimaro is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with Kimimaro.  If not, see <https://www.gnu.org/licenses/>.\n*****************************************************************\n";
 static const char __pyx_k_extract_edges_from_binary_image[] = "extract_edges_from_binary_image";
 static const char __pyx_k_must_be_be_contained_within_sha[] = "<{},{},{}> must be be contained within shape <{},{},{}>";
 static const char __pyx_k_numpy_core_multiarray_failed_to[] = "numpy.core.multiarray failed to import";
 static const char __pyx_k_All_dimensions_preceding_dimensi[] = "All dimensions preceding dimension %d must be indexed and not sliced";
 static const char __pyx_k_Buffer_view_does_not_expose_stri[] = "Buffer view does not expose strides";
 static const char __pyx_k_CachedTargetFinder_first_label_i[] = "CachedTargetFinder.first_label_indexed";
 static const char __pyx_k_Can_only_create_a_buffer_that_is[] = "Can only create a buffer that is contiguous in memory.";
@@ -4398,14 +4390,15 @@
 static const char __pyx_k_Invalid_mode_expected_c_or_fortr[] = "Invalid mode, expected 'c' or 'fortran', got ";
 static const char __pyx_k_Out_of_bounds_on_buffer_access_a[] = "Out of bounds on buffer access (axis ";
 static const char __pyx_k_Unable_to_convert_item_to_object[] = "Unable to convert item to object";
 static const char __pyx_k_ext_skeletontricks_skeletontrick[] = "ext/skeletontricks/skeletontricks.pyx";
 static const char __pyx_k_got_differing_extents_in_dimensi[] = "got differing extents in dimension ";
 static const char __pyx_k_no_default___reduce___due_to_non[] = "no default __reduce__ due to non-trivial __cinit__";
 static const char __pyx_k_numpy_core_umath_failed_to_impor[] = "numpy.core.umath failed to import";
+static const char __pyx_k_roll_invalidation_ball_inside_co[] = "roll_invalidation_ball_inside_component";
 static const char __pyx_k_unable_to_allocate_shape_and_str[] = "unable to allocate shape and strides.";
 /* #### Code section: decls ### */
 static int __pyx_array___pyx_pf_15View_dot_MemoryView_5array___cinit__(struct __pyx_array_obj *__pyx_v_self, PyObject *__pyx_v_shape, Py_ssize_t __pyx_v_itemsize, PyObject *__pyx_v_format, PyObject *__pyx_v_mode, int __pyx_v_allocate_buffer); /* proto */
 static int __pyx_array___pyx_pf_15View_dot_MemoryView_5array_2__getbuffer__(struct __pyx_array_obj *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /* proto */
 static void __pyx_array___pyx_pf_15View_dot_MemoryView_5array_4__dealloc__(struct __pyx_array_obj *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_15View_dot_MemoryView_5array_7memview___get__(struct __pyx_array_obj *__pyx_v_self); /* proto */
 static Py_ssize_t __pyx_array___pyx_pf_15View_dot_MemoryView_5array_6__len__(struct __pyx_array_obj *__pyx_v_self); /* proto */
@@ -4448,31 +4441,31 @@
 static int __pyx_pf_7cpython_5array_5array___getbuffer__(arrayobject *__pyx_v_self, Py_buffer *__pyx_v_info, CYTHON_UNUSED int __pyx_v_flags); /* proto */
 static void __pyx_pf_7cpython_5array_5array_2__releasebuffer__(CYTHON_UNUSED arrayobject *__pyx_v_self, Py_buffer *__pyx_v_info); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_find_cycle(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_edges); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_2create_distance_graph(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_skeleton); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_4inf2zero(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_6zero2inf(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_8zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_36zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int8_t __pyx_v_leave_alone); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_38zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int16_t __pyx_v_leave_alone); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_40zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int32_t __pyx_v_leave_alone); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_42zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int64_t __pyx_v_leave_alone); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_44zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint8_t __pyx_v_leave_alone); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_46zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint16_t __pyx_v_leave_alone); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_48zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint32_t __pyx_v_leave_alone); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_50zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint64_t __pyx_v_leave_alone); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_52zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, unsigned char __pyx_v_leave_alone); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_38zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int8_t __pyx_v_leave_alone); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_40zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int16_t __pyx_v_leave_alone); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_42zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int32_t __pyx_v_leave_alone); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_44zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int64_t __pyx_v_leave_alone); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_46zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint8_t __pyx_v_leave_alone); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_48zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint16_t __pyx_v_leave_alone); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_50zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint32_t __pyx_v_leave_alone); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_52zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint64_t __pyx_v_leave_alone); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_54zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, unsigned char __pyx_v_leave_alone); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_10finite_max(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_12finite_min(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_14first_label(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_16find_target(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_PDRF); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_192__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_18roll_invalidation_ball(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, PyObject *__pyx_v_path, float __pyx_v_scale, float __pyx_v_const, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_invalid_vertices); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_20get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_56get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_18roll_invalidation_ball_inside_component(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, float __pyx_v_scale, float __pyx_v_constant, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_path, PyObject *__pyx_v_voxel_connectivity_graph, PyObject *__pyx_v_connectivity); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_194__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_20roll_invalidation_ball(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, PyObject *__pyx_v_path, float __pyx_v_scale, float __pyx_v_const, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_invalid_vertices); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_22get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_58get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_60get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_62get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_64get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_66get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_68get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_70get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
@@ -4509,44 +4502,45 @@
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_132get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_134get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_136get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_138get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_140get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_142get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_144get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_22compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_148compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_146get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_24compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_150compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_152compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_154compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_156compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_24find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_160find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_158compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_26find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_162find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_164find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_166find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_168find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_26compute_tiebreaker_maxima(CYTHON_UNUSED PyObject *__pyx_self, float __pyx_v_px, float __pyx_v_py, float __pyx_v_x, float __pyx_v_y, float __pyx_v_centx, float __pyx_v_centy, float __pyx_v_sx, float __pyx_v_sy, float __pyx_v_wx, float __pyx_v_wy); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_194__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_28roll_invalidation_cube(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, PyObject *__pyx_v_path, float __pyx_v_scale, float __pyx_v_const, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_invalid_vertices); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_30find_cycle_cython(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_edges); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_32find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_172find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int8_t __pyx_v_background); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_174find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int16_t __pyx_v_background); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_176find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int32_t __pyx_v_background); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_178find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int64_t __pyx_v_background); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_180find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint8_t __pyx_v_background); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_182find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint16_t __pyx_v_background); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_184find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint32_t __pyx_v_background); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_186find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint64_t __pyx_v_background); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_188find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, unsigned char __pyx_v_background); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_170find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_28compute_tiebreaker_maxima(CYTHON_UNUSED PyObject *__pyx_self, float __pyx_v_px, float __pyx_v_py, float __pyx_v_x, float __pyx_v_y, float __pyx_v_centx, float __pyx_v_centy, float __pyx_v_sx, float __pyx_v_sy, float __pyx_v_wx, float __pyx_v_wy); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_196__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_30roll_invalidation_cube(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, PyObject *__pyx_v_path, float __pyx_v_scale, float __pyx_v_const, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_invalid_vertices); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_32find_cycle_cython(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_edges); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_34find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_174find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int8_t __pyx_v_background); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_176find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int16_t __pyx_v_background); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_178find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int32_t __pyx_v_background); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_180find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int64_t __pyx_v_background); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_182find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint8_t __pyx_v_background); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_184find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint16_t __pyx_v_background); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_186find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint32_t __pyx_v_background); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_188find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint64_t __pyx_v_background); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_190find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, unsigned char __pyx_v_background); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_18CachedTargetFinder___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_mask, PyObject *__pyx_v_daf); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_18CachedTargetFinder_2find_target(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_mask); /* proto */
 static PyObject *__pyx_pf_8kimimaro_14skeletontricks_18CachedTargetFinder_4first_label_indexed(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, __Pyx_memviewslice __pyx_v_labels, __Pyx_memviewslice __pyx_v_indices); /* proto */
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_34extract_edges_from_binary_image(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_binimg, int __pyx_v_connectivity); /* proto */
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_36extract_edges_from_binary_image(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_binimg, int __pyx_v_connectivity); /* proto */
 static PyObject *__pyx_tp_new_array(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static __Pyx_CachedCFunction __pyx_umethod_PyDict_Type_get = {0, 0, 0, 0, 0};
 static __Pyx_CachedCFunction __pyx_umethod_PyDict_Type_values = {0, 0, 0, 0, 0};
 static __Pyx_CachedCFunction __pyx_umethod_PyList_Type_pop = {0, 0, 0, 0, 0};
@@ -4765,17 +4759,17 @@
   PyObject *__pyx_n_s_View_MemoryView;
   PyObject *__pyx_kp_s__13;
   PyObject *__pyx_kp_s__14;
   PyObject *__pyx_kp_u__14;
   PyObject *__pyx_kp_u__2;
   PyObject *__pyx_n_s__3;
   PyObject *__pyx_kp_u__6;
-  PyObject *__pyx_n_s__60;
+  PyObject *__pyx_n_s__63;
   PyObject *__pyx_kp_u__7;
-  PyObject *__pyx_n_s__71;
+  PyObject *__pyx_n_s__74;
   PyObject *__pyx_n_s_abc;
   PyObject *__pyx_n_s_add;
   PyObject *__pyx_n_s_allocate_buffer;
   PyObject *__pyx_n_s_allowed_differences;
   PyObject *__pyx_kp_u_and;
   PyObject *__pyx_n_s_anisotropy;
   PyObject *__pyx_n_s_append;
@@ -4804,14 +4798,15 @@
   PyObject *__pyx_n_s_cline_in_traceback;
   PyObject *__pyx_n_s_collections;
   PyObject *__pyx_kp_s_collections_abc;
   PyObject *__pyx_n_s_compute_centroids;
   PyObject *__pyx_n_s_compute_tiebreaker_maxima;
   PyObject *__pyx_n_s_connectivity;
   PyObject *__pyx_n_s_const;
+  PyObject *__pyx_n_s_constant;
   PyObject *__pyx_kp_s_contiguous_and_direct;
   PyObject *__pyx_kp_s_contiguous_and_indirect;
   PyObject *__pyx_n_s_coord;
   PyObject *__pyx_n_s_count;
   PyObject *__pyx_n_s_create_distance_graph;
   PyObject *__pyx_n_s_critical_points;
   PyObject *__pyx_n_s_cts;
@@ -4926,14 +4921,15 @@
   PyObject *__pyx_n_s_last_label;
   PyObject *__pyx_n_s_leave_alone;
   PyObject *__pyx_n_s_length;
   PyObject *__pyx_n_s_loc;
   PyObject *__pyx_n_s_main;
   PyObject *__pyx_n_s_mask;
   PyObject *__pyx_n_s_mask_indices;
+  PyObject *__pyx_n_s_max_distances;
   PyObject *__pyx_n_s_maximum;
   PyObject *__pyx_n_s_maxpdrf;
   PyObject *__pyx_n_s_maxx;
   PyObject *__pyx_n_s_maxy;
   PyObject *__pyx_n_s_maxz;
   PyObject *__pyx_n_s_memview;
   PyObject *__pyx_n_s_metaclass;
@@ -4945,14 +4941,15 @@
   PyObject *__pyx_n_s_module;
   PyObject *__pyx_kp_u_must_be_be_contained_within_sha;
   PyObject *__pyx_n_s_mx;
   PyObject *__pyx_n_s_my;
   PyObject *__pyx_n_s_mz;
   PyObject *__pyx_n_s_name;
   PyObject *__pyx_n_s_name_2;
+  PyObject *__pyx_n_s_ndarray;
   PyObject *__pyx_n_s_ndim;
   PyObject *__pyx_n_s_new;
   PyObject *__pyx_kp_s_no_default___reduce___due_to_non;
   PyObject *__pyx_n_s_node;
   PyObject *__pyx_n_s_np;
   PyObject *__pyx_kp_s_np_ndarray;
   PyObject *__pyx_n_s_numbering;
@@ -4990,14 +4987,15 @@
   PyObject *__pyx_n_s_reduce_ex;
   PyObject *__pyx_n_s_register;
   PyObject *__pyx_n_s_remap;
   PyObject *__pyx_n_s_res;
   PyObject *__pyx_n_s_result;
   PyObject *__pyx_n_s_return_counts;
   PyObject *__pyx_n_s_roll_invalidation_ball;
+  PyObject *__pyx_n_s_roll_invalidation_ball_inside_co;
   PyObject *__pyx_n_s_roll_invalidation_cube;
   PyObject *__pyx_n_s_root;
   PyObject *__pyx_n_s_s;
   PyObject *__pyx_n_s_scale;
   PyObject *__pyx_n_s_self;
   PyObject *__pyx_n_s_set_name;
   PyObject *__pyx_n_s_setstate;
@@ -5068,17 +5066,20 @@
   PyObject *__pyx_kp_s_unsigned_char_uint8_t;
   PyObject *__pyx_kp_s_unsigned_char_unsigned_char;
   PyObject *__pyx_n_s_update;
   PyObject *__pyx_n_s_v;
   PyObject *__pyx_n_s_v1;
   PyObject *__pyx_n_s_v2;
   PyObject *__pyx_n_s_values;
+  PyObject *__pyx_n_s_vcg;
+  PyObject *__pyx_n_s_vcg_arr;
   PyObject *__pyx_n_s_version_info;
   PyObject *__pyx_n_s_vertices;
   PyObject *__pyx_n_s_visited;
+  PyObject *__pyx_n_s_voxel_connectivity_graph;
   PyObject *__pyx_n_s_voxels;
   PyObject *__pyx_n_s_wx;
   PyObject *__pyx_n_s_wy;
   PyObject *__pyx_n_s_wz;
   PyObject *__pyx_n_s_x;
   PyObject *__pyx_n_s_x0;
   PyObject *__pyx_n_s_xsum;
@@ -5091,14 +5092,15 @@
   PyObject *__pyx_n_s_zero_out_all_except;
   PyObject *__pyx_n_s_zeros;
   PyObject *__pyx_int_0;
   PyObject *__pyx_int_1;
   PyObject *__pyx_int_2;
   PyObject *__pyx_int_3;
   PyObject *__pyx_int_4;
+  PyObject *__pyx_int_26;
   PyObject *__pyx_int_112105877;
   PyObject *__pyx_int_136983863;
   PyObject *__pyx_int_184977713;
   PyObject *__pyx_int_4294967295;
   PyObject *__pyx_int_neg_1;
   PyObject *__pyx_slice__5;
   PyObject *__pyx_tuple__4;
@@ -5126,46 +5128,49 @@
   PyObject *__pyx_tuple__36;
   PyObject *__pyx_tuple__38;
   PyObject *__pyx_tuple__40;
   PyObject *__pyx_tuple__42;
   PyObject *__pyx_tuple__44;
   PyObject *__pyx_tuple__46;
   PyObject *__pyx_tuple__48;
-  PyObject *__pyx_tuple__50;
-  PyObject *__pyx_tuple__52;
-  PyObject *__pyx_tuple__54;
-  PyObject *__pyx_tuple__56;
-  PyObject *__pyx_tuple__58;
+  PyObject *__pyx_tuple__49;
+  PyObject *__pyx_tuple__51;
+  PyObject *__pyx_tuple__53;
+  PyObject *__pyx_tuple__55;
+  PyObject *__pyx_tuple__57;
+  PyObject *__pyx_tuple__59;
   PyObject *__pyx_tuple__61;
-  PyObject *__pyx_tuple__63;
-  PyObject *__pyx_tuple__65;
-  PyObject *__pyx_tuple__67;
-  PyObject *__pyx_tuple__69;
+  PyObject *__pyx_tuple__64;
+  PyObject *__pyx_tuple__66;
+  PyObject *__pyx_tuple__68;
+  PyObject *__pyx_tuple__70;
+  PyObject *__pyx_tuple__72;
   PyObject *__pyx_codeobj__28;
   PyObject *__pyx_codeobj__30;
   PyObject *__pyx_codeobj__32;
   PyObject *__pyx_codeobj__34;
   PyObject *__pyx_codeobj__35;
   PyObject *__pyx_codeobj__37;
   PyObject *__pyx_codeobj__39;
   PyObject *__pyx_codeobj__41;
   PyObject *__pyx_codeobj__43;
   PyObject *__pyx_codeobj__45;
   PyObject *__pyx_codeobj__47;
-  PyObject *__pyx_codeobj__49;
-  PyObject *__pyx_codeobj__51;
-  PyObject *__pyx_codeobj__53;
-  PyObject *__pyx_codeobj__55;
-  PyObject *__pyx_codeobj__57;
-  PyObject *__pyx_codeobj__59;
+  PyObject *__pyx_codeobj__50;
+  PyObject *__pyx_codeobj__52;
+  PyObject *__pyx_codeobj__54;
+  PyObject *__pyx_codeobj__56;
+  PyObject *__pyx_codeobj__58;
+  PyObject *__pyx_codeobj__60;
   PyObject *__pyx_codeobj__62;
-  PyObject *__pyx_codeobj__64;
-  PyObject *__pyx_codeobj__66;
-  PyObject *__pyx_codeobj__68;
-  PyObject *__pyx_codeobj__70;
+  PyObject *__pyx_codeobj__65;
+  PyObject *__pyx_codeobj__67;
+  PyObject *__pyx_codeobj__69;
+  PyObject *__pyx_codeobj__71;
+  PyObject *__pyx_codeobj__73;
 } __pyx_mstate;
 
 #if CYTHON_USE_MODULE_STATE
 #ifdef __cplusplus
 namespace {
   extern struct PyModuleDef __pyx_moduledef;
 } /* anonymous namespace */
@@ -5275,17 +5280,17 @@
   Py_CLEAR(clear_module_state->__pyx_n_s_View_MemoryView);
   Py_CLEAR(clear_module_state->__pyx_kp_s__13);
   Py_CLEAR(clear_module_state->__pyx_kp_s__14);
   Py_CLEAR(clear_module_state->__pyx_kp_u__14);
   Py_CLEAR(clear_module_state->__pyx_kp_u__2);
   Py_CLEAR(clear_module_state->__pyx_n_s__3);
   Py_CLEAR(clear_module_state->__pyx_kp_u__6);
-  Py_CLEAR(clear_module_state->__pyx_n_s__60);
+  Py_CLEAR(clear_module_state->__pyx_n_s__63);
   Py_CLEAR(clear_module_state->__pyx_kp_u__7);
-  Py_CLEAR(clear_module_state->__pyx_n_s__71);
+  Py_CLEAR(clear_module_state->__pyx_n_s__74);
   Py_CLEAR(clear_module_state->__pyx_n_s_abc);
   Py_CLEAR(clear_module_state->__pyx_n_s_add);
   Py_CLEAR(clear_module_state->__pyx_n_s_allocate_buffer);
   Py_CLEAR(clear_module_state->__pyx_n_s_allowed_differences);
   Py_CLEAR(clear_module_state->__pyx_kp_u_and);
   Py_CLEAR(clear_module_state->__pyx_n_s_anisotropy);
   Py_CLEAR(clear_module_state->__pyx_n_s_append);
@@ -5314,14 +5319,15 @@
   Py_CLEAR(clear_module_state->__pyx_n_s_cline_in_traceback);
   Py_CLEAR(clear_module_state->__pyx_n_s_collections);
   Py_CLEAR(clear_module_state->__pyx_kp_s_collections_abc);
   Py_CLEAR(clear_module_state->__pyx_n_s_compute_centroids);
   Py_CLEAR(clear_module_state->__pyx_n_s_compute_tiebreaker_maxima);
   Py_CLEAR(clear_module_state->__pyx_n_s_connectivity);
   Py_CLEAR(clear_module_state->__pyx_n_s_const);
+  Py_CLEAR(clear_module_state->__pyx_n_s_constant);
   Py_CLEAR(clear_module_state->__pyx_kp_s_contiguous_and_direct);
   Py_CLEAR(clear_module_state->__pyx_kp_s_contiguous_and_indirect);
   Py_CLEAR(clear_module_state->__pyx_n_s_coord);
   Py_CLEAR(clear_module_state->__pyx_n_s_count);
   Py_CLEAR(clear_module_state->__pyx_n_s_create_distance_graph);
   Py_CLEAR(clear_module_state->__pyx_n_s_critical_points);
   Py_CLEAR(clear_module_state->__pyx_n_s_cts);
@@ -5436,14 +5442,15 @@
   Py_CLEAR(clear_module_state->__pyx_n_s_last_label);
   Py_CLEAR(clear_module_state->__pyx_n_s_leave_alone);
   Py_CLEAR(clear_module_state->__pyx_n_s_length);
   Py_CLEAR(clear_module_state->__pyx_n_s_loc);
   Py_CLEAR(clear_module_state->__pyx_n_s_main);
   Py_CLEAR(clear_module_state->__pyx_n_s_mask);
   Py_CLEAR(clear_module_state->__pyx_n_s_mask_indices);
+  Py_CLEAR(clear_module_state->__pyx_n_s_max_distances);
   Py_CLEAR(clear_module_state->__pyx_n_s_maximum);
   Py_CLEAR(clear_module_state->__pyx_n_s_maxpdrf);
   Py_CLEAR(clear_module_state->__pyx_n_s_maxx);
   Py_CLEAR(clear_module_state->__pyx_n_s_maxy);
   Py_CLEAR(clear_module_state->__pyx_n_s_maxz);
   Py_CLEAR(clear_module_state->__pyx_n_s_memview);
   Py_CLEAR(clear_module_state->__pyx_n_s_metaclass);
@@ -5455,14 +5462,15 @@
   Py_CLEAR(clear_module_state->__pyx_n_s_module);
   Py_CLEAR(clear_module_state->__pyx_kp_u_must_be_be_contained_within_sha);
   Py_CLEAR(clear_module_state->__pyx_n_s_mx);
   Py_CLEAR(clear_module_state->__pyx_n_s_my);
   Py_CLEAR(clear_module_state->__pyx_n_s_mz);
   Py_CLEAR(clear_module_state->__pyx_n_s_name);
   Py_CLEAR(clear_module_state->__pyx_n_s_name_2);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ndarray);
   Py_CLEAR(clear_module_state->__pyx_n_s_ndim);
   Py_CLEAR(clear_module_state->__pyx_n_s_new);
   Py_CLEAR(clear_module_state->__pyx_kp_s_no_default___reduce___due_to_non);
   Py_CLEAR(clear_module_state->__pyx_n_s_node);
   Py_CLEAR(clear_module_state->__pyx_n_s_np);
   Py_CLEAR(clear_module_state->__pyx_kp_s_np_ndarray);
   Py_CLEAR(clear_module_state->__pyx_n_s_numbering);
@@ -5500,14 +5508,15 @@
   Py_CLEAR(clear_module_state->__pyx_n_s_reduce_ex);
   Py_CLEAR(clear_module_state->__pyx_n_s_register);
   Py_CLEAR(clear_module_state->__pyx_n_s_remap);
   Py_CLEAR(clear_module_state->__pyx_n_s_res);
   Py_CLEAR(clear_module_state->__pyx_n_s_result);
   Py_CLEAR(clear_module_state->__pyx_n_s_return_counts);
   Py_CLEAR(clear_module_state->__pyx_n_s_roll_invalidation_ball);
+  Py_CLEAR(clear_module_state->__pyx_n_s_roll_invalidation_ball_inside_co);
   Py_CLEAR(clear_module_state->__pyx_n_s_roll_invalidation_cube);
   Py_CLEAR(clear_module_state->__pyx_n_s_root);
   Py_CLEAR(clear_module_state->__pyx_n_s_s);
   Py_CLEAR(clear_module_state->__pyx_n_s_scale);
   Py_CLEAR(clear_module_state->__pyx_n_s_self);
   Py_CLEAR(clear_module_state->__pyx_n_s_set_name);
   Py_CLEAR(clear_module_state->__pyx_n_s_setstate);
@@ -5578,17 +5587,20 @@
   Py_CLEAR(clear_module_state->__pyx_kp_s_unsigned_char_uint8_t);
   Py_CLEAR(clear_module_state->__pyx_kp_s_unsigned_char_unsigned_char);
   Py_CLEAR(clear_module_state->__pyx_n_s_update);
   Py_CLEAR(clear_module_state->__pyx_n_s_v);
   Py_CLEAR(clear_module_state->__pyx_n_s_v1);
   Py_CLEAR(clear_module_state->__pyx_n_s_v2);
   Py_CLEAR(clear_module_state->__pyx_n_s_values);
+  Py_CLEAR(clear_module_state->__pyx_n_s_vcg);
+  Py_CLEAR(clear_module_state->__pyx_n_s_vcg_arr);
   Py_CLEAR(clear_module_state->__pyx_n_s_version_info);
   Py_CLEAR(clear_module_state->__pyx_n_s_vertices);
   Py_CLEAR(clear_module_state->__pyx_n_s_visited);
+  Py_CLEAR(clear_module_state->__pyx_n_s_voxel_connectivity_graph);
   Py_CLEAR(clear_module_state->__pyx_n_s_voxels);
   Py_CLEAR(clear_module_state->__pyx_n_s_wx);
   Py_CLEAR(clear_module_state->__pyx_n_s_wy);
   Py_CLEAR(clear_module_state->__pyx_n_s_wz);
   Py_CLEAR(clear_module_state->__pyx_n_s_x);
   Py_CLEAR(clear_module_state->__pyx_n_s_x0);
   Py_CLEAR(clear_module_state->__pyx_n_s_xsum);
@@ -5601,14 +5613,15 @@
   Py_CLEAR(clear_module_state->__pyx_n_s_zero_out_all_except);
   Py_CLEAR(clear_module_state->__pyx_n_s_zeros);
   Py_CLEAR(clear_module_state->__pyx_int_0);
   Py_CLEAR(clear_module_state->__pyx_int_1);
   Py_CLEAR(clear_module_state->__pyx_int_2);
   Py_CLEAR(clear_module_state->__pyx_int_3);
   Py_CLEAR(clear_module_state->__pyx_int_4);
+  Py_CLEAR(clear_module_state->__pyx_int_26);
   Py_CLEAR(clear_module_state->__pyx_int_112105877);
   Py_CLEAR(clear_module_state->__pyx_int_136983863);
   Py_CLEAR(clear_module_state->__pyx_int_184977713);
   Py_CLEAR(clear_module_state->__pyx_int_4294967295);
   Py_CLEAR(clear_module_state->__pyx_int_neg_1);
   Py_CLEAR(clear_module_state->__pyx_slice__5);
   Py_CLEAR(clear_module_state->__pyx_tuple__4);
@@ -5636,46 +5649,49 @@
   Py_CLEAR(clear_module_state->__pyx_tuple__36);
   Py_CLEAR(clear_module_state->__pyx_tuple__38);
   Py_CLEAR(clear_module_state->__pyx_tuple__40);
   Py_CLEAR(clear_module_state->__pyx_tuple__42);
   Py_CLEAR(clear_module_state->__pyx_tuple__44);
   Py_CLEAR(clear_module_state->__pyx_tuple__46);
   Py_CLEAR(clear_module_state->__pyx_tuple__48);
-  Py_CLEAR(clear_module_state->__pyx_tuple__50);
-  Py_CLEAR(clear_module_state->__pyx_tuple__52);
-  Py_CLEAR(clear_module_state->__pyx_tuple__54);
-  Py_CLEAR(clear_module_state->__pyx_tuple__56);
-  Py_CLEAR(clear_module_state->__pyx_tuple__58);
+  Py_CLEAR(clear_module_state->__pyx_tuple__49);
+  Py_CLEAR(clear_module_state->__pyx_tuple__51);
+  Py_CLEAR(clear_module_state->__pyx_tuple__53);
+  Py_CLEAR(clear_module_state->__pyx_tuple__55);
+  Py_CLEAR(clear_module_state->__pyx_tuple__57);
+  Py_CLEAR(clear_module_state->__pyx_tuple__59);
   Py_CLEAR(clear_module_state->__pyx_tuple__61);
-  Py_CLEAR(clear_module_state->__pyx_tuple__63);
-  Py_CLEAR(clear_module_state->__pyx_tuple__65);
-  Py_CLEAR(clear_module_state->__pyx_tuple__67);
-  Py_CLEAR(clear_module_state->__pyx_tuple__69);
+  Py_CLEAR(clear_module_state->__pyx_tuple__64);
+  Py_CLEAR(clear_module_state->__pyx_tuple__66);
+  Py_CLEAR(clear_module_state->__pyx_tuple__68);
+  Py_CLEAR(clear_module_state->__pyx_tuple__70);
+  Py_CLEAR(clear_module_state->__pyx_tuple__72);
   Py_CLEAR(clear_module_state->__pyx_codeobj__28);
   Py_CLEAR(clear_module_state->__pyx_codeobj__30);
   Py_CLEAR(clear_module_state->__pyx_codeobj__32);
   Py_CLEAR(clear_module_state->__pyx_codeobj__34);
   Py_CLEAR(clear_module_state->__pyx_codeobj__35);
   Py_CLEAR(clear_module_state->__pyx_codeobj__37);
   Py_CLEAR(clear_module_state->__pyx_codeobj__39);
   Py_CLEAR(clear_module_state->__pyx_codeobj__41);
   Py_CLEAR(clear_module_state->__pyx_codeobj__43);
   Py_CLEAR(clear_module_state->__pyx_codeobj__45);
   Py_CLEAR(clear_module_state->__pyx_codeobj__47);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__49);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__51);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__53);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__55);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__57);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__59);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__50);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__52);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__54);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__56);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__58);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__60);
   Py_CLEAR(clear_module_state->__pyx_codeobj__62);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__64);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__66);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__68);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__70);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__65);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__67);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__69);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__71);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__73);
   return 0;
 }
 #endif
 /* #### Code section: module_state_traverse ### */
 #if CYTHON_USE_MODULE_STATE
 static int __pyx_m_traverse(PyObject *m, visitproc visit, void *arg) {
   __pyx_mstate *traverse_module_state = __pyx_mstate(m);
@@ -5763,17 +5779,17 @@
   Py_VISIT(traverse_module_state->__pyx_n_s_View_MemoryView);
   Py_VISIT(traverse_module_state->__pyx_kp_s__13);
   Py_VISIT(traverse_module_state->__pyx_kp_s__14);
   Py_VISIT(traverse_module_state->__pyx_kp_u__14);
   Py_VISIT(traverse_module_state->__pyx_kp_u__2);
   Py_VISIT(traverse_module_state->__pyx_n_s__3);
   Py_VISIT(traverse_module_state->__pyx_kp_u__6);
-  Py_VISIT(traverse_module_state->__pyx_n_s__60);
+  Py_VISIT(traverse_module_state->__pyx_n_s__63);
   Py_VISIT(traverse_module_state->__pyx_kp_u__7);
-  Py_VISIT(traverse_module_state->__pyx_n_s__71);
+  Py_VISIT(traverse_module_state->__pyx_n_s__74);
   Py_VISIT(traverse_module_state->__pyx_n_s_abc);
   Py_VISIT(traverse_module_state->__pyx_n_s_add);
   Py_VISIT(traverse_module_state->__pyx_n_s_allocate_buffer);
   Py_VISIT(traverse_module_state->__pyx_n_s_allowed_differences);
   Py_VISIT(traverse_module_state->__pyx_kp_u_and);
   Py_VISIT(traverse_module_state->__pyx_n_s_anisotropy);
   Py_VISIT(traverse_module_state->__pyx_n_s_append);
@@ -5802,14 +5818,15 @@
   Py_VISIT(traverse_module_state->__pyx_n_s_cline_in_traceback);
   Py_VISIT(traverse_module_state->__pyx_n_s_collections);
   Py_VISIT(traverse_module_state->__pyx_kp_s_collections_abc);
   Py_VISIT(traverse_module_state->__pyx_n_s_compute_centroids);
   Py_VISIT(traverse_module_state->__pyx_n_s_compute_tiebreaker_maxima);
   Py_VISIT(traverse_module_state->__pyx_n_s_connectivity);
   Py_VISIT(traverse_module_state->__pyx_n_s_const);
+  Py_VISIT(traverse_module_state->__pyx_n_s_constant);
   Py_VISIT(traverse_module_state->__pyx_kp_s_contiguous_and_direct);
   Py_VISIT(traverse_module_state->__pyx_kp_s_contiguous_and_indirect);
   Py_VISIT(traverse_module_state->__pyx_n_s_coord);
   Py_VISIT(traverse_module_state->__pyx_n_s_count);
   Py_VISIT(traverse_module_state->__pyx_n_s_create_distance_graph);
   Py_VISIT(traverse_module_state->__pyx_n_s_critical_points);
   Py_VISIT(traverse_module_state->__pyx_n_s_cts);
@@ -5924,14 +5941,15 @@
   Py_VISIT(traverse_module_state->__pyx_n_s_last_label);
   Py_VISIT(traverse_module_state->__pyx_n_s_leave_alone);
   Py_VISIT(traverse_module_state->__pyx_n_s_length);
   Py_VISIT(traverse_module_state->__pyx_n_s_loc);
   Py_VISIT(traverse_module_state->__pyx_n_s_main);
   Py_VISIT(traverse_module_state->__pyx_n_s_mask);
   Py_VISIT(traverse_module_state->__pyx_n_s_mask_indices);
+  Py_VISIT(traverse_module_state->__pyx_n_s_max_distances);
   Py_VISIT(traverse_module_state->__pyx_n_s_maximum);
   Py_VISIT(traverse_module_state->__pyx_n_s_maxpdrf);
   Py_VISIT(traverse_module_state->__pyx_n_s_maxx);
   Py_VISIT(traverse_module_state->__pyx_n_s_maxy);
   Py_VISIT(traverse_module_state->__pyx_n_s_maxz);
   Py_VISIT(traverse_module_state->__pyx_n_s_memview);
   Py_VISIT(traverse_module_state->__pyx_n_s_metaclass);
@@ -5943,14 +5961,15 @@
   Py_VISIT(traverse_module_state->__pyx_n_s_module);
   Py_VISIT(traverse_module_state->__pyx_kp_u_must_be_be_contained_within_sha);
   Py_VISIT(traverse_module_state->__pyx_n_s_mx);
   Py_VISIT(traverse_module_state->__pyx_n_s_my);
   Py_VISIT(traverse_module_state->__pyx_n_s_mz);
   Py_VISIT(traverse_module_state->__pyx_n_s_name);
   Py_VISIT(traverse_module_state->__pyx_n_s_name_2);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ndarray);
   Py_VISIT(traverse_module_state->__pyx_n_s_ndim);
   Py_VISIT(traverse_module_state->__pyx_n_s_new);
   Py_VISIT(traverse_module_state->__pyx_kp_s_no_default___reduce___due_to_non);
   Py_VISIT(traverse_module_state->__pyx_n_s_node);
   Py_VISIT(traverse_module_state->__pyx_n_s_np);
   Py_VISIT(traverse_module_state->__pyx_kp_s_np_ndarray);
   Py_VISIT(traverse_module_state->__pyx_n_s_numbering);
@@ -5988,14 +6007,15 @@
   Py_VISIT(traverse_module_state->__pyx_n_s_reduce_ex);
   Py_VISIT(traverse_module_state->__pyx_n_s_register);
   Py_VISIT(traverse_module_state->__pyx_n_s_remap);
   Py_VISIT(traverse_module_state->__pyx_n_s_res);
   Py_VISIT(traverse_module_state->__pyx_n_s_result);
   Py_VISIT(traverse_module_state->__pyx_n_s_return_counts);
   Py_VISIT(traverse_module_state->__pyx_n_s_roll_invalidation_ball);
+  Py_VISIT(traverse_module_state->__pyx_n_s_roll_invalidation_ball_inside_co);
   Py_VISIT(traverse_module_state->__pyx_n_s_roll_invalidation_cube);
   Py_VISIT(traverse_module_state->__pyx_n_s_root);
   Py_VISIT(traverse_module_state->__pyx_n_s_s);
   Py_VISIT(traverse_module_state->__pyx_n_s_scale);
   Py_VISIT(traverse_module_state->__pyx_n_s_self);
   Py_VISIT(traverse_module_state->__pyx_n_s_set_name);
   Py_VISIT(traverse_module_state->__pyx_n_s_setstate);
@@ -6066,17 +6086,20 @@
   Py_VISIT(traverse_module_state->__pyx_kp_s_unsigned_char_uint8_t);
   Py_VISIT(traverse_module_state->__pyx_kp_s_unsigned_char_unsigned_char);
   Py_VISIT(traverse_module_state->__pyx_n_s_update);
   Py_VISIT(traverse_module_state->__pyx_n_s_v);
   Py_VISIT(traverse_module_state->__pyx_n_s_v1);
   Py_VISIT(traverse_module_state->__pyx_n_s_v2);
   Py_VISIT(traverse_module_state->__pyx_n_s_values);
+  Py_VISIT(traverse_module_state->__pyx_n_s_vcg);
+  Py_VISIT(traverse_module_state->__pyx_n_s_vcg_arr);
   Py_VISIT(traverse_module_state->__pyx_n_s_version_info);
   Py_VISIT(traverse_module_state->__pyx_n_s_vertices);
   Py_VISIT(traverse_module_state->__pyx_n_s_visited);
+  Py_VISIT(traverse_module_state->__pyx_n_s_voxel_connectivity_graph);
   Py_VISIT(traverse_module_state->__pyx_n_s_voxels);
   Py_VISIT(traverse_module_state->__pyx_n_s_wx);
   Py_VISIT(traverse_module_state->__pyx_n_s_wy);
   Py_VISIT(traverse_module_state->__pyx_n_s_wz);
   Py_VISIT(traverse_module_state->__pyx_n_s_x);
   Py_VISIT(traverse_module_state->__pyx_n_s_x0);
   Py_VISIT(traverse_module_state->__pyx_n_s_xsum);
@@ -6089,14 +6112,15 @@
   Py_VISIT(traverse_module_state->__pyx_n_s_zero_out_all_except);
   Py_VISIT(traverse_module_state->__pyx_n_s_zeros);
   Py_VISIT(traverse_module_state->__pyx_int_0);
   Py_VISIT(traverse_module_state->__pyx_int_1);
   Py_VISIT(traverse_module_state->__pyx_int_2);
   Py_VISIT(traverse_module_state->__pyx_int_3);
   Py_VISIT(traverse_module_state->__pyx_int_4);
+  Py_VISIT(traverse_module_state->__pyx_int_26);
   Py_VISIT(traverse_module_state->__pyx_int_112105877);
   Py_VISIT(traverse_module_state->__pyx_int_136983863);
   Py_VISIT(traverse_module_state->__pyx_int_184977713);
   Py_VISIT(traverse_module_state->__pyx_int_4294967295);
   Py_VISIT(traverse_module_state->__pyx_int_neg_1);
   Py_VISIT(traverse_module_state->__pyx_slice__5);
   Py_VISIT(traverse_module_state->__pyx_tuple__4);
@@ -6124,46 +6148,49 @@
   Py_VISIT(traverse_module_state->__pyx_tuple__36);
   Py_VISIT(traverse_module_state->__pyx_tuple__38);
   Py_VISIT(traverse_module_state->__pyx_tuple__40);
   Py_VISIT(traverse_module_state->__pyx_tuple__42);
   Py_VISIT(traverse_module_state->__pyx_tuple__44);
   Py_VISIT(traverse_module_state->__pyx_tuple__46);
   Py_VISIT(traverse_module_state->__pyx_tuple__48);
-  Py_VISIT(traverse_module_state->__pyx_tuple__50);
-  Py_VISIT(traverse_module_state->__pyx_tuple__52);
-  Py_VISIT(traverse_module_state->__pyx_tuple__54);
-  Py_VISIT(traverse_module_state->__pyx_tuple__56);
-  Py_VISIT(traverse_module_state->__pyx_tuple__58);
+  Py_VISIT(traverse_module_state->__pyx_tuple__49);
+  Py_VISIT(traverse_module_state->__pyx_tuple__51);
+  Py_VISIT(traverse_module_state->__pyx_tuple__53);
+  Py_VISIT(traverse_module_state->__pyx_tuple__55);
+  Py_VISIT(traverse_module_state->__pyx_tuple__57);
+  Py_VISIT(traverse_module_state->__pyx_tuple__59);
   Py_VISIT(traverse_module_state->__pyx_tuple__61);
-  Py_VISIT(traverse_module_state->__pyx_tuple__63);
-  Py_VISIT(traverse_module_state->__pyx_tuple__65);
-  Py_VISIT(traverse_module_state->__pyx_tuple__67);
-  Py_VISIT(traverse_module_state->__pyx_tuple__69);
+  Py_VISIT(traverse_module_state->__pyx_tuple__64);
+  Py_VISIT(traverse_module_state->__pyx_tuple__66);
+  Py_VISIT(traverse_module_state->__pyx_tuple__68);
+  Py_VISIT(traverse_module_state->__pyx_tuple__70);
+  Py_VISIT(traverse_module_state->__pyx_tuple__72);
   Py_VISIT(traverse_module_state->__pyx_codeobj__28);
   Py_VISIT(traverse_module_state->__pyx_codeobj__30);
   Py_VISIT(traverse_module_state->__pyx_codeobj__32);
   Py_VISIT(traverse_module_state->__pyx_codeobj__34);
   Py_VISIT(traverse_module_state->__pyx_codeobj__35);
   Py_VISIT(traverse_module_state->__pyx_codeobj__37);
   Py_VISIT(traverse_module_state->__pyx_codeobj__39);
   Py_VISIT(traverse_module_state->__pyx_codeobj__41);
   Py_VISIT(traverse_module_state->__pyx_codeobj__43);
   Py_VISIT(traverse_module_state->__pyx_codeobj__45);
   Py_VISIT(traverse_module_state->__pyx_codeobj__47);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__49);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__51);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__53);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__55);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__57);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__59);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__50);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__52);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__54);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__56);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__58);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__60);
   Py_VISIT(traverse_module_state->__pyx_codeobj__62);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__64);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__66);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__68);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__70);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__65);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__67);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__69);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__71);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__73);
   return 0;
 }
 #endif
 /* #### Code section: module_state_defines ### */
 #define __pyx_d __pyx_mstate_global->__pyx_d
 #define __pyx_b __pyx_mstate_global->__pyx_b
 #define __pyx_cython_runtime __pyx_mstate_global->__pyx_cython_runtime
@@ -6375,17 +6402,17 @@
 #define __pyx_n_s_View_MemoryView __pyx_mstate_global->__pyx_n_s_View_MemoryView
 #define __pyx_kp_s__13 __pyx_mstate_global->__pyx_kp_s__13
 #define __pyx_kp_s__14 __pyx_mstate_global->__pyx_kp_s__14
 #define __pyx_kp_u__14 __pyx_mstate_global->__pyx_kp_u__14
 #define __pyx_kp_u__2 __pyx_mstate_global->__pyx_kp_u__2
 #define __pyx_n_s__3 __pyx_mstate_global->__pyx_n_s__3
 #define __pyx_kp_u__6 __pyx_mstate_global->__pyx_kp_u__6
-#define __pyx_n_s__60 __pyx_mstate_global->__pyx_n_s__60
+#define __pyx_n_s__63 __pyx_mstate_global->__pyx_n_s__63
 #define __pyx_kp_u__7 __pyx_mstate_global->__pyx_kp_u__7
-#define __pyx_n_s__71 __pyx_mstate_global->__pyx_n_s__71
+#define __pyx_n_s__74 __pyx_mstate_global->__pyx_n_s__74
 #define __pyx_n_s_abc __pyx_mstate_global->__pyx_n_s_abc
 #define __pyx_n_s_add __pyx_mstate_global->__pyx_n_s_add
 #define __pyx_n_s_allocate_buffer __pyx_mstate_global->__pyx_n_s_allocate_buffer
 #define __pyx_n_s_allowed_differences __pyx_mstate_global->__pyx_n_s_allowed_differences
 #define __pyx_kp_u_and __pyx_mstate_global->__pyx_kp_u_and
 #define __pyx_n_s_anisotropy __pyx_mstate_global->__pyx_n_s_anisotropy
 #define __pyx_n_s_append __pyx_mstate_global->__pyx_n_s_append
@@ -6414,14 +6441,15 @@
 #define __pyx_n_s_cline_in_traceback __pyx_mstate_global->__pyx_n_s_cline_in_traceback
 #define __pyx_n_s_collections __pyx_mstate_global->__pyx_n_s_collections
 #define __pyx_kp_s_collections_abc __pyx_mstate_global->__pyx_kp_s_collections_abc
 #define __pyx_n_s_compute_centroids __pyx_mstate_global->__pyx_n_s_compute_centroids
 #define __pyx_n_s_compute_tiebreaker_maxima __pyx_mstate_global->__pyx_n_s_compute_tiebreaker_maxima
 #define __pyx_n_s_connectivity __pyx_mstate_global->__pyx_n_s_connectivity
 #define __pyx_n_s_const __pyx_mstate_global->__pyx_n_s_const
+#define __pyx_n_s_constant __pyx_mstate_global->__pyx_n_s_constant
 #define __pyx_kp_s_contiguous_and_direct __pyx_mstate_global->__pyx_kp_s_contiguous_and_direct
 #define __pyx_kp_s_contiguous_and_indirect __pyx_mstate_global->__pyx_kp_s_contiguous_and_indirect
 #define __pyx_n_s_coord __pyx_mstate_global->__pyx_n_s_coord
 #define __pyx_n_s_count __pyx_mstate_global->__pyx_n_s_count
 #define __pyx_n_s_create_distance_graph __pyx_mstate_global->__pyx_n_s_create_distance_graph
 #define __pyx_n_s_critical_points __pyx_mstate_global->__pyx_n_s_critical_points
 #define __pyx_n_s_cts __pyx_mstate_global->__pyx_n_s_cts
@@ -6536,14 +6564,15 @@
 #define __pyx_n_s_last_label __pyx_mstate_global->__pyx_n_s_last_label
 #define __pyx_n_s_leave_alone __pyx_mstate_global->__pyx_n_s_leave_alone
 #define __pyx_n_s_length __pyx_mstate_global->__pyx_n_s_length
 #define __pyx_n_s_loc __pyx_mstate_global->__pyx_n_s_loc
 #define __pyx_n_s_main __pyx_mstate_global->__pyx_n_s_main
 #define __pyx_n_s_mask __pyx_mstate_global->__pyx_n_s_mask
 #define __pyx_n_s_mask_indices __pyx_mstate_global->__pyx_n_s_mask_indices
+#define __pyx_n_s_max_distances __pyx_mstate_global->__pyx_n_s_max_distances
 #define __pyx_n_s_maximum __pyx_mstate_global->__pyx_n_s_maximum
 #define __pyx_n_s_maxpdrf __pyx_mstate_global->__pyx_n_s_maxpdrf
 #define __pyx_n_s_maxx __pyx_mstate_global->__pyx_n_s_maxx
 #define __pyx_n_s_maxy __pyx_mstate_global->__pyx_n_s_maxy
 #define __pyx_n_s_maxz __pyx_mstate_global->__pyx_n_s_maxz
 #define __pyx_n_s_memview __pyx_mstate_global->__pyx_n_s_memview
 #define __pyx_n_s_metaclass __pyx_mstate_global->__pyx_n_s_metaclass
@@ -6555,14 +6584,15 @@
 #define __pyx_n_s_module __pyx_mstate_global->__pyx_n_s_module
 #define __pyx_kp_u_must_be_be_contained_within_sha __pyx_mstate_global->__pyx_kp_u_must_be_be_contained_within_sha
 #define __pyx_n_s_mx __pyx_mstate_global->__pyx_n_s_mx
 #define __pyx_n_s_my __pyx_mstate_global->__pyx_n_s_my
 #define __pyx_n_s_mz __pyx_mstate_global->__pyx_n_s_mz
 #define __pyx_n_s_name __pyx_mstate_global->__pyx_n_s_name
 #define __pyx_n_s_name_2 __pyx_mstate_global->__pyx_n_s_name_2
+#define __pyx_n_s_ndarray __pyx_mstate_global->__pyx_n_s_ndarray
 #define __pyx_n_s_ndim __pyx_mstate_global->__pyx_n_s_ndim
 #define __pyx_n_s_new __pyx_mstate_global->__pyx_n_s_new
 #define __pyx_kp_s_no_default___reduce___due_to_non __pyx_mstate_global->__pyx_kp_s_no_default___reduce___due_to_non
 #define __pyx_n_s_node __pyx_mstate_global->__pyx_n_s_node
 #define __pyx_n_s_np __pyx_mstate_global->__pyx_n_s_np
 #define __pyx_kp_s_np_ndarray __pyx_mstate_global->__pyx_kp_s_np_ndarray
 #define __pyx_n_s_numbering __pyx_mstate_global->__pyx_n_s_numbering
@@ -6600,14 +6630,15 @@
 #define __pyx_n_s_reduce_ex __pyx_mstate_global->__pyx_n_s_reduce_ex
 #define __pyx_n_s_register __pyx_mstate_global->__pyx_n_s_register
 #define __pyx_n_s_remap __pyx_mstate_global->__pyx_n_s_remap
 #define __pyx_n_s_res __pyx_mstate_global->__pyx_n_s_res
 #define __pyx_n_s_result __pyx_mstate_global->__pyx_n_s_result
 #define __pyx_n_s_return_counts __pyx_mstate_global->__pyx_n_s_return_counts
 #define __pyx_n_s_roll_invalidation_ball __pyx_mstate_global->__pyx_n_s_roll_invalidation_ball
+#define __pyx_n_s_roll_invalidation_ball_inside_co __pyx_mstate_global->__pyx_n_s_roll_invalidation_ball_inside_co
 #define __pyx_n_s_roll_invalidation_cube __pyx_mstate_global->__pyx_n_s_roll_invalidation_cube
 #define __pyx_n_s_root __pyx_mstate_global->__pyx_n_s_root
 #define __pyx_n_s_s __pyx_mstate_global->__pyx_n_s_s
 #define __pyx_n_s_scale __pyx_mstate_global->__pyx_n_s_scale
 #define __pyx_n_s_self __pyx_mstate_global->__pyx_n_s_self
 #define __pyx_n_s_set_name __pyx_mstate_global->__pyx_n_s_set_name
 #define __pyx_n_s_setstate __pyx_mstate_global->__pyx_n_s_setstate
@@ -6678,17 +6709,20 @@
 #define __pyx_kp_s_unsigned_char_uint8_t __pyx_mstate_global->__pyx_kp_s_unsigned_char_uint8_t
 #define __pyx_kp_s_unsigned_char_unsigned_char __pyx_mstate_global->__pyx_kp_s_unsigned_char_unsigned_char
 #define __pyx_n_s_update __pyx_mstate_global->__pyx_n_s_update
 #define __pyx_n_s_v __pyx_mstate_global->__pyx_n_s_v
 #define __pyx_n_s_v1 __pyx_mstate_global->__pyx_n_s_v1
 #define __pyx_n_s_v2 __pyx_mstate_global->__pyx_n_s_v2
 #define __pyx_n_s_values __pyx_mstate_global->__pyx_n_s_values
+#define __pyx_n_s_vcg __pyx_mstate_global->__pyx_n_s_vcg
+#define __pyx_n_s_vcg_arr __pyx_mstate_global->__pyx_n_s_vcg_arr
 #define __pyx_n_s_version_info __pyx_mstate_global->__pyx_n_s_version_info
 #define __pyx_n_s_vertices __pyx_mstate_global->__pyx_n_s_vertices
 #define __pyx_n_s_visited __pyx_mstate_global->__pyx_n_s_visited
+#define __pyx_n_s_voxel_connectivity_graph __pyx_mstate_global->__pyx_n_s_voxel_connectivity_graph
 #define __pyx_n_s_voxels __pyx_mstate_global->__pyx_n_s_voxels
 #define __pyx_n_s_wx __pyx_mstate_global->__pyx_n_s_wx
 #define __pyx_n_s_wy __pyx_mstate_global->__pyx_n_s_wy
 #define __pyx_n_s_wz __pyx_mstate_global->__pyx_n_s_wz
 #define __pyx_n_s_x __pyx_mstate_global->__pyx_n_s_x
 #define __pyx_n_s_x0 __pyx_mstate_global->__pyx_n_s_x0
 #define __pyx_n_s_xsum __pyx_mstate_global->__pyx_n_s_xsum
@@ -6701,14 +6735,15 @@
 #define __pyx_n_s_zero_out_all_except __pyx_mstate_global->__pyx_n_s_zero_out_all_except
 #define __pyx_n_s_zeros __pyx_mstate_global->__pyx_n_s_zeros
 #define __pyx_int_0 __pyx_mstate_global->__pyx_int_0
 #define __pyx_int_1 __pyx_mstate_global->__pyx_int_1
 #define __pyx_int_2 __pyx_mstate_global->__pyx_int_2
 #define __pyx_int_3 __pyx_mstate_global->__pyx_int_3
 #define __pyx_int_4 __pyx_mstate_global->__pyx_int_4
+#define __pyx_int_26 __pyx_mstate_global->__pyx_int_26
 #define __pyx_int_112105877 __pyx_mstate_global->__pyx_int_112105877
 #define __pyx_int_136983863 __pyx_mstate_global->__pyx_int_136983863
 #define __pyx_int_184977713 __pyx_mstate_global->__pyx_int_184977713
 #define __pyx_int_4294967295 __pyx_mstate_global->__pyx_int_4294967295
 #define __pyx_int_neg_1 __pyx_mstate_global->__pyx_int_neg_1
 #define __pyx_slice__5 __pyx_mstate_global->__pyx_slice__5
 #define __pyx_tuple__4 __pyx_mstate_global->__pyx_tuple__4
@@ -6736,46 +6771,49 @@
 #define __pyx_tuple__36 __pyx_mstate_global->__pyx_tuple__36
 #define __pyx_tuple__38 __pyx_mstate_global->__pyx_tuple__38
 #define __pyx_tuple__40 __pyx_mstate_global->__pyx_tuple__40
 #define __pyx_tuple__42 __pyx_mstate_global->__pyx_tuple__42
 #define __pyx_tuple__44 __pyx_mstate_global->__pyx_tuple__44
 #define __pyx_tuple__46 __pyx_mstate_global->__pyx_tuple__46
 #define __pyx_tuple__48 __pyx_mstate_global->__pyx_tuple__48
-#define __pyx_tuple__50 __pyx_mstate_global->__pyx_tuple__50
-#define __pyx_tuple__52 __pyx_mstate_global->__pyx_tuple__52
-#define __pyx_tuple__54 __pyx_mstate_global->__pyx_tuple__54
-#define __pyx_tuple__56 __pyx_mstate_global->__pyx_tuple__56
-#define __pyx_tuple__58 __pyx_mstate_global->__pyx_tuple__58
+#define __pyx_tuple__49 __pyx_mstate_global->__pyx_tuple__49
+#define __pyx_tuple__51 __pyx_mstate_global->__pyx_tuple__51
+#define __pyx_tuple__53 __pyx_mstate_global->__pyx_tuple__53
+#define __pyx_tuple__55 __pyx_mstate_global->__pyx_tuple__55
+#define __pyx_tuple__57 __pyx_mstate_global->__pyx_tuple__57
+#define __pyx_tuple__59 __pyx_mstate_global->__pyx_tuple__59
 #define __pyx_tuple__61 __pyx_mstate_global->__pyx_tuple__61
-#define __pyx_tuple__63 __pyx_mstate_global->__pyx_tuple__63
-#define __pyx_tuple__65 __pyx_mstate_global->__pyx_tuple__65
-#define __pyx_tuple__67 __pyx_mstate_global->__pyx_tuple__67
-#define __pyx_tuple__69 __pyx_mstate_global->__pyx_tuple__69
+#define __pyx_tuple__64 __pyx_mstate_global->__pyx_tuple__64
+#define __pyx_tuple__66 __pyx_mstate_global->__pyx_tuple__66
+#define __pyx_tuple__68 __pyx_mstate_global->__pyx_tuple__68
+#define __pyx_tuple__70 __pyx_mstate_global->__pyx_tuple__70
+#define __pyx_tuple__72 __pyx_mstate_global->__pyx_tuple__72
 #define __pyx_codeobj__28 __pyx_mstate_global->__pyx_codeobj__28
 #define __pyx_codeobj__30 __pyx_mstate_global->__pyx_codeobj__30
 #define __pyx_codeobj__32 __pyx_mstate_global->__pyx_codeobj__32
 #define __pyx_codeobj__34 __pyx_mstate_global->__pyx_codeobj__34
 #define __pyx_codeobj__35 __pyx_mstate_global->__pyx_codeobj__35
 #define __pyx_codeobj__37 __pyx_mstate_global->__pyx_codeobj__37
 #define __pyx_codeobj__39 __pyx_mstate_global->__pyx_codeobj__39
 #define __pyx_codeobj__41 __pyx_mstate_global->__pyx_codeobj__41
 #define __pyx_codeobj__43 __pyx_mstate_global->__pyx_codeobj__43
 #define __pyx_codeobj__45 __pyx_mstate_global->__pyx_codeobj__45
 #define __pyx_codeobj__47 __pyx_mstate_global->__pyx_codeobj__47
-#define __pyx_codeobj__49 __pyx_mstate_global->__pyx_codeobj__49
-#define __pyx_codeobj__51 __pyx_mstate_global->__pyx_codeobj__51
-#define __pyx_codeobj__53 __pyx_mstate_global->__pyx_codeobj__53
-#define __pyx_codeobj__55 __pyx_mstate_global->__pyx_codeobj__55
-#define __pyx_codeobj__57 __pyx_mstate_global->__pyx_codeobj__57
-#define __pyx_codeobj__59 __pyx_mstate_global->__pyx_codeobj__59
+#define __pyx_codeobj__50 __pyx_mstate_global->__pyx_codeobj__50
+#define __pyx_codeobj__52 __pyx_mstate_global->__pyx_codeobj__52
+#define __pyx_codeobj__54 __pyx_mstate_global->__pyx_codeobj__54
+#define __pyx_codeobj__56 __pyx_mstate_global->__pyx_codeobj__56
+#define __pyx_codeobj__58 __pyx_mstate_global->__pyx_codeobj__58
+#define __pyx_codeobj__60 __pyx_mstate_global->__pyx_codeobj__60
 #define __pyx_codeobj__62 __pyx_mstate_global->__pyx_codeobj__62
-#define __pyx_codeobj__64 __pyx_mstate_global->__pyx_codeobj__64
-#define __pyx_codeobj__66 __pyx_mstate_global->__pyx_codeobj__66
-#define __pyx_codeobj__68 __pyx_mstate_global->__pyx_codeobj__68
-#define __pyx_codeobj__70 __pyx_mstate_global->__pyx_codeobj__70
+#define __pyx_codeobj__65 __pyx_mstate_global->__pyx_codeobj__65
+#define __pyx_codeobj__67 __pyx_mstate_global->__pyx_codeobj__67
+#define __pyx_codeobj__69 __pyx_mstate_global->__pyx_codeobj__69
+#define __pyx_codeobj__71 __pyx_mstate_global->__pyx_codeobj__71
+#define __pyx_codeobj__73 __pyx_mstate_global->__pyx_codeobj__73
 /* #### Code section: module_code ### */
 
 /* "vector.to_py":66
  * 
  * @cname("__pyx_convert_vector_to_py_int32_t")
  * cdef object __pyx_convert_vector_to_py_int32_t(const vector[X]& v):             # <<<<<<<<<<<<<<
  *     if v.size() > <size_t> PY_SSIZE_T_MAX:
@@ -7180,14 +7218,286 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_o);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "vector.from_py":45
+ * 
+ * @cname("__pyx_convert_vector_from_py_uint64_t")
+ * cdef vector[X] __pyx_convert_vector_from_py_uint64_t(object o) except *:             # <<<<<<<<<<<<<<
+ *     cdef vector[X] v
+ *     for item in o:
+ */
+
+static std::vector<uint64_t>  __pyx_convert_vector_from_py_uint64_t(PyObject *__pyx_v_o) {
+  std::vector<uint64_t>  __pyx_v_v;
+  PyObject *__pyx_v_item = NULL;
+  std::vector<uint64_t>  __pyx_r;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
+  PyObject *(*__pyx_t_3)(PyObject *);
+  PyObject *__pyx_t_4 = NULL;
+  uint64_t __pyx_t_5;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__pyx_convert_vector_from_py_uint64_t", 1);
+
+  /* "vector.from_py":47
+ * cdef vector[X] __pyx_convert_vector_from_py_uint64_t(object o) except *:
+ *     cdef vector[X] v
+ *     for item in o:             # <<<<<<<<<<<<<<
+ *         v.push_back(<X>item)
+ *     return v
+ */
+  if (likely(PyList_CheckExact(__pyx_v_o)) || PyTuple_CheckExact(__pyx_v_o)) {
+    __pyx_t_1 = __pyx_v_o; __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_2 = 0;
+    __pyx_t_3 = NULL;
+  } else {
+    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_o); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_3 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 47, __pyx_L1_error)
+  }
+  for (;;) {
+    if (likely(!__pyx_t_3)) {
+      if (likely(PyList_CheckExact(__pyx_t_1))) {
+        {
+          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
+          #if !CYTHON_ASSUME_SAFE_MACROS
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(1, 47, __pyx_L1_error)
+          #endif
+          if (__pyx_t_2 >= __pyx_temp) break;
+        }
+        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(1, 47, __pyx_L1_error)
+        #else
+        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 47, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_4);
+        #endif
+      } else {
+        {
+          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
+          #if !CYTHON_ASSUME_SAFE_MACROS
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(1, 47, __pyx_L1_error)
+          #endif
+          if (__pyx_t_2 >= __pyx_temp) break;
+        }
+        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(1, 47, __pyx_L1_error)
+        #else
+        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 47, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_4);
+        #endif
+      }
+    } else {
+      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
+      if (unlikely(!__pyx_t_4)) {
+        PyObject* exc_type = PyErr_Occurred();
+        if (exc_type) {
+          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+          else __PYX_ERR(1, 47, __pyx_L1_error)
+        }
+        break;
+      }
+      __Pyx_GOTREF(__pyx_t_4);
+    }
+    __Pyx_XDECREF_SET(__pyx_v_item, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "vector.from_py":48
+ *     cdef vector[X] v
+ *     for item in o:
+ *         v.push_back(<X>item)             # <<<<<<<<<<<<<<
+ *     return v
+ * 
+ */
+    __pyx_t_5 = __Pyx_PyInt_As_uint64_t(__pyx_v_item); if (unlikely((__pyx_t_5 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(1, 48, __pyx_L1_error)
+    try {
+      __pyx_v_v.push_back(((uint64_t)__pyx_t_5));
+    } catch(...) {
+      __Pyx_CppExn2PyErr();
+      __PYX_ERR(1, 48, __pyx_L1_error)
+    }
+
+    /* "vector.from_py":47
+ * cdef vector[X] __pyx_convert_vector_from_py_uint64_t(object o) except *:
+ *     cdef vector[X] v
+ *     for item in o:             # <<<<<<<<<<<<<<
+ *         v.push_back(<X>item)
+ *     return v
+ */
+  }
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "vector.from_py":49
+ *     for item in o:
+ *         v.push_back(<X>item)
+ *     return v             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = __pyx_v_v;
+  goto __pyx_L0;
+
+  /* "vector.from_py":45
+ * 
+ * @cname("__pyx_convert_vector_from_py_uint64_t")
+ * cdef vector[X] __pyx_convert_vector_from_py_uint64_t(object o) except *:             # <<<<<<<<<<<<<<
+ *     cdef vector[X] v
+ *     for item in o:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("vector.from_py.__pyx_convert_vector_from_py_uint64_t", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_pretend_to_initialize(&__pyx_r);
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_item);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static std::vector<float>  __pyx_convert_vector_from_py_float(PyObject *__pyx_v_o) {
+  std::vector<float>  __pyx_v_v;
+  PyObject *__pyx_v_item = NULL;
+  std::vector<float>  __pyx_r;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
+  PyObject *(*__pyx_t_3)(PyObject *);
+  PyObject *__pyx_t_4 = NULL;
+  float __pyx_t_5;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__pyx_convert_vector_from_py_float", 1);
+
+  /* "vector.from_py":47
+ * cdef vector[X] __pyx_convert_vector_from_py_float(object o) except *:
+ *     cdef vector[X] v
+ *     for item in o:             # <<<<<<<<<<<<<<
+ *         v.push_back(<X>item)
+ *     return v
+ */
+  if (likely(PyList_CheckExact(__pyx_v_o)) || PyTuple_CheckExact(__pyx_v_o)) {
+    __pyx_t_1 = __pyx_v_o; __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_2 = 0;
+    __pyx_t_3 = NULL;
+  } else {
+    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_o); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_3 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 47, __pyx_L1_error)
+  }
+  for (;;) {
+    if (likely(!__pyx_t_3)) {
+      if (likely(PyList_CheckExact(__pyx_t_1))) {
+        {
+          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
+          #if !CYTHON_ASSUME_SAFE_MACROS
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(1, 47, __pyx_L1_error)
+          #endif
+          if (__pyx_t_2 >= __pyx_temp) break;
+        }
+        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(1, 47, __pyx_L1_error)
+        #else
+        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 47, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_4);
+        #endif
+      } else {
+        {
+          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
+          #if !CYTHON_ASSUME_SAFE_MACROS
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(1, 47, __pyx_L1_error)
+          #endif
+          if (__pyx_t_2 >= __pyx_temp) break;
+        }
+        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(1, 47, __pyx_L1_error)
+        #else
+        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 47, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_4);
+        #endif
+      }
+    } else {
+      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
+      if (unlikely(!__pyx_t_4)) {
+        PyObject* exc_type = PyErr_Occurred();
+        if (exc_type) {
+          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+          else __PYX_ERR(1, 47, __pyx_L1_error)
+        }
+        break;
+      }
+      __Pyx_GOTREF(__pyx_t_4);
+    }
+    __Pyx_XDECREF_SET(__pyx_v_item, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "vector.from_py":48
+ *     cdef vector[X] v
+ *     for item in o:
+ *         v.push_back(<X>item)             # <<<<<<<<<<<<<<
+ *     return v
+ * 
+ */
+    __pyx_t_5 = __pyx_PyFloat_AsFloat(__pyx_v_item); if (unlikely((__pyx_t_5 == (float)-1) && PyErr_Occurred())) __PYX_ERR(1, 48, __pyx_L1_error)
+    try {
+      __pyx_v_v.push_back(((float)__pyx_t_5));
+    } catch(...) {
+      __Pyx_CppExn2PyErr();
+      __PYX_ERR(1, 48, __pyx_L1_error)
+    }
+
+    /* "vector.from_py":47
+ * cdef vector[X] __pyx_convert_vector_from_py_float(object o) except *:
+ *     cdef vector[X] v
+ *     for item in o:             # <<<<<<<<<<<<<<
+ *         v.push_back(<X>item)
+ *     return v
+ */
+  }
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "vector.from_py":49
+ *     for item in o:
+ *         v.push_back(<X>item)
+ *     return v             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = __pyx_v_v;
+  goto __pyx_L0;
+
+  /* "vector.from_py":45
+ * 
+ * @cname("__pyx_convert_vector_from_py_float")
+ * cdef vector[X] __pyx_convert_vector_from_py_float(object o) except *:             # <<<<<<<<<<<<<<
+ *     cdef vector[X] v
+ *     for item in o:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("vector.from_py.__pyx_convert_vector_from_py_float", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_pretend_to_initialize(&__pyx_r);
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_item);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
 /* "carray.to_py":114
  * 
  * @cname("__Pyx_carray_to_py_Py_ssize_t")
  * cdef inline list __Pyx_carray_to_py_Py_ssize_t(base_type *v, Py_ssize_t length):             # <<<<<<<<<<<<<<
  *     cdef size_t i
  *     cdef object value
  */
@@ -21092,70 +21402,70 @@
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "cpython/complex.pxd":19
  * 
  *         @property
- *         cdef inline double real(self) noexcept:             # <<<<<<<<<<<<<<
+ *         cdef inline double real(self):             # <<<<<<<<<<<<<<
  *             return self.cval.real
  * 
  */
 
 static CYTHON_INLINE double __pyx_f_7cpython_7complex_7complex_4real_real(PyComplexObject *__pyx_v_self) {
   double __pyx_r;
 
   /* "cpython/complex.pxd":20
  *         @property
- *         cdef inline double real(self) noexcept:
+ *         cdef inline double real(self):
  *             return self.cval.real             # <<<<<<<<<<<<<<
  * 
  *         @property
  */
   __pyx_r = __pyx_v_self->cval.real;
   goto __pyx_L0;
 
   /* "cpython/complex.pxd":19
  * 
  *         @property
- *         cdef inline double real(self) noexcept:             # <<<<<<<<<<<<<<
+ *         cdef inline double real(self):             # <<<<<<<<<<<<<<
  *             return self.cval.real
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
 /* "cpython/complex.pxd":23
  * 
  *         @property
- *         cdef inline double imag(self) noexcept:             # <<<<<<<<<<<<<<
+ *         cdef inline double imag(self):             # <<<<<<<<<<<<<<
  *             return self.cval.imag
  * 
  */
 
 static CYTHON_INLINE double __pyx_f_7cpython_7complex_7complex_4imag_imag(PyComplexObject *__pyx_v_self) {
   double __pyx_r;
 
   /* "cpython/complex.pxd":24
  *         @property
- *         cdef inline double imag(self) noexcept:
+ *         cdef inline double imag(self):
  *             return self.cval.imag             # <<<<<<<<<<<<<<
  * 
  *     # PyTypeObject PyComplex_Type
  */
   __pyx_r = __pyx_v_self->cval.imag;
   goto __pyx_L0;
 
   /* "cpython/complex.pxd":23
  * 
  *         @property
- *         cdef inline double imag(self) noexcept:             # <<<<<<<<<<<<<<
+ *         cdef inline double imag(self):             # <<<<<<<<<<<<<<
  *             return self.cval.imag
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
@@ -21973,15 +22283,15 @@
   }
 
   /* "array.pxd":170
  *     if self.ob_descr.typecode != other.ob_descr.typecode:
  *         PyErr_BadArgument()
  *     return extend_buffer(self, other.data.as_chars, Py_SIZE(other))             # <<<<<<<<<<<<<<
  * 
- * cdef inline void zero(array self) noexcept:
+ * cdef inline void zero(array self):
  */
   __pyx_t_2 = __pyx_f_7cpython_5array_extend_buffer(__pyx_v_self, __pyx_v_other->data.as_chars, Py_SIZE(((PyObject *)__pyx_v_other))); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(3, 170, __pyx_L1_error)
   __pyx_r = __pyx_t_2;
   goto __pyx_L0;
 
   /* "array.pxd":166
  *     return 0
@@ -21998,286 +22308,286 @@
   __pyx_L0:;
   return __pyx_r;
 }
 
 /* "array.pxd":172
  *     return extend_buffer(self, other.data.as_chars, Py_SIZE(other))
  * 
- * cdef inline void zero(array self) noexcept:             # <<<<<<<<<<<<<<
+ * cdef inline void zero(array self):             # <<<<<<<<<<<<<<
  *     """ set all elements of array to zero. """
  *     memset(self.data.as_chars, 0, Py_SIZE(self) * self.ob_descr.itemsize)
  */
 
 static CYTHON_INLINE void __pyx_f_7cpython_5array_zero(arrayobject *__pyx_v_self) {
 
   /* "array.pxd":174
- * cdef inline void zero(array self) noexcept:
+ * cdef inline void zero(array self):
  *     """ set all elements of array to zero. """
  *     memset(self.data.as_chars, 0, Py_SIZE(self) * self.ob_descr.itemsize)             # <<<<<<<<<<<<<<
  */
   (void)(memset(__pyx_v_self->data.as_chars, 0, (Py_SIZE(((PyObject *)__pyx_v_self)) * __pyx_v_self->ob_descr->itemsize)));
 
   /* "array.pxd":172
  *     return extend_buffer(self, other.data.as_chars, Py_SIZE(other))
  * 
- * cdef inline void zero(array self) noexcept:             # <<<<<<<<<<<<<<
+ * cdef inline void zero(array self):             # <<<<<<<<<<<<<<
  *     """ set all elements of array to zero. """
  *     memset(self.data.as_chars, 0, Py_SIZE(self) * self.ob_descr.itemsize)
  */
 
   /* function exit code */
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":245
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":245
  * 
  *         @property
  *         cdef inline PyObject* base(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns a borrowed reference to the object owning the data/memory.
  *             """
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_7ndarray_4base_base(PyArrayObject *__pyx_v_self) {
   PyObject *__pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":248
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":248
  *             """Returns a borrowed reference to the object owning the data/memory.
  *             """
  *             return PyArray_BASE(self)             # <<<<<<<<<<<<<<
  * 
  *         @property
  */
   __pyx_r = PyArray_BASE(__pyx_v_self);
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":245
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":245
  * 
  *         @property
  *         cdef inline PyObject* base(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns a borrowed reference to the object owning the data/memory.
  *             """
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":251
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":251
  * 
  *         @property
  *         cdef inline dtype descr(self):             # <<<<<<<<<<<<<<
  *             """Returns an owned reference to the dtype of the array.
  *             """
  */
 
 static CYTHON_INLINE PyArray_Descr *__pyx_f_5numpy_7ndarray_5descr_descr(PyArrayObject *__pyx_v_self) {
   PyArray_Descr *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyArray_Descr *__pyx_t_1;
   __Pyx_RefNannySetupContext("descr", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":254
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":254
  *             """Returns an owned reference to the dtype of the array.
  *             """
  *             return <dtype>PyArray_DESCR(self)             # <<<<<<<<<<<<<<
  * 
  *         @property
  */
   __Pyx_XDECREF((PyObject *)__pyx_r);
   __pyx_t_1 = PyArray_DESCR(__pyx_v_self);
   __Pyx_INCREF((PyObject *)((PyArray_Descr *)__pyx_t_1));
   __pyx_r = ((PyArray_Descr *)__pyx_t_1);
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":251
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":251
  * 
  *         @property
  *         cdef inline dtype descr(self):             # <<<<<<<<<<<<<<
  *             """Returns an owned reference to the dtype of the array.
  *             """
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":257
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":257
  * 
  *         @property
  *         cdef inline int ndim(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns the number of dimensions in the array.
  *             """
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_7ndarray_4ndim_ndim(PyArrayObject *__pyx_v_self) {
   int __pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":260
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":260
  *             """Returns the number of dimensions in the array.
  *             """
  *             return PyArray_NDIM(self)             # <<<<<<<<<<<<<<
  * 
  *         @property
  */
   __pyx_r = PyArray_NDIM(__pyx_v_self);
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":257
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":257
  * 
  *         @property
  *         cdef inline int ndim(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns the number of dimensions in the array.
  *             """
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":263
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":263
  * 
  *         @property
  *         cdef inline npy_intp *shape(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns a pointer to the dimensions/shape of the array.
  *             The number of elements matches the number of dimensions of the array (ndim).
  */
 
 static CYTHON_INLINE npy_intp *__pyx_f_5numpy_7ndarray_5shape_shape(PyArrayObject *__pyx_v_self) {
   npy_intp *__pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":268
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":268
  *             Can return NULL for 0-dimensional arrays.
  *             """
  *             return PyArray_DIMS(self)             # <<<<<<<<<<<<<<
  * 
  *         @property
  */
   __pyx_r = PyArray_DIMS(__pyx_v_self);
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":263
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":263
  * 
  *         @property
  *         cdef inline npy_intp *shape(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns a pointer to the dimensions/shape of the array.
  *             The number of elements matches the number of dimensions of the array (ndim).
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":271
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":271
  * 
  *         @property
  *         cdef inline npy_intp *strides(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns a pointer to the strides of the array.
  *             The number of elements matches the number of dimensions of the array (ndim).
  */
 
 static CYTHON_INLINE npy_intp *__pyx_f_5numpy_7ndarray_7strides_strides(PyArrayObject *__pyx_v_self) {
   npy_intp *__pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":275
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":275
  *             The number of elements matches the number of dimensions of the array (ndim).
  *             """
  *             return PyArray_STRIDES(self)             # <<<<<<<<<<<<<<
  * 
  *         @property
  */
   __pyx_r = PyArray_STRIDES(__pyx_v_self);
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":271
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":271
  * 
  *         @property
  *         cdef inline npy_intp *strides(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns a pointer to the strides of the array.
  *             The number of elements matches the number of dimensions of the array (ndim).
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":278
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":278
  * 
  *         @property
  *         cdef inline npy_intp size(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns the total size (in number of elements) of the array.
  *             """
  */
 
 static CYTHON_INLINE npy_intp __pyx_f_5numpy_7ndarray_4size_size(PyArrayObject *__pyx_v_self) {
   npy_intp __pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":281
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":281
  *             """Returns the total size (in number of elements) of the array.
  *             """
  *             return PyArray_SIZE(self)             # <<<<<<<<<<<<<<
  * 
  *         @property
  */
   __pyx_r = PyArray_SIZE(__pyx_v_self);
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":278
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":278
  * 
  *         @property
  *         cdef inline npy_intp size(self) nogil:             # <<<<<<<<<<<<<<
  *             """Returns the total size (in number of elements) of the array.
  *             """
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":284
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":284
  * 
  *         @property
  *         cdef inline char* data(self) nogil:             # <<<<<<<<<<<<<<
  *             """The pointer to the data buffer as a char*.
  *             This is provided for legacy reasons to avoid direct struct field access.
  */
 
 static CYTHON_INLINE char *__pyx_f_5numpy_7ndarray_4data_data(PyArrayObject *__pyx_v_self) {
   char *__pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":290
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":290
  *             of `PyArray_DATA()` instead, which returns a 'void*'.
  *             """
  *             return PyArray_BYTES(self)             # <<<<<<<<<<<<<<
  * 
  *     ctypedef unsigned char      npy_bool
  */
   __pyx_r = PyArray_BYTES(__pyx_v_self);
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":284
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":284
  * 
  *         @property
  *         cdef inline char* data(self) nogil:             # <<<<<<<<<<<<<<
  *             """The pointer to the data buffer as a char*.
  *             This is provided for legacy reasons to avoid direct struct field access.
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":776
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":776
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -22286,29 +22596,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":777
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":777
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 777, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":776
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":776
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  */
 
@@ -22319,15 +22629,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":779
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":779
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -22336,29 +22646,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":780
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":780
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 780, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":779
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":779
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  */
 
@@ -22369,15 +22679,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":782
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":782
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -22386,29 +22696,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":783
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":783
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 783, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":782
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":782
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  */
 
@@ -22419,15 +22729,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":785
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":785
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -22436,29 +22746,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":786
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":786
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 786, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":785
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":785
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  */
 
@@ -22469,15 +22779,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":788
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":788
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -22486,29 +22796,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":789
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":789
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 789, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":788
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":788
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  */
 
@@ -22519,209 +22829,209 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":791
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":791
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("PyDataType_SHAPE", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":792
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":792
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   __pyx_t_1 = PyDataType_HASSUBARRAY(__pyx_v_d);
   if (__pyx_t_1) {
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":793
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":793
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
  *     else:
  *         return ()
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
     __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
     goto __pyx_L0;
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":792
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":792
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):
  *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
  *         return <tuple>d.subarray.shape
  *     else:
  */
   }
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":795
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":795
  *         return <tuple>d.subarray.shape
  *     else:
  *         return ()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_empty_tuple);
     __pyx_r = __pyx_empty_tuple;
     goto __pyx_L0;
   }
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":791
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":791
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
  *     if PyDataType_HASSUBARRAY(d):
  *         return <tuple>d.subarray.shape
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":970
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":970
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
 static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":971
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":971
  * 
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
  *     PyArray_SetBaseObject(arr, base)
  * 
  */
   Py_INCREF(__pyx_v_base);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":972
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":972
  * cdef inline void set_array_base(ndarray arr, object base):
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
  * 
  * cdef inline object get_array_base(ndarray arr):
  */
   (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":970
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":970
  *     int _import_umath() except -1
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
  *     Py_INCREF(base) # important to do this before stealing the reference below!
  *     PyArray_SetBaseObject(arr, base)
  */
 
   /* function exit code */
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":974
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":974
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
 static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
   PyObject *__pyx_v_base;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("get_array_base", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":975
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":975
  * 
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
  *     if base is NULL:
  *         return None
  */
   __pyx_v_base = PyArray_BASE(__pyx_v_arr);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":976
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":976
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   __pyx_t_1 = (__pyx_v_base == NULL);
   if (__pyx_t_1) {
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":977
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":977
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  *         return None             # <<<<<<<<<<<<<<
  *     return <object>base
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":976
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":976
  * cdef inline object get_array_base(ndarray arr):
  *     base = PyArray_BASE(arr)
  *     if base is NULL:             # <<<<<<<<<<<<<<
  *         return None
  *     return <object>base
  */
   }
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":978
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":978
  *     if base is NULL:
  *         return None
  *     return <object>base             # <<<<<<<<<<<<<<
  * 
  * # Versions of the import_* functions which are more suitable for
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_base));
   __pyx_r = ((PyObject *)__pyx_v_base);
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":974
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":974
  *     PyArray_SetBaseObject(arr, base)
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
  *     base = PyArray_BASE(arr)
  *     if base is NULL:
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":982
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":982
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -22737,15 +23047,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_array", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":983
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":983
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
   {
@@ -22753,68 +23063,68 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":984
+      /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":984
  * cdef inline int import_array() except -1:
  *     try:
  *         __pyx_import_array()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")
  */
       __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(4, 984, __pyx_L3_error)
 
-      /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":983
+      /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":983
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":985
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":985
  *     try:
  *         __pyx_import_array()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(4, 985, __pyx_L5_except_error)
       __Pyx_XGOTREF(__pyx_t_5);
       __Pyx_XGOTREF(__pyx_t_6);
       __Pyx_XGOTREF(__pyx_t_7);
 
-      /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":986
+      /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":986
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(4, 986, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(4, 986, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":983
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":983
  * # Cython code.
  * cdef inline int import_array() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         __pyx_import_array()
  *     except Exception:
  */
     __pyx_L5_except_error:;
@@ -22822,15 +23132,15 @@
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":982
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":982
  * # Versions of the import_* functions which are more suitable for
  * # Cython code.
  * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         __pyx_import_array()
  */
 
@@ -22845,15 +23155,15 @@
   __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":988
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":988
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -22869,15 +23179,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_umath", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":989
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":989
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -22885,68 +23195,68 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":990
+      /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":990
  * cdef inline int import_umath() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(4, 990, __pyx_L3_error)
 
-      /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":989
+      /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":989
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":991
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":991
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(4, 991, __pyx_L5_except_error)
       __Pyx_XGOTREF(__pyx_t_5);
       __Pyx_XGOTREF(__pyx_t_6);
       __Pyx_XGOTREF(__pyx_t_7);
 
-      /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":992
+      /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":992
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(4, 992, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(4, 992, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":989
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":989
  * 
  * cdef inline int import_umath() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __pyx_L5_except_error:;
@@ -22954,15 +23264,15 @@
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":988
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":988
  *         raise ImportError("numpy.core.multiarray failed to import")
  * 
  * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -22977,15 +23287,15 @@
   __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":994
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":994
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -23001,15 +23311,15 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("import_ufunc", 1);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":995
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":995
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
   {
@@ -23017,68 +23327,68 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":996
+      /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":996
  * cdef inline int import_ufunc() except -1:
  *     try:
  *         _import_umath()             # <<<<<<<<<<<<<<
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")
  */
       __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(4, 996, __pyx_L3_error)
 
-      /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":995
+      /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":995
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     }
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L8_try_end;
     __pyx_L3_error:;
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":997
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":997
  *     try:
  *         _import_umath()
  *     except Exception:             # <<<<<<<<<<<<<<
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  */
     __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_4) {
       __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
       if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(4, 997, __pyx_L5_except_error)
       __Pyx_XGOTREF(__pyx_t_5);
       __Pyx_XGOTREF(__pyx_t_6);
       __Pyx_XGOTREF(__pyx_t_7);
 
-      /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":998
+      /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":998
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * 
  */
       __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(4, 998, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_Raise(__pyx_t_8, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __PYX_ERR(4, 998, __pyx_L5_except_error)
     }
     goto __pyx_L5_except_error;
 
-    /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":995
+    /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":995
  * 
  * cdef inline int import_ufunc() except -1:
  *     try:             # <<<<<<<<<<<<<<
  *         _import_umath()
  *     except Exception:
  */
     __pyx_L5_except_error:;
@@ -23086,15 +23396,15 @@
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     goto __pyx_L1_error;
     __pyx_L8_try_end:;
   }
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":994
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":994
  *         raise ImportError("numpy.core.umath failed to import")
  * 
  * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
  *     try:
  *         _import_umath()
  */
 
@@ -23109,183 +23419,183 @@
   __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1001
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1001
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1013
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1013
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1001
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1001
  * 
  * 
  * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.timedelta64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1016
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1016
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
 static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
   int __pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1028
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1028
  *     bool
  *     """
  *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1016
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1016
  * 
  * 
  * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
  *     """
  *     Cython equivalent of `isinstance(obj, np.datetime64)`
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1031
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1031
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
 static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
   npy_datetime __pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1038
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1038
  *     also needed.  That can be found using `get_datetime64_unit`.
  *     """
  *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1031
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1031
  * 
  * 
  * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy datetime64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1041
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1041
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
 static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
   npy_timedelta __pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1045
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1045
  *     returns the int64 value underlying scalar numpy timedelta64 object
  *     """
  *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1041
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1041
  * 
  * 
  * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the int64 value underlying scalar numpy timedelta64 object
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1048
+/* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1048
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
 static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
   NPY_DATETIMEUNIT __pyx_r;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1052
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1052
  *     returns the unit part of the dtype for a numpy datetime64 object.
  *     """
  *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
  */
   __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
   goto __pyx_L0;
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1048
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":1048
  * 
  * 
  * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     returns the unit part of the dtype for a numpy datetime64 object.
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":90
+/* "ext/skeletontricks/skeletontricks.pyx":101
  *   )
  * 
  * def find_cycle(cnp.ndarray[int32_t, ndim=2] edges):             # <<<<<<<<<<<<<<
  *   """
  *   Given a graph of edges that are a single connected component,
  */
 
@@ -23339,45 +23649,45 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_edges)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 90, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 101, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_cycle") < 0)) __PYX_ERR(0, 90, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_cycle") < 0)) __PYX_ERR(0, 101, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_edges = ((PyArrayObject *)values[0]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_cycle", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 90, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_cycle", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 101, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_cycle", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_edges), __pyx_ptype_5numpy_ndarray, 1, "edges", 0))) __PYX_ERR(0, 90, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_edges), __pyx_ptype_5numpy_ndarray, 1, "edges", 0))) __PYX_ERR(0, 101, __pyx_L1_error)
   __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_find_cycle(__pyx_self, __pyx_v_edges);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -23425,78 +23735,78 @@
   __pyx_pybuffernd_elist.rcbuffer = &__pyx_pybuffer_elist;
   __pyx_pybuffer_edges.pybuffer.buf = NULL;
   __pyx_pybuffer_edges.refcount = 0;
   __pyx_pybuffernd_edges.data = NULL;
   __pyx_pybuffernd_edges.rcbuffer = &__pyx_pybuffer_edges;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_edges.rcbuffer->pybuffer, (PyObject*)__pyx_v_edges, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 90, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_edges.rcbuffer->pybuffer, (PyObject*)__pyx_v_edges, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 101, __pyx_L1_error)
   }
   __pyx_pybuffernd_edges.diminfo[0].strides = __pyx_pybuffernd_edges.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_edges.diminfo[0].shape = __pyx_pybuffernd_edges.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_edges.diminfo[1].strides = __pyx_pybuffernd_edges.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_edges.diminfo[1].shape = __pyx_pybuffernd_edges.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":97
+  /* "ext/skeletontricks/skeletontricks.pyx":108
  *   Returns: list of edges in a cycle (empty list if no cycle is found)
  *   """
  *   if edges.size == 0:             # <<<<<<<<<<<<<<
  *     return np.zeros((0,), dtype=np.uint32)
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_edges)); if (unlikely(__pyx_t_1 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_edges)); if (unlikely(__pyx_t_1 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 108, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1 == 0);
   if (__pyx_t_2) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":98
+    /* "ext/skeletontricks/skeletontricks.pyx":109
  *   """
  *   if edges.size == 0:
  *     return np.zeros((0,), dtype=np.uint32)             # <<<<<<<<<<<<<<
  * 
  *   edges = np.ascontiguousarray(edges)
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 109, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 109, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 109, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 109, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uint32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 109, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 98, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 109, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_tuple__12, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 98, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_tuple__12, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 109, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":97
+    /* "ext/skeletontricks/skeletontricks.pyx":108
  *   Returns: list of edges in a cycle (empty list if no cycle is found)
  *   """
  *   if edges.size == 0:             # <<<<<<<<<<<<<<
  *     return np.zeros((0,), dtype=np.uint32)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":100
+  /* "ext/skeletontricks/skeletontricks.pyx":111
  *     return np.zeros((0,), dtype=np.uint32)
  * 
  *   edges = np.ascontiguousarray(edges)             # <<<<<<<<<<<<<<
  * 
  *   cdef cnp.ndarray[int32_t, ndim=1] elist = np.array(
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 100, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 111, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ascontiguousarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 100, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ascontiguousarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 111, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   __pyx_t_7 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
@@ -23509,19 +23819,19 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_3, ((PyObject *)__pyx_v_edges)};
     __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 100, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 111, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   }
-  if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 100, __pyx_L1_error)
+  if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 111, __pyx_L1_error)
   __pyx_t_8 = ((PyArrayObject *)__pyx_t_6);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
     __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_edges.rcbuffer->pybuffer);
     __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_edges.rcbuffer->pybuffer, (PyObject*)__pyx_t_8, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack);
     if (unlikely(__pyx_t_7 < 0)) {
       PyErr_Fetch(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
@@ -23530,34 +23840,34 @@
         __Pyx_RaiseBufferFallbackError();
       } else {
         PyErr_Restore(__pyx_t_9, __pyx_t_10, __pyx_t_11);
       }
       __pyx_t_9 = __pyx_t_10 = __pyx_t_11 = 0;
     }
     __pyx_pybuffernd_edges.diminfo[0].strides = __pyx_pybuffernd_edges.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_edges.diminfo[0].shape = __pyx_pybuffernd_edges.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_edges.diminfo[1].strides = __pyx_pybuffernd_edges.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_edges.diminfo[1].shape = __pyx_pybuffernd_edges.rcbuffer->pybuffer.shape[1];
-    if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 100, __pyx_L1_error)
+    if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 111, __pyx_L1_error)
   }
   __pyx_t_8 = 0;
   __Pyx_DECREF_SET(__pyx_v_edges, ((PyArrayObject *)__pyx_t_6));
   __pyx_t_6 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":102
+  /* "ext/skeletontricks/skeletontricks.pyx":113
  *   edges = np.ascontiguousarray(edges)
  * 
  *   cdef cnp.ndarray[int32_t, ndim=1] elist = np.array(             # <<<<<<<<<<<<<<
  *     _find_cycle[int32_t](
  *       <int32_t*>&edges[0,0], <size_t>(edges.size // 2)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":104
+  /* "ext/skeletontricks/skeletontricks.pyx":115
  *   cdef cnp.ndarray[int32_t, ndim=1] elist = np.array(
  *     _find_cycle[int32_t](
  *       <int32_t*>&edges[0,0], <size_t>(edges.size // 2)             # <<<<<<<<<<<<<<
  *     ),
  *     dtype=np.int32
  */
   __pyx_t_12 = 0;
@@ -23569,97 +23879,97 @@
   } else if (unlikely(__pyx_t_12 >= __pyx_pybuffernd_edges.diminfo[0].shape)) __pyx_t_7 = 0;
   if (__pyx_t_13 < 0) {
     __pyx_t_13 += __pyx_pybuffernd_edges.diminfo[1].shape;
     if (unlikely(__pyx_t_13 < 0)) __pyx_t_7 = 1;
   } else if (unlikely(__pyx_t_13 >= __pyx_pybuffernd_edges.diminfo[1].shape)) __pyx_t_7 = 1;
   if (unlikely(__pyx_t_7 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_7);
-    __PYX_ERR(0, 104, __pyx_L1_error)
+    __PYX_ERR(0, 115, __pyx_L1_error)
   }
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_edges)); if (unlikely(__pyx_t_1 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 104, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_edges)); if (unlikely(__pyx_t_1 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 115, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":103
+  /* "ext/skeletontricks/skeletontricks.pyx":114
  * 
  *   cdef cnp.ndarray[int32_t, ndim=1] elist = np.array(
  *     _find_cycle[int32_t](             # <<<<<<<<<<<<<<
  *       <int32_t*>&edges[0,0], <size_t>(edges.size // 2)
  *     ),
  */
-  __pyx_t_6 = __pyx_convert_vector_to_py_int32_t(skeletontricks::_find_cycle<int32_t>(((int32_t *)(&(*__Pyx_BufPtrStrided2d(int32_t *, __pyx_pybuffernd_edges.rcbuffer->pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_edges.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_edges.diminfo[1].strides)))), ((size_t)__Pyx_div_npy_intp(__pyx_t_1, 2)))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 103, __pyx_L1_error)
+  __pyx_t_6 = __pyx_convert_vector_to_py_int32_t(skeletontricks::_find_cycle<int32_t>(((int32_t *)(&(*__Pyx_BufPtrStrided2d(int32_t *, __pyx_pybuffernd_edges.rcbuffer->pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_edges.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_edges.diminfo[1].strides)))), ((size_t)__Pyx_div_npy_intp(__pyx_t_1, 2)))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 114, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":102
+  /* "ext/skeletontricks/skeletontricks.pyx":113
  *   edges = np.ascontiguousarray(edges)
  * 
  *   cdef cnp.ndarray[int32_t, ndim=1] elist = np.array(             # <<<<<<<<<<<<<<
  *     _find_cycle[int32_t](
  *       <int32_t*>&edges[0,0], <size_t>(edges.size // 2)
  */
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_6)) __PYX_ERR(0, 113, __pyx_L1_error);
   __pyx_t_6 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":106
+  /* "ext/skeletontricks/skeletontricks.pyx":117
  *       <int32_t*>&edges[0,0], <size_t>(edges.size // 2)
  *     ),
  *     dtype=np.int32             # <<<<<<<<<<<<<<
  *   )
  *   return elist
  */
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 106, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 117, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 106, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 117, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 106, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 117, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_14) < 0) __PYX_ERR(0, 106, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_14) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":102
+  /* "ext/skeletontricks/skeletontricks.pyx":113
  *   edges = np.ascontiguousarray(edges)
  * 
  *   cdef cnp.ndarray[int32_t, ndim=1] elist = np.array(             # <<<<<<<<<<<<<<
  *     _find_cycle[int32_t](
  *       <int32_t*>&edges[0,0], <size_t>(edges.size // 2)
  */
-  __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 113, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (!(likely(((__pyx_t_14) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_14, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 102, __pyx_L1_error)
+  if (!(likely(((__pyx_t_14) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_14, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 113, __pyx_L1_error)
   __pyx_t_15 = ((PyArrayObject *)__pyx_t_14);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
     if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_elist.rcbuffer->pybuffer, (PyObject*)__pyx_t_15, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
       __pyx_v_elist = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_pybuffernd_elist.rcbuffer->pybuffer.buf = NULL;
-      __PYX_ERR(0, 102, __pyx_L1_error)
+      __PYX_ERR(0, 113, __pyx_L1_error)
     } else {__pyx_pybuffernd_elist.diminfo[0].strides = __pyx_pybuffernd_elist.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_elist.diminfo[0].shape = __pyx_pybuffernd_elist.rcbuffer->pybuffer.shape[0];
     }
   }
   __pyx_t_15 = 0;
   __pyx_v_elist = ((PyArrayObject *)__pyx_t_14);
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":108
+  /* "ext/skeletontricks/skeletontricks.pyx":119
  *     dtype=np.int32
  *   )
  *   return elist             # <<<<<<<<<<<<<<
  * 
  * def create_distance_graph(skeleton):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_elist);
   __pyx_r = ((PyObject *)__pyx_v_elist);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":90
+  /* "ext/skeletontricks/skeletontricks.pyx":101
  *   )
  * 
  * def find_cycle(cnp.ndarray[int32_t, ndim=2] edges):             # <<<<<<<<<<<<<<
  *   """
  *   Given a graph of edges that are a single connected component,
  */
 
@@ -23687,15 +23997,15 @@
   __Pyx_XDECREF((PyObject *)__pyx_v_elist);
   __Pyx_XDECREF((PyObject *)__pyx_v_edges);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":110
+/* "ext/skeletontricks/skeletontricks.pyx":121
  *   return elist
  * 
  * def create_distance_graph(skeleton):             # <<<<<<<<<<<<<<
  *   """
  *   Creates the distance "supergraph" from a single connected component
  */
 
@@ -23749,31 +24059,31 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_skeleton)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 121, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "create_distance_graph") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "create_distance_graph") < 0)) __PYX_ERR(0, 121, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_skeleton = values[0];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("create_distance_graph", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 110, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("create_distance_graph", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 121, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
@@ -23847,192 +24157,192 @@
   __pyx_pybuffernd_vertices.data = NULL;
   __pyx_pybuffernd_vertices.rcbuffer = &__pyx_pybuffer_vertices;
   __pyx_pybuffer_edges.pybuffer.buf = NULL;
   __pyx_pybuffer_edges.refcount = 0;
   __pyx_pybuffernd_edges.data = NULL;
   __pyx_pybuffernd_edges.rcbuffer = &__pyx_pybuffer_edges;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":133
+  /* "ext/skeletontricks/skeletontricks.pyx":144
  *   }
  *   """
  *   cdef cnp.ndarray[float, ndim=2] vertices = skeleton.vertices             # <<<<<<<<<<<<<<
  *   cdef cnp.ndarray[uint32_t, ndim=2] edges = skeleton.edges
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_skeleton, __pyx_n_s_vertices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 133, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_skeleton, __pyx_n_s_vertices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 133, __pyx_L1_error)
+  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 144, __pyx_L1_error)
   __pyx_t_2 = ((PyArrayObject *)__pyx_t_1);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
     if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_vertices.rcbuffer->pybuffer, (PyObject*)__pyx_t_2, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
       __pyx_v_vertices = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_pybuffernd_vertices.rcbuffer->pybuffer.buf = NULL;
-      __PYX_ERR(0, 133, __pyx_L1_error)
+      __PYX_ERR(0, 144, __pyx_L1_error)
     } else {__pyx_pybuffernd_vertices.diminfo[0].strides = __pyx_pybuffernd_vertices.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_vertices.diminfo[0].shape = __pyx_pybuffernd_vertices.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_vertices.diminfo[1].strides = __pyx_pybuffernd_vertices.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_vertices.diminfo[1].shape = __pyx_pybuffernd_vertices.rcbuffer->pybuffer.shape[1];
     }
   }
   __pyx_t_2 = 0;
   __pyx_v_vertices = ((PyArrayObject *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":134
+  /* "ext/skeletontricks/skeletontricks.pyx":145
  *   """
  *   cdef cnp.ndarray[float, ndim=2] vertices = skeleton.vertices
  *   cdef cnp.ndarray[uint32_t, ndim=2] edges = skeleton.edges             # <<<<<<<<<<<<<<
  * 
  *   unique_nodes, unique_counts = np.unique(edges, return_counts=True)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_skeleton, __pyx_n_s_edges); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_skeleton, __pyx_n_s_edges); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 145, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 134, __pyx_L1_error)
+  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 145, __pyx_L1_error)
   __pyx_t_3 = ((PyArrayObject *)__pyx_t_1);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
     if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_edges.rcbuffer->pybuffer, (PyObject*)__pyx_t_3, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) {
       __pyx_v_edges = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_pybuffernd_edges.rcbuffer->pybuffer.buf = NULL;
-      __PYX_ERR(0, 134, __pyx_L1_error)
+      __PYX_ERR(0, 145, __pyx_L1_error)
     } else {__pyx_pybuffernd_edges.diminfo[0].strides = __pyx_pybuffernd_edges.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_edges.diminfo[0].shape = __pyx_pybuffernd_edges.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_edges.diminfo[1].strides = __pyx_pybuffernd_edges.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_edges.diminfo[1].shape = __pyx_pybuffernd_edges.rcbuffer->pybuffer.shape[1];
     }
   }
   __pyx_t_3 = 0;
   __pyx_v_edges = ((PyArrayObject *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":136
+  /* "ext/skeletontricks/skeletontricks.pyx":147
  *   cdef cnp.ndarray[uint32_t, ndim=2] edges = skeleton.edges
  * 
  *   unique_nodes, unique_counts = np.unique(edges, return_counts=True)             # <<<<<<<<<<<<<<
  *   terminal_nodes = unique_nodes[ unique_counts == 1 ]
  *   branch_nodes = set(unique_nodes[ unique_counts >= 3 ])
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 147, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_unique); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_unique); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 147, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 147, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF((PyObject *)__pyx_v_edges);
   __Pyx_GIVEREF((PyObject *)__pyx_v_edges);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_edges))) __PYX_ERR(0, 136, __pyx_L1_error);
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 136, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_edges))) __PYX_ERR(0, 147, __pyx_L1_error);
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 147, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 136, __pyx_L1_error)
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 136, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 147, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 147, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_6))) || (PyList_CheckExact(__pyx_t_6))) {
     PyObject* sequence = __pyx_t_6;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 136, __pyx_L1_error)
+      __PYX_ERR(0, 147, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_5);
     __Pyx_INCREF(__pyx_t_1);
     #else
-    __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 136, __pyx_L1_error)
+    __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
+    __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     #endif
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L1_error)
+    __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
     index = 0; __pyx_t_5 = __pyx_t_7(__pyx_t_4); if (unlikely(!__pyx_t_5)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_5);
     index = 1; __pyx_t_1 = __pyx_t_7(__pyx_t_4); if (unlikely(!__pyx_t_1)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_1);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_4), 2) < 0) __PYX_ERR(0, 136, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_4), 2) < 0) __PYX_ERR(0, 147, __pyx_L1_error)
     __pyx_t_7 = NULL;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     goto __pyx_L4_unpacking_done;
     __pyx_L3_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_7 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 136, __pyx_L1_error)
+    __PYX_ERR(0, 147, __pyx_L1_error)
     __pyx_L4_unpacking_done:;
   }
   __pyx_v_unique_nodes = __pyx_t_5;
   __pyx_t_5 = 0;
   __pyx_v_unique_counts = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":137
+  /* "ext/skeletontricks/skeletontricks.pyx":148
  * 
  *   unique_nodes, unique_counts = np.unique(edges, return_counts=True)
  *   terminal_nodes = unique_nodes[ unique_counts == 1 ]             # <<<<<<<<<<<<<<
  *   branch_nodes = set(unique_nodes[ unique_counts >= 3 ])
  * 
  */
-  __pyx_t_6 = __Pyx_PyInt_EqObjC(__pyx_v_unique_counts, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 137, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_EqObjC(__pyx_v_unique_counts, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_unique_nodes, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 137, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_unique_nodes, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_terminal_nodes = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":138
+  /* "ext/skeletontricks/skeletontricks.pyx":149
  *   unique_nodes, unique_counts = np.unique(edges, return_counts=True)
  *   terminal_nodes = unique_nodes[ unique_counts == 1 ]
  *   branch_nodes = set(unique_nodes[ unique_counts >= 3 ])             # <<<<<<<<<<<<<<
  * 
  *   critical_points = set(terminal_nodes)
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_unique_counts, __pyx_int_3, Py_GE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)
-  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_unique_nodes, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 138, __pyx_L1_error)
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_unique_counts, __pyx_int_3, Py_GE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_unique_nodes, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PySet_New(__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)
+  __pyx_t_1 = PySet_New(__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 149, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_branch_nodes = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":140
+  /* "ext/skeletontricks/skeletontricks.pyx":151
  *   branch_nodes = set(unique_nodes[ unique_counts >= 3 ])
  * 
  *   critical_points = set(terminal_nodes)             # <<<<<<<<<<<<<<
  *   critical_points.update(branch_nodes)
  * 
  */
-  __pyx_t_1 = PySet_New(__pyx_v_terminal_nodes); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)
+  __pyx_t_1 = PySet_New(__pyx_v_terminal_nodes); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_critical_points = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":141
+  /* "ext/skeletontricks/skeletontricks.pyx":152
  * 
  *   critical_points = set(terminal_nodes)
  *   critical_points.update(branch_nodes)             # <<<<<<<<<<<<<<
  * 
  *   res = _create_distance_graph(
  */
-  __pyx_t_1 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PySet_Type_update, __pyx_v_critical_points, __pyx_v_branch_nodes); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PySet_Type_update, __pyx_v_critical_points, __pyx_v_branch_nodes); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":144
+  /* "ext/skeletontricks/skeletontricks.pyx":155
  * 
  *   res = _create_distance_graph(
  *     <float*>&vertices[0,0], vertices.shape[0],             # <<<<<<<<<<<<<<
  *     <uint32_t*>&edges[0,0], edges.shape[0], terminal_nodes[0],
  *     list(critical_points)
  */
   __pyx_t_8 = 0;
@@ -24044,19 +24354,19 @@
   } else if (unlikely(__pyx_t_8 >= __pyx_pybuffernd_vertices.diminfo[0].shape)) __pyx_t_10 = 0;
   if (__pyx_t_9 < 0) {
     __pyx_t_9 += __pyx_pybuffernd_vertices.diminfo[1].shape;
     if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 1;
   } else if (unlikely(__pyx_t_9 >= __pyx_pybuffernd_vertices.diminfo[1].shape)) __pyx_t_10 = 1;
   if (unlikely(__pyx_t_10 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_10);
-    __PYX_ERR(0, 144, __pyx_L1_error)
+    __PYX_ERR(0, 155, __pyx_L1_error)
   }
-  __pyx_t_11 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_vertices)); if (unlikely(__pyx_t_11 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
+  __pyx_t_11 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_vertices)); if (unlikely(__pyx_t_11 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 155, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":145
+  /* "ext/skeletontricks/skeletontricks.pyx":156
  *   res = _create_distance_graph(
  *     <float*>&vertices[0,0], vertices.shape[0],
  *     <uint32_t*>&edges[0,0], edges.shape[0], terminal_nodes[0],             # <<<<<<<<<<<<<<
  *     list(critical_points)
  *   )
  */
   __pyx_t_12 = 0;
@@ -24068,167 +24378,167 @@
   } else if (unlikely(__pyx_t_12 >= __pyx_pybuffernd_edges.diminfo[0].shape)) __pyx_t_10 = 0;
   if (__pyx_t_13 < 0) {
     __pyx_t_13 += __pyx_pybuffernd_edges.diminfo[1].shape;
     if (unlikely(__pyx_t_13 < 0)) __pyx_t_10 = 1;
   } else if (unlikely(__pyx_t_13 >= __pyx_pybuffernd_edges.diminfo[1].shape)) __pyx_t_10 = 1;
   if (unlikely(__pyx_t_10 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_10);
-    __PYX_ERR(0, 145, __pyx_L1_error)
+    __PYX_ERR(0, 156, __pyx_L1_error)
   }
-  __pyx_t_14 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_edges)); if (unlikely(__pyx_t_14 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 145, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_terminal_nodes, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 145, __pyx_L1_error)
+  __pyx_t_14 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_edges)); if (unlikely(__pyx_t_14 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 156, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_terminal_nodes, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 156, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_15 = __Pyx_PyInt_As_uint32_t(__pyx_t_1); if (unlikely((__pyx_t_15 == ((uint32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 145, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyInt_As_uint32_t(__pyx_t_1); if (unlikely((__pyx_t_15 == ((uint32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 156, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":146
+  /* "ext/skeletontricks/skeletontricks.pyx":157
  *     <float*>&vertices[0,0], vertices.shape[0],
  *     <uint32_t*>&edges[0,0], edges.shape[0], terminal_nodes[0],
  *     list(critical_points)             # <<<<<<<<<<<<<<
  *   )
  *   cdef dict supergraph = res
  */
-  __pyx_t_1 = PySequence_List(__pyx_v_critical_points); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __pyx_t_1 = PySequence_List(__pyx_v_critical_points); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_16 = __pyx_convert_vector_from_py_int32_t(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 146, __pyx_L1_error)
+  __pyx_t_16 = __pyx_convert_vector_from_py_int32_t(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 157, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":143
+  /* "ext/skeletontricks/skeletontricks.pyx":154
  *   critical_points.update(branch_nodes)
  * 
  *   res = _create_distance_graph(             # <<<<<<<<<<<<<<
  *     <float*>&vertices[0,0], vertices.shape[0],
  *     <uint32_t*>&edges[0,0], edges.shape[0], terminal_nodes[0],
  */
   __pyx_v_res = skeletontricks::_create_distance_graph(((float *)(&(*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_vertices.rcbuffer->pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_vertices.diminfo[0].strides, __pyx_t_9, __pyx_pybuffernd_vertices.diminfo[1].strides)))), (__pyx_t_11[0]), ((uint32_t *)(&(*__Pyx_BufPtrStrided2d(uint32_t *, __pyx_pybuffernd_edges.rcbuffer->pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_edges.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_edges.diminfo[1].strides)))), (__pyx_t_14[0]), __pyx_t_15, __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_16));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":148
+  /* "ext/skeletontricks/skeletontricks.pyx":159
  *     list(critical_points)
  *   )
  *   cdef dict supergraph = res             # <<<<<<<<<<<<<<
  * 
  *   cdef dict real_supergraph = {}
  */
-  __pyx_t_1 = __pyx_convert_unordered_map_to_py_uint64_t____float(__pyx_v_res); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_unordered_map_to_py_uint64_t____float(__pyx_v_res); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 159, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyDict_CheckExact(__pyx_t_1)) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_1))) __PYX_ERR(0, 148, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_t_1)) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_1))) __PYX_ERR(0, 159, __pyx_L1_error)
   __pyx_v_supergraph = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":150
+  /* "ext/skeletontricks/skeletontricks.pyx":161
  *   cdef dict supergraph = res
  * 
  *   cdef dict real_supergraph = {}             # <<<<<<<<<<<<<<
  *   cdef uint64_t key = 0
  *   cdef int32_t e1, e2
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 150, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 161, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_real_supergraph = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":151
+  /* "ext/skeletontricks/skeletontricks.pyx":162
  * 
  *   cdef dict real_supergraph = {}
  *   cdef uint64_t key = 0             # <<<<<<<<<<<<<<
  *   cdef int32_t e1, e2
  * 
  */
   __pyx_v_key = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":154
+  /* "ext/skeletontricks/skeletontricks.pyx":165
  *   cdef int32_t e1, e2
  * 
  *   for key in supergraph.keys():             # <<<<<<<<<<<<<<
  *     e2 = <int32_t>(key & 0xffffffff)
  *     e1 = <int32_t>(key >> 32)
  */
   __pyx_t_17 = 0;
-  __pyx_t_6 = __Pyx_dict_iterator(__pyx_v_supergraph, 1, __pyx_n_s_keys, (&__pyx_t_18), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(__pyx_v_supergraph, 1, __pyx_n_s_keys, (&__pyx_t_18), (&__pyx_t_10)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_19 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_18, &__pyx_t_17, &__pyx_t_6, NULL, NULL, __pyx_t_10);
     if (unlikely(__pyx_t_19 == 0)) break;
-    if (unlikely(__pyx_t_19 == -1)) __PYX_ERR(0, 154, __pyx_L1_error)
+    if (unlikely(__pyx_t_19 == -1)) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_20 = __Pyx_PyInt_As_uint64_t(__pyx_t_6); if (unlikely((__pyx_t_20 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+    __pyx_t_20 = __Pyx_PyInt_As_uint64_t(__pyx_t_6); if (unlikely((__pyx_t_20 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 165, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_v_key = __pyx_t_20;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":155
+    /* "ext/skeletontricks/skeletontricks.pyx":166
  * 
  *   for key in supergraph.keys():
  *     e2 = <int32_t>(key & 0xffffffff)             # <<<<<<<<<<<<<<
  *     e1 = <int32_t>(key >> 32)
  *     real_supergraph[ (e1, e2) ] = supergraph[key]
  */
-    __pyx_t_6 = __Pyx_PyInt_From_uint64_t(__pyx_v_key); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 155, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_uint64_t(__pyx_v_key); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 166, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_5 = PyNumber_And(__pyx_t_6, __pyx_int_4294967295); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 155, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_And(__pyx_t_6, __pyx_int_4294967295); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 166, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_21 = __Pyx_PyInt_As_int32_t(__pyx_t_5); if (unlikely((__pyx_t_21 == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 155, __pyx_L1_error)
+    __pyx_t_21 = __Pyx_PyInt_As_int32_t(__pyx_t_5); if (unlikely((__pyx_t_21 == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 166, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_v_e2 = ((int32_t)__pyx_t_21);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":156
+    /* "ext/skeletontricks/skeletontricks.pyx":167
  *   for key in supergraph.keys():
  *     e2 = <int32_t>(key & 0xffffffff)
  *     e1 = <int32_t>(key >> 32)             # <<<<<<<<<<<<<<
  *     real_supergraph[ (e1, e2) ] = supergraph[key]
  * 
  */
     __pyx_v_e1 = ((int32_t)(__pyx_v_key >> 32));
 
-    /* "ext/skeletontricks/skeletontricks.pyx":157
+    /* "ext/skeletontricks/skeletontricks.pyx":168
  *     e2 = <int32_t>(key & 0xffffffff)
  *     e1 = <int32_t>(key >> 32)
  *     real_supergraph[ (e1, e2) ] = supergraph[key]             # <<<<<<<<<<<<<<
  * 
  *   return real_supergraph
  */
-    __pyx_t_5 = __Pyx_PyInt_From_uint64_t(__pyx_v_key); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 157, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_From_uint64_t(__pyx_v_key); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 168, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_supergraph, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 157, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_supergraph, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 168, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyInt_From_int32_t(__pyx_v_e1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 157, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_From_int32_t(__pyx_v_e1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 168, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __Pyx_PyInt_From_int32_t(__pyx_v_e2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 157, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_int32_t(__pyx_v_e2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 168, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_22 = PyTuple_New(2); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 157, __pyx_L1_error)
+    __pyx_t_22 = PyTuple_New(2); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 168, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_22);
     __Pyx_GIVEREF(__pyx_t_5);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_22, 0, __pyx_t_5)) __PYX_ERR(0, 157, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_22, 0, __pyx_t_5)) __PYX_ERR(0, 168, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_4);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_22, 1, __pyx_t_4)) __PYX_ERR(0, 157, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_22, 1, __pyx_t_4)) __PYX_ERR(0, 168, __pyx_L1_error);
     __pyx_t_5 = 0;
     __pyx_t_4 = 0;
-    if (unlikely((PyDict_SetItem(__pyx_v_real_supergraph, __pyx_t_22, __pyx_t_6) < 0))) __PYX_ERR(0, 157, __pyx_L1_error)
+    if (unlikely((PyDict_SetItem(__pyx_v_real_supergraph, __pyx_t_22, __pyx_t_6) < 0))) __PYX_ERR(0, 168, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":159
+  /* "ext/skeletontricks/skeletontricks.pyx":170
  *     real_supergraph[ (e1, e2) ] = supergraph[key]
  * 
  *   return real_supergraph             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_real_supergraph);
   __pyx_r = __pyx_v_real_supergraph;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":110
+  /* "ext/skeletontricks/skeletontricks.pyx":121
  *   return elist
  * 
  * def create_distance_graph(skeleton):             # <<<<<<<<<<<<<<
  *   """
  *   Creates the distance "supergraph" from a single connected component
  */
 
@@ -24263,15 +24573,15 @@
   __Pyx_XDECREF(__pyx_v_supergraph);
   __Pyx_XDECREF(__pyx_v_real_supergraph);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":162
+/* "ext/skeletontricks/skeletontricks.pyx":173
  * 
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -24325,45 +24635,45 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 162, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 173, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "inf2zero") < 0)) __PYX_ERR(0, 162, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "inf2zero") < 0)) __PYX_ERR(0, 173, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("inf2zero", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 162, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("inf2zero", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 173, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.inf2zero", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 165, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 176, __pyx_L1_error)
   __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_4inf2zero(__pyx_self, __pyx_v_field);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -24408,134 +24718,134 @@
   __Pyx_RefNannySetupContext("inf2zero", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 162, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 173, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":176
+  /* "ext/skeletontricks/skeletontricks.pyx":187
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 176, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 187, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":177
+  /* "ext/skeletontricks/skeletontricks.pyx":188
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 177, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 188, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":178
+  /* "ext/skeletontricks/skeletontricks.pyx":189
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":180
+  /* "ext/skeletontricks/skeletontricks.pyx":191
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":181
+    /* "ext/skeletontricks/skeletontricks.pyx":192
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] == INFINITY):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":182
+      /* "ext/skeletontricks/skeletontricks.pyx":193
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] == INFINITY):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":183
+        /* "ext/skeletontricks/skeletontricks.pyx":194
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] == INFINITY):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) == INFINITY);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":184
+          /* "ext/skeletontricks/skeletontricks.pyx":195
  *       for x in range(0, sx):
  *         if (field[x,y,z] == INFINITY):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0.0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":183
+          /* "ext/skeletontricks/skeletontricks.pyx":194
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] == INFINITY):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":186
+  /* "ext/skeletontricks/skeletontricks.pyx":197
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":162
+  /* "ext/skeletontricks/skeletontricks.pyx":173
  * 
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -24554,15 +24864,15 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_field.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":188
+/* "ext/skeletontricks/skeletontricks.pyx":199
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -24616,45 +24926,45 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 188, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 199, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero2inf") < 0)) __PYX_ERR(0, 188, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero2inf") < 0)) __PYX_ERR(0, 199, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero2inf", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 188, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero2inf", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 199, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero2inf", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 191, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 202, __pyx_L1_error)
   __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_6zero2inf(__pyx_self, __pyx_v_field);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -24699,134 +25009,134 @@
   __Pyx_RefNannySetupContext("zero2inf", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 188, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 199, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":202
+  /* "ext/skeletontricks/skeletontricks.pyx":213
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 202, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 213, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":203
+  /* "ext/skeletontricks/skeletontricks.pyx":214
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 203, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":204
+  /* "ext/skeletontricks/skeletontricks.pyx":215
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 204, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 215, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":206
+  /* "ext/skeletontricks/skeletontricks.pyx":217
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":207
+    /* "ext/skeletontricks/skeletontricks.pyx":218
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] == 0):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":208
+      /* "ext/skeletontricks/skeletontricks.pyx":219
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] == 0):
  *           field[x,y,z] = INFINITY
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":209
+        /* "ext/skeletontricks/skeletontricks.pyx":220
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] == 0):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = INFINITY
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) == 0.0);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":210
+          /* "ext/skeletontricks/skeletontricks.pyx":221
  *       for x in range(0, sx):
  *         if (field[x,y,z] == 0):
  *           field[x,y,z] = INFINITY             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = INFINITY;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":209
+          /* "ext/skeletontricks/skeletontricks.pyx":220
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] == 0):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = INFINITY
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":212
+  /* "ext/skeletontricks/skeletontricks.pyx":223
  *           field[x,y,z] = INFINITY
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":188
+  /* "ext/skeletontricks/skeletontricks.pyx":199
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -24845,15 +25155,15 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_field.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":214
+/* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -24905,57 +25215,57 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_signatures)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_args)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_kwargs)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 225, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_defaults)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 225, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_fused_sigindex);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
@@ -24969,15 +25279,15 @@
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
     __pyx_v__fused_sigindex = values[4];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
@@ -25056,36 +25366,36 @@
   Py_ssize_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("zero_out_all_except", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, Py_None)) __PYX_ERR(0, 214, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, Py_None)) __PYX_ERR(0, 225, __pyx_L1_error);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   if (__pyx_t_3) {
   } else {
     __pyx_t_2 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_3);
   __pyx_t_2 = __pyx_t_4;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v___pyx_fused_dtype_int8__t_is_signed = (!(((int8_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_int16__t_is_signed = (!(((int16_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_int32__t_is_signed = (!(((int32_t)-1L) > 0));
@@ -25093,22 +25403,22 @@
   __pyx_v___pyx_fused_dtype_uint8__t_is_signed = (!(((uint8_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint16__t_is_signed = (!(((uint16_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint32__t_is_signed = (!(((uint32_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint64__t_is_signed = (!(((uint64_t)-1L) > 0));
   __pyx_v_unsigned_char_is_signed = (!(((unsigned char)-1L) > 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 214, __pyx_L1_error)
+    __PYX_ERR(0, 225, __pyx_L1_error)
   }
-  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 225, __pyx_L1_error)
   __pyx_t_2 = (0 < __pyx_t_5);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 214, __pyx_L1_error)
+      __PYX_ERR(0, 225, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 0);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -25116,80 +25426,80 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 214, __pyx_L1_error)
+    __PYX_ERR(0, 225, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_field, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_field, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
   __pyx_t_2 = __pyx_t_4;
   __pyx_L7_bool_binop_done:;
   if (likely(__pyx_t_2)) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 214, __pyx_L1_error)
+      __PYX_ERR(0, 225, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_field); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_field); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 214, __pyx_L1_error)
+      __PYX_ERR(0, 225, __pyx_L1_error)
     }
-    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 214, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 225, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_2);
     __Pyx_GIVEREF(__pyx_int_2);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_2)) __PYX_ERR(0, 214, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_2)) __PYX_ERR(0, 225, __pyx_L1_error);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 214, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 225, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_1);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 214, __pyx_L1_error)
+    __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -25202,233 +25512,233 @@
         __Pyx_INCREF(Py_None);
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 0x69);
         switch (__pyx_v_kind) {
           case 0x69:
           case 0x75:
           __pyx_t_4 = ((sizeof(int8_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int8__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(int16_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int16__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L20_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(int32_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int32__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L24_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(int64_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int64__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L28_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint8_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint8__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L32_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint16_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L36_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L36_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint16__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L36_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint32_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L40_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L40_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint32__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L40_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint64_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L44_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L44_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint64__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L44_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(unsigned char)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L48_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L48_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v_unsigned_char_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L48_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 0x66:
           break;
           case 99:
           break;
@@ -25436,349 +25746,349 @@
           break;
           default: break;
         }
       }
     }
     __pyx_t_2 = (__pyx_v_arg == Py_None);
     if (__pyx_t_2) {
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
       goto __pyx_L10_break;
     }
     {
       __Pyx_PyThreadState_declare
       __Pyx_PyThreadState_assign
       __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
       __Pyx_XGOTREF(__pyx_t_8);
       __Pyx_XGOTREF(__pyx_t_9);
       __Pyx_XGOTREF(__pyx_t_10);
       /*try:*/ {
-        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L52_error)
+        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L52_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_as_memoryview = ((PyObject*)__pyx_t_6);
         __pyx_t_6 = 0;
       }
       /*else:*/ {
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L63_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int8_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L62_next_and;
         }
         __pyx_L63_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int8_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L61_bool_binop_done;
         }
         __pyx_L62_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L61_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int8_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L69_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int16_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L68_next_and;
         }
         __pyx_L69_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int16_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L67_bool_binop_done;
         }
         __pyx_L68_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L67_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int16_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L75_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int32_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L74_next_and;
         }
         __pyx_L75_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int32_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L73_bool_binop_done;
         }
         __pyx_L74_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L73_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int32_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L81_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int64_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L80_next_and;
         }
         __pyx_L81_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int64_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L79_bool_binop_done;
         }
         __pyx_L80_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L79_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int64_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L87_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint8_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L86_next_and;
         }
         __pyx_L87_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint8_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L85_bool_binop_done;
         }
         __pyx_L86_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L85_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint8_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L93_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint16_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L92_next_and;
         }
         __pyx_L93_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint16_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L91_bool_binop_done;
         }
         __pyx_L92_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L91_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint16_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L99_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint32_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L98_next_and;
         }
         __pyx_L99_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint32_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L97_bool_binop_done;
         }
         __pyx_L98_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L97_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint32_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L105_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint64_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L104_next_and;
         }
         __pyx_L105_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint64_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L103_bool_binop_done;
         }
         __pyx_L104_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L103_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint64_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L111_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(unsigned char)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L110_next_and;
         }
         __pyx_L111_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(unsigned char)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L109_bool_binop_done;
         }
         __pyx_L110_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L109_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_unsigned_char(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
       }
@@ -25788,15 +26098,15 @@
       goto __pyx_L59_try_end;
       __pyx_L52_error:;
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_11 = __Pyx_PyErr_ExceptionMatches2(__pyx_builtin_ValueError, __pyx_builtin_TypeError);
       if (__pyx_t_11) {
         __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
-        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 214, __pyx_L54_except_error)
+        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 225, __pyx_L54_except_error)
         __Pyx_XGOTREF(__pyx_t_6);
         __Pyx_XGOTREF(__pyx_t_1);
         __Pyx_XGOTREF(__pyx_t_13);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         goto __pyx_L53_exception_handled;
@@ -25817,43 +26127,43 @@
       __pyx_L53_exception_handled:;
       __Pyx_XGIVEREF(__pyx_t_8);
       __Pyx_XGIVEREF(__pyx_t_9);
       __Pyx_XGIVEREF(__pyx_t_10);
       __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
       __pyx_L59_try_end:;
     }
-    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_2);
   if (__pyx_t_4) {
     __pyx_t_5 = 0;
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 214, __pyx_L1_error)
+      __PYX_ERR(0, 225, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF(__pyx_t_13);
     __pyx_t_13 = __pyx_t_1;
     __pyx_t_1 = 0;
     while (1) {
       __pyx_t_15 = __Pyx_dict_iter_next(__pyx_t_13, __pyx_t_14, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_11);
       if (unlikely(__pyx_t_15 == 0)) break;
-      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_1 = __pyx_v__fused_sigindex;
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_1));
       __pyx_t_1 = 0;
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 214, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __pyx_t_17 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_17 = PyMethod_GET_SELF(__pyx_t_16);
         if (likely(__pyx_t_17)) {
@@ -25865,19 +26175,19 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_17, __pyx_kp_s__13};
         __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 214, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_6 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_16);
@@ -25890,34 +26200,34 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_kp_s__14};
         __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 214, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_18 = PyList_GET_SIZE(__pyx_t_16);
       if (unlikely(__pyx_t_18 < 1)) {
-        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 214, __pyx_L1_error)
+        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 225, __pyx_L1_error)
       }
       #if CYTHON_COMPILING_IN_CPYTHON
       __pyx_t_6 = PyList_GET_ITEM(__pyx_t_16, __pyx_t_18-1); 
       ((PyVarObject*)__pyx_t_16)->ob_size--;
       #else
       __pyx_t_6 = PySequence_ITEM(__pyx_t_16, __pyx_t_18-1); 
       #endif
       __Pyx_GOTREF(__pyx_t_6);
       #if !CYTHON_COMPILING_IN_CPYTHON
-      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 214, __pyx_L1_error)
+      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_17);
       __Pyx_DECREF(__pyx_t_16);
       __pyx_t_16 = __pyx_t_17; __pyx_t_17 = NULL;
       #else
       CYTHON_UNUSED_VAR(__pyx_t_17);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_sig_series, ((PyObject*)__pyx_t_16));
@@ -25926,220 +26236,220 @@
       __pyx_t_6 = 0;
       __pyx_t_1 = __pyx_v_sig_series; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_18 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
           #endif
           if (__pyx_t_18 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
         #else
-        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sig_type, __pyx_t_6);
         __pyx_t_6 = 0;
         if (unlikely(__pyx_v_sigindex_node == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 214, __pyx_L1_error)
+          __PYX_ERR(0, 225, __pyx_L1_error)
         }
-        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
         if (__pyx_t_4) {
-          __pyx_t_6 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 214, __pyx_L1_error)
+            __PYX_ERR(0, 225, __pyx_L1_error)
           }
-          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_6) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_6) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, __pyx_t_6);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           goto __pyx_L121;
         }
         /*else*/ {
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 214, __pyx_L1_error)
+            __PYX_ERR(0, 225, __pyx_L1_error)
           }
-          __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_t_16 = __pyx_t_6;
           __Pyx_INCREF(__pyx_t_16);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_16));
           __pyx_t_16 = 0;
         }
         __pyx_L121:;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       if (unlikely(__pyx_v_sigindex_node == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 214, __pyx_L1_error)
+        __PYX_ERR(0, 225, __pyx_L1_error)
       }
-      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   }
-  __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __pyx_v_sigindex_matches = ((PyObject*)__pyx_t_13);
   __pyx_t_13 = 0;
-  __pyx_t_13 = PyList_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_13 = PyList_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_INCREF(__pyx_v__fused_sigindex);
   __Pyx_GIVEREF(__pyx_v__fused_sigindex);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_13, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 214, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_13, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 225, __pyx_L1_error);
   __pyx_v_sigindex_candidates = ((PyObject*)__pyx_t_13);
   __pyx_t_13 = 0;
   __pyx_t_13 = __pyx_v_dest_sig; __Pyx_INCREF(__pyx_t_13);
   __pyx_t_14 = 0;
   for (;;) {
     {
       Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_13);
       #if !CYTHON_ASSUME_SAFE_MACROS
-      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
       #endif
       if (__pyx_t_14 >= __pyx_temp) break;
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
     #else
-    __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_found_matches, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_found_candidates, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
     __pyx_t_4 = (__pyx_v_dst_type == Py_None);
     if (__pyx_t_4) {
       __pyx_t_1 = __pyx_v_sigindex_matches; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 214, __pyx_L1_error)
+          __PYX_ERR(0, 225, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_1 = __pyx_v_sigindex_candidates; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 214, __pyx_L1_error)
+          __PYX_ERR(0, 225, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       goto __pyx_L125;
     }
     /*else*/ {
-      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_INCREF(__pyx_v_sigindex_matches);
       __Pyx_GIVEREF(__pyx_v_sigindex_matches);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 214, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 225, __pyx_L1_error);
       __Pyx_INCREF(__pyx_v_sigindex_candidates);
       __Pyx_GIVEREF(__pyx_v_sigindex_candidates);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 214, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 225, __pyx_L1_error);
       __pyx_t_16 = __pyx_t_1; __Pyx_INCREF(__pyx_t_16);
       __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       for (;;) {
         if (__pyx_t_5 >= 2) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
         #else
-        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 214, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 225, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_search_list, ((PyObject*)__pyx_t_1));
         __pyx_t_1 = 0;
         if (unlikely(__pyx_v_search_list == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 214, __pyx_L1_error)
+          __PYX_ERR(0, 225, __pyx_L1_error)
         }
         __pyx_t_1 = __pyx_v_search_list; __Pyx_INCREF(__pyx_t_1);
         __pyx_t_18 = 0;
         for (;;) {
           {
             Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
             #if !CYTHON_ASSUME_SAFE_MACROS
-            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
             #endif
             if (__pyx_t_18 >= __pyx_temp) break;
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 225, __pyx_L1_error)
           #else
-          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
           __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_6);
           __pyx_t_6 = 0;
           if (unlikely(__pyx_v_sn == Py_None)) {
             PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-            __PYX_ERR(0, 214, __pyx_L1_error)
+            __PYX_ERR(0, 225, __pyx_L1_error)
           }
-          __pyx_t_6 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 214, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 225, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_XDECREF_SET(__pyx_v_type_match, __pyx_t_6);
           __pyx_t_6 = 0;
           __pyx_t_4 = (__pyx_v_type_match != Py_None);
           if (__pyx_t_4) {
-            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 214, __pyx_L1_error)
+            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 225, __pyx_L1_error)
           }
         }
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       }
       __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
     }
     __pyx_L125:;
@@ -26168,36 +26478,36 @@
   goto __pyx_L142_for_end;
   __pyx_L142_for_end:;
   __Pyx_INCREF(__pyx_v_sigindex_matches);
   __pyx_v_candidates = __pyx_v_sigindex_matches;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_4 = (!__pyx_t_2);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_Raise(__pyx_t_13, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __PYX_ERR(0, 214, __pyx_L1_error)
+    __PYX_ERR(0, 225, __pyx_L1_error)
   }
-  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 225, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_14 > 1);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_Raise(__pyx_t_13, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __PYX_ERR(0, 214, __pyx_L1_error)
+    __PYX_ERR(0, 225, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 214, __pyx_L1_error)
+      __PYX_ERR(0, 225, __pyx_L1_error)
     }
-    __pyx_t_13 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 214, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -26233,17 +26543,17 @@
   __Pyx_XDECREF(__pyx_v_kwargs);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_37zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_37zero_out_all_except = {"__pyx_fuse_0zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_37zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
-static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_37zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_39zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_39zero_out_all_except = {"__pyx_fuse_0zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_39zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
+static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_39zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_field = 0;
   int8_t __pyx_v_leave_alone;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -26272,58 +26582,58 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_leave_alone)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
-    __pyx_v_leave_alone = __Pyx_PyInt_As_int8_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((int8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 217, __pyx_L3_error)
+    __pyx_v_leave_alone = __Pyx_PyInt_As_int8_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((int8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero_out_all_except", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 217, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_36zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_38zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -26332,15 +26642,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_36zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int8_t __pyx_v_leave_alone) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_38zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int8_t __pyx_v_leave_alone) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_field;
@@ -26367,134 +26677,134 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_0zero_out_all_except", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":228
+  /* "ext/skeletontricks/skeletontricks.pyx":239
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 239, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":229
+  /* "ext/skeletontricks/skeletontricks.pyx":240
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":230
+  /* "ext/skeletontricks/skeletontricks.pyx":241
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":232
+  /* "ext/skeletontricks/skeletontricks.pyx":243
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":233
+    /* "ext/skeletontricks/skeletontricks.pyx":244
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":234
+      /* "ext/skeletontricks/skeletontricks.pyx":245
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":235
+        /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) != __pyx_v_leave_alone);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":236
+          /* "ext/skeletontricks/skeletontricks.pyx":247
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":235
+          /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":238
+  /* "ext/skeletontricks/skeletontricks.pyx":249
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -26514,17 +26824,17 @@
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_39zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_39zero_out_all_except = {"__pyx_fuse_1zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_39zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
-static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_39zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_41zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_41zero_out_all_except = {"__pyx_fuse_1zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_41zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
+static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_41zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_field = 0;
   int16_t __pyx_v_leave_alone;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -26553,58 +26863,58 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_leave_alone)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
-    __pyx_v_leave_alone = __Pyx_PyInt_As_int16_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((int16_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 217, __pyx_L3_error)
+    __pyx_v_leave_alone = __Pyx_PyInt_As_int16_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((int16_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero_out_all_except", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 217, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_38zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_40zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -26613,15 +26923,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_38zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int16_t __pyx_v_leave_alone) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_40zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int16_t __pyx_v_leave_alone) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_field;
@@ -26648,134 +26958,134 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_1zero_out_all_except", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":228
+  /* "ext/skeletontricks/skeletontricks.pyx":239
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 239, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":229
+  /* "ext/skeletontricks/skeletontricks.pyx":240
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":230
+  /* "ext/skeletontricks/skeletontricks.pyx":241
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":232
+  /* "ext/skeletontricks/skeletontricks.pyx":243
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":233
+    /* "ext/skeletontricks/skeletontricks.pyx":244
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":234
+      /* "ext/skeletontricks/skeletontricks.pyx":245
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":235
+        /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) != __pyx_v_leave_alone);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":236
+          /* "ext/skeletontricks/skeletontricks.pyx":247
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":235
+          /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":238
+  /* "ext/skeletontricks/skeletontricks.pyx":249
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -26795,17 +27105,17 @@
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_41zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_41zero_out_all_except = {"__pyx_fuse_2zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_41zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
-static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_41zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_43zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_43zero_out_all_except = {"__pyx_fuse_2zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_43zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
+static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_43zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_field = 0;
   int32_t __pyx_v_leave_alone;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -26834,58 +27144,58 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_leave_alone)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
-    __pyx_v_leave_alone = __Pyx_PyInt_As_int32_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 217, __pyx_L3_error)
+    __pyx_v_leave_alone = __Pyx_PyInt_As_int32_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero_out_all_except", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 217, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_40zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_42zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -26894,15 +27204,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_40zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int32_t __pyx_v_leave_alone) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_42zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int32_t __pyx_v_leave_alone) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_field;
@@ -26929,134 +27239,134 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_2zero_out_all_except", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":228
+  /* "ext/skeletontricks/skeletontricks.pyx":239
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 239, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":229
+  /* "ext/skeletontricks/skeletontricks.pyx":240
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":230
+  /* "ext/skeletontricks/skeletontricks.pyx":241
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":232
+  /* "ext/skeletontricks/skeletontricks.pyx":243
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":233
+    /* "ext/skeletontricks/skeletontricks.pyx":244
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":234
+      /* "ext/skeletontricks/skeletontricks.pyx":245
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":235
+        /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) != __pyx_v_leave_alone);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":236
+          /* "ext/skeletontricks/skeletontricks.pyx":247
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":235
+          /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":238
+  /* "ext/skeletontricks/skeletontricks.pyx":249
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -27076,17 +27386,17 @@
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_43zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_43zero_out_all_except = {"__pyx_fuse_3zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_43zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
-static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_43zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_45zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_45zero_out_all_except = {"__pyx_fuse_3zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_45zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
+static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_45zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_field = 0;
   int64_t __pyx_v_leave_alone;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -27115,58 +27425,58 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_leave_alone)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
-    __pyx_v_leave_alone = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 217, __pyx_L3_error)
+    __pyx_v_leave_alone = __Pyx_PyInt_As_int64_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero_out_all_except", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 217, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_42zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_44zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -27175,15 +27485,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_42zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int64_t __pyx_v_leave_alone) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_44zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, int64_t __pyx_v_leave_alone) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_field;
@@ -27210,134 +27520,134 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_3zero_out_all_except", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":228
+  /* "ext/skeletontricks/skeletontricks.pyx":239
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 239, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":229
+  /* "ext/skeletontricks/skeletontricks.pyx":240
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":230
+  /* "ext/skeletontricks/skeletontricks.pyx":241
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":232
+  /* "ext/skeletontricks/skeletontricks.pyx":243
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":233
+    /* "ext/skeletontricks/skeletontricks.pyx":244
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":234
+      /* "ext/skeletontricks/skeletontricks.pyx":245
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":235
+        /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) != __pyx_v_leave_alone);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":236
+          /* "ext/skeletontricks/skeletontricks.pyx":247
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":235
+          /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":238
+  /* "ext/skeletontricks/skeletontricks.pyx":249
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -27357,17 +27667,17 @@
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_45zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_45zero_out_all_except = {"__pyx_fuse_4zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_45zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
-static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_45zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_47zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_47zero_out_all_except = {"__pyx_fuse_4zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_47zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
+static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_47zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_field = 0;
   uint8_t __pyx_v_leave_alone;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -27396,58 +27706,58 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_leave_alone)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
-    __pyx_v_leave_alone = __Pyx_PyInt_As_uint8_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 217, __pyx_L3_error)
+    __pyx_v_leave_alone = __Pyx_PyInt_As_uint8_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero_out_all_except", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 217, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_44zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_46zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -27456,15 +27766,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_44zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint8_t __pyx_v_leave_alone) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_46zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint8_t __pyx_v_leave_alone) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_field;
@@ -27491,134 +27801,134 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_4zero_out_all_except", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":228
+  /* "ext/skeletontricks/skeletontricks.pyx":239
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 239, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":229
+  /* "ext/skeletontricks/skeletontricks.pyx":240
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":230
+  /* "ext/skeletontricks/skeletontricks.pyx":241
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":232
+  /* "ext/skeletontricks/skeletontricks.pyx":243
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":233
+    /* "ext/skeletontricks/skeletontricks.pyx":244
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":234
+      /* "ext/skeletontricks/skeletontricks.pyx":245
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":235
+        /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) != __pyx_v_leave_alone);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":236
+          /* "ext/skeletontricks/skeletontricks.pyx":247
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":235
+          /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":238
+  /* "ext/skeletontricks/skeletontricks.pyx":249
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -27638,17 +27948,17 @@
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_47zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_5__pyx_mdef_8kimimaro_14skeletontricks_47zero_out_all_except = {"__pyx_fuse_5zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_47zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
-static PyObject *__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_47zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_49zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_5__pyx_mdef_8kimimaro_14skeletontricks_49zero_out_all_except = {"__pyx_fuse_5zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_49zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
+static PyObject *__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_49zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_field = 0;
   uint16_t __pyx_v_leave_alone;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -27677,58 +27987,58 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_leave_alone)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
-    __pyx_v_leave_alone = __Pyx_PyInt_As_uint16_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((uint16_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 217, __pyx_L3_error)
+    __pyx_v_leave_alone = __Pyx_PyInt_As_uint16_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((uint16_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero_out_all_except", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 217, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_46zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_48zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -27737,15 +28047,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_46zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint16_t __pyx_v_leave_alone) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_48zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint16_t __pyx_v_leave_alone) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_field;
@@ -27772,134 +28082,134 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_5zero_out_all_except", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":228
+  /* "ext/skeletontricks/skeletontricks.pyx":239
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 239, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":229
+  /* "ext/skeletontricks/skeletontricks.pyx":240
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":230
+  /* "ext/skeletontricks/skeletontricks.pyx":241
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":232
+  /* "ext/skeletontricks/skeletontricks.pyx":243
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":233
+    /* "ext/skeletontricks/skeletontricks.pyx":244
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":234
+      /* "ext/skeletontricks/skeletontricks.pyx":245
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":235
+        /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) != __pyx_v_leave_alone);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":236
+          /* "ext/skeletontricks/skeletontricks.pyx":247
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":235
+          /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":238
+  /* "ext/skeletontricks/skeletontricks.pyx":249
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -27919,17 +28229,17 @@
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_49zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_6__pyx_mdef_8kimimaro_14skeletontricks_49zero_out_all_except = {"__pyx_fuse_6zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_49zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
-static PyObject *__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_49zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_51zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_6__pyx_mdef_8kimimaro_14skeletontricks_51zero_out_all_except = {"__pyx_fuse_6zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_51zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
+static PyObject *__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_51zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_field = 0;
   uint32_t __pyx_v_leave_alone;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -27958,58 +28268,58 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_leave_alone)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
-    __pyx_v_leave_alone = __Pyx_PyInt_As_uint32_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((uint32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 217, __pyx_L3_error)
+    __pyx_v_leave_alone = __Pyx_PyInt_As_uint32_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((uint32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero_out_all_except", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 217, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_48zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_50zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -28018,15 +28328,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_48zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint32_t __pyx_v_leave_alone) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_50zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint32_t __pyx_v_leave_alone) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_field;
@@ -28053,134 +28363,134 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_6zero_out_all_except", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":228
+  /* "ext/skeletontricks/skeletontricks.pyx":239
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 239, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":229
+  /* "ext/skeletontricks/skeletontricks.pyx":240
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":230
+  /* "ext/skeletontricks/skeletontricks.pyx":241
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":232
+  /* "ext/skeletontricks/skeletontricks.pyx":243
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":233
+    /* "ext/skeletontricks/skeletontricks.pyx":244
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":234
+      /* "ext/skeletontricks/skeletontricks.pyx":245
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":235
+        /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) != __pyx_v_leave_alone);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":236
+          /* "ext/skeletontricks/skeletontricks.pyx":247
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":235
+          /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":238
+  /* "ext/skeletontricks/skeletontricks.pyx":249
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -28200,17 +28510,17 @@
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_51zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_7__pyx_mdef_8kimimaro_14skeletontricks_51zero_out_all_except = {"__pyx_fuse_7zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_51zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
-static PyObject *__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_51zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_53zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_7__pyx_mdef_8kimimaro_14skeletontricks_53zero_out_all_except = {"__pyx_fuse_7zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_53zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
+static PyObject *__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_53zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_field = 0;
   uint64_t __pyx_v_leave_alone;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -28239,58 +28549,58 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_leave_alone)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
-    __pyx_v_leave_alone = __Pyx_PyInt_As_uint64_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 217, __pyx_L3_error)
+    __pyx_v_leave_alone = __Pyx_PyInt_As_uint64_t(values[1]); if (unlikely((__pyx_v_leave_alone == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero_out_all_except", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 217, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_50zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_52zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -28299,15 +28609,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_50zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint64_t __pyx_v_leave_alone) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_52zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, uint64_t __pyx_v_leave_alone) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_field;
@@ -28334,134 +28644,134 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_7zero_out_all_except", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":228
+  /* "ext/skeletontricks/skeletontricks.pyx":239
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 239, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":229
+  /* "ext/skeletontricks/skeletontricks.pyx":240
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":230
+  /* "ext/skeletontricks/skeletontricks.pyx":241
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":232
+  /* "ext/skeletontricks/skeletontricks.pyx":243
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":233
+    /* "ext/skeletontricks/skeletontricks.pyx":244
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":234
+      /* "ext/skeletontricks/skeletontricks.pyx":245
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":235
+        /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) != __pyx_v_leave_alone);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":236
+          /* "ext/skeletontricks/skeletontricks.pyx":247
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":235
+          /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":238
+  /* "ext/skeletontricks/skeletontricks.pyx":249
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -28481,17 +28791,17 @@
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_53zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_8__pyx_mdef_8kimimaro_14skeletontricks_53zero_out_all_except = {"__pyx_fuse_8zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_53zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
-static PyObject *__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_53zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_55zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_8__pyx_mdef_8kimimaro_14skeletontricks_55zero_out_all_except = {"__pyx_fuse_8zero_out_all_except", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_55zero_out_all_except, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_8zero_out_all_except};
+static PyObject *__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_55zero_out_all_except(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_field = 0;
   unsigned char __pyx_v_leave_alone;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -28520,58 +28830,58 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_leave_alone)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 225, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 214, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, 1); __PYX_ERR(0, 225, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 214, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "zero_out_all_except") < 0)) __PYX_ERR(0, 225, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
-    __pyx_v_leave_alone = __Pyx_PyInt_As_unsigned_char(values[1]); if (unlikely((__pyx_v_leave_alone == (unsigned char)-1) && PyErr_Occurred())) __PYX_ERR(0, 217, __pyx_L3_error)
+    __pyx_v_leave_alone = __Pyx_PyInt_As_unsigned_char(values[1]); if (unlikely((__pyx_v_leave_alone == (unsigned char)-1) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 214, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("zero_out_all_except", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 225, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.zero_out_all_except", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 217, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_52zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_54zero_out_all_except(__pyx_self, __pyx_v_field, __pyx_v_leave_alone);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -28580,15 +28890,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_52zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, unsigned char __pyx_v_leave_alone) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_54zero_out_all_except(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_field, unsigned char __pyx_v_leave_alone) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_field;
@@ -28615,134 +28925,134 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_8zero_out_all_except", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 214, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 225, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":228
+  /* "ext/skeletontricks/skeletontricks.pyx":239
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 228, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 239, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":229
+  /* "ext/skeletontricks/skeletontricks.pyx":240
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":230
+  /* "ext/skeletontricks/skeletontricks.pyx":241
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":232
+  /* "ext/skeletontricks/skeletontricks.pyx":243
  *   sz = field.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":233
+    /* "ext/skeletontricks/skeletontricks.pyx":244
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":234
+      /* "ext/skeletontricks/skeletontricks.pyx":245
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":235
+        /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[2].strides)) != __pyx_v_leave_alone);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":236
+          /* "ext/skeletontricks/skeletontricks.pyx":247
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):
  *           field[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return field
  */
           __pyx_t_13 = __pyx_v_x;
           __pyx_t_12 = __pyx_v_y;
           __pyx_t_11 = __pyx_v_z;
           *__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_11, __pyx_pybuffernd_field.diminfo[2].strides) = 0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":235
+          /* "ext/skeletontricks/skeletontricks.pyx":246
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] != leave_alone):             # <<<<<<<<<<<<<<
  *           field[x,y,z] = 0
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":238
+  /* "ext/skeletontricks/skeletontricks.pyx":249
  *           field[x,y,z] = 0
  * 
  *   return field             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF((PyObject *)__pyx_v_field);
   __pyx_r = ((PyObject *)__pyx_v_field);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -28761,15 +29071,15 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_field.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":240
+/* "ext/skeletontricks/skeletontricks.pyx":251
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -28823,45 +29133,45 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 251, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "finite_max") < 0)) __PYX_ERR(0, 240, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "finite_max") < 0)) __PYX_ERR(0, 251, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("finite_max", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 240, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("finite_max", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 251, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.finite_max", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 243, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 254, __pyx_L1_error)
   __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_10finite_max(__pyx_self, __pyx_v_field);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -28909,94 +29219,94 @@
   __Pyx_RefNannySetupContext("finite_max", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 240, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 251, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":253
+  /* "ext/skeletontricks/skeletontricks.pyx":264
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 253, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 264, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":254
+  /* "ext/skeletontricks/skeletontricks.pyx":265
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 254, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 265, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":255
+  /* "ext/skeletontricks/skeletontricks.pyx":266
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef float maximum = -INFINITY
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 255, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 266, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":257
+  /* "ext/skeletontricks/skeletontricks.pyx":268
  *   sz = field.shape[2]
  * 
  *   cdef float maximum = -INFINITY             # <<<<<<<<<<<<<<
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  */
   __pyx_v_maximum = (-INFINITY);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":258
+  /* "ext/skeletontricks/skeletontricks.pyx":269
  * 
  *   cdef float maximum = -INFINITY
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":259
+    /* "ext/skeletontricks/skeletontricks.pyx":270
  *   cdef float maximum = -INFINITY
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] > maximum) and (field[x,y,z] < +INFINITY):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":260
+      /* "ext/skeletontricks/skeletontricks.pyx":271
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] > maximum) and (field[x,y,z] < +INFINITY):
  *           maximum = field[x,y,z]
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":261
+        /* "ext/skeletontricks/skeletontricks.pyx":272
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] > maximum) and (field[x,y,z] < +INFINITY):             # <<<<<<<<<<<<<<
  *           maximum = field[x,y,z]
  * 
  */
         __pyx_t_12 = __pyx_v_x;
@@ -29012,53 +29322,53 @@
         __pyx_t_13 = __pyx_v_y;
         __pyx_t_12 = __pyx_v_z;
         __pyx_t_15 = ((*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[2].strides)) < INFINITY);
         __pyx_t_11 = __pyx_t_15;
         __pyx_L10_bool_binop_done:;
         if (__pyx_t_11) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":262
+          /* "ext/skeletontricks/skeletontricks.pyx":273
  *       for x in range(0, sx):
  *         if (field[x,y,z] > maximum) and (field[x,y,z] < +INFINITY):
  *           maximum = field[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return maximum
  */
           __pyx_t_12 = __pyx_v_x;
           __pyx_t_13 = __pyx_v_y;
           __pyx_t_14 = __pyx_v_z;
           __pyx_v_maximum = (*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_14, __pyx_pybuffernd_field.diminfo[2].strides));
 
-          /* "ext/skeletontricks/skeletontricks.pyx":261
+          /* "ext/skeletontricks/skeletontricks.pyx":272
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] > maximum) and (field[x,y,z] < +INFINITY):             # <<<<<<<<<<<<<<
  *           maximum = field[x,y,z]
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":264
+  /* "ext/skeletontricks/skeletontricks.pyx":275
  *           maximum = field[x,y,z]
  * 
  *   return maximum             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_16 = PyFloat_FromDouble(__pyx_v_maximum); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 264, __pyx_L1_error)
+  __pyx_t_16 = PyFloat_FromDouble(__pyx_v_maximum); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 275, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_16);
   __pyx_r = __pyx_t_16;
   __pyx_t_16 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":240
+  /* "ext/skeletontricks/skeletontricks.pyx":251
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -29078,15 +29388,15 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_field.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":266
+/* "ext/skeletontricks/skeletontricks.pyx":277
  *   return maximum
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -29140,45 +29450,45 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_field)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 266, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 277, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "finite_min") < 0)) __PYX_ERR(0, 266, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "finite_min") < 0)) __PYX_ERR(0, 277, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_field = ((PyArrayObject *)values[0]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("finite_min", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 266, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("finite_min", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 277, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.finite_min", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 269, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_field), __pyx_ptype_5numpy_ndarray, 1, "field", 0))) __PYX_ERR(0, 280, __pyx_L1_error)
   __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_12finite_min(__pyx_self, __pyx_v_field);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -29226,94 +29536,94 @@
   __Pyx_RefNannySetupContext("finite_min", 1);
   __pyx_pybuffer_field.pybuffer.buf = NULL;
   __pyx_pybuffer_field.refcount = 0;
   __pyx_pybuffernd_field.data = NULL;
   __pyx_pybuffernd_field.rcbuffer = &__pyx_pybuffer_field;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 266, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_field.rcbuffer->pybuffer, (PyObject*)__pyx_v_field, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 277, __pyx_L1_error)
   }
   __pyx_pybuffernd_field.diminfo[0].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_field.diminfo[0].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_field.diminfo[1].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_field.diminfo[1].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_field.diminfo[2].strides = __pyx_pybuffernd_field.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_field.diminfo[2].shape = __pyx_pybuffernd_field.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":279
+  /* "ext/skeletontricks/skeletontricks.pyx":290
  *   cdef size_t  x,  y,  z
  * 
  *   sx = field.shape[0]             # <<<<<<<<<<<<<<
  *   sy = field.shape[1]
  *   sz = field.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 279, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 290, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":280
+  /* "ext/skeletontricks/skeletontricks.pyx":291
  * 
  *   sx = field.shape[0]
  *   sy = field.shape[1]             # <<<<<<<<<<<<<<
  *   sz = field.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 280, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 291, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":281
+  /* "ext/skeletontricks/skeletontricks.pyx":292
  *   sx = field.shape[0]
  *   sy = field.shape[1]
  *   sz = field.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef float minimum = -INFINITY
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 281, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_field)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 292, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":283
+  /* "ext/skeletontricks/skeletontricks.pyx":294
  *   sz = field.shape[2]
  * 
  *   cdef float minimum = -INFINITY             # <<<<<<<<<<<<<<
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  */
   __pyx_v_minimum = (-INFINITY);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":284
+  /* "ext/skeletontricks/skeletontricks.pyx":295
  * 
  *   cdef float minimum = -INFINITY
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":285
+    /* "ext/skeletontricks/skeletontricks.pyx":296
  *   cdef float minimum = -INFINITY
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if (field[x,y,z] < minimum) and (field[x,y,z] > -INFINITY):
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":286
+      /* "ext/skeletontricks/skeletontricks.pyx":297
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if (field[x,y,z] < minimum) and (field[x,y,z] > -INFINITY):
  *           minimum = field[x,y,z]
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":287
+        /* "ext/skeletontricks/skeletontricks.pyx":298
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] < minimum) and (field[x,y,z] > -INFINITY):             # <<<<<<<<<<<<<<
  *           minimum = field[x,y,z]
  * 
  */
         __pyx_t_12 = __pyx_v_x;
@@ -29329,53 +29639,53 @@
         __pyx_t_13 = __pyx_v_y;
         __pyx_t_12 = __pyx_v_z;
         __pyx_t_15 = ((*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_12, __pyx_pybuffernd_field.diminfo[2].strides)) > (-INFINITY));
         __pyx_t_11 = __pyx_t_15;
         __pyx_L10_bool_binop_done:;
         if (__pyx_t_11) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":288
+          /* "ext/skeletontricks/skeletontricks.pyx":299
  *       for x in range(0, sx):
  *         if (field[x,y,z] < minimum) and (field[x,y,z] > -INFINITY):
  *           minimum = field[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return minimum
  */
           __pyx_t_12 = __pyx_v_x;
           __pyx_t_13 = __pyx_v_y;
           __pyx_t_14 = __pyx_v_z;
           __pyx_v_minimum = (*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_field.rcbuffer->pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_field.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_field.diminfo[1].strides, __pyx_t_14, __pyx_pybuffernd_field.diminfo[2].strides));
 
-          /* "ext/skeletontricks/skeletontricks.pyx":287
+          /* "ext/skeletontricks/skeletontricks.pyx":298
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if (field[x,y,z] < minimum) and (field[x,y,z] > -INFINITY):             # <<<<<<<<<<<<<<
  *           minimum = field[x,y,z]
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":290
+  /* "ext/skeletontricks/skeletontricks.pyx":301
  *           minimum = field[x,y,z]
  * 
  *   return minimum             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_16 = PyFloat_FromDouble(__pyx_v_minimum); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 290, __pyx_L1_error)
+  __pyx_t_16 = PyFloat_FromDouble(__pyx_v_minimum); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 301, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_16);
   __pyx_r = __pyx_t_16;
   __pyx_t_16 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":266
+  /* "ext/skeletontricks/skeletontricks.pyx":277
  *   return maximum
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -29395,15 +29705,15 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_field.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":292
+/* "ext/skeletontricks/skeletontricks.pyx":303
  *   return minimum
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -29457,45 +29767,45 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 292, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 303, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "first_label") < 0)) __PYX_ERR(0, 292, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "first_label") < 0)) __PYX_ERR(0, 303, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("first_label", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 292, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("first_label", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 303, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.first_label", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 295, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 306, __pyx_L1_error)
   __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_14first_label(__pyx_self, __pyx_v_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -29544,150 +29854,150 @@
   __Pyx_RefNannySetupContext("first_label", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 292, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 303, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":304
+  /* "ext/skeletontricks/skeletontricks.pyx":315
  *   cdef size_t  x,  y,  z
  * 
  *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = labels.shape[1]
  *   sz = labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 304, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 315, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":305
+  /* "ext/skeletontricks/skeletontricks.pyx":316
  * 
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 305, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 316, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":306
+  /* "ext/skeletontricks/skeletontricks.pyx":317
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]
  *   sz = labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(0, sz):
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 306, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 317, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":308
+  /* "ext/skeletontricks/skeletontricks.pyx":319
  *   sz = labels.shape[2]
  * 
  *   for z in range(0, sz):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  */
   __pyx_t_2 = __pyx_v_sz;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_z = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":309
+    /* "ext/skeletontricks/skeletontricks.pyx":320
  * 
  *   for z in range(0, sz):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for x in range(0, sx):
  *         if labels[x,y,z]:
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":310
+      /* "ext/skeletontricks/skeletontricks.pyx":321
  *   for z in range(0, sz):
  *     for y in range(0, sy):
  *       for x in range(0, sx):             # <<<<<<<<<<<<<<
  *         if labels[x,y,z]:
  *           return (x,y,z)
  */
       __pyx_t_8 = __pyx_v_sx;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_x = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":311
+        /* "ext/skeletontricks/skeletontricks.pyx":322
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           return (x,y,z)
  * 
  */
         __pyx_t_11 = __pyx_v_x;
         __pyx_t_12 = __pyx_v_y;
         __pyx_t_13 = __pyx_v_z;
         __pyx_t_14 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_13, __pyx_pybuffernd_labels.diminfo[2].strides)) != 0);
         if (__pyx_t_14) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":312
+          /* "ext/skeletontricks/skeletontricks.pyx":323
  *       for x in range(0, sx):
  *         if labels[x,y,z]:
  *           return (x,y,z)             # <<<<<<<<<<<<<<
  * 
  *   return None
  */
           __Pyx_XDECREF(__pyx_r);
-          __pyx_t_15 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 312, __pyx_L1_error)
+          __pyx_t_15 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 323, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_15);
-          __pyx_t_16 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 312, __pyx_L1_error)
+          __pyx_t_16 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 323, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_16);
-          __pyx_t_17 = __Pyx_PyInt_FromSize_t(__pyx_v_z); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 312, __pyx_L1_error)
+          __pyx_t_17 = __Pyx_PyInt_FromSize_t(__pyx_v_z); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 323, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_17);
-          __pyx_t_18 = PyTuple_New(3); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 312, __pyx_L1_error)
+          __pyx_t_18 = PyTuple_New(3); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 323, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_18);
           __Pyx_GIVEREF(__pyx_t_15);
-          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_15)) __PYX_ERR(0, 312, __pyx_L1_error);
+          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_15)) __PYX_ERR(0, 323, __pyx_L1_error);
           __Pyx_GIVEREF(__pyx_t_16);
-          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_18, 1, __pyx_t_16)) __PYX_ERR(0, 312, __pyx_L1_error);
+          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_18, 1, __pyx_t_16)) __PYX_ERR(0, 323, __pyx_L1_error);
           __Pyx_GIVEREF(__pyx_t_17);
-          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_18, 2, __pyx_t_17)) __PYX_ERR(0, 312, __pyx_L1_error);
+          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_18, 2, __pyx_t_17)) __PYX_ERR(0, 323, __pyx_L1_error);
           __pyx_t_15 = 0;
           __pyx_t_16 = 0;
           __pyx_t_17 = 0;
           __pyx_r = __pyx_t_18;
           __pyx_t_18 = 0;
           goto __pyx_L0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":311
+          /* "ext/skeletontricks/skeletontricks.pyx":322
  *     for y in range(0, sy):
  *       for x in range(0, sx):
  *         if labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           return (x,y,z)
  * 
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":314
+  /* "ext/skeletontricks/skeletontricks.pyx":325
  *           return (x,y,z)
  * 
  *   return None             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":292
+  /* "ext/skeletontricks/skeletontricks.pyx":303
  *   return minimum
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -29710,15 +30020,15 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":316
+/* "ext/skeletontricks/skeletontricks.pyx":327
  *   return None
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -29775,58 +30085,58 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 316, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 327, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_PDRF)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 316, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 327, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_target", 1, 2, 2, 1); __PYX_ERR(0, 316, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_target", 1, 2, 2, 1); __PYX_ERR(0, 327, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_target") < 0)) __PYX_ERR(0, 316, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_target") < 0)) __PYX_ERR(0, 327, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
     __pyx_v_PDRF = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_target", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 316, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_target", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 327, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_target", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 320, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_PDRF), __pyx_ptype_5numpy_ndarray, 1, "PDRF", 0))) __PYX_ERR(0, 321, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 331, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_PDRF), __pyx_ptype_5numpy_ndarray, 1, "PDRF", 0))) __PYX_ERR(0, 332, __pyx_L1_error)
   __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_16find_target(__pyx_self, __pyx_v_labels, __pyx_v_PDRF);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -29886,126 +30196,126 @@
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   __pyx_pybuffer_PDRF.pybuffer.buf = NULL;
   __pyx_pybuffer_PDRF.refcount = 0;
   __pyx_pybuffernd_PDRF.data = NULL;
   __pyx_pybuffernd_PDRF.rcbuffer = &__pyx_pybuffer_PDRF;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 316, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 327, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_PDRF.rcbuffer->pybuffer, (PyObject*)__pyx_v_PDRF, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 316, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_PDRF.rcbuffer->pybuffer, (PyObject*)__pyx_v_PDRF, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 327, __pyx_L1_error)
   }
   __pyx_pybuffernd_PDRF.diminfo[0].strides = __pyx_pybuffernd_PDRF.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_PDRF.diminfo[0].shape = __pyx_pybuffernd_PDRF.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_PDRF.diminfo[1].strides = __pyx_pybuffernd_PDRF.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_PDRF.diminfo[1].shape = __pyx_pybuffernd_PDRF.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_PDRF.diminfo[2].strides = __pyx_pybuffernd_PDRF.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_PDRF.diminfo[2].shape = __pyx_pybuffernd_PDRF.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":335
+  /* "ext/skeletontricks/skeletontricks.pyx":346
  *   cdef size_t sx, sy, sz
  * 
  *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = labels.shape[1]
  *   sz = labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 335, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 346, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":336
+  /* "ext/skeletontricks/skeletontricks.pyx":347
  * 
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 336, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 347, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":337
+  /* "ext/skeletontricks/skeletontricks.pyx":348
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]
  *   sz = labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef int64_t mx, my, mz
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 337, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 348, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":341
+  /* "ext/skeletontricks/skeletontricks.pyx":352
  *   cdef int64_t mx, my, mz
  * 
  *   mx = -1             # <<<<<<<<<<<<<<
  *   my = -1
  *   mz = -1
  */
   __pyx_v_mx = -1L;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":342
+  /* "ext/skeletontricks/skeletontricks.pyx":353
  * 
  *   mx = -1
  *   my = -1             # <<<<<<<<<<<<<<
  *   mz = -1
  * 
  */
   __pyx_v_my = -1L;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":343
+  /* "ext/skeletontricks/skeletontricks.pyx":354
  *   mx = -1
  *   my = -1
  *   mz = -1             # <<<<<<<<<<<<<<
  * 
  *   cdef float maxpdrf = -INFINITY
  */
   __pyx_v_mz = -1L;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":345
+  /* "ext/skeletontricks/skeletontricks.pyx":356
  *   mz = -1
  * 
  *   cdef float maxpdrf = -INFINITY             # <<<<<<<<<<<<<<
  *   for x in range(0, sx):
  *     for y in range(0, sy):
  */
   __pyx_v_maxpdrf = (-INFINITY);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":346
+  /* "ext/skeletontricks/skeletontricks.pyx":357
  * 
  *   cdef float maxpdrf = -INFINITY
  *   for x in range(0, sx):             # <<<<<<<<<<<<<<
  *     for y in range(0, sy):
  *       for z in range(0, sz):
  */
   __pyx_t_2 = __pyx_v_sx;
   __pyx_t_3 = __pyx_t_2;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_3; __pyx_t_4+=1) {
     __pyx_v_x = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":347
+    /* "ext/skeletontricks/skeletontricks.pyx":358
  *   cdef float maxpdrf = -INFINITY
  *   for x in range(0, sx):
  *     for y in range(0, sy):             # <<<<<<<<<<<<<<
  *       for z in range(0, sz):
  *         if labels[x,y,z] and PDRF[x,y,z] > maxpdrf:
  */
     __pyx_t_5 = __pyx_v_sy;
     __pyx_t_6 = __pyx_t_5;
     for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
       __pyx_v_y = __pyx_t_7;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":348
+      /* "ext/skeletontricks/skeletontricks.pyx":359
  *   for x in range(0, sx):
  *     for y in range(0, sy):
  *       for z in range(0, sz):             # <<<<<<<<<<<<<<
  *         if labels[x,y,z] and PDRF[x,y,z] > maxpdrf:
  *           maxpdrf = PDRF[x,y,z]
  */
       __pyx_t_8 = __pyx_v_sz;
       __pyx_t_9 = __pyx_t_8;
       for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
         __pyx_v_z = __pyx_t_10;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":349
+        /* "ext/skeletontricks/skeletontricks.pyx":360
  *     for y in range(0, sy):
  *       for z in range(0, sz):
  *         if labels[x,y,z] and PDRF[x,y,z] > maxpdrf:             # <<<<<<<<<<<<<<
  *           maxpdrf = PDRF[x,y,z]
  *           mx = x
  */
         __pyx_t_12 = __pyx_v_x;
@@ -30021,95 +30331,95 @@
         __pyx_t_13 = __pyx_v_y;
         __pyx_t_12 = __pyx_v_z;
         __pyx_t_15 = ((*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_PDRF.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_PDRF.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_PDRF.diminfo[1].strides, __pyx_t_12, __pyx_pybuffernd_PDRF.diminfo[2].strides)) > __pyx_v_maxpdrf);
         __pyx_t_11 = __pyx_t_15;
         __pyx_L10_bool_binop_done:;
         if (__pyx_t_11) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":350
+          /* "ext/skeletontricks/skeletontricks.pyx":361
  *       for z in range(0, sz):
  *         if labels[x,y,z] and PDRF[x,y,z] > maxpdrf:
  *           maxpdrf = PDRF[x,y,z]             # <<<<<<<<<<<<<<
  *           mx = x
  *           my = y
  */
           __pyx_t_12 = __pyx_v_x;
           __pyx_t_13 = __pyx_v_y;
           __pyx_t_14 = __pyx_v_z;
           __pyx_v_maxpdrf = (*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_PDRF.rcbuffer->pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_PDRF.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_PDRF.diminfo[1].strides, __pyx_t_14, __pyx_pybuffernd_PDRF.diminfo[2].strides));
 
-          /* "ext/skeletontricks/skeletontricks.pyx":351
+          /* "ext/skeletontricks/skeletontricks.pyx":362
  *         if labels[x,y,z] and PDRF[x,y,z] > maxpdrf:
  *           maxpdrf = PDRF[x,y,z]
  *           mx = x             # <<<<<<<<<<<<<<
  *           my = y
  *           mz = z
  */
           __pyx_v_mx = __pyx_v_x;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":352
+          /* "ext/skeletontricks/skeletontricks.pyx":363
  *           maxpdrf = PDRF[x,y,z]
  *           mx = x
  *           my = y             # <<<<<<<<<<<<<<
  *           mz = z
  * 
  */
           __pyx_v_my = __pyx_v_y;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":353
+          /* "ext/skeletontricks/skeletontricks.pyx":364
  *           mx = x
  *           my = y
  *           mz = z             # <<<<<<<<<<<<<<
  * 
  *   return (mx, my, mz)
  */
           __pyx_v_mz = __pyx_v_z;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":349
+          /* "ext/skeletontricks/skeletontricks.pyx":360
  *     for y in range(0, sy):
  *       for z in range(0, sz):
  *         if labels[x,y,z] and PDRF[x,y,z] > maxpdrf:             # <<<<<<<<<<<<<<
  *           maxpdrf = PDRF[x,y,z]
  *           mx = x
  */
         }
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":355
+  /* "ext/skeletontricks/skeletontricks.pyx":366
  *           mz = z
  * 
  *   return (mx, my, mz)             # <<<<<<<<<<<<<<
  * 
- * 
+ * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_16 = __Pyx_PyInt_From_int64_t(__pyx_v_mx); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_16 = __Pyx_PyInt_From_int64_t(__pyx_v_mx); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 366, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_16);
-  __pyx_t_17 = __Pyx_PyInt_From_int64_t(__pyx_v_my); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_17 = __Pyx_PyInt_From_int64_t(__pyx_v_my); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 366, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
-  __pyx_t_18 = __Pyx_PyInt_From_int64_t(__pyx_v_mz); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_18 = __Pyx_PyInt_From_int64_t(__pyx_v_mz); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 366, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
-  __pyx_t_19 = PyTuple_New(3); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 355, __pyx_L1_error)
+  __pyx_t_19 = PyTuple_New(3); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 366, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_19);
   __Pyx_GIVEREF(__pyx_t_16);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_19, 0, __pyx_t_16)) __PYX_ERR(0, 355, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_19, 0, __pyx_t_16)) __PYX_ERR(0, 366, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_17);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_19, 1, __pyx_t_17)) __PYX_ERR(0, 355, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_19, 1, __pyx_t_17)) __PYX_ERR(0, 366, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_18);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_19, 2, __pyx_t_18)) __PYX_ERR(0, 355, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_19, 2, __pyx_t_18)) __PYX_ERR(0, 366, __pyx_L1_error);
   __pyx_t_16 = 0;
   __pyx_t_17 = 0;
   __pyx_t_18 = 0;
   __pyx_r = __pyx_t_19;
   __pyx_t_19 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":316
+  /* "ext/skeletontricks/skeletontricks.pyx":327
  *   return None
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -30134,63 +30444,966 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":358
+/* "ext/skeletontricks/skeletontricks.pyx":368
+ *   return (mx, my, mz)
  * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
+ * @cython.wraparound(False)  # turn off negative index wrapping for entire function
+ * @cython.nonecheck(False)
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_19roll_invalidation_ball_inside_component(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_19roll_invalidation_ball_inside_component = {"roll_invalidation_ball_inside_component", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_19roll_invalidation_ball_inside_component, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_19roll_invalidation_ball_inside_component(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyArrayObject *__pyx_v_labels = 0;
+  PyArrayObject *__pyx_v_DBF = 0;
+  float __pyx_v_scale;
+  float __pyx_v_constant;
+  PyObject *__pyx_v_anisotropy = 0;
+  PyObject *__pyx_v_path = 0;
+  PyObject *__pyx_v_voxel_connectivity_graph = 0;
+  PyObject *__pyx_v_connectivity = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
+  PyObject* values[8] = {0,0,0,0,0,0,0,0};
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("roll_invalidation_ball_inside_component (wrapper)", 0);
+  #if !CYTHON_METH_FASTCALL
+  #if CYTHON_ASSUME_SAFE_MACROS
+  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #else
+  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
+  #endif
+  #endif
+  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  {
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_labels,&__pyx_n_s_DBF,&__pyx_n_s_scale,&__pyx_n_s_constant,&__pyx_n_s_anisotropy,&__pyx_n_s_path,&__pyx_n_s_voxel_connectivity_graph,&__pyx_n_s_connectivity,0};
+
+    /* "ext/skeletontricks/skeletontricks.pyx":379
+ *     anisotropy,
+ *     path,
+ *     voxel_connectivity_graph = None,             # <<<<<<<<<<<<<<
+ *     connectivity = 26,
+ * ):
+ */
+    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
+    values[7] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_26)));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  8: values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
+        CYTHON_FALLTHROUGH;
+        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
+        CYTHON_FALLTHROUGH;
+        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
+        CYTHON_FALLTHROUGH;
+        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
+        CYTHON_FALLTHROUGH;
+        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
+        CYTHON_FALLTHROUGH;
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
+          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
+          kw_args--;
+        }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 368, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_DBF)) != 0)) {
+          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
+          kw_args--;
+        }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 368, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball_inside_component", 0, 6, 8, 1); __PYX_ERR(0, 368, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_scale)) != 0)) {
+          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
+          kw_args--;
+        }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 368, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball_inside_component", 0, 6, 8, 2); __PYX_ERR(0, 368, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  3:
+        if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_constant)) != 0)) {
+          (void)__Pyx_Arg_NewRef_FASTCALL(values[3]);
+          kw_args--;
+        }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 368, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball_inside_component", 0, 6, 8, 3); __PYX_ERR(0, 368, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  4:
+        if (likely((values[4] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_anisotropy)) != 0)) {
+          (void)__Pyx_Arg_NewRef_FASTCALL(values[4]);
+          kw_args--;
+        }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 368, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball_inside_component", 0, 6, 8, 4); __PYX_ERR(0, 368, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  5:
+        if (likely((values[5] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_path)) != 0)) {
+          (void)__Pyx_Arg_NewRef_FASTCALL(values[5]);
+          kw_args--;
+        }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 368, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball_inside_component", 0, 6, 8, 5); __PYX_ERR(0, 368, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  6:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_voxel_connectivity_graph);
+          if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 368, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  7:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_connectivity);
+          if (value) { values[7] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 368, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "roll_invalidation_ball_inside_component") < 0)) __PYX_ERR(0, 368, __pyx_L3_error)
+      }
+    } else {
+      switch (__pyx_nargs) {
+        case  8: values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
+        CYTHON_FALLTHROUGH;
+        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
+        CYTHON_FALLTHROUGH;
+        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
+        values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
+        values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
+        values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+        values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+    }
+    __pyx_v_labels = ((PyArrayObject *)values[0]);
+    __pyx_v_DBF = ((PyArrayObject *)values[1]);
+    __pyx_v_scale = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_scale == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 375, __pyx_L3_error)
+    __pyx_v_constant = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_constant == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 376, __pyx_L3_error)
+    __pyx_v_anisotropy = values[4];
+    __pyx_v_path = values[5];
+    __pyx_v_voxel_connectivity_graph = values[6];
+    __pyx_v_connectivity = values[7];
+  }
+  goto __pyx_L6_skip;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball_inside_component", 0, 6, 8, __pyx_nargs); __PYX_ERR(0, 368, __pyx_L3_error)
+  __pyx_L6_skip:;
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L3_error:;
+  {
+    Py_ssize_t __pyx_temp;
+    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
+      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
+    }
+  }
+  __Pyx_AddTraceback("kimimaro.skeletontricks.roll_invalidation_ball_inside_component", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 373, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_DBF), __pyx_ptype_5numpy_ndarray, 1, "DBF", 0))) __PYX_ERR(0, 374, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_18roll_invalidation_ball_inside_component(__pyx_self, __pyx_v_labels, __pyx_v_DBF, __pyx_v_scale, __pyx_v_constant, __pyx_v_anisotropy, __pyx_v_path, __pyx_v_voxel_connectivity_graph, __pyx_v_connectivity);
+
+  /* "ext/skeletontricks/skeletontricks.pyx":368
+ *   return (mx, my, mz)
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_192__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __pyx_r = NULL;
+  __pyx_L0:;
+  {
+    Py_ssize_t __pyx_temp;
+    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
+      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
+    }
+  }
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_18roll_invalidation_ball_inside_component(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, float __pyx_v_scale, float __pyx_v_constant, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_path, PyObject *__pyx_v_voxel_connectivity_graph, PyObject *__pyx_v_connectivity) {
+  int64_t __pyx_v_sx;
+  int64_t __pyx_v_sy;
+  int64_t __pyx_v_sz;
+  size_t __pyx_v_sxy;
+  float __pyx_v_wx;
+  float __pyx_v_wy;
+  float __pyx_v_wz;
+  PyObject *__pyx_v_max_distances = NULL;
+  uint32_t *__pyx_v_vcg;
+  PyArrayObject *__pyx_v_vcg_arr = 0;
+  int64_t __pyx_v_invalidated;
+  PyObject *__pyx_7genexpr__pyx_v_x = NULL;
+  PyObject *__pyx_7genexpr__pyx_v_y = NULL;
+  PyObject *__pyx_7genexpr__pyx_v_z = NULL;
+  PyObject *__pyx_8genexpr1__pyx_v_coord = NULL;
+  __Pyx_LocalBuf_ND __pyx_pybuffernd_DBF;
+  __Pyx_Buffer __pyx_pybuffer_DBF;
+  __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
+  __Pyx_Buffer __pyx_pybuffer_labels;
+  __Pyx_LocalBuf_ND __pyx_pybuffernd_vcg_arr;
+  __Pyx_Buffer __pyx_pybuffer_vcg_arr;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  npy_intp *__pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *(*__pyx_t_6)(PyObject *);
+  float __pyx_t_7;
+  float __pyx_t_8;
+  float __pyx_t_9;
+  Py_ssize_t __pyx_t_10;
+  PyObject *(*__pyx_t_11)(PyObject *);
+  PyObject *__pyx_t_12 = NULL;
+  PyObject *__pyx_t_13 = NULL;
+  PyObject *__pyx_t_14 = NULL;
+  int __pyx_t_15;
+  int __pyx_t_16;
+  PyObject *__pyx_t_17 = NULL;
+  PyObject *__pyx_t_18 = NULL;
+  PyObject *__pyx_t_19 = NULL;
+  Py_ssize_t __pyx_t_20;
+  Py_ssize_t __pyx_t_21;
+  Py_ssize_t __pyx_t_22;
+  std::vector<uint64_t>  __pyx_t_23;
+  std::vector<float>  __pyx_t_24;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("roll_invalidation_ball_inside_component", 0);
+  __Pyx_INCREF(__pyx_v_path);
+  __pyx_pybuffer_vcg_arr.pybuffer.buf = NULL;
+  __pyx_pybuffer_vcg_arr.refcount = 0;
+  __pyx_pybuffernd_vcg_arr.data = NULL;
+  __pyx_pybuffernd_vcg_arr.rcbuffer = &__pyx_pybuffer_vcg_arr;
+  __pyx_pybuffer_labels.pybuffer.buf = NULL;
+  __pyx_pybuffer_labels.refcount = 0;
+  __pyx_pybuffernd_labels.data = NULL;
+  __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
+  __pyx_pybuffer_DBF.pybuffer.buf = NULL;
+  __pyx_pybuffer_DBF.refcount = 0;
+  __pyx_pybuffernd_DBF.data = NULL;
+  __pyx_pybuffernd_DBF.rcbuffer = &__pyx_pybuffer_DBF;
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 368, __pyx_L1_error)
+  }
+  __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_DBF.rcbuffer->pybuffer, (PyObject*)__pyx_v_DBF, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 368, __pyx_L1_error)
+  }
+  __pyx_pybuffernd_DBF.diminfo[0].strides = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_DBF.diminfo[0].shape = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_DBF.diminfo[1].strides = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_DBF.diminfo[1].shape = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_DBF.diminfo[2].strides = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_DBF.diminfo[2].shape = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.shape[2];
+
+  /* "ext/skeletontricks/skeletontricks.pyx":383
+ * ):
+ *   cdef int64_t sx, sy, sz
+ *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
+ *   sy = labels.shape[1]
+ *   sz = labels.shape[2]
+ */
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 383, __pyx_L1_error)
+  __pyx_v_sx = (__pyx_t_1[0]);
+
+  /* "ext/skeletontricks/skeletontricks.pyx":384
+ *   cdef int64_t sx, sy, sz
+ *   sx = labels.shape[0]
+ *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
+ *   sz = labels.shape[2]
+ * 
+ */
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 384, __pyx_L1_error)
+  __pyx_v_sy = (__pyx_t_1[1]);
+
+  /* "ext/skeletontricks/skeletontricks.pyx":385
+ *   sx = labels.shape[0]
+ *   sy = labels.shape[1]
+ *   sz = labels.shape[2]             # <<<<<<<<<<<<<<
+ * 
+ *   cdef size_t sxy = sx * sy
+ */
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 385, __pyx_L1_error)
+  __pyx_v_sz = (__pyx_t_1[2]);
+
+  /* "ext/skeletontricks/skeletontricks.pyx":387
+ *   sz = labels.shape[2]
+ * 
+ *   cdef size_t sxy = sx * sy             # <<<<<<<<<<<<<<
+ * 
+ *   cdef float wx, wy, wz
+ */
+  __pyx_v_sxy = (__pyx_v_sx * __pyx_v_sy);
+
+  /* "ext/skeletontricks/skeletontricks.pyx":390
+ * 
+ *   cdef float wx, wy, wz
+ *   (wx, wy, wz) = anisotropy             # <<<<<<<<<<<<<<
+ * 
+ *   max_distances = [
+ */
+  if ((likely(PyTuple_CheckExact(__pyx_v_anisotropy))) || (PyList_CheckExact(__pyx_v_anisotropy))) {
+    PyObject* sequence = __pyx_v_anisotropy;
+    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+    if (unlikely(size != 3)) {
+      if (size > 3) __Pyx_RaiseTooManyValuesError(3);
+      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+      __PYX_ERR(0, 390, __pyx_L1_error)
+    }
+    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    if (likely(PyTuple_CheckExact(sequence))) {
+      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
+      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
+      __pyx_t_4 = PyTuple_GET_ITEM(sequence, 2); 
+    } else {
+      __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
+      __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
+      __pyx_t_4 = PyList_GET_ITEM(sequence, 2); 
+    }
+    __Pyx_INCREF(__pyx_t_2);
+    __Pyx_INCREF(__pyx_t_3);
+    __Pyx_INCREF(__pyx_t_4);
+    #else
+    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    #endif
+  } else {
+    Py_ssize_t index = -1;
+    __pyx_t_5 = PyObject_GetIter(__pyx_v_anisotropy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 390, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
+    index = 0; __pyx_t_2 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
+    __Pyx_GOTREF(__pyx_t_2);
+    index = 1; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
+    __Pyx_GOTREF(__pyx_t_3);
+    index = 2; __pyx_t_4 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L3_unpacking_failed;
+    __Pyx_GOTREF(__pyx_t_4);
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_t_6 = NULL;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    goto __pyx_L4_unpacking_done;
+    __pyx_L3_unpacking_failed:;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_t_6 = NULL;
+    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+    __PYX_ERR(0, 390, __pyx_L1_error)
+    __pyx_L4_unpacking_done:;
+  }
+  __pyx_t_7 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_7 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 390, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_8 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_8 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 390, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_9 = __pyx_PyFloat_AsFloat(__pyx_t_4); if (unlikely((__pyx_t_9 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 390, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_v_wx = __pyx_t_7;
+  __pyx_v_wy = __pyx_t_8;
+  __pyx_v_wz = __pyx_t_9;
+
+  /* "ext/skeletontricks/skeletontricks.pyx":392
+ *   (wx, wy, wz) = anisotropy
+ * 
+ *   max_distances = [             # <<<<<<<<<<<<<<
+ *     (scale * DBF[x,y,z] + constant) for (x,y,z) in path
+ *   ]
+ */
+  { /* enter inner scope */
+    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 392, __pyx_L7_error)
+    __Pyx_GOTREF(__pyx_t_4);
+
+    /* "ext/skeletontricks/skeletontricks.pyx":393
+ * 
+ *   max_distances = [
+ *     (scale * DBF[x,y,z] + constant) for (x,y,z) in path             # <<<<<<<<<<<<<<
+ *   ]
+ * 
+ */
+    if (likely(PyList_CheckExact(__pyx_v_path)) || PyTuple_CheckExact(__pyx_v_path)) {
+      __pyx_t_3 = __pyx_v_path; __Pyx_INCREF(__pyx_t_3);
+      __pyx_t_10 = 0;
+      __pyx_t_11 = NULL;
+    } else {
+      __pyx_t_10 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_path); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 393, __pyx_L7_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 393, __pyx_L7_error)
+    }
+    for (;;) {
+      if (likely(!__pyx_t_11)) {
+        if (likely(PyList_CheckExact(__pyx_t_3))) {
+          {
+            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
+            #if !CYTHON_ASSUME_SAFE_MACROS
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 393, __pyx_L7_error)
+            #endif
+            if (__pyx_t_10 >= __pyx_temp) break;
+          }
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 393, __pyx_L7_error)
+          #else
+          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 393, __pyx_L7_error)
+          __Pyx_GOTREF(__pyx_t_2);
+          #endif
+        } else {
+          {
+            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
+            #if !CYTHON_ASSUME_SAFE_MACROS
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 393, __pyx_L7_error)
+            #endif
+            if (__pyx_t_10 >= __pyx_temp) break;
+          }
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 393, __pyx_L7_error)
+          #else
+          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 393, __pyx_L7_error)
+          __Pyx_GOTREF(__pyx_t_2);
+          #endif
+        }
+      } else {
+        __pyx_t_2 = __pyx_t_11(__pyx_t_3);
+        if (unlikely(!__pyx_t_2)) {
+          PyObject* exc_type = PyErr_Occurred();
+          if (exc_type) {
+            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+            else __PYX_ERR(0, 393, __pyx_L7_error)
+          }
+          break;
+        }
+        __Pyx_GOTREF(__pyx_t_2);
+      }
+      if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
+        PyObject* sequence = __pyx_t_2;
+        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+        if (unlikely(size != 3)) {
+          if (size > 3) __Pyx_RaiseTooManyValuesError(3);
+          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+          __PYX_ERR(0, 393, __pyx_L7_error)
+        }
+        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+        if (likely(PyTuple_CheckExact(sequence))) {
+          __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
+          __pyx_t_12 = PyTuple_GET_ITEM(sequence, 1); 
+          __pyx_t_13 = PyTuple_GET_ITEM(sequence, 2); 
+        } else {
+          __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
+          __pyx_t_12 = PyList_GET_ITEM(sequence, 1); 
+          __pyx_t_13 = PyList_GET_ITEM(sequence, 2); 
+        }
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(__pyx_t_12);
+        __Pyx_INCREF(__pyx_t_13);
+        #else
+        __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 393, __pyx_L7_error)
+        __Pyx_GOTREF(__pyx_t_5);
+        __pyx_t_12 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 393, __pyx_L7_error)
+        __Pyx_GOTREF(__pyx_t_12);
+        __pyx_t_13 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 393, __pyx_L7_error)
+        __Pyx_GOTREF(__pyx_t_13);
+        #endif
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      } else {
+        Py_ssize_t index = -1;
+        __pyx_t_14 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 393, __pyx_L7_error)
+        __Pyx_GOTREF(__pyx_t_14);
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+        __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_14);
+        index = 0; __pyx_t_5 = __pyx_t_6(__pyx_t_14); if (unlikely(!__pyx_t_5)) goto __pyx_L10_unpacking_failed;
+        __Pyx_GOTREF(__pyx_t_5);
+        index = 1; __pyx_t_12 = __pyx_t_6(__pyx_t_14); if (unlikely(!__pyx_t_12)) goto __pyx_L10_unpacking_failed;
+        __Pyx_GOTREF(__pyx_t_12);
+        index = 2; __pyx_t_13 = __pyx_t_6(__pyx_t_14); if (unlikely(!__pyx_t_13)) goto __pyx_L10_unpacking_failed;
+        __Pyx_GOTREF(__pyx_t_13);
+        if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_14), 3) < 0) __PYX_ERR(0, 393, __pyx_L7_error)
+        __pyx_t_6 = NULL;
+        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+        goto __pyx_L11_unpacking_done;
+        __pyx_L10_unpacking_failed:;
+        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+        __pyx_t_6 = NULL;
+        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+        __PYX_ERR(0, 393, __pyx_L7_error)
+        __pyx_L11_unpacking_done:;
+      }
+      __Pyx_XDECREF_SET(__pyx_7genexpr__pyx_v_x, __pyx_t_5);
+      __pyx_t_5 = 0;
+      __Pyx_XDECREF_SET(__pyx_7genexpr__pyx_v_y, __pyx_t_12);
+      __pyx_t_12 = 0;
+      __Pyx_XDECREF_SET(__pyx_7genexpr__pyx_v_z, __pyx_t_13);
+      __pyx_t_13 = 0;
+      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_scale); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 393, __pyx_L7_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_13 = PyTuple_New(3); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 393, __pyx_L7_error)
+      __Pyx_GOTREF(__pyx_t_13);
+      __Pyx_INCREF(__pyx_7genexpr__pyx_v_x);
+      __Pyx_GIVEREF(__pyx_7genexpr__pyx_v_x);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_7genexpr__pyx_v_x)) __PYX_ERR(0, 393, __pyx_L7_error);
+      __Pyx_INCREF(__pyx_7genexpr__pyx_v_y);
+      __Pyx_GIVEREF(__pyx_7genexpr__pyx_v_y);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_7genexpr__pyx_v_y)) __PYX_ERR(0, 393, __pyx_L7_error);
+      __Pyx_INCREF(__pyx_7genexpr__pyx_v_z);
+      __Pyx_GIVEREF(__pyx_7genexpr__pyx_v_z);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 2, __pyx_7genexpr__pyx_v_z)) __PYX_ERR(0, 393, __pyx_L7_error);
+      __pyx_t_12 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_DBF), __pyx_t_13); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 393, __pyx_L7_error)
+      __Pyx_GOTREF(__pyx_t_12);
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __pyx_t_13 = PyNumber_Multiply(__pyx_t_2, __pyx_t_12); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 393, __pyx_L7_error)
+      __Pyx_GOTREF(__pyx_t_13);
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+      __pyx_t_12 = PyFloat_FromDouble(__pyx_v_constant); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 393, __pyx_L7_error)
+      __Pyx_GOTREF(__pyx_t_12);
+      __pyx_t_2 = PyNumber_Add(__pyx_t_13, __pyx_t_12); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 393, __pyx_L7_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 392, __pyx_L7_error)
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    }
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_x); __pyx_7genexpr__pyx_v_x = 0;
+    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_y); __pyx_7genexpr__pyx_v_y = 0;
+    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_z); __pyx_7genexpr__pyx_v_z = 0;
+    goto __pyx_L13_exit_scope;
+    __pyx_L7_error:;
+    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_x); __pyx_7genexpr__pyx_v_x = 0;
+    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_y); __pyx_7genexpr__pyx_v_y = 0;
+    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_z); __pyx_7genexpr__pyx_v_z = 0;
+    goto __pyx_L1_error;
+    __pyx_L13_exit_scope:;
+  } /* exit inner scope */
+  __pyx_v_max_distances = ((PyObject*)__pyx_t_4);
+  __pyx_t_4 = 0;
+
+  /* "ext/skeletontricks/skeletontricks.pyx":396
+ *   ]
+ * 
+ *   path = [             # <<<<<<<<<<<<<<
+ *     coord[0] + sx * coord[1] + sxy * coord[2]
+ *     for coord in path if tuple(coord)
+ */
+  { /* enter inner scope */
+    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 396, __pyx_L16_error)
+    __Pyx_GOTREF(__pyx_t_4);
+
+    /* "ext/skeletontricks/skeletontricks.pyx":398
+ *   path = [
+ *     coord[0] + sx * coord[1] + sxy * coord[2]
+ *     for coord in path if tuple(coord)             # <<<<<<<<<<<<<<
+ *   ]
+ * 
+ */
+    if (likely(PyList_CheckExact(__pyx_v_path)) || PyTuple_CheckExact(__pyx_v_path)) {
+      __pyx_t_3 = __pyx_v_path; __Pyx_INCREF(__pyx_t_3);
+      __pyx_t_10 = 0;
+      __pyx_t_11 = NULL;
+    } else {
+      __pyx_t_10 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_path); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 398, __pyx_L16_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 398, __pyx_L16_error)
+    }
+    for (;;) {
+      if (likely(!__pyx_t_11)) {
+        if (likely(PyList_CheckExact(__pyx_t_3))) {
+          {
+            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
+            #if !CYTHON_ASSUME_SAFE_MACROS
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 398, __pyx_L16_error)
+            #endif
+            if (__pyx_t_10 >= __pyx_temp) break;
+          }
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 398, __pyx_L16_error)
+          #else
+          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 398, __pyx_L16_error)
+          __Pyx_GOTREF(__pyx_t_2);
+          #endif
+        } else {
+          {
+            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
+            #if !CYTHON_ASSUME_SAFE_MACROS
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 398, __pyx_L16_error)
+            #endif
+            if (__pyx_t_10 >= __pyx_temp) break;
+          }
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 398, __pyx_L16_error)
+          #else
+          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 398, __pyx_L16_error)
+          __Pyx_GOTREF(__pyx_t_2);
+          #endif
+        }
+      } else {
+        __pyx_t_2 = __pyx_t_11(__pyx_t_3);
+        if (unlikely(!__pyx_t_2)) {
+          PyObject* exc_type = PyErr_Occurred();
+          if (exc_type) {
+            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+            else __PYX_ERR(0, 398, __pyx_L16_error)
+          }
+          break;
+        }
+        __Pyx_GOTREF(__pyx_t_2);
+      }
+      __Pyx_XDECREF_SET(__pyx_8genexpr1__pyx_v_coord, __pyx_t_2);
+      __pyx_t_2 = 0;
+      __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_8genexpr1__pyx_v_coord); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 398, __pyx_L16_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_15 = (PyTuple_GET_SIZE(__pyx_t_2) != 0);
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      if (__pyx_t_15) {
+
+        /* "ext/skeletontricks/skeletontricks.pyx":397
+ * 
+ *   path = [
+ *     coord[0] + sx * coord[1] + sxy * coord[2]             # <<<<<<<<<<<<<<
+ *     for coord in path if tuple(coord)
+ *   ]
+ */
+        __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr1__pyx_v_coord, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 397, __pyx_L16_error)
+        __Pyx_GOTREF(__pyx_t_2);
+        __pyx_t_12 = __Pyx_PyInt_From_int64_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 397, __pyx_L16_error)
+        __Pyx_GOTREF(__pyx_t_12);
+        __pyx_t_13 = __Pyx_GetItemInt(__pyx_8genexpr1__pyx_v_coord, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 397, __pyx_L16_error)
+        __Pyx_GOTREF(__pyx_t_13);
+        __pyx_t_5 = PyNumber_Multiply(__pyx_t_12, __pyx_t_13); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 397, __pyx_L16_error)
+        __Pyx_GOTREF(__pyx_t_5);
+        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+        __pyx_t_13 = PyNumber_Add(__pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 397, __pyx_L16_error)
+        __Pyx_GOTREF(__pyx_t_13);
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+        __pyx_t_5 = __Pyx_PyInt_FromSize_t(__pyx_v_sxy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 397, __pyx_L16_error)
+        __Pyx_GOTREF(__pyx_t_5);
+        __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr1__pyx_v_coord, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 397, __pyx_L16_error)
+        __Pyx_GOTREF(__pyx_t_2);
+        __pyx_t_12 = PyNumber_Multiply(__pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 397, __pyx_L16_error)
+        __Pyx_GOTREF(__pyx_t_12);
+        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+        __pyx_t_2 = PyNumber_Add(__pyx_t_13, __pyx_t_12); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 397, __pyx_L16_error)
+        __Pyx_GOTREF(__pyx_t_2);
+        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 396, __pyx_L16_error)
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+        /* "ext/skeletontricks/skeletontricks.pyx":398
+ *   path = [
+ *     coord[0] + sx * coord[1] + sxy * coord[2]
+ *     for coord in path if tuple(coord)             # <<<<<<<<<<<<<<
+ *   ]
+ * 
+ */
+      }
+    }
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_coord); __pyx_8genexpr1__pyx_v_coord = 0;
+    goto __pyx_L21_exit_scope;
+    __pyx_L16_error:;
+    __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_coord); __pyx_8genexpr1__pyx_v_coord = 0;
+    goto __pyx_L1_error;
+    __pyx_L21_exit_scope:;
+  } /* exit inner scope */
+  __Pyx_DECREF_SET(__pyx_v_path, __pyx_t_4);
+  __pyx_t_4 = 0;
+
+  /* "ext/skeletontricks/skeletontricks.pyx":401
+ *   ]
+ * 
+ *   cdef uint32_t* vcg = NULL             # <<<<<<<<<<<<<<
+ *   cdef cnp.ndarray[uint32_t, ndim=3] vcg_arr
+ * 
+ */
+  __pyx_v_vcg = NULL;
+
+  /* "ext/skeletontricks/skeletontricks.pyx":404
+ *   cdef cnp.ndarray[uint32_t, ndim=3] vcg_arr
+ * 
+ *   if isinstance(voxel_connectivity_graph, np.ndarray):             # <<<<<<<<<<<<<<
+ *     vcg_arr = voxel_connectivity_graph
+ *     vcg = <uint32_t*>&vcg_arr[0,0,0]
+ */
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 404, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ndarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 404, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_15 = PyObject_IsInstance(__pyx_v_voxel_connectivity_graph, __pyx_t_3); if (unlikely(__pyx_t_15 == ((int)-1))) __PYX_ERR(0, 404, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (__pyx_t_15) {
+
+    /* "ext/skeletontricks/skeletontricks.pyx":405
+ * 
+ *   if isinstance(voxel_connectivity_graph, np.ndarray):
+ *     vcg_arr = voxel_connectivity_graph             # <<<<<<<<<<<<<<
+ *     vcg = <uint32_t*>&vcg_arr[0,0,0]
+ * 
+ */
+    if (!(likely(((__pyx_v_voxel_connectivity_graph) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_voxel_connectivity_graph, __pyx_ptype_5numpy_ndarray))))) __PYX_ERR(0, 405, __pyx_L1_error)
+    __pyx_t_3 = __pyx_v_voxel_connectivity_graph;
+    __Pyx_INCREF(__pyx_t_3);
+    {
+      __Pyx_BufFmt_StackElem __pyx_stack[1];
+      __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer);
+      __pyx_t_16 = __Pyx_GetBufferAndValidate(&__pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer, (PyObject*)((PyArrayObject *)__pyx_t_3), &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack);
+      if (unlikely(__pyx_t_16 < 0)) {
+        PyErr_Fetch(&__pyx_t_17, &__pyx_t_18, &__pyx_t_19);
+        if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer, (PyObject*)__pyx_v_vcg_arr, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) {
+          Py_XDECREF(__pyx_t_17); Py_XDECREF(__pyx_t_18); Py_XDECREF(__pyx_t_19);
+          __Pyx_RaiseBufferFallbackError();
+        } else {
+          PyErr_Restore(__pyx_t_17, __pyx_t_18, __pyx_t_19);
+        }
+        __pyx_t_17 = __pyx_t_18 = __pyx_t_19 = 0;
+      }
+      __pyx_pybuffernd_vcg_arr.diminfo[0].strides = __pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_vcg_arr.diminfo[0].shape = __pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_vcg_arr.diminfo[1].strides = __pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_vcg_arr.diminfo[1].shape = __pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_vcg_arr.diminfo[2].strides = __pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_vcg_arr.diminfo[2].shape = __pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer.shape[2];
+      if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 405, __pyx_L1_error)
+    }
+    __pyx_v_vcg_arr = ((PyArrayObject *)__pyx_t_3);
+    __pyx_t_3 = 0;
+
+    /* "ext/skeletontricks/skeletontricks.pyx":406
+ *   if isinstance(voxel_connectivity_graph, np.ndarray):
+ *     vcg_arr = voxel_connectivity_graph
+ *     vcg = <uint32_t*>&vcg_arr[0,0,0]             # <<<<<<<<<<<<<<
+ * 
+ *   invalidated = _roll_invalidation_ball(
+ */
+    __pyx_t_20 = 0;
+    __pyx_t_21 = 0;
+    __pyx_t_22 = 0;
+    __pyx_v_vcg = ((uint32_t *)(&(*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_vcg_arr.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_vcg_arr.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_vcg_arr.diminfo[2].strides))));
+
+    /* "ext/skeletontricks/skeletontricks.pyx":404
+ *   cdef cnp.ndarray[uint32_t, ndim=3] vcg_arr
+ * 
+ *   if isinstance(voxel_connectivity_graph, np.ndarray):             # <<<<<<<<<<<<<<
+ *     vcg_arr = voxel_connectivity_graph
+ *     vcg = <uint32_t*>&vcg_arr[0,0,0]
+ */
+  }
+
+  /* "ext/skeletontricks/skeletontricks.pyx":409
+ * 
+ *   invalidated = _roll_invalidation_ball(
+ *     <uint8_t*>&labels[0,0,0],             # <<<<<<<<<<<<<<
+ *     sx, sy, sz,
+ *     wx, wy, wz,
+ */
+  __pyx_t_22 = 0;
+  __pyx_t_21 = 0;
+  __pyx_t_20 = 0;
+
+  /* "ext/skeletontricks/skeletontricks.pyx":412
+ *     sx, sy, sz,
+ *     wx, wy, wz,
+ *     path, max_distances,             # <<<<<<<<<<<<<<
+ *     connectivity,
+ *     vcg
+ */
+  __pyx_t_23 = __pyx_convert_vector_from_py_uint64_t(__pyx_v_path); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 412, __pyx_L1_error)
+  __pyx_t_24 = __pyx_convert_vector_from_py_float(__pyx_v_max_distances); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 412, __pyx_L1_error)
+
+  /* "ext/skeletontricks/skeletontricks.pyx":413
+ *     wx, wy, wz,
+ *     path, max_distances,
+ *     connectivity,             # <<<<<<<<<<<<<<
+ *     vcg
+ *   )
+ */
+  __pyx_t_16 = __Pyx_PyInt_As_int(__pyx_v_connectivity); if (unlikely((__pyx_t_16 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 413, __pyx_L1_error)
+
+  /* "ext/skeletontricks/skeletontricks.pyx":408
+ *     vcg = <uint32_t*>&vcg_arr[0,0,0]
+ * 
+ *   invalidated = _roll_invalidation_ball(             # <<<<<<<<<<<<<<
+ *     <uint8_t*>&labels[0,0,0],
+ *     sx, sy, sz,
+ */
+  __pyx_v_invalidated = dijkstra_invalidation::_roll_invalidation_ball(((uint8_t *)(&(*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)))), __pyx_v_sx, __pyx_v_sy, __pyx_v_sz, __pyx_v_wx, __pyx_v_wy, __pyx_v_wz, __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_23), __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_24), __pyx_t_16, __pyx_v_vcg);
+
+  /* "ext/skeletontricks/skeletontricks.pyx":417
+ *   )
+ * 
+ *   return (invalidated, labels)             # <<<<<<<<<<<<<<
+ * 
+ * @cython.boundscheck(False)
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_invalidated); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 417, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 417, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_GIVEREF(__pyx_t_3);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3)) __PYX_ERR(0, 417, __pyx_L1_error);
+  __Pyx_INCREF((PyObject *)__pyx_v_labels);
+  __Pyx_GIVEREF((PyObject *)__pyx_v_labels);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_labels))) __PYX_ERR(0, 417, __pyx_L1_error);
+  __pyx_t_3 = 0;
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
+  goto __pyx_L0;
+
+  /* "ext/skeletontricks/skeletontricks.pyx":368
+ *   return (mx, my, mz)
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
+ * @cython.wraparound(False)  # turn off negative index wrapping for entire function
+ * @cython.nonecheck(False)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_12);
+  __Pyx_XDECREF(__pyx_t_13);
+  __Pyx_XDECREF(__pyx_t_14);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_DBF.rcbuffer->pybuffer);
+    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
+    __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("kimimaro.skeletontricks.roll_invalidation_ball_inside_component", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  goto __pyx_L2;
+  __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_DBF.rcbuffer->pybuffer);
+  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
+  __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_vcg_arr.rcbuffer->pybuffer);
+  __pyx_L2:;
+  __Pyx_XDECREF(__pyx_v_max_distances);
+  __Pyx_XDECREF((PyObject *)__pyx_v_vcg_arr);
+  __Pyx_XDECREF(__pyx_7genexpr__pyx_v_x);
+  __Pyx_XDECREF(__pyx_7genexpr__pyx_v_y);
+  __Pyx_XDECREF(__pyx_7genexpr__pyx_v_z);
+  __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_coord);
+  __Pyx_XDECREF(__pyx_v_path);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "ext/skeletontricks/skeletontricks.pyx":419
+ *   return (invalidated, labels)
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
+ * @cython.wraparound(False)  # turn off negative index wrapping for entire function
+ * @cython.nonecheck(False)
+ */
+
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_194__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__defaults__", 1);
   __Pyx_XDECREF(__pyx_r);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":365
+  /* "ext/skeletontricks/skeletontricks.pyx":427
  *     cnp.ndarray[float, ndim=3] DBF,
  *     path, float scale, float const,
  *     anisotropy=(1,1,1),             # <<<<<<<<<<<<<<
  *     invalid_vertices={},
  *   ):
  */
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 358, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 419, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(((PyObject*)__pyx_tuple__17));
   __Pyx_GIVEREF(((PyObject*)__pyx_tuple__17));
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject*)__pyx_tuple__17))) __PYX_ERR(0, 358, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject*)__pyx_tuple__17))) __PYX_ERR(0, 419, __pyx_L1_error);
   __Pyx_INCREF(__Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_invalid_vertices);
   __Pyx_GIVEREF(__Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_invalid_vertices);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_invalid_vertices)) __PYX_ERR(0, 358, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_invalid_vertices)) __PYX_ERR(0, 419, __pyx_L1_error);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":358
- * 
+  /* "ext/skeletontricks/skeletontricks.pyx":419
+ *   return (invalidated, labels)
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 358, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 419, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 358, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 419, __pyx_L1_error);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None)) __PYX_ERR(0, 358, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None)) __PYX_ERR(0, 419, __pyx_L1_error);
   __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -30201,24 +31414,24 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_19roll_invalidation_ball(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_21roll_invalidation_ball(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_18roll_invalidation_ball, "\n  roll_invalidation_ball(\n    ndarray[uint8_t, cast=True, ndim=3] labels, ndarray[float, ndim=3] DBF, \n    path, float scale, float const, anisotropy=(1,1,1), invalid_vertices={}\n  )\n\n  Given an anisotropic binary image, its distance transform, and a path \n  traversing the binary image, erase the voxels surrounding the path\n  in a sphere around each vertex on the path corresponding to the \n  equation: \n\n  r = scale * DBF[x,y,z] + const\n\n  Returns: modified labels\n  ");
-static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_19roll_invalidation_ball = {"roll_invalidation_ball", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_19roll_invalidation_ball, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_18roll_invalidation_ball};
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_19roll_invalidation_ball(PyObject *__pyx_self, 
+PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_20roll_invalidation_ball, "\n  Given an anisotropic binary image, its distance transform, and a path \n  traversing the binary image, erase the voxels surrounding the path\n  in a sphere around each vertex on the path corresponding to the \n  equation: \n\n  r = scale * DBF[x,y,z] + const\n\n  Returns: modified labels\n  ");
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_21roll_invalidation_ball = {"roll_invalidation_ball", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_21roll_invalidation_ball, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20roll_invalidation_ball};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_21roll_invalidation_ball(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyArrayObject *__pyx_v_labels = 0;
@@ -30275,74 +31488,74 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 358, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 419, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_DBF)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 358, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 419, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, 1); __PYX_ERR(0, 358, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, 1); __PYX_ERR(0, 419, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_path)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 358, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 419, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, 2); __PYX_ERR(0, 358, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, 2); __PYX_ERR(0, 419, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_scale)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 358, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 419, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, 3); __PYX_ERR(0, 358, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, 3); __PYX_ERR(0, 419, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_const)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[4]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 358, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 419, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, 4); __PYX_ERR(0, 358, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, 4); __PYX_ERR(0, 419, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_anisotropy);
           if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 358, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 419, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_invalid_vertices);
           if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 358, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 419, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "roll_invalidation_ball") < 0)) __PYX_ERR(0, 358, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "roll_invalidation_ball") < 0)) __PYX_ERR(0, 419, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
@@ -30354,38 +31567,38 @@
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
     __pyx_v_DBF = ((PyArrayObject *)values[1]);
     __pyx_v_path = values[2];
-    __pyx_v_scale = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_scale == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 364, __pyx_L3_error)
-    __pyx_v_const = __pyx_PyFloat_AsFloat(values[4]); if (unlikely((__pyx_v_const == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 364, __pyx_L3_error)
+    __pyx_v_scale = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_scale == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 426, __pyx_L3_error)
+    __pyx_v_const = __pyx_PyFloat_AsFloat(values[4]); if (unlikely((__pyx_v_const == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 426, __pyx_L3_error)
     __pyx_v_anisotropy = values[5];
     __pyx_v_invalid_vertices = values[6];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, __pyx_nargs); __PYX_ERR(0, 358, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("roll_invalidation_ball", 0, 5, 7, __pyx_nargs); __PYX_ERR(0, 419, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.roll_invalidation_ball", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 362, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_DBF), __pyx_ptype_5numpy_ndarray, 1, "DBF", 0))) __PYX_ERR(0, 363, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_18roll_invalidation_ball(__pyx_self, __pyx_v_labels, __pyx_v_DBF, __pyx_v_path, __pyx_v_scale, __pyx_v_const, __pyx_v_anisotropy, __pyx_v_invalid_vertices);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 424, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_DBF), __pyx_ptype_5numpy_ndarray, 1, "DBF", 0))) __PYX_ERR(0, 425, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_20roll_invalidation_ball(__pyx_self, __pyx_v_labels, __pyx_v_DBF, __pyx_v_path, __pyx_v_scale, __pyx_v_const, __pyx_v_anisotropy, __pyx_v_invalid_vertices);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -30394,15 +31607,15 @@
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_18roll_invalidation_ball(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, PyObject *__pyx_v_path, float __pyx_v_scale, float __pyx_v_const, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_invalid_vertices) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_20roll_invalidation_ball(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, PyObject *__pyx_v_path, float __pyx_v_scale, float __pyx_v_const, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_invalid_vertices) {
   int64_t __pyx_v_sx;
   int64_t __pyx_v_sy;
   int64_t __pyx_v_sz;
   float __pyx_v_wx;
   float __pyx_v_wy;
   float __pyx_v_wz;
   float __pyx_v_radius;
@@ -30463,67 +31676,67 @@
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   __pyx_pybuffer_DBF.pybuffer.buf = NULL;
   __pyx_pybuffer_DBF.refcount = 0;
   __pyx_pybuffernd_DBF.data = NULL;
   __pyx_pybuffernd_DBF.rcbuffer = &__pyx_pybuffer_DBF;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 358, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 419, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_DBF.rcbuffer->pybuffer, (PyObject*)__pyx_v_DBF, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 358, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_DBF.rcbuffer->pybuffer, (PyObject*)__pyx_v_DBF, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 419, __pyx_L1_error)
   }
   __pyx_pybuffernd_DBF.diminfo[0].strides = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_DBF.diminfo[0].shape = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_DBF.diminfo[1].strides = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_DBF.diminfo[1].shape = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_DBF.diminfo[2].strides = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_DBF.diminfo[2].shape = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":384
+  /* "ext/skeletontricks/skeletontricks.pyx":441
  *   """
  *   cdef int64_t sx, sy, sz
  *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = labels.shape[1]
  *   sz = labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 384, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 441, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":385
+  /* "ext/skeletontricks/skeletontricks.pyx":442
  *   cdef int64_t sx, sy, sz
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 385, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 442, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":386
+  /* "ext/skeletontricks/skeletontricks.pyx":443
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]
  *   sz = labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef float wx, wy, wz
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 386, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 443, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":389
+  /* "ext/skeletontricks/skeletontricks.pyx":446
  * 
  *   cdef float wx, wy, wz
  *   (wx, wy, wz) = anisotropy             # <<<<<<<<<<<<<<
  * 
  *   cdef float radius, dist
  */
   if ((likely(PyTuple_CheckExact(__pyx_v_anisotropy))) || (PyList_CheckExact(__pyx_v_anisotropy))) {
     PyObject* sequence = __pyx_v_anisotropy;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 3)) {
       if (size > 3) __Pyx_RaiseTooManyValuesError(3);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 389, __pyx_L1_error)
+      __PYX_ERR(0, 446, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
       __pyx_t_4 = PyTuple_GET_ITEM(sequence, 2); 
     } else {
@@ -30531,169 +31744,169 @@
       __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
       __pyx_t_4 = PyList_GET_ITEM(sequence, 2); 
     }
     __Pyx_INCREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_t_4);
     #else
-    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 389, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 446, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 389, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 446, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 389, __pyx_L1_error)
+    __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 446, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     #endif
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_5 = PyObject_GetIter(__pyx_v_anisotropy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 389, __pyx_L1_error)
+    __pyx_t_5 = PyObject_GetIter(__pyx_v_anisotropy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 446, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
     index = 0; __pyx_t_2 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_2);
     index = 1; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_3);
     index = 2; __pyx_t_4 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_4);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 389, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 446, __pyx_L1_error)
     __pyx_t_6 = NULL;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     goto __pyx_L4_unpacking_done;
     __pyx_L3_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_6 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 389, __pyx_L1_error)
+    __PYX_ERR(0, 446, __pyx_L1_error)
     __pyx_L4_unpacking_done:;
   }
-  __pyx_t_7 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_7 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 389, __pyx_L1_error)
+  __pyx_t_7 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_7 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 446, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_8 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_8 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 389, __pyx_L1_error)
+  __pyx_t_8 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_8 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 446, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_9 = __pyx_PyFloat_AsFloat(__pyx_t_4); if (unlikely((__pyx_t_9 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 389, __pyx_L1_error)
+  __pyx_t_9 = __pyx_PyFloat_AsFloat(__pyx_t_4); if (unlikely((__pyx_t_9 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 446, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_wx = __pyx_t_7;
   __pyx_v_wy = __pyx_t_8;
   __pyx_v_wz = __pyx_t_9;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":397
+  /* "ext/skeletontricks/skeletontricks.pyx":454
  *   cdef int64_t x0, y0, z0
  * 
  *   cdef size_t invalidated = 0             # <<<<<<<<<<<<<<
  * 
  *   for coord in path:
  */
   __pyx_v_invalidated = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":399
+  /* "ext/skeletontricks/skeletontricks.pyx":456
  *   cdef size_t invalidated = 0
  * 
  *   for coord in path:             # <<<<<<<<<<<<<<
  *     if tuple(coord) in invalid_vertices:
  *       continue
  */
   if (likely(PyList_CheckExact(__pyx_v_path)) || PyTuple_CheckExact(__pyx_v_path)) {
     __pyx_t_4 = __pyx_v_path; __Pyx_INCREF(__pyx_t_4);
     __pyx_t_10 = 0;
     __pyx_t_11 = NULL;
   } else {
-    __pyx_t_10 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_path); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 399, __pyx_L1_error)
+    __pyx_t_10 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_path); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 456, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 399, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 456, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_11)) {
       if (likely(PyList_CheckExact(__pyx_t_4))) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_4);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 399, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 456, __pyx_L1_error)
           #endif
           if (__pyx_t_10 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_3); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 399, __pyx_L1_error)
+        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_3); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 456, __pyx_L1_error)
         #else
-        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 399, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 456, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         #endif
       } else {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_4);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 399, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 456, __pyx_L1_error)
           #endif
           if (__pyx_t_10 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_3); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 399, __pyx_L1_error)
+        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_3); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 456, __pyx_L1_error)
         #else
-        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 399, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 456, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         #endif
       }
     } else {
       __pyx_t_3 = __pyx_t_11(__pyx_t_4);
       if (unlikely(!__pyx_t_3)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 399, __pyx_L1_error)
+          else __PYX_ERR(0, 456, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_3);
     }
     __Pyx_XDECREF_SET(__pyx_v_coord, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":400
+    /* "ext/skeletontricks/skeletontricks.pyx":457
  * 
  *   for coord in path:
  *     if tuple(coord) in invalid_vertices:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
-    __pyx_t_3 = __Pyx_PySequence_Tuple(__pyx_v_coord); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 400, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PySequence_Tuple(__pyx_v_coord); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 457, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_12 = (__Pyx_PySequence_ContainsTF(__pyx_t_3, __pyx_v_invalid_vertices, Py_EQ)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 400, __pyx_L1_error)
+    __pyx_t_12 = (__Pyx_PySequence_ContainsTF(__pyx_t_3, __pyx_v_invalid_vertices, Py_EQ)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 457, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (__pyx_t_12) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":401
+      /* "ext/skeletontricks/skeletontricks.pyx":458
  *   for coord in path:
  *     if tuple(coord) in invalid_vertices:
  *       continue             # <<<<<<<<<<<<<<
  * 
  *     (x0, y0, z0) = coord
  */
       goto __pyx_L5_continue;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":400
+      /* "ext/skeletontricks/skeletontricks.pyx":457
  * 
  *   for coord in path:
  *     if tuple(coord) in invalid_vertices:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":403
+    /* "ext/skeletontricks/skeletontricks.pyx":460
  *       continue
  * 
  *     (x0, y0, z0) = coord             # <<<<<<<<<<<<<<
  *     radius = DBF[x0,y0,z0] * scale + const # physical units (e.g. nm)
  * 
  */
     if ((likely(PyTuple_CheckExact(__pyx_v_coord))) || (PyList_CheckExact(__pyx_v_coord))) {
       PyObject* sequence = __pyx_v_coord;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 3)) {
         if (size > 3) __Pyx_RaiseTooManyValuesError(3);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 403, __pyx_L1_error)
+        __PYX_ERR(0, 460, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
         __pyx_t_5 = PyTuple_GET_ITEM(sequence, 2); 
       } else {
@@ -30701,355 +31914,355 @@
         __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
         __pyx_t_5 = PyList_GET_ITEM(sequence, 2); 
       }
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_5);
       #else
-      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 403, __pyx_L1_error)
+      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 460, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 403, __pyx_L1_error)
+      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 460, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_5 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 403, __pyx_L1_error)
+      __pyx_t_5 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 460, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       #endif
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_13 = PyObject_GetIter(__pyx_v_coord); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 403, __pyx_L1_error)
+      __pyx_t_13 = PyObject_GetIter(__pyx_v_coord); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 460, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_13);
       __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_13);
       index = 0; __pyx_t_3 = __pyx_t_6(__pyx_t_13); if (unlikely(!__pyx_t_3)) goto __pyx_L8_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_3);
       index = 1; __pyx_t_2 = __pyx_t_6(__pyx_t_13); if (unlikely(!__pyx_t_2)) goto __pyx_L8_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_2);
       index = 2; __pyx_t_5 = __pyx_t_6(__pyx_t_13); if (unlikely(!__pyx_t_5)) goto __pyx_L8_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_5);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_13), 3) < 0) __PYX_ERR(0, 403, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_13), 3) < 0) __PYX_ERR(0, 460, __pyx_L1_error)
       __pyx_t_6 = NULL;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       goto __pyx_L9_unpacking_done;
       __pyx_L8_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __pyx_t_6 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 403, __pyx_L1_error)
+      __PYX_ERR(0, 460, __pyx_L1_error)
       __pyx_L9_unpacking_done:;
     }
-    __pyx_t_14 = __Pyx_PyInt_As_int64_t(__pyx_t_3); if (unlikely((__pyx_t_14 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 403, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_As_int64_t(__pyx_t_3); if (unlikely((__pyx_t_14 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 460, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_15 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_15 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 403, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_15 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 460, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_16 = __Pyx_PyInt_As_int64_t(__pyx_t_5); if (unlikely((__pyx_t_16 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 403, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyInt_As_int64_t(__pyx_t_5); if (unlikely((__pyx_t_16 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 460, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_v_x0 = __pyx_t_14;
     __pyx_v_y0 = __pyx_t_15;
     __pyx_v_z0 = __pyx_t_16;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":404
+    /* "ext/skeletontricks/skeletontricks.pyx":461
  * 
  *     (x0, y0, z0) = coord
  *     radius = DBF[x0,y0,z0] * scale + const # physical units (e.g. nm)             # <<<<<<<<<<<<<<
  * 
  *     minx = max(0,  <int64_t>(0.5 + (x0 - (radius / wx))))
  */
     __pyx_t_17 = __pyx_v_x0;
     __pyx_t_18 = __pyx_v_y0;
     __pyx_t_19 = __pyx_v_z0;
     __pyx_v_radius = (((*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_DBF.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_DBF.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_DBF.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_DBF.diminfo[2].strides)) * __pyx_v_scale) + __pyx_v_const);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":406
+    /* "ext/skeletontricks/skeletontricks.pyx":463
  *     radius = DBF[x0,y0,z0] * scale + const # physical units (e.g. nm)
  * 
  *     minx = max(0,  <int64_t>(0.5 + (x0 - (radius / wx))))             # <<<<<<<<<<<<<<
  *     maxx = min(sx, <int64_t>(0.5 + (x0 + (radius / wx))))
  *     miny = max(0,  <int64_t>(0.5 + (y0 - (radius / wy))))
  */
     if (unlikely(__pyx_v_wx == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 406, __pyx_L1_error)
+      __PYX_ERR(0, 463, __pyx_L1_error)
     }
     __pyx_t_16 = ((int64_t)(0.5 + (__pyx_v_x0 - (__pyx_v_radius / __pyx_v_wx))));
     __pyx_t_20 = 0;
     __pyx_t_12 = (__pyx_t_16 > __pyx_t_20);
     if (__pyx_t_12) {
       __pyx_t_15 = __pyx_t_16;
     } else {
       __pyx_t_15 = __pyx_t_20;
     }
     __pyx_v_minx = __pyx_t_15;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":407
+    /* "ext/skeletontricks/skeletontricks.pyx":464
  * 
  *     minx = max(0,  <int64_t>(0.5 + (x0 - (radius / wx))))
  *     maxx = min(sx, <int64_t>(0.5 + (x0 + (radius / wx))))             # <<<<<<<<<<<<<<
  *     miny = max(0,  <int64_t>(0.5 + (y0 - (radius / wy))))
  *     maxy = min(sy, <int64_t>(0.5 + (y0 + (radius / wy))))
  */
     if (unlikely(__pyx_v_wx == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 407, __pyx_L1_error)
+      __PYX_ERR(0, 464, __pyx_L1_error)
     }
     __pyx_t_15 = ((int64_t)(0.5 + (__pyx_v_x0 + (__pyx_v_radius / __pyx_v_wx))));
     __pyx_t_16 = __pyx_v_sx;
     __pyx_t_12 = (__pyx_t_15 < __pyx_t_16);
     if (__pyx_t_12) {
       __pyx_t_14 = __pyx_t_15;
     } else {
       __pyx_t_14 = __pyx_t_16;
     }
     __pyx_v_maxx = __pyx_t_14;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":408
+    /* "ext/skeletontricks/skeletontricks.pyx":465
  *     minx = max(0,  <int64_t>(0.5 + (x0 - (radius / wx))))
  *     maxx = min(sx, <int64_t>(0.5 + (x0 + (radius / wx))))
  *     miny = max(0,  <int64_t>(0.5 + (y0 - (radius / wy))))             # <<<<<<<<<<<<<<
  *     maxy = min(sy, <int64_t>(0.5 + (y0 + (radius / wy))))
  *     minz = max(0,  <int64_t>(0.5 + (z0 - (radius / wz))))
  */
     if (unlikely(__pyx_v_wy == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 408, __pyx_L1_error)
+      __PYX_ERR(0, 465, __pyx_L1_error)
     }
     __pyx_t_14 = ((int64_t)(0.5 + (__pyx_v_y0 - (__pyx_v_radius / __pyx_v_wy))));
     __pyx_t_20 = 0;
     __pyx_t_12 = (__pyx_t_14 > __pyx_t_20);
     if (__pyx_t_12) {
       __pyx_t_15 = __pyx_t_14;
     } else {
       __pyx_t_15 = __pyx_t_20;
     }
     __pyx_v_miny = __pyx_t_15;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":409
+    /* "ext/skeletontricks/skeletontricks.pyx":466
  *     maxx = min(sx, <int64_t>(0.5 + (x0 + (radius / wx))))
  *     miny = max(0,  <int64_t>(0.5 + (y0 - (radius / wy))))
  *     maxy = min(sy, <int64_t>(0.5 + (y0 + (radius / wy))))             # <<<<<<<<<<<<<<
  *     minz = max(0,  <int64_t>(0.5 + (z0 - (radius / wz))))
  *     maxz = min(sz, <int64_t>(0.5 + (z0 + (radius / wz))))
  */
     if (unlikely(__pyx_v_wy == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 409, __pyx_L1_error)
+      __PYX_ERR(0, 466, __pyx_L1_error)
     }
     __pyx_t_15 = ((int64_t)(0.5 + (__pyx_v_y0 + (__pyx_v_radius / __pyx_v_wy))));
     __pyx_t_14 = __pyx_v_sy;
     __pyx_t_12 = (__pyx_t_15 < __pyx_t_14);
     if (__pyx_t_12) {
       __pyx_t_16 = __pyx_t_15;
     } else {
       __pyx_t_16 = __pyx_t_14;
     }
     __pyx_v_maxy = __pyx_t_16;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":410
+    /* "ext/skeletontricks/skeletontricks.pyx":467
  *     miny = max(0,  <int64_t>(0.5 + (y0 - (radius / wy))))
  *     maxy = min(sy, <int64_t>(0.5 + (y0 + (radius / wy))))
  *     minz = max(0,  <int64_t>(0.5 + (z0 - (radius / wz))))             # <<<<<<<<<<<<<<
  *     maxz = min(sz, <int64_t>(0.5 + (z0 + (radius / wz))))
  * 
  */
     if (unlikely(__pyx_v_wz == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 410, __pyx_L1_error)
+      __PYX_ERR(0, 467, __pyx_L1_error)
     }
     __pyx_t_16 = ((int64_t)(0.5 + (__pyx_v_z0 - (__pyx_v_radius / __pyx_v_wz))));
     __pyx_t_20 = 0;
     __pyx_t_12 = (__pyx_t_16 > __pyx_t_20);
     if (__pyx_t_12) {
       __pyx_t_15 = __pyx_t_16;
     } else {
       __pyx_t_15 = __pyx_t_20;
     }
     __pyx_v_minz = __pyx_t_15;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":411
+    /* "ext/skeletontricks/skeletontricks.pyx":468
  *     maxy = min(sy, <int64_t>(0.5 + (y0 + (radius / wy))))
  *     minz = max(0,  <int64_t>(0.5 + (z0 - (radius / wz))))
  *     maxz = min(sz, <int64_t>(0.5 + (z0 + (radius / wz))))             # <<<<<<<<<<<<<<
  * 
  *     radius *= radius
  */
     if (unlikely(__pyx_v_wz == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 411, __pyx_L1_error)
+      __PYX_ERR(0, 468, __pyx_L1_error)
     }
     __pyx_t_15 = ((int64_t)(0.5 + (__pyx_v_z0 + (__pyx_v_radius / __pyx_v_wz))));
     __pyx_t_16 = __pyx_v_sz;
     __pyx_t_12 = (__pyx_t_15 < __pyx_t_16);
     if (__pyx_t_12) {
       __pyx_t_14 = __pyx_t_15;
     } else {
       __pyx_t_14 = __pyx_t_16;
     }
     __pyx_v_maxz = __pyx_t_14;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":413
+    /* "ext/skeletontricks/skeletontricks.pyx":470
  *     maxz = min(sz, <int64_t>(0.5 + (z0 + (radius / wz))))
  * 
  *     radius *= radius             # <<<<<<<<<<<<<<
  * 
  *     for x in range(minx, maxx):
  */
     __pyx_v_radius = (__pyx_v_radius * __pyx_v_radius);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":415
+    /* "ext/skeletontricks/skeletontricks.pyx":472
  *     radius *= radius
  * 
  *     for x in range(minx, maxx):             # <<<<<<<<<<<<<<
  *       for y in range(miny, maxy):
  *         for z in range(minz, maxz):
  */
     __pyx_t_14 = __pyx_v_maxx;
     __pyx_t_15 = __pyx_t_14;
     for (__pyx_t_16 = __pyx_v_minx; __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
       __pyx_v_x = __pyx_t_16;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":416
+      /* "ext/skeletontricks/skeletontricks.pyx":473
  * 
  *     for x in range(minx, maxx):
  *       for y in range(miny, maxy):             # <<<<<<<<<<<<<<
  *         for z in range(minz, maxz):
  *           if not labels[x,y,z]:
  */
       __pyx_t_21 = __pyx_v_maxy;
       __pyx_t_22 = __pyx_t_21;
       for (__pyx_t_23 = __pyx_v_miny; __pyx_t_23 < __pyx_t_22; __pyx_t_23+=1) {
         __pyx_v_y = __pyx_t_23;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":417
+        /* "ext/skeletontricks/skeletontricks.pyx":474
  *     for x in range(minx, maxx):
  *       for y in range(miny, maxy):
  *         for z in range(minz, maxz):             # <<<<<<<<<<<<<<
  *           if not labels[x,y,z]:
  *             continue
  */
         __pyx_t_24 = __pyx_v_maxz;
         __pyx_t_25 = __pyx_t_24;
         for (__pyx_t_26 = __pyx_v_minz; __pyx_t_26 < __pyx_t_25; __pyx_t_26+=1) {
           __pyx_v_z = __pyx_t_26;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":418
+          /* "ext/skeletontricks/skeletontricks.pyx":475
  *       for y in range(miny, maxy):
  *         for z in range(minz, maxz):
  *           if not labels[x,y,z]:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
           __pyx_t_19 = __pyx_v_x;
           __pyx_t_18 = __pyx_v_y;
           __pyx_t_17 = __pyx_v_z;
           __pyx_t_12 = (!((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[2].strides)) != 0));
           if (__pyx_t_12) {
 
-            /* "ext/skeletontricks/skeletontricks.pyx":419
+            /* "ext/skeletontricks/skeletontricks.pyx":476
  *         for z in range(minz, maxz):
  *           if not labels[x,y,z]:
  *             continue             # <<<<<<<<<<<<<<
  * 
  *           dist = (wx * (x - x0)) ** 2 + (wy * (y - y0)) ** 2 + (wz * (z - z0)) ** 2
  */
             goto __pyx_L14_continue;
 
-            /* "ext/skeletontricks/skeletontricks.pyx":418
+            /* "ext/skeletontricks/skeletontricks.pyx":475
  *       for y in range(miny, maxy):
  *         for z in range(minz, maxz):
  *           if not labels[x,y,z]:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
           }
 
-          /* "ext/skeletontricks/skeletontricks.pyx":421
+          /* "ext/skeletontricks/skeletontricks.pyx":478
  *             continue
  * 
  *           dist = (wx * (x - x0)) ** 2 + (wy * (y - y0)) ** 2 + (wz * (z - z0)) ** 2             # <<<<<<<<<<<<<<
  *           if dist <= radius:
  *             invalidated += 1
  */
           __pyx_v_dist = ((powf((__pyx_v_wx * (__pyx_v_x - __pyx_v_x0)), 2.0) + powf((__pyx_v_wy * (__pyx_v_y - __pyx_v_y0)), 2.0)) + powf((__pyx_v_wz * (__pyx_v_z - __pyx_v_z0)), 2.0));
 
-          /* "ext/skeletontricks/skeletontricks.pyx":422
+          /* "ext/skeletontricks/skeletontricks.pyx":479
  * 
  *           dist = (wx * (x - x0)) ** 2 + (wy * (y - y0)) ** 2 + (wz * (z - z0)) ** 2
  *           if dist <= radius:             # <<<<<<<<<<<<<<
  *             invalidated += 1
  *             labels[x,y,z] = 0
  */
           __pyx_t_12 = (__pyx_v_dist <= __pyx_v_radius);
           if (__pyx_t_12) {
 
-            /* "ext/skeletontricks/skeletontricks.pyx":423
+            /* "ext/skeletontricks/skeletontricks.pyx":480
  *           dist = (wx * (x - x0)) ** 2 + (wy * (y - y0)) ** 2 + (wz * (z - z0)) ** 2
  *           if dist <= radius:
  *             invalidated += 1             # <<<<<<<<<<<<<<
  *             labels[x,y,z] = 0
  * 
  */
             __pyx_v_invalidated = (__pyx_v_invalidated + 1);
 
-            /* "ext/skeletontricks/skeletontricks.pyx":424
+            /* "ext/skeletontricks/skeletontricks.pyx":481
  *           if dist <= radius:
  *             invalidated += 1
  *             labels[x,y,z] = 0             # <<<<<<<<<<<<<<
  * 
  *   return invalidated, labels
  */
             __pyx_t_17 = __pyx_v_x;
             __pyx_t_18 = __pyx_v_y;
             __pyx_t_19 = __pyx_v_z;
             *__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides) = 0;
 
-            /* "ext/skeletontricks/skeletontricks.pyx":422
+            /* "ext/skeletontricks/skeletontricks.pyx":479
  * 
  *           dist = (wx * (x - x0)) ** 2 + (wy * (y - y0)) ** 2 + (wz * (z - z0)) ** 2
  *           if dist <= radius:             # <<<<<<<<<<<<<<
  *             invalidated += 1
  *             labels[x,y,z] = 0
  */
           }
           __pyx_L14_continue:;
         }
       }
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":399
+    /* "ext/skeletontricks/skeletontricks.pyx":456
  *   cdef size_t invalidated = 0
  * 
  *   for coord in path:             # <<<<<<<<<<<<<<
  *     if tuple(coord) in invalid_vertices:
  *       continue
  */
     __pyx_L5_continue:;
   }
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":426
+  /* "ext/skeletontricks/skeletontricks.pyx":483
  *             labels[x,y,z] = 0
  * 
  *   return invalidated, labels             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_v_invalidated); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 426, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_v_invalidated); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 426, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_4);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4)) __PYX_ERR(0, 426, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4)) __PYX_ERR(0, 483, __pyx_L1_error);
   __Pyx_INCREF((PyObject *)__pyx_v_labels);
   __Pyx_GIVEREF((PyObject *)__pyx_v_labels);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_labels))) __PYX_ERR(0, 426, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_v_labels))) __PYX_ERR(0, 483, __pyx_L1_error);
   __pyx_t_4 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":358
- * 
+  /* "ext/skeletontricks/skeletontricks.pyx":419
+ *   return (invalidated, labels)
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
   /* function exit code */
@@ -31075,27 +32288,27 @@
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_coord);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":428
+/* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_21get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_20get_mapping, "\n  get_mapping(\n    ndarray[INTEGER, ndim=3] orig_labels, \n    ndarray[UINT, ndim=3] cc_labels\n  )\n\n  Given a set of possibly not connected labels \n  and an image containing their labeled connected components, \n  produce a dictionary containing the inverse of this mapping.\n\n  Returns: { $CC_LABEL: $ORIGINAL_LABEL }\n  ");
-static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_21get_mapping = {"get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_21get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_21get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_23get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_22get_mapping, "\n  Given a set of possibly not connected labels \n  and an image containing their labeled connected components, \n  produce a dictionary containing the inverse of this mapping.\n\n  Returns: { $CC_LABEL: $ORIGINAL_LABEL }\n  ");
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_23get_mapping = {"get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_23get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_23get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_signatures = 0;
   PyObject *__pyx_v_args = 0;
   PyObject *__pyx_v_kwargs = 0;
   CYTHON_UNUSED PyObject *__pyx_v_defaults = 0;
   PyObject *__pyx_v__fused_sigindex = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -31135,57 +32348,57 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_signatures)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_args)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_kwargs)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 485, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_defaults)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 485, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_fused_sigindex);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
@@ -31199,42 +32412,42 @@
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
     __pyx_v__fused_sigindex = values[4];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_20get_mapping(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults, __pyx_v__fused_sigindex);
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_22get_mapping(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults, __pyx_v__fused_sigindex);
 
   /* function exit code */
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_20get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_22get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex) {
   PyObject *__pyx_v_search_list = 0;
   PyObject *__pyx_v_sigindex_node = 0;
   PyObject *__pyx_v_dest_sig = NULL;
   PyTypeObject *__pyx_v_ndarray = 0;
   PyObject *__pyx_v_arg_as_memoryview = 0;
   __Pyx_memviewslice __pyx_v_memslice;
   Py_ssize_t __pyx_v_itemsize;
@@ -31286,40 +32499,40 @@
   Py_ssize_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_mapping", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1 * 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 2; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_None)) __PYX_ERR(0, 428, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_1, __pyx_temp, Py_None)) __PYX_ERR(0, 485, __pyx_L1_error);
     }
   }
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   if (__pyx_t_3) {
   } else {
     __pyx_t_2 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_3);
   __pyx_t_2 = __pyx_t_4;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v___pyx_fused_dtype_int8__t_is_signed = (!(((int8_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_int16__t_is_signed = (!(((int16_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_int32__t_is_signed = (!(((int32_t)-1L) > 0));
@@ -31327,22 +32540,22 @@
   __pyx_v___pyx_fused_dtype_uint8__t_is_signed = (!(((uint8_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint16__t_is_signed = (!(((uint16_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint32__t_is_signed = (!(((uint32_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint64__t_is_signed = (!(((uint64_t)-1L) > 0));
   __pyx_v_unsigned_char_is_signed = (!(((unsigned char)-1L) > 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 428, __pyx_L1_error)
+    __PYX_ERR(0, 485, __pyx_L1_error)
   }
-  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
   __pyx_t_2 = (0 < __pyx_t_5);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 428, __pyx_L1_error)
+      __PYX_ERR(0, 485, __pyx_L1_error)
     }
     __pyx_t_1 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 0);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
@@ -31350,80 +32563,80 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 428, __pyx_L1_error)
+    __PYX_ERR(0, 485, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_orig_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_orig_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
   __pyx_t_2 = __pyx_t_4;
   __pyx_L7_bool_binop_done:;
   if (likely(__pyx_t_2)) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 428, __pyx_L1_error)
+      __PYX_ERR(0, 485, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_orig_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_orig_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 428, __pyx_L1_error)
+      __PYX_ERR(0, 485, __pyx_L1_error)
     }
-    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_2);
     __Pyx_GIVEREF(__pyx_int_2);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_2)) __PYX_ERR(0, 428, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_2)) __PYX_ERR(0, 485, __pyx_L1_error);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 428, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 485, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_1);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 428, __pyx_L1_error)
+    __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -31436,233 +32649,233 @@
         __Pyx_INCREF(Py_None);
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 0x69);
         switch (__pyx_v_kind) {
           case 0x69:
           case 0x75:
           __pyx_t_4 = ((sizeof(int8_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int8__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(int16_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int16__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L20_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(int32_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int32__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L24_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(int64_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int64__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L28_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint8_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint8__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L32_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint16_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L36_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L36_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint16__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L36_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint32_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L40_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L40_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint32__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L40_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint64_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L44_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L44_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint64__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L44_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(unsigned char)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L48_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L48_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v_unsigned_char_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L48_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 0x66:
           break;
           case 99:
           break;
@@ -31670,349 +32883,349 @@
           break;
           default: break;
         }
       }
     }
     __pyx_t_2 = (__pyx_v_arg == Py_None);
     if (__pyx_t_2) {
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
       goto __pyx_L10_break;
     }
     {
       __Pyx_PyThreadState_declare
       __Pyx_PyThreadState_assign
       __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
       __Pyx_XGOTREF(__pyx_t_8);
       __Pyx_XGOTREF(__pyx_t_9);
       __Pyx_XGOTREF(__pyx_t_10);
       /*try:*/ {
-        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L52_error)
+        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L52_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_as_memoryview = ((PyObject*)__pyx_t_6);
         __pyx_t_6 = 0;
       }
       /*else:*/ {
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L63_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int8_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L62_next_and;
         }
         __pyx_L63_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int8_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L61_bool_binop_done;
         }
         __pyx_L62_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L61_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int8_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L69_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int16_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L68_next_and;
         }
         __pyx_L69_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int16_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L67_bool_binop_done;
         }
         __pyx_L68_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L67_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int16_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L75_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int32_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L74_next_and;
         }
         __pyx_L75_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int32_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L73_bool_binop_done;
         }
         __pyx_L74_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L73_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int32_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L81_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int64_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L80_next_and;
         }
         __pyx_L81_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int64_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L79_bool_binop_done;
         }
         __pyx_L80_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L79_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int64_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L87_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint8_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L86_next_and;
         }
         __pyx_L87_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint8_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L85_bool_binop_done;
         }
         __pyx_L86_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L85_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint8_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L93_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint16_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L92_next_and;
         }
         __pyx_L93_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint16_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L91_bool_binop_done;
         }
         __pyx_L92_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L91_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint16_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L99_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint32_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L98_next_and;
         }
         __pyx_L99_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint32_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L97_bool_binop_done;
         }
         __pyx_L98_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L97_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint32_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L105_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint64_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L104_next_and;
         }
         __pyx_L105_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint64_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L103_bool_binop_done;
         }
         __pyx_L104_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L103_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint64_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L111_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(unsigned char)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L110_next_and;
         }
         __pyx_L111_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(unsigned char)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L109_bool_binop_done;
         }
         __pyx_L110_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L109_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_unsigned_char(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
       }
@@ -32022,15 +33235,15 @@
       goto __pyx_L59_try_end;
       __pyx_L52_error:;
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_11 = __Pyx_PyErr_ExceptionMatches2(__pyx_builtin_ValueError, __pyx_builtin_TypeError);
       if (__pyx_t_11) {
         __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
-        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 428, __pyx_L54_except_error)
+        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 485, __pyx_L54_except_error)
         __Pyx_XGOTREF(__pyx_t_6);
         __Pyx_XGOTREF(__pyx_t_1);
         __Pyx_XGOTREF(__pyx_t_13);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         goto __pyx_L53_exception_handled;
@@ -32051,28 +33264,28 @@
       __pyx_L53_exception_handled:;
       __Pyx_XGIVEREF(__pyx_t_8);
       __Pyx_XGIVEREF(__pyx_t_9);
       __Pyx_XGIVEREF(__pyx_t_10);
       __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
       __pyx_L59_try_end:;
     }
-    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 428, __pyx_L1_error)
+    __PYX_ERR(0, 485, __pyx_L1_error)
   }
-  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
   __pyx_t_2 = (1 < __pyx_t_5);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 428, __pyx_L1_error)
+      __PYX_ERR(0, 485, __pyx_L1_error)
     }
     __pyx_t_13 = PyTuple_GET_ITEM(((PyObject*)__pyx_v_args), 1);
     __Pyx_INCREF(__pyx_t_13);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_13);
     __pyx_t_13 = 0;
     goto __pyx_L116;
   }
@@ -32080,80 +33293,80 @@
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L117_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 428, __pyx_L1_error)
+    __PYX_ERR(0, 485, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_cc_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_cc_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
   __pyx_t_2 = __pyx_t_4;
   __pyx_L117_bool_binop_done:;
   if (likely(__pyx_t_2)) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 428, __pyx_L1_error)
+      __PYX_ERR(0, 485, __pyx_L1_error)
     }
-    __pyx_t_13 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_cc_labels); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_cc_labels); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF_SET(__pyx_v_arg, __pyx_t_13);
     __pyx_t_13 = 0;
     goto __pyx_L116;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 428, __pyx_L1_error)
+      __PYX_ERR(0, 485, __pyx_L1_error)
     }
-    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
-    __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
+    __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_int_2);
     __Pyx_GIVEREF(__pyx_int_2);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_2)) __PYX_ERR(0, 428, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_2)) __PYX_ERR(0, 485, __pyx_L1_error);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_s)) __PYX_ERR(0, 428, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_s_s)) __PYX_ERR(0, 485, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_13);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error);
     __pyx_t_13 = 0;
-    __pyx_t_13 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_13); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_13); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 428, __pyx_L1_error)
+    __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_L116:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
         __pyx_t_1 = 0;
         goto __pyx_L122;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_arg_base, __pyx_t_1);
         __pyx_t_1 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         if (__pyx_t_2) {
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_XDECREF_SET(__pyx_v_dtype, __pyx_t_1);
           __pyx_t_1 = 0;
           goto __pyx_L123;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -32166,141 +33379,141 @@
         __Pyx_INCREF(Py_None);
         __Pyx_XDECREF_SET(__pyx_v_dtype, Py_None);
       }
       __pyx_L122:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       if (__pyx_t_2) {
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_1); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 0x69);
         switch (__pyx_v_kind) {
           case 0x69:
           case 0x75:
           __pyx_t_4 = ((sizeof(uint8_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L126_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L126_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint8__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L126_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L120_break;
           }
           __pyx_t_4 = ((sizeof(uint16_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L130_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L130_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint16__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L130_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L120_break;
           }
           __pyx_t_4 = ((sizeof(uint32_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L134_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L134_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint32__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L134_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L120_break;
           }
           __pyx_t_4 = ((sizeof(uint64_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L138_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L138_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint64__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L138_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L120_break;
           }
           __pyx_t_4 = ((sizeof(unsigned char)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L142_bool_binop_done;
           }
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L142_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v_unsigned_char_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L142_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             goto __pyx_L120_break;
           }
           break;
           case 0x66:
           break;
           case 99:
           break;
@@ -32308,205 +33521,205 @@
           break;
           default: break;
         }
       }
     }
     __pyx_t_2 = (__pyx_v_arg == Py_None);
     if (__pyx_t_2) {
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
       goto __pyx_L120_break;
     }
     {
       __Pyx_PyThreadState_declare
       __Pyx_PyThreadState_assign
       __Pyx_ExceptionSave(&__pyx_t_10, &__pyx_t_9, &__pyx_t_8);
       __Pyx_XGOTREF(__pyx_t_10);
       __Pyx_XGOTREF(__pyx_t_9);
       __Pyx_XGOTREF(__pyx_t_8);
       /*try:*/ {
-        __pyx_t_1 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L146_error)
+        __pyx_t_1 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L146_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_XDECREF_SET(__pyx_v_arg_as_memoryview, ((PyObject*)__pyx_t_1));
         __pyx_t_1 = 0;
       }
       /*else:*/ {
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L157_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint8_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L156_next_and;
         }
         __pyx_L157_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint8_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L155_bool_binop_done;
         }
         __pyx_L156_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L155_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint8_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L148_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L148_except_error)
             goto __pyx_L151_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L163_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint16_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L162_next_and;
         }
         __pyx_L163_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint16_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L161_bool_binop_done;
         }
         __pyx_L162_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L161_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint16_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L148_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L148_except_error)
             goto __pyx_L151_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L169_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint32_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L168_next_and;
         }
         __pyx_L169_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint32_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L167_bool_binop_done;
         }
         __pyx_L168_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L167_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint32_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L148_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L148_except_error)
             goto __pyx_L151_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L175_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint64_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L174_next_and;
         }
         __pyx_L175_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint64_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L173_bool_binop_done;
         }
         __pyx_L174_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L173_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint64_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L148_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L148_except_error)
             goto __pyx_L151_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L181_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(unsigned char)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L180_next_and;
         }
         __pyx_L181_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(unsigned char)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L179_bool_binop_done;
         }
         __pyx_L180_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L179_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_unsigned_char(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L148_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L148_except_error)
             goto __pyx_L151_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
       }
@@ -32517,15 +33730,15 @@
       __pyx_L146_error:;
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_11 = __Pyx_PyErr_ExceptionMatches2(__pyx_builtin_ValueError, __pyx_builtin_TypeError);
       if (__pyx_t_11) {
         __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
-        if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_13, &__pyx_t_6) < 0) __PYX_ERR(0, 428, __pyx_L148_except_error)
+        if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_13, &__pyx_t_6) < 0) __PYX_ERR(0, 485, __pyx_L148_except_error)
         __Pyx_XGOTREF(__pyx_t_1);
         __Pyx_XGOTREF(__pyx_t_13);
         __Pyx_XGOTREF(__pyx_t_6);
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         goto __pyx_L147_exception_handled;
@@ -32546,43 +33759,43 @@
       __pyx_L147_exception_handled:;
       __Pyx_XGIVEREF(__pyx_t_10);
       __Pyx_XGIVEREF(__pyx_t_9);
       __Pyx_XGIVEREF(__pyx_t_8);
       __Pyx_ExceptionReset(__pyx_t_10, __pyx_t_9, __pyx_t_8);
       __pyx_L153_try_end:;
     }
-    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 1, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 0) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
     goto __pyx_L120_break;
   }
   __pyx_L120_break:;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_2);
   if (__pyx_t_4) {
     __pyx_t_5 = 0;
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 428, __pyx_L1_error)
+      __PYX_ERR(0, 485, __pyx_L1_error)
     }
-    __pyx_t_13 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_XDECREF(__pyx_t_6);
     __pyx_t_6 = __pyx_t_13;
     __pyx_t_13 = 0;
     while (1) {
       __pyx_t_15 = __Pyx_dict_iter_next(__pyx_t_6, __pyx_t_14, &__pyx_t_5, &__pyx_t_13, NULL, NULL, __pyx_t_11);
       if (unlikely(__pyx_t_15 == 0)) break;
-      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_13);
       __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_13);
       __pyx_t_13 = 0;
       __pyx_t_13 = __pyx_v__fused_sigindex;
       __Pyx_INCREF(__pyx_t_13);
       __Pyx_XDECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_13));
       __pyx_t_13 = 0;
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 428, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 485, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __pyx_t_17 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_17 = PyMethod_GET_SELF(__pyx_t_16);
         if (likely(__pyx_t_17)) {
@@ -32594,19 +33807,19 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_17, __pyx_kp_s__13};
         __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 428, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 485, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_1 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_16);
@@ -32619,34 +33832,34 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_kp_s__14};
         __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-        if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+        if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_13);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_13); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 428, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_13); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 485, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __pyx_t_18 = PyList_GET_SIZE(__pyx_t_16);
       if (unlikely(__pyx_t_18 < 1)) {
-        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 428, __pyx_L1_error)
+        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 485, __pyx_L1_error)
       }
       #if CYTHON_COMPILING_IN_CPYTHON
       __pyx_t_1 = PyList_GET_ITEM(__pyx_t_16, __pyx_t_18-1); 
       ((PyVarObject*)__pyx_t_16)->ob_size--;
       #else
       __pyx_t_1 = PySequence_ITEM(__pyx_t_16, __pyx_t_18-1); 
       #endif
       __Pyx_GOTREF(__pyx_t_1);
       #if !CYTHON_COMPILING_IN_CPYTHON
-      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 428, __pyx_L1_error)
+      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 485, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_17);
       __Pyx_DECREF(__pyx_t_16);
       __pyx_t_16 = __pyx_t_17; __pyx_t_17 = NULL;
       #else
       CYTHON_UNUSED_VAR(__pyx_t_17);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_sig_series, ((PyObject*)__pyx_t_16));
@@ -32655,220 +33868,220 @@
       __pyx_t_1 = 0;
       __pyx_t_13 = __pyx_v_sig_series; __Pyx_INCREF(__pyx_t_13);
       __pyx_t_18 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_13);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
           #endif
           if (__pyx_t_18 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_18); __Pyx_INCREF(__pyx_t_1); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_18); __Pyx_INCREF(__pyx_t_1); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
         #else
-        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sig_type, __pyx_t_1);
         __pyx_t_1 = 0;
         if (unlikely(__pyx_v_sigindex_node == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 428, __pyx_L1_error)
+          __PYX_ERR(0, 485, __pyx_L1_error)
         }
-        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
         if (__pyx_t_4) {
-          __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 428, __pyx_L1_error)
+            __PYX_ERR(0, 485, __pyx_L1_error)
           }
-          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_1) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_1) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_INCREF(__pyx_t_1);
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, __pyx_t_1);
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           goto __pyx_L191;
         }
         /*else*/ {
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 428, __pyx_L1_error)
+            __PYX_ERR(0, 485, __pyx_L1_error)
           }
-          __pyx_t_1 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __pyx_t_16 = __pyx_t_1;
           __Pyx_INCREF(__pyx_t_16);
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_16));
           __pyx_t_16 = 0;
         }
         __pyx_L191:;
       }
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       if (unlikely(__pyx_v_sigindex_node == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 428, __pyx_L1_error)
+        __PYX_ERR(0, 485, __pyx_L1_error)
       }
-      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   }
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_sigindex_matches = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyList_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_INCREF(__pyx_v__fused_sigindex);
   __Pyx_GIVEREF(__pyx_v__fused_sigindex);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_6, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 428, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_6, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 485, __pyx_L1_error);
   __pyx_v_sigindex_candidates = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
   __pyx_t_6 = __pyx_v_dest_sig; __Pyx_INCREF(__pyx_t_6);
   __pyx_t_14 = 0;
   for (;;) {
     {
       Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_6);
       #if !CYTHON_ASSUME_SAFE_MACROS
-      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
       #endif
       if (__pyx_t_14 >= __pyx_temp) break;
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_13 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_14); __Pyx_INCREF(__pyx_t_13); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_13 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_14); __Pyx_INCREF(__pyx_t_13); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
     #else
-    __pyx_t_13 = __Pyx_PySequence_ITEM(__pyx_t_6, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PySequence_ITEM(__pyx_t_6, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_13);
     __pyx_t_13 = 0;
-    __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_XDECREF_SET(__pyx_v_found_matches, ((PyObject*)__pyx_t_13));
     __pyx_t_13 = 0;
-    __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_XDECREF_SET(__pyx_v_found_candidates, ((PyObject*)__pyx_t_13));
     __pyx_t_13 = 0;
     __pyx_t_4 = (__pyx_v_dst_type == Py_None);
     if (__pyx_t_4) {
       __pyx_t_13 = __pyx_v_sigindex_matches; __Pyx_INCREF(__pyx_t_13);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_13);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 428, __pyx_L1_error)
+          __PYX_ERR(0, 485, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __pyx_t_13 = __pyx_v_sigindex_candidates; __Pyx_INCREF(__pyx_t_13);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_13);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 428, __pyx_L1_error)
+          __PYX_ERR(0, 485, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       goto __pyx_L195;
     }
     /*else*/ {
-      __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+      __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_13);
       __Pyx_INCREF(__pyx_v_sigindex_matches);
       __Pyx_GIVEREF(__pyx_v_sigindex_matches);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 428, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 485, __pyx_L1_error);
       __Pyx_INCREF(__pyx_v_sigindex_candidates);
       __Pyx_GIVEREF(__pyx_v_sigindex_candidates);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 428, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 485, __pyx_L1_error);
       __pyx_t_16 = __pyx_t_13; __Pyx_INCREF(__pyx_t_16);
       __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       for (;;) {
         if (__pyx_t_5 >= 2) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_13 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_13); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_13 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_13); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
         #else
-        __pyx_t_13 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 428, __pyx_L1_error)
+        __pyx_t_13 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 485, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_13);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_search_list, ((PyObject*)__pyx_t_13));
         __pyx_t_13 = 0;
         if (unlikely(__pyx_v_search_list == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 428, __pyx_L1_error)
+          __PYX_ERR(0, 485, __pyx_L1_error)
         }
         __pyx_t_13 = __pyx_v_search_list; __Pyx_INCREF(__pyx_t_13);
         __pyx_t_18 = 0;
         for (;;) {
           {
             Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_13);
             #if !CYTHON_ASSUME_SAFE_MACROS
-            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
             #endif
             if (__pyx_t_18 >= __pyx_temp) break;
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_18); __Pyx_INCREF(__pyx_t_1); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_18); __Pyx_INCREF(__pyx_t_1); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
           #else
-          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           #endif
           __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_1);
           __pyx_t_1 = 0;
           if (unlikely(__pyx_v_sn == Py_None)) {
             PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-            __PYX_ERR(0, 428, __pyx_L1_error)
+            __PYX_ERR(0, 485, __pyx_L1_error)
           }
-          __pyx_t_1 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_XDECREF_SET(__pyx_v_type_match, __pyx_t_1);
           __pyx_t_1 = 0;
           __pyx_t_4 = (__pyx_v_type_match != Py_None);
           if (__pyx_t_4) {
-            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
+            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
           }
         }
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       }
       __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
     }
     __pyx_L195:;
@@ -32897,36 +34110,36 @@
   goto __pyx_L212_for_end;
   __pyx_L212_for_end:;
   __Pyx_INCREF(__pyx_v_sigindex_matches);
   __pyx_v_candidates = __pyx_v_sigindex_matches;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_4 = (!__pyx_t_2);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 428, __pyx_L1_error)
+    __PYX_ERR(0, 485, __pyx_L1_error)
   }
-  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 485, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_14 > 1);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 428, __pyx_L1_error)
+    __PYX_ERR(0, 485, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 428, __pyx_L1_error)
+      __PYX_ERR(0, 485, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), PyList_GET_ITEM(__pyx_v_candidates, 0)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
   /* function exit code */
@@ -32962,17 +34175,17 @@
   __Pyx_XDECREF(__pyx_v_kwargs);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_0_0__pyx_pw_8kimimaro_14skeletontricks_57get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_0_0__pyx_mdef_8kimimaro_14skeletontricks_57get_mapping = {"__pyx_fuse_0_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_0__pyx_pw_8kimimaro_14skeletontricks_57get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_0_0__pyx_pw_8kimimaro_14skeletontricks_57get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_0_0__pyx_pw_8kimimaro_14skeletontricks_59get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_0_0__pyx_mdef_8kimimaro_14skeletontricks_59get_mapping = {"__pyx_fuse_0_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_0__pyx_pw_8kimimaro_14skeletontricks_59get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_0_0__pyx_pw_8kimimaro_14skeletontricks_59get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -33001,59 +34214,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_56get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_58get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -33062,15 +34275,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_56get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_58get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -33111,219 +34324,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -33331,27 +34544,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -33376,17 +34589,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_0_1__pyx_pw_8kimimaro_14skeletontricks_59get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_0_1__pyx_mdef_8kimimaro_14skeletontricks_59get_mapping = {"__pyx_fuse_0_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_1__pyx_pw_8kimimaro_14skeletontricks_59get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_0_1__pyx_pw_8kimimaro_14skeletontricks_59get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_0_1__pyx_pw_8kimimaro_14skeletontricks_61get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_0_1__pyx_mdef_8kimimaro_14skeletontricks_61get_mapping = {"__pyx_fuse_0_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_1__pyx_pw_8kimimaro_14skeletontricks_61get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_0_1__pyx_pw_8kimimaro_14skeletontricks_61get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -33415,59 +34628,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_58get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_60get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -33476,15 +34689,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_58get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_60get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -33525,219 +34738,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -33745,27 +34958,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -33790,17 +35003,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_0_2__pyx_pw_8kimimaro_14skeletontricks_61get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_0_2__pyx_mdef_8kimimaro_14skeletontricks_61get_mapping = {"__pyx_fuse_0_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_2__pyx_pw_8kimimaro_14skeletontricks_61get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_0_2__pyx_pw_8kimimaro_14skeletontricks_61get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_0_2__pyx_pw_8kimimaro_14skeletontricks_63get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_0_2__pyx_mdef_8kimimaro_14skeletontricks_63get_mapping = {"__pyx_fuse_0_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_2__pyx_pw_8kimimaro_14skeletontricks_63get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_0_2__pyx_pw_8kimimaro_14skeletontricks_63get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -33829,59 +35042,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_60get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_62get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -33890,15 +35103,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_60get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_62get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -33939,219 +35152,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -34159,27 +35372,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -34204,17 +35417,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_0_3__pyx_pw_8kimimaro_14skeletontricks_63get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_0_3__pyx_mdef_8kimimaro_14skeletontricks_63get_mapping = {"__pyx_fuse_0_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_3__pyx_pw_8kimimaro_14skeletontricks_63get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_0_3__pyx_pw_8kimimaro_14skeletontricks_63get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_0_3__pyx_pw_8kimimaro_14skeletontricks_65get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_0_3__pyx_mdef_8kimimaro_14skeletontricks_65get_mapping = {"__pyx_fuse_0_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_3__pyx_pw_8kimimaro_14skeletontricks_65get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_0_3__pyx_pw_8kimimaro_14skeletontricks_65get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -34243,59 +35456,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_62get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_64get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -34304,15 +35517,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_62get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_64get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -34353,219 +35566,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -34573,27 +35786,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -34618,17 +35831,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_0_4__pyx_pw_8kimimaro_14skeletontricks_65get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_0_4__pyx_mdef_8kimimaro_14skeletontricks_65get_mapping = {"__pyx_fuse_0_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_4__pyx_pw_8kimimaro_14skeletontricks_65get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_0_4__pyx_pw_8kimimaro_14skeletontricks_65get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_0_4__pyx_pw_8kimimaro_14skeletontricks_67get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_0_4__pyx_mdef_8kimimaro_14skeletontricks_67get_mapping = {"__pyx_fuse_0_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0_4__pyx_pw_8kimimaro_14skeletontricks_67get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_0_4__pyx_pw_8kimimaro_14skeletontricks_67get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -34657,59 +35870,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_64get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_66get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -34718,15 +35931,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_64get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_66get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -34767,219 +35980,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -34987,27 +36200,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -35032,17 +36245,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_1_0__pyx_pw_8kimimaro_14skeletontricks_67get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_1_0__pyx_mdef_8kimimaro_14skeletontricks_67get_mapping = {"__pyx_fuse_1_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_0__pyx_pw_8kimimaro_14skeletontricks_67get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_1_0__pyx_pw_8kimimaro_14skeletontricks_67get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_1_0__pyx_pw_8kimimaro_14skeletontricks_69get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_1_0__pyx_mdef_8kimimaro_14skeletontricks_69get_mapping = {"__pyx_fuse_1_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_0__pyx_pw_8kimimaro_14skeletontricks_69get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_1_0__pyx_pw_8kimimaro_14skeletontricks_69get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -35071,59 +36284,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_66get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_68get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -35132,15 +36345,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_66get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_68get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -35181,219 +36394,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -35401,27 +36614,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -35446,17 +36659,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_1_1__pyx_pw_8kimimaro_14skeletontricks_69get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_1_1__pyx_mdef_8kimimaro_14skeletontricks_69get_mapping = {"__pyx_fuse_1_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_1__pyx_pw_8kimimaro_14skeletontricks_69get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_1_1__pyx_pw_8kimimaro_14skeletontricks_69get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_1_1__pyx_pw_8kimimaro_14skeletontricks_71get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_1_1__pyx_mdef_8kimimaro_14skeletontricks_71get_mapping = {"__pyx_fuse_1_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_1__pyx_pw_8kimimaro_14skeletontricks_71get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_1_1__pyx_pw_8kimimaro_14skeletontricks_71get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -35485,59 +36698,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_68get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_70get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -35546,15 +36759,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_68get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_70get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -35595,219 +36808,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -35815,27 +37028,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -35860,17 +37073,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_1_2__pyx_pw_8kimimaro_14skeletontricks_71get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_1_2__pyx_mdef_8kimimaro_14skeletontricks_71get_mapping = {"__pyx_fuse_1_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_2__pyx_pw_8kimimaro_14skeletontricks_71get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_1_2__pyx_pw_8kimimaro_14skeletontricks_71get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_1_2__pyx_pw_8kimimaro_14skeletontricks_73get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_1_2__pyx_mdef_8kimimaro_14skeletontricks_73get_mapping = {"__pyx_fuse_1_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_2__pyx_pw_8kimimaro_14skeletontricks_73get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_1_2__pyx_pw_8kimimaro_14skeletontricks_73get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -35899,59 +37112,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_70get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_72get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -35960,15 +37173,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_70get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_72get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -36009,219 +37222,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -36229,27 +37442,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -36274,17 +37487,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_1_3__pyx_pw_8kimimaro_14skeletontricks_73get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_1_3__pyx_mdef_8kimimaro_14skeletontricks_73get_mapping = {"__pyx_fuse_1_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_3__pyx_pw_8kimimaro_14skeletontricks_73get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_1_3__pyx_pw_8kimimaro_14skeletontricks_73get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_1_3__pyx_pw_8kimimaro_14skeletontricks_75get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_1_3__pyx_mdef_8kimimaro_14skeletontricks_75get_mapping = {"__pyx_fuse_1_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_3__pyx_pw_8kimimaro_14skeletontricks_75get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_1_3__pyx_pw_8kimimaro_14skeletontricks_75get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -36313,59 +37526,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_72get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_74get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -36374,15 +37587,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_72get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_74get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -36423,219 +37636,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -36643,27 +37856,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -36688,17 +37901,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_1_4__pyx_pw_8kimimaro_14skeletontricks_75get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_1_4__pyx_mdef_8kimimaro_14skeletontricks_75get_mapping = {"__pyx_fuse_1_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_4__pyx_pw_8kimimaro_14skeletontricks_75get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_1_4__pyx_pw_8kimimaro_14skeletontricks_75get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_1_4__pyx_pw_8kimimaro_14skeletontricks_77get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_1_4__pyx_mdef_8kimimaro_14skeletontricks_77get_mapping = {"__pyx_fuse_1_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1_4__pyx_pw_8kimimaro_14skeletontricks_77get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_1_4__pyx_pw_8kimimaro_14skeletontricks_77get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -36727,59 +37940,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_74get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_76get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -36788,15 +38001,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_74get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_76get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -36837,219 +38050,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -37057,27 +38270,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -37102,17 +38315,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_2_0__pyx_pw_8kimimaro_14skeletontricks_77get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_2_0__pyx_mdef_8kimimaro_14skeletontricks_77get_mapping = {"__pyx_fuse_2_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_0__pyx_pw_8kimimaro_14skeletontricks_77get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_2_0__pyx_pw_8kimimaro_14skeletontricks_77get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_2_0__pyx_pw_8kimimaro_14skeletontricks_79get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_2_0__pyx_mdef_8kimimaro_14skeletontricks_79get_mapping = {"__pyx_fuse_2_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_0__pyx_pw_8kimimaro_14skeletontricks_79get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_2_0__pyx_pw_8kimimaro_14skeletontricks_79get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -37141,59 +38354,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_76get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_78get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -37202,15 +38415,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_76get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_78get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -37251,219 +38464,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -37471,27 +38684,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -37516,17 +38729,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_2_1__pyx_pw_8kimimaro_14skeletontricks_79get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_2_1__pyx_mdef_8kimimaro_14skeletontricks_79get_mapping = {"__pyx_fuse_2_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_1__pyx_pw_8kimimaro_14skeletontricks_79get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_2_1__pyx_pw_8kimimaro_14skeletontricks_79get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_2_1__pyx_pw_8kimimaro_14skeletontricks_81get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_2_1__pyx_mdef_8kimimaro_14skeletontricks_81get_mapping = {"__pyx_fuse_2_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_1__pyx_pw_8kimimaro_14skeletontricks_81get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_2_1__pyx_pw_8kimimaro_14skeletontricks_81get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -37555,59 +38768,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_78get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_80get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -37616,15 +38829,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_78get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_80get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -37665,219 +38878,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -37885,27 +39098,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -37930,17 +39143,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_2_2__pyx_pw_8kimimaro_14skeletontricks_81get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_2_2__pyx_mdef_8kimimaro_14skeletontricks_81get_mapping = {"__pyx_fuse_2_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_2__pyx_pw_8kimimaro_14skeletontricks_81get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_2_2__pyx_pw_8kimimaro_14skeletontricks_81get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_2_2__pyx_pw_8kimimaro_14skeletontricks_83get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_2_2__pyx_mdef_8kimimaro_14skeletontricks_83get_mapping = {"__pyx_fuse_2_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_2__pyx_pw_8kimimaro_14skeletontricks_83get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_2_2__pyx_pw_8kimimaro_14skeletontricks_83get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -37969,59 +39182,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_80get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_82get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -38030,15 +39243,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_80get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_82get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -38079,219 +39292,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -38299,27 +39512,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -38344,17 +39557,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_2_3__pyx_pw_8kimimaro_14skeletontricks_83get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_2_3__pyx_mdef_8kimimaro_14skeletontricks_83get_mapping = {"__pyx_fuse_2_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_3__pyx_pw_8kimimaro_14skeletontricks_83get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_2_3__pyx_pw_8kimimaro_14skeletontricks_83get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_2_3__pyx_pw_8kimimaro_14skeletontricks_85get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_2_3__pyx_mdef_8kimimaro_14skeletontricks_85get_mapping = {"__pyx_fuse_2_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_3__pyx_pw_8kimimaro_14skeletontricks_85get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_2_3__pyx_pw_8kimimaro_14skeletontricks_85get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -38383,59 +39596,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_82get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_84get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -38444,15 +39657,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_82get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_84get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -38493,219 +39706,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -38713,27 +39926,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -38758,17 +39971,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_2_4__pyx_pw_8kimimaro_14skeletontricks_85get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_2_4__pyx_mdef_8kimimaro_14skeletontricks_85get_mapping = {"__pyx_fuse_2_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_4__pyx_pw_8kimimaro_14skeletontricks_85get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_2_4__pyx_pw_8kimimaro_14skeletontricks_85get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_2_4__pyx_pw_8kimimaro_14skeletontricks_87get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_2_4__pyx_mdef_8kimimaro_14skeletontricks_87get_mapping = {"__pyx_fuse_2_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2_4__pyx_pw_8kimimaro_14skeletontricks_87get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_2_4__pyx_pw_8kimimaro_14skeletontricks_87get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -38797,59 +40010,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_84get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_86get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -38858,15 +40071,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_84get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_86get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -38907,219 +40120,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -39127,27 +40340,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -39172,17 +40385,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_3_0__pyx_pw_8kimimaro_14skeletontricks_87get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_3_0__pyx_mdef_8kimimaro_14skeletontricks_87get_mapping = {"__pyx_fuse_3_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_0__pyx_pw_8kimimaro_14skeletontricks_87get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_3_0__pyx_pw_8kimimaro_14skeletontricks_87get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_3_0__pyx_pw_8kimimaro_14skeletontricks_89get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_3_0__pyx_mdef_8kimimaro_14skeletontricks_89get_mapping = {"__pyx_fuse_3_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_0__pyx_pw_8kimimaro_14skeletontricks_89get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_3_0__pyx_pw_8kimimaro_14skeletontricks_89get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -39211,59 +40424,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_86get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_88get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -39272,15 +40485,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_86get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_88get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -39321,219 +40534,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -39541,27 +40754,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -39586,17 +40799,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_3_1__pyx_pw_8kimimaro_14skeletontricks_89get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_3_1__pyx_mdef_8kimimaro_14skeletontricks_89get_mapping = {"__pyx_fuse_3_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_1__pyx_pw_8kimimaro_14skeletontricks_89get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_3_1__pyx_pw_8kimimaro_14skeletontricks_89get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_3_1__pyx_pw_8kimimaro_14skeletontricks_91get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_3_1__pyx_mdef_8kimimaro_14skeletontricks_91get_mapping = {"__pyx_fuse_3_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_1__pyx_pw_8kimimaro_14skeletontricks_91get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_3_1__pyx_pw_8kimimaro_14skeletontricks_91get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -39625,59 +40838,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_88get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_90get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -39686,15 +40899,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_88get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_90get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -39735,219 +40948,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -39955,27 +41168,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -40000,17 +41213,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_3_2__pyx_pw_8kimimaro_14skeletontricks_91get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_3_2__pyx_mdef_8kimimaro_14skeletontricks_91get_mapping = {"__pyx_fuse_3_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_2__pyx_pw_8kimimaro_14skeletontricks_91get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_3_2__pyx_pw_8kimimaro_14skeletontricks_91get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_3_2__pyx_pw_8kimimaro_14skeletontricks_93get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_3_2__pyx_mdef_8kimimaro_14skeletontricks_93get_mapping = {"__pyx_fuse_3_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_2__pyx_pw_8kimimaro_14skeletontricks_93get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_3_2__pyx_pw_8kimimaro_14skeletontricks_93get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -40039,59 +41252,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_90get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_92get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -40100,15 +41313,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_90get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_92get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -40149,219 +41362,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -40369,27 +41582,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -40414,17 +41627,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_3_3__pyx_pw_8kimimaro_14skeletontricks_93get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_3_3__pyx_mdef_8kimimaro_14skeletontricks_93get_mapping = {"__pyx_fuse_3_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_3__pyx_pw_8kimimaro_14skeletontricks_93get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_3_3__pyx_pw_8kimimaro_14skeletontricks_93get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_3_3__pyx_pw_8kimimaro_14skeletontricks_95get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_3_3__pyx_mdef_8kimimaro_14skeletontricks_95get_mapping = {"__pyx_fuse_3_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_3__pyx_pw_8kimimaro_14skeletontricks_95get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_3_3__pyx_pw_8kimimaro_14skeletontricks_95get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -40453,59 +41666,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_92get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_94get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -40514,15 +41727,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_92get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_94get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -40563,219 +41776,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -40783,27 +41996,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -40828,17 +42041,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_3_4__pyx_pw_8kimimaro_14skeletontricks_95get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_3_4__pyx_mdef_8kimimaro_14skeletontricks_95get_mapping = {"__pyx_fuse_3_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_4__pyx_pw_8kimimaro_14skeletontricks_95get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_3_4__pyx_pw_8kimimaro_14skeletontricks_95get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_3_4__pyx_pw_8kimimaro_14skeletontricks_97get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_3_4__pyx_mdef_8kimimaro_14skeletontricks_97get_mapping = {"__pyx_fuse_3_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3_4__pyx_pw_8kimimaro_14skeletontricks_97get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_3_4__pyx_pw_8kimimaro_14skeletontricks_97get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -40867,59 +42080,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_94get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_96get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -40928,15 +42141,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_94get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_96get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -40977,219 +42190,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -41197,27 +42410,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -41242,17 +42455,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_4_0__pyx_pw_8kimimaro_14skeletontricks_97get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_4_0__pyx_mdef_8kimimaro_14skeletontricks_97get_mapping = {"__pyx_fuse_4_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_0__pyx_pw_8kimimaro_14skeletontricks_97get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_4_0__pyx_pw_8kimimaro_14skeletontricks_97get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_4_0__pyx_pw_8kimimaro_14skeletontricks_99get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_4_0__pyx_mdef_8kimimaro_14skeletontricks_99get_mapping = {"__pyx_fuse_4_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_0__pyx_pw_8kimimaro_14skeletontricks_99get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_4_0__pyx_pw_8kimimaro_14skeletontricks_99get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -41281,59 +42494,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_96get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_98get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -41342,15 +42555,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_96get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_98get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -41391,219 +42604,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -41611,27 +42824,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -41656,17 +42869,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_4_1__pyx_pw_8kimimaro_14skeletontricks_99get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_4_1__pyx_mdef_8kimimaro_14skeletontricks_99get_mapping = {"__pyx_fuse_4_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_1__pyx_pw_8kimimaro_14skeletontricks_99get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_4_1__pyx_pw_8kimimaro_14skeletontricks_99get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_4_1__pyx_pw_8kimimaro_14skeletontricks_101get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_4_1__pyx_mdef_8kimimaro_14skeletontricks_101get_mapping = {"__pyx_fuse_4_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_1__pyx_pw_8kimimaro_14skeletontricks_101get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_4_1__pyx_pw_8kimimaro_14skeletontricks_101get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -41695,59 +42908,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_98get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_100get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -41756,15 +42969,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_98get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_100get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -41805,219 +43018,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -42025,27 +43238,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -42070,17 +43283,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_4_2__pyx_pw_8kimimaro_14skeletontricks_101get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_4_2__pyx_mdef_8kimimaro_14skeletontricks_101get_mapping = {"__pyx_fuse_4_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_2__pyx_pw_8kimimaro_14skeletontricks_101get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_4_2__pyx_pw_8kimimaro_14skeletontricks_101get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_4_2__pyx_pw_8kimimaro_14skeletontricks_103get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_4_2__pyx_mdef_8kimimaro_14skeletontricks_103get_mapping = {"__pyx_fuse_4_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_2__pyx_pw_8kimimaro_14skeletontricks_103get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_4_2__pyx_pw_8kimimaro_14skeletontricks_103get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -42109,59 +43322,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_100get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_102get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -42170,15 +43383,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_100get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_102get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -42219,219 +43432,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -42439,27 +43652,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -42484,17 +43697,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_4_3__pyx_pw_8kimimaro_14skeletontricks_103get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_4_3__pyx_mdef_8kimimaro_14skeletontricks_103get_mapping = {"__pyx_fuse_4_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_3__pyx_pw_8kimimaro_14skeletontricks_103get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_4_3__pyx_pw_8kimimaro_14skeletontricks_103get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_4_3__pyx_pw_8kimimaro_14skeletontricks_105get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_4_3__pyx_mdef_8kimimaro_14skeletontricks_105get_mapping = {"__pyx_fuse_4_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_3__pyx_pw_8kimimaro_14skeletontricks_105get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_4_3__pyx_pw_8kimimaro_14skeletontricks_105get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -42523,59 +43736,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_102get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_104get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -42584,15 +43797,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_102get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_104get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -42633,219 +43846,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -42853,27 +44066,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -42898,17 +44111,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_4_4__pyx_pw_8kimimaro_14skeletontricks_105get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_4_4__pyx_mdef_8kimimaro_14skeletontricks_105get_mapping = {"__pyx_fuse_4_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_4__pyx_pw_8kimimaro_14skeletontricks_105get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_4_4__pyx_pw_8kimimaro_14skeletontricks_105get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_4_4__pyx_pw_8kimimaro_14skeletontricks_107get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_4_4__pyx_mdef_8kimimaro_14skeletontricks_107get_mapping = {"__pyx_fuse_4_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4_4__pyx_pw_8kimimaro_14skeletontricks_107get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_4_4__pyx_pw_8kimimaro_14skeletontricks_107get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -42937,59 +44150,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_104get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_106get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -42998,15 +44211,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_104get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_106get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -43047,219 +44260,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -43267,27 +44480,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -43312,17 +44525,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_5_0__pyx_pw_8kimimaro_14skeletontricks_107get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_5_0__pyx_mdef_8kimimaro_14skeletontricks_107get_mapping = {"__pyx_fuse_5_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_0__pyx_pw_8kimimaro_14skeletontricks_107get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_5_0__pyx_pw_8kimimaro_14skeletontricks_107get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_5_0__pyx_pw_8kimimaro_14skeletontricks_109get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_5_0__pyx_mdef_8kimimaro_14skeletontricks_109get_mapping = {"__pyx_fuse_5_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_0__pyx_pw_8kimimaro_14skeletontricks_109get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_5_0__pyx_pw_8kimimaro_14skeletontricks_109get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -43351,59 +44564,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_106get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_108get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -43412,15 +44625,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_106get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_108get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -43461,219 +44674,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -43681,27 +44894,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -43726,17 +44939,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_5_1__pyx_pw_8kimimaro_14skeletontricks_109get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_5_1__pyx_mdef_8kimimaro_14skeletontricks_109get_mapping = {"__pyx_fuse_5_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_1__pyx_pw_8kimimaro_14skeletontricks_109get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_5_1__pyx_pw_8kimimaro_14skeletontricks_109get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_5_1__pyx_pw_8kimimaro_14skeletontricks_111get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_5_1__pyx_mdef_8kimimaro_14skeletontricks_111get_mapping = {"__pyx_fuse_5_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_1__pyx_pw_8kimimaro_14skeletontricks_111get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_5_1__pyx_pw_8kimimaro_14skeletontricks_111get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -43765,59 +44978,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_108get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_110get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -43826,15 +45039,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_108get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_110get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -43875,219 +45088,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -44095,27 +45308,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -44140,17 +45353,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_5_2__pyx_pw_8kimimaro_14skeletontricks_111get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_5_2__pyx_mdef_8kimimaro_14skeletontricks_111get_mapping = {"__pyx_fuse_5_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_2__pyx_pw_8kimimaro_14skeletontricks_111get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_5_2__pyx_pw_8kimimaro_14skeletontricks_111get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_5_2__pyx_pw_8kimimaro_14skeletontricks_113get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_5_2__pyx_mdef_8kimimaro_14skeletontricks_113get_mapping = {"__pyx_fuse_5_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_2__pyx_pw_8kimimaro_14skeletontricks_113get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_5_2__pyx_pw_8kimimaro_14skeletontricks_113get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -44179,59 +45392,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_110get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_112get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -44240,15 +45453,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_110get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_112get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -44289,219 +45502,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -44509,27 +45722,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -44554,17 +45767,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_5_3__pyx_pw_8kimimaro_14skeletontricks_113get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_5_3__pyx_mdef_8kimimaro_14skeletontricks_113get_mapping = {"__pyx_fuse_5_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_3__pyx_pw_8kimimaro_14skeletontricks_113get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_5_3__pyx_pw_8kimimaro_14skeletontricks_113get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_5_3__pyx_pw_8kimimaro_14skeletontricks_115get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_5_3__pyx_mdef_8kimimaro_14skeletontricks_115get_mapping = {"__pyx_fuse_5_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_3__pyx_pw_8kimimaro_14skeletontricks_115get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_5_3__pyx_pw_8kimimaro_14skeletontricks_115get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -44593,59 +45806,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_112get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_114get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -44654,15 +45867,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_112get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_114get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -44703,219 +45916,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -44923,27 +46136,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -44968,17 +46181,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_5_4__pyx_pw_8kimimaro_14skeletontricks_115get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_5_4__pyx_mdef_8kimimaro_14skeletontricks_115get_mapping = {"__pyx_fuse_5_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_4__pyx_pw_8kimimaro_14skeletontricks_115get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_5_4__pyx_pw_8kimimaro_14skeletontricks_115get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_5_4__pyx_pw_8kimimaro_14skeletontricks_117get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_5_4__pyx_mdef_8kimimaro_14skeletontricks_117get_mapping = {"__pyx_fuse_5_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5_4__pyx_pw_8kimimaro_14skeletontricks_117get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_5_4__pyx_pw_8kimimaro_14skeletontricks_117get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -45007,59 +46220,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_114get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_116get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -45068,15 +46281,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_114get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_116get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -45117,219 +46330,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -45337,27 +46550,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -45382,17 +46595,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_6_0__pyx_pw_8kimimaro_14skeletontricks_117get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_6_0__pyx_mdef_8kimimaro_14skeletontricks_117get_mapping = {"__pyx_fuse_6_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_0__pyx_pw_8kimimaro_14skeletontricks_117get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_6_0__pyx_pw_8kimimaro_14skeletontricks_117get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_6_0__pyx_pw_8kimimaro_14skeletontricks_119get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_6_0__pyx_mdef_8kimimaro_14skeletontricks_119get_mapping = {"__pyx_fuse_6_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_0__pyx_pw_8kimimaro_14skeletontricks_119get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_6_0__pyx_pw_8kimimaro_14skeletontricks_119get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -45421,59 +46634,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_116get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_118get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -45482,15 +46695,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_116get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_118get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -45531,219 +46744,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -45751,27 +46964,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -45796,17 +47009,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_6_1__pyx_pw_8kimimaro_14skeletontricks_119get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_6_1__pyx_mdef_8kimimaro_14skeletontricks_119get_mapping = {"__pyx_fuse_6_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_1__pyx_pw_8kimimaro_14skeletontricks_119get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_6_1__pyx_pw_8kimimaro_14skeletontricks_119get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_6_1__pyx_pw_8kimimaro_14skeletontricks_121get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_6_1__pyx_mdef_8kimimaro_14skeletontricks_121get_mapping = {"__pyx_fuse_6_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_1__pyx_pw_8kimimaro_14skeletontricks_121get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_6_1__pyx_pw_8kimimaro_14skeletontricks_121get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -45835,59 +47048,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_118get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_120get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -45896,15 +47109,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_118get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_120get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -45945,219 +47158,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -46165,27 +47378,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -46210,17 +47423,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_6_2__pyx_pw_8kimimaro_14skeletontricks_121get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_6_2__pyx_mdef_8kimimaro_14skeletontricks_121get_mapping = {"__pyx_fuse_6_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_2__pyx_pw_8kimimaro_14skeletontricks_121get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_6_2__pyx_pw_8kimimaro_14skeletontricks_121get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_6_2__pyx_pw_8kimimaro_14skeletontricks_123get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_6_2__pyx_mdef_8kimimaro_14skeletontricks_123get_mapping = {"__pyx_fuse_6_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_2__pyx_pw_8kimimaro_14skeletontricks_123get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_6_2__pyx_pw_8kimimaro_14skeletontricks_123get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -46249,59 +47462,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_120get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_122get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -46310,15 +47523,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_120get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_122get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -46359,219 +47572,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -46579,27 +47792,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -46624,17 +47837,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_6_3__pyx_pw_8kimimaro_14skeletontricks_123get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_6_3__pyx_mdef_8kimimaro_14skeletontricks_123get_mapping = {"__pyx_fuse_6_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_3__pyx_pw_8kimimaro_14skeletontricks_123get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_6_3__pyx_pw_8kimimaro_14skeletontricks_123get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_6_3__pyx_pw_8kimimaro_14skeletontricks_125get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_6_3__pyx_mdef_8kimimaro_14skeletontricks_125get_mapping = {"__pyx_fuse_6_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_3__pyx_pw_8kimimaro_14skeletontricks_125get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_6_3__pyx_pw_8kimimaro_14skeletontricks_125get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -46663,59 +47876,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_122get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_124get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -46724,15 +47937,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_122get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_124get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -46773,219 +47986,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -46993,27 +48206,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -47038,17 +48251,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_6_4__pyx_pw_8kimimaro_14skeletontricks_125get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_6_4__pyx_mdef_8kimimaro_14skeletontricks_125get_mapping = {"__pyx_fuse_6_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_4__pyx_pw_8kimimaro_14skeletontricks_125get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_6_4__pyx_pw_8kimimaro_14skeletontricks_125get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_6_4__pyx_pw_8kimimaro_14skeletontricks_127get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_6_4__pyx_mdef_8kimimaro_14skeletontricks_127get_mapping = {"__pyx_fuse_6_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6_4__pyx_pw_8kimimaro_14skeletontricks_127get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_6_4__pyx_pw_8kimimaro_14skeletontricks_127get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -47077,59 +48290,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_124get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_126get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -47138,15 +48351,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_124get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_126get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -47187,219 +48400,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -47407,27 +48620,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -47452,17 +48665,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_7_0__pyx_pw_8kimimaro_14skeletontricks_127get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_7_0__pyx_mdef_8kimimaro_14skeletontricks_127get_mapping = {"__pyx_fuse_7_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_0__pyx_pw_8kimimaro_14skeletontricks_127get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_7_0__pyx_pw_8kimimaro_14skeletontricks_127get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_7_0__pyx_pw_8kimimaro_14skeletontricks_129get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_7_0__pyx_mdef_8kimimaro_14skeletontricks_129get_mapping = {"__pyx_fuse_7_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_0__pyx_pw_8kimimaro_14skeletontricks_129get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_7_0__pyx_pw_8kimimaro_14skeletontricks_129get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -47491,59 +48704,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_126get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_128get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -47552,15 +48765,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_126get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_128get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -47601,219 +48814,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -47821,27 +49034,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -47866,17 +49079,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_7_1__pyx_pw_8kimimaro_14skeletontricks_129get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_7_1__pyx_mdef_8kimimaro_14skeletontricks_129get_mapping = {"__pyx_fuse_7_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_1__pyx_pw_8kimimaro_14skeletontricks_129get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_7_1__pyx_pw_8kimimaro_14skeletontricks_129get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_7_1__pyx_pw_8kimimaro_14skeletontricks_131get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_7_1__pyx_mdef_8kimimaro_14skeletontricks_131get_mapping = {"__pyx_fuse_7_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_1__pyx_pw_8kimimaro_14skeletontricks_131get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_7_1__pyx_pw_8kimimaro_14skeletontricks_131get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -47905,59 +49118,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_128get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_130get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -47966,15 +49179,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_128get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_130get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -48015,219 +49228,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -48235,27 +49448,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -48280,17 +49493,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_7_2__pyx_pw_8kimimaro_14skeletontricks_131get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_7_2__pyx_mdef_8kimimaro_14skeletontricks_131get_mapping = {"__pyx_fuse_7_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_2__pyx_pw_8kimimaro_14skeletontricks_131get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_7_2__pyx_pw_8kimimaro_14skeletontricks_131get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_7_2__pyx_pw_8kimimaro_14skeletontricks_133get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_7_2__pyx_mdef_8kimimaro_14skeletontricks_133get_mapping = {"__pyx_fuse_7_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_2__pyx_pw_8kimimaro_14skeletontricks_133get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_7_2__pyx_pw_8kimimaro_14skeletontricks_133get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -48319,59 +49532,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_130get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_132get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -48380,15 +49593,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_130get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_132get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -48429,219 +49642,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -48649,27 +49862,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -48694,17 +49907,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_7_3__pyx_pw_8kimimaro_14skeletontricks_133get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_7_3__pyx_mdef_8kimimaro_14skeletontricks_133get_mapping = {"__pyx_fuse_7_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_3__pyx_pw_8kimimaro_14skeletontricks_133get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_7_3__pyx_pw_8kimimaro_14skeletontricks_133get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_7_3__pyx_pw_8kimimaro_14skeletontricks_135get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_7_3__pyx_mdef_8kimimaro_14skeletontricks_135get_mapping = {"__pyx_fuse_7_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_3__pyx_pw_8kimimaro_14skeletontricks_135get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_7_3__pyx_pw_8kimimaro_14skeletontricks_135get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -48733,59 +49946,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_132get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_134get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -48794,15 +50007,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_132get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_134get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -48843,219 +50056,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -49063,27 +50276,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -49108,17 +50321,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_7_4__pyx_pw_8kimimaro_14skeletontricks_135get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_7_4__pyx_mdef_8kimimaro_14skeletontricks_135get_mapping = {"__pyx_fuse_7_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_4__pyx_pw_8kimimaro_14skeletontricks_135get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_7_4__pyx_pw_8kimimaro_14skeletontricks_135get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_7_4__pyx_pw_8kimimaro_14skeletontricks_137get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_7_4__pyx_mdef_8kimimaro_14skeletontricks_137get_mapping = {"__pyx_fuse_7_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7_4__pyx_pw_8kimimaro_14skeletontricks_137get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_7_4__pyx_pw_8kimimaro_14skeletontricks_137get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -49147,59 +50360,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_134get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_136get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -49208,15 +50421,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_134get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_136get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -49257,219 +50470,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -49477,27 +50690,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -49522,17 +50735,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_8_0__pyx_pw_8kimimaro_14skeletontricks_137get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_8_0__pyx_mdef_8kimimaro_14skeletontricks_137get_mapping = {"__pyx_fuse_8_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_0__pyx_pw_8kimimaro_14skeletontricks_137get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_8_0__pyx_pw_8kimimaro_14skeletontricks_137get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_8_0__pyx_pw_8kimimaro_14skeletontricks_139get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_8_0__pyx_mdef_8kimimaro_14skeletontricks_139get_mapping = {"__pyx_fuse_8_0get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_0__pyx_pw_8kimimaro_14skeletontricks_139get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_8_0__pyx_pw_8kimimaro_14skeletontricks_139get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -49561,59 +50774,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_136get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_138get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -49622,15 +50835,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_136get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_138get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -49671,219 +50884,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -49891,27 +51104,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -49936,17 +51149,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_8_1__pyx_pw_8kimimaro_14skeletontricks_139get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_8_1__pyx_mdef_8kimimaro_14skeletontricks_139get_mapping = {"__pyx_fuse_8_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_1__pyx_pw_8kimimaro_14skeletontricks_139get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_8_1__pyx_pw_8kimimaro_14skeletontricks_139get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_8_1__pyx_pw_8kimimaro_14skeletontricks_141get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_8_1__pyx_mdef_8kimimaro_14skeletontricks_141get_mapping = {"__pyx_fuse_8_1get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_1__pyx_pw_8kimimaro_14skeletontricks_141get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_8_1__pyx_pw_8kimimaro_14skeletontricks_141get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -49975,59 +51188,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_138get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_140get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -50036,15 +51249,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_138get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_140get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -50085,219 +51298,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -50305,27 +51518,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -50350,17 +51563,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_8_2__pyx_pw_8kimimaro_14skeletontricks_141get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_8_2__pyx_mdef_8kimimaro_14skeletontricks_141get_mapping = {"__pyx_fuse_8_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_2__pyx_pw_8kimimaro_14skeletontricks_141get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_8_2__pyx_pw_8kimimaro_14skeletontricks_141get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_8_2__pyx_pw_8kimimaro_14skeletontricks_143get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_8_2__pyx_mdef_8kimimaro_14skeletontricks_143get_mapping = {"__pyx_fuse_8_2get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_2__pyx_pw_8kimimaro_14skeletontricks_143get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_8_2__pyx_pw_8kimimaro_14skeletontricks_143get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -50389,59 +51602,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_140get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_142get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -50450,15 +51663,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_140get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_142get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -50499,219 +51712,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -50719,27 +51932,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -50764,17 +51977,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_8_3__pyx_pw_8kimimaro_14skeletontricks_143get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_8_3__pyx_mdef_8kimimaro_14skeletontricks_143get_mapping = {"__pyx_fuse_8_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_3__pyx_pw_8kimimaro_14skeletontricks_143get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_8_3__pyx_pw_8kimimaro_14skeletontricks_143get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_8_3__pyx_pw_8kimimaro_14skeletontricks_145get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_8_3__pyx_mdef_8kimimaro_14skeletontricks_145get_mapping = {"__pyx_fuse_8_3get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_3__pyx_pw_8kimimaro_14skeletontricks_145get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_8_3__pyx_pw_8kimimaro_14skeletontricks_145get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -50803,59 +52016,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_142get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_144get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -50864,15 +52077,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_142get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_144get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -50913,219 +52126,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -51133,27 +52346,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -51178,17 +52391,17 @@
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_8_4__pyx_pw_8kimimaro_14skeletontricks_145get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_8_4__pyx_mdef_8kimimaro_14skeletontricks_145get_mapping = {"__pyx_fuse_8_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_4__pyx_pw_8kimimaro_14skeletontricks_145get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_20get_mapping};
-static PyObject *__pyx_fuse_8_4__pyx_pw_8kimimaro_14skeletontricks_145get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_8_4__pyx_pw_8kimimaro_14skeletontricks_147get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_8_4__pyx_mdef_8kimimaro_14skeletontricks_147get_mapping = {"__pyx_fuse_8_4get_mapping", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8_4__pyx_pw_8kimimaro_14skeletontricks_147get_mapping, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22get_mapping};
+static PyObject *__pyx_fuse_8_4__pyx_pw_8kimimaro_14skeletontricks_147get_mapping(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_orig_labels = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[2] = {0,0};
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
@@ -51217,59 +52430,59 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_orig_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 485, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 428, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, 1); __PYX_ERR(0, 485, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_mapping") < 0)) __PYX_ERR(0, 485, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
     }
     __pyx_v_orig_labels = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_mapping", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 485, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.get_mapping", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 432, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 433, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_144get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_orig_labels), __pyx_ptype_5numpy_ndarray, 1, "orig_labels", 0))) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 491, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_146get_mapping(__pyx_self, __pyx_v_orig_labels, __pyx_v_cc_labels);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -51278,15 +52491,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_144get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_146get_mapping(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_orig_labels, PyArrayObject *__pyx_v_cc_labels) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   PyObject *__pyx_v_remap = NULL;
@@ -51327,219 +52540,219 @@
   __pyx_pybuffernd_orig_labels.rcbuffer = &__pyx_pybuffer_orig_labels;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_orig_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_orig_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_orig_labels.diminfo[0].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_orig_labels.diminfo[0].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_orig_labels.diminfo[1].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_orig_labels.diminfo[1].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_orig_labels.diminfo[2].strides = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_orig_labels.diminfo[2].shape = __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 428, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 485, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_cc_labels.diminfo[2].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_cc_labels.diminfo[2].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":449
+  /* "ext/skeletontricks/skeletontricks.pyx":502
  * 
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 449, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":450
+  /* "ext/skeletontricks/skeletontricks.pyx":503
  *   cdef size_t sx, sy, sz
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = orig_labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 450, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 503, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":451
+  /* "ext/skeletontricks/skeletontricks.pyx":504
  *   sx = orig_labels.shape[0]
  *   sy = orig_labels.shape[1]
  *   sz = orig_labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x,y,z
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 451, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":455
+  /* "ext/skeletontricks/skeletontricks.pyx":508
  *   cdef size_t x,y,z
  * 
  *   remap = {}             # <<<<<<<<<<<<<<
  * 
  *   if orig_labels.size == 0:
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_remap = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":457
+  /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 457, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_orig_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 510, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_3 == 0);
   if (__pyx_t_4) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":458
+    /* "ext/skeletontricks/skeletontricks.pyx":511
  * 
  *   if orig_labels.size == 0:
  *     return remap             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_remap);
     __pyx_r = __pyx_v_remap;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":457
+    /* "ext/skeletontricks/skeletontricks.pyx":510
  *   remap = {}
  * 
  *   if orig_labels.size == 0:             # <<<<<<<<<<<<<<
  *     return remap
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":460
+  /* "ext/skeletontricks/skeletontricks.pyx":513
  *     return remap
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]             # <<<<<<<<<<<<<<
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  */
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
   __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":461
+  /* "ext/skeletontricks/skeletontricks.pyx":514
  * 
  *   cdef UINT last_label = cc_labels[0,0,0]
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]             # <<<<<<<<<<<<<<
  * 
  *   for z in range(sz):
  */
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_5, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 461, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_5, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_6, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_7, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 461, __pyx_L1_error)
+  if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":463
+  /* "ext/skeletontricks/skeletontricks.pyx":516
  *   remap[cc_labels[0,0,0]] = orig_labels[0,0,0]
  * 
  *   for z in range(sz):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       for x in range(sx):
  */
   __pyx_t_9 = __pyx_v_sz;
   __pyx_t_10 = __pyx_t_9;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_z = __pyx_t_11;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":464
+    /* "ext/skeletontricks/skeletontricks.pyx":517
  * 
  *   for z in range(sz):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  */
     __pyx_t_12 = __pyx_v_sy;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_y = __pyx_t_14;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":465
+      /* "ext/skeletontricks/skeletontricks.pyx":518
  *   for z in range(sz):
  *     for y in range(sy):
  *       for x in range(sx):             # <<<<<<<<<<<<<<
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  */
       __pyx_t_15 = __pyx_v_sx;
       __pyx_t_16 = __pyx_t_15;
       for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
         __pyx_v_x = __pyx_t_17;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":466
+        /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
         __pyx_t_4 = (__pyx_v_last_label == (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides)));
         if (__pyx_t_4) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":467
+          /* "ext/skeletontricks/skeletontricks.pyx":520
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:
  *           continue             # <<<<<<<<<<<<<<
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]
  */
           goto __pyx_L8_continue;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":466
+          /* "ext/skeletontricks/skeletontricks.pyx":519
  *     for y in range(sy):
  *       for x in range(sx):
  *         if last_label == cc_labels[x,y,z]:             # <<<<<<<<<<<<<<
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":468
+        /* "ext/skeletontricks/skeletontricks.pyx":521
  *         if last_label == cc_labels[x,y,z]:
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]             # <<<<<<<<<<<<<<
  *         last_label = cc_labels[x,y,z]
  * 
  */
         __pyx_t_20 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_18 = __pyx_v_z;
-        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_orig_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_orig_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_orig_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_orig_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_18 = __pyx_v_x;
         __pyx_t_19 = __pyx_v_y;
         __pyx_t_20 = __pyx_v_z;
-        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 468, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 468, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_remap, __pyx_t_8, __pyx_t_2) < 0))) __PYX_ERR(0, 521, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":469
+        /* "ext/skeletontricks/skeletontricks.pyx":522
  *           continue
  *         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
  *         last_label = cc_labels[x,y,z]             # <<<<<<<<<<<<<<
  * 
  *   return remap
  */
         __pyx_t_20 = __pyx_v_x;
@@ -51547,27 +52760,27 @@
         __pyx_t_18 = __pyx_v_z;
         __pyx_v_last_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_19, __pyx_pybuffernd_cc_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_cc_labels.diminfo[2].strides));
         __pyx_L8_continue:;
       }
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":471
+  /* "ext/skeletontricks/skeletontricks.pyx":524
  *         last_label = cc_labels[x,y,z]
  * 
  *   return remap             # <<<<<<<<<<<<<<
  * 
- * def compute_centroids(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_remap);
   __pyx_r = __pyx_v_remap;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -51591,27 +52804,27 @@
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_remap);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":473
+/* "ext/skeletontricks/skeletontricks.pyx":526
  *   return remap
  * 
- * def compute_centroids(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def compute_centroids(
  *     cnp.ndarray[UINT, ndim=2] labels,
- *     float wx, float wy
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_23compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_22compute_centroids, "\n  compute_centroids(\n    cnp.ndarray[UINT, ndim=2] labels,\n    float wx, float wy\n  )\n\n  Compute the centroid for every label on a 2D image at once.\n\n  Returns: { $segid: (x, y), ... }\n  ");
-static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_23compute_centroids = {"compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_23compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22compute_centroids};
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_23compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_25compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_24compute_centroids, "\n  Compute the centroid for every label on a 2D image at once.\n\n  Returns: { $segid: (x, y), ... }\n  ");
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_25compute_centroids = {"compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_25compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24compute_centroids};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_25compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_signatures = 0;
   PyObject *__pyx_v_args = 0;
   PyObject *__pyx_v_kwargs = 0;
   CYTHON_UNUSED PyObject *__pyx_v_defaults = 0;
   PyObject *__pyx_v__fused_sigindex = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -51651,57 +52864,57 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_signatures)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_args)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 526, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_kwargs)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 526, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_defaults)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 526, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_fused_sigindex);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 473, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 526, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
@@ -51715,42 +52928,42 @@
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
     __pyx_v__fused_sigindex = values[4];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 473, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 526, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_22compute_centroids(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults, __pyx_v__fused_sigindex);
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_24compute_centroids(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults, __pyx_v__fused_sigindex);
 
   /* function exit code */
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_22compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_24compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex) {
   PyObject *__pyx_v_search_list = 0;
   PyObject *__pyx_v_sigindex_node = 0;
   PyObject *__pyx_v_dest_sig = NULL;
   PyTypeObject *__pyx_v_ndarray = 0;
   PyObject *__pyx_v_arg_as_memoryview = 0;
   __Pyx_memviewslice __pyx_v_memslice;
   Py_ssize_t __pyx_v_itemsize;
@@ -51798,136 +53011,136 @@
   Py_ssize_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("compute_centroids", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, Py_None)) __PYX_ERR(0, 473, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, Py_None)) __PYX_ERR(0, 526, __pyx_L1_error);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   if (__pyx_t_3) {
   } else {
     __pyx_t_2 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_3);
   __pyx_t_2 = __pyx_t_4;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v___pyx_fused_dtype_uint8__t_is_signed = (!(((uint8_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint16__t_is_signed = (!(((uint16_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint32__t_is_signed = (!(((uint32_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint64__t_is_signed = (!(((uint64_t)-1L) > 0));
   __pyx_v_unsigned_char_is_signed = (!(((unsigned char)-1L) > 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 473, __pyx_L1_error)
+    __PYX_ERR(0, 526, __pyx_L1_error)
   }
-  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 526, __pyx_L1_error)
   __pyx_t_2 = (0 < __pyx_t_5);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 473, __pyx_L1_error)
+      __PYX_ERR(0, 526, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_GetItemInt_Tuple(((PyObject*)__pyx_v_args), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt_Tuple(((PyObject*)__pyx_v_args), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   __pyx_t_4 = (__pyx_v_kwargs != Py_None);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 473, __pyx_L1_error)
+    __PYX_ERR(0, 526, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
   __pyx_t_2 = __pyx_t_4;
   __pyx_L7_bool_binop_done:;
   if (likely(__pyx_t_2)) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 473, __pyx_L1_error)
+      __PYX_ERR(0, 526, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 473, __pyx_L1_error)
+      __PYX_ERR(0, 526, __pyx_L1_error)
     }
-    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 473, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 526, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_3);
     __Pyx_GIVEREF(__pyx_int_3);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_3)) __PYX_ERR(0, 473, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_3)) __PYX_ERR(0, 526, __pyx_L1_error);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 473, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 526, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_1);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 473, __pyx_L1_error)
+    __PYX_ERR(0, 526, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -51940,141 +53153,141 @@
         __Pyx_INCREF(Py_None);
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 0x69);
         switch (__pyx_v_kind) {
           case 0x69:
           case 0x75:
           __pyx_t_4 = ((sizeof(uint8_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint8__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint16_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint16__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L20_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint32_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint32__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L24_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint64_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint64__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L28_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(unsigned char)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v_unsigned_char_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L32_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 0x66:
           break;
           case 99:
           break;
@@ -52082,205 +53295,205 @@
           break;
           default: break;
         }
       }
     }
     __pyx_t_2 = (__pyx_v_arg == Py_None);
     if (__pyx_t_2) {
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
       goto __pyx_L10_break;
     }
     {
       __Pyx_PyThreadState_declare
       __Pyx_PyThreadState_assign
       __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
       __Pyx_XGOTREF(__pyx_t_8);
       __Pyx_XGOTREF(__pyx_t_9);
       __Pyx_XGOTREF(__pyx_t_10);
       /*try:*/ {
-        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L36_error)
+        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L36_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_as_memoryview = ((PyObject*)__pyx_t_6);
         __pyx_t_6 = 0;
       }
       /*else:*/ {
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L47_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint8_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L46_next_and;
         }
         __pyx_L47_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint8_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L45_bool_binop_done;
         }
         __pyx_L46_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L45_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn_uint8_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L53_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint16_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L52_next_and;
         }
         __pyx_L53_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint16_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L51_bool_binop_done;
         }
         __pyx_L52_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L51_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn_uint16_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L59_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint32_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L58_next_and;
         }
         __pyx_L59_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint32_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L57_bool_binop_done;
         }
         __pyx_L58_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L57_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn_uint32_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L65_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint64_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L64_next_and;
         }
         __pyx_L65_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint64_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L63_bool_binop_done;
         }
         __pyx_L64_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L63_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn_uint64_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L71_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(unsigned char)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L70_next_and;
         }
         __pyx_L71_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(unsigned char)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L69_bool_binop_done;
         }
         __pyx_L70_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L69_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_unsigned_char(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
       }
@@ -52290,15 +53503,15 @@
       goto __pyx_L43_try_end;
       __pyx_L36_error:;
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_11 = __Pyx_PyErr_ExceptionMatches2(__pyx_builtin_ValueError, __pyx_builtin_TypeError);
       if (__pyx_t_11) {
         __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
-        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 473, __pyx_L38_except_error)
+        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 526, __pyx_L38_except_error)
         __Pyx_XGOTREF(__pyx_t_6);
         __Pyx_XGOTREF(__pyx_t_1);
         __Pyx_XGOTREF(__pyx_t_13);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         goto __pyx_L37_exception_handled;
@@ -52319,43 +53532,43 @@
       __pyx_L37_exception_handled:;
       __Pyx_XGIVEREF(__pyx_t_8);
       __Pyx_XGIVEREF(__pyx_t_9);
       __Pyx_XGIVEREF(__pyx_t_10);
       __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
       __pyx_L43_try_end:;
     }
-    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_2);
   if (__pyx_t_4) {
     __pyx_t_5 = 0;
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 473, __pyx_L1_error)
+      __PYX_ERR(0, 526, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF(__pyx_t_13);
     __pyx_t_13 = __pyx_t_1;
     __pyx_t_1 = 0;
     while (1) {
       __pyx_t_15 = __Pyx_dict_iter_next(__pyx_t_13, __pyx_t_14, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_11);
       if (unlikely(__pyx_t_15 == 0)) break;
-      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 473, __pyx_L1_error)
+      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_1 = __pyx_v__fused_sigindex;
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_1));
       __pyx_t_1 = 0;
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 473, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __pyx_t_17 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_17 = PyMethod_GET_SELF(__pyx_t_16);
         if (likely(__pyx_t_17)) {
@@ -52367,19 +53580,19 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_17, __pyx_kp_s__13};
         __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 473, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_6 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_16);
@@ -52392,34 +53605,34 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_kp_s__14};
         __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 473, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_18 = PyList_GET_SIZE(__pyx_t_16);
       if (unlikely(__pyx_t_18 < 1)) {
-        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 473, __pyx_L1_error)
+        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 526, __pyx_L1_error)
       }
       #if CYTHON_COMPILING_IN_CPYTHON
       __pyx_t_6 = PyList_GET_ITEM(__pyx_t_16, __pyx_t_18-1); 
       ((PyVarObject*)__pyx_t_16)->ob_size--;
       #else
       __pyx_t_6 = PySequence_ITEM(__pyx_t_16, __pyx_t_18-1); 
       #endif
       __Pyx_GOTREF(__pyx_t_6);
       #if !CYTHON_COMPILING_IN_CPYTHON
-      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 473, __pyx_L1_error)
+      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_17);
       __Pyx_DECREF(__pyx_t_16);
       __pyx_t_16 = __pyx_t_17; __pyx_t_17 = NULL;
       #else
       CYTHON_UNUSED_VAR(__pyx_t_17);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_sig_series, ((PyObject*)__pyx_t_16));
@@ -52428,220 +53641,220 @@
       __pyx_t_6 = 0;
       __pyx_t_1 = __pyx_v_sig_series; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_18 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
           #endif
           if (__pyx_t_18 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
         #else
-        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sig_type, __pyx_t_6);
         __pyx_t_6 = 0;
         if (unlikely(__pyx_v_sigindex_node == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 473, __pyx_L1_error)
+          __PYX_ERR(0, 526, __pyx_L1_error)
         }
-        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
         if (__pyx_t_4) {
-          __pyx_t_6 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 473, __pyx_L1_error)
+            __PYX_ERR(0, 526, __pyx_L1_error)
           }
-          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_6) < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_6) < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, __pyx_t_6);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           goto __pyx_L81;
         }
         /*else*/ {
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 473, __pyx_L1_error)
+            __PYX_ERR(0, 526, __pyx_L1_error)
           }
-          __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_t_16 = __pyx_t_6;
           __Pyx_INCREF(__pyx_t_16);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_16));
           __pyx_t_16 = 0;
         }
         __pyx_L81:;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       if (unlikely(__pyx_v_sigindex_node == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 473, __pyx_L1_error)
+        __PYX_ERR(0, 526, __pyx_L1_error)
       }
-      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   }
-  __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __pyx_v_sigindex_matches = ((PyObject*)__pyx_t_13);
   __pyx_t_13 = 0;
-  __pyx_t_13 = PyList_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_13 = PyList_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_INCREF(__pyx_v__fused_sigindex);
   __Pyx_GIVEREF(__pyx_v__fused_sigindex);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_13, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 473, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_13, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 526, __pyx_L1_error);
   __pyx_v_sigindex_candidates = ((PyObject*)__pyx_t_13);
   __pyx_t_13 = 0;
   __pyx_t_13 = __pyx_v_dest_sig; __Pyx_INCREF(__pyx_t_13);
   __pyx_t_14 = 0;
   for (;;) {
     {
       Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_13);
       #if !CYTHON_ASSUME_SAFE_MACROS
-      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
       #endif
       if (__pyx_t_14 >= __pyx_temp) break;
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
     #else
-    __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_found_matches, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_found_candidates, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
     __pyx_t_4 = (__pyx_v_dst_type == Py_None);
     if (__pyx_t_4) {
       __pyx_t_1 = __pyx_v_sigindex_matches; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 473, __pyx_L1_error)
+          __PYX_ERR(0, 526, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_1 = __pyx_v_sigindex_candidates; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 473, __pyx_L1_error)
+          __PYX_ERR(0, 526, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       goto __pyx_L85;
     }
     /*else*/ {
-      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_INCREF(__pyx_v_sigindex_matches);
       __Pyx_GIVEREF(__pyx_v_sigindex_matches);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 473, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 526, __pyx_L1_error);
       __Pyx_INCREF(__pyx_v_sigindex_candidates);
       __Pyx_GIVEREF(__pyx_v_sigindex_candidates);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 473, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 526, __pyx_L1_error);
       __pyx_t_16 = __pyx_t_1; __Pyx_INCREF(__pyx_t_16);
       __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       for (;;) {
         if (__pyx_t_5 >= 2) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
         #else
-        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 473, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 526, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_search_list, ((PyObject*)__pyx_t_1));
         __pyx_t_1 = 0;
         if (unlikely(__pyx_v_search_list == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 473, __pyx_L1_error)
+          __PYX_ERR(0, 526, __pyx_L1_error)
         }
         __pyx_t_1 = __pyx_v_search_list; __Pyx_INCREF(__pyx_t_1);
         __pyx_t_18 = 0;
         for (;;) {
           {
             Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
             #if !CYTHON_ASSUME_SAFE_MACROS
-            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
             #endif
             if (__pyx_t_18 >= __pyx_temp) break;
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 526, __pyx_L1_error)
           #else
-          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
           __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_6);
           __pyx_t_6 = 0;
           if (unlikely(__pyx_v_sn == Py_None)) {
             PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-            __PYX_ERR(0, 473, __pyx_L1_error)
+            __PYX_ERR(0, 526, __pyx_L1_error)
           }
-          __pyx_t_6 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 473, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 526, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_XDECREF_SET(__pyx_v_type_match, __pyx_t_6);
           __pyx_t_6 = 0;
           __pyx_t_4 = (__pyx_v_type_match != Py_None);
           if (__pyx_t_4) {
-            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 473, __pyx_L1_error)
+            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 526, __pyx_L1_error)
           }
         }
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       }
       __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
     }
     __pyx_L85:;
@@ -52670,38 +53883,38 @@
   goto __pyx_L102_for_end;
   __pyx_L102_for_end:;
   __Pyx_INCREF(__pyx_v_sigindex_matches);
   __pyx_v_candidates = __pyx_v_sigindex_matches;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_4 = (!__pyx_t_2);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_Raise(__pyx_t_13, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __PYX_ERR(0, 473, __pyx_L1_error)
+    __PYX_ERR(0, 526, __pyx_L1_error)
   }
-  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 526, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_14 > 1);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_Raise(__pyx_t_13, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __PYX_ERR(0, 473, __pyx_L1_error)
+    __PYX_ERR(0, 526, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 473, __pyx_L1_error)
+      __PYX_ERR(0, 526, __pyx_L1_error)
     }
-    __pyx_t_13 = __Pyx_GetItemInt_List(__pyx_v_candidates, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_GetItemInt_List(__pyx_v_candidates, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_16 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), __pyx_t_13); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 473, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), __pyx_t_13); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 526, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_16);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_r = __pyx_t_16;
     __pyx_t_16 = 0;
     goto __pyx_L0;
   }
 
@@ -52738,17 +53951,17 @@
   __Pyx_XDECREF(__pyx_v_kwargs);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_149compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_149compute_centroids = {"__pyx_fuse_0compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_149compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22compute_centroids};
-static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_149compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_151compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_151compute_centroids = {"__pyx_fuse_0compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_151compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24compute_centroids};
+static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_151compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[3] = {0,0,0};
   int __pyx_lineno = 0;
@@ -52780,70 +53993,70 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 526, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 526, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 473, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 526, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 3)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 473, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 526, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.compute_centroids", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 474, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_148compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 528, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_150compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -52852,15 +54065,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_148compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_150compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
   __Pyx_memviewslice __pyx_v_xsum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_ysum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_labelct = { 0, 0, { 0 }, { 0 }, { 0 } };
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
@@ -52903,555 +54116,555 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_0compute_centroids", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 526, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":488
+  /* "ext/skeletontricks/skeletontricks.pyx":537
  *   """
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 488, __pyx_L1_error)
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 537, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_4);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 488, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_xsum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":489
+  /* "ext/skeletontricks/skeletontricks.pyx":538
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 489, __pyx_L1_error)
-  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 489, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_ysum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":490
+  /* "ext/skeletontricks/skeletontricks.pyx":539
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t sx, sy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 490, __pyx_L1_error)
-  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 539, __pyx_L1_error)
+  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_labelct = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":493
+  /* "ext/skeletontricks/skeletontricks.pyx":542
  * 
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = labels.shape[1]
  * 
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 542, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_9[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":494
+  /* "ext/skeletontricks/skeletontricks.pyx":543
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 494, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_9[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":497
+  /* "ext/skeletontricks/skeletontricks.pyx":546
  * 
  *   cdef size_t x, y
  *   cdef uint32_t label = 0             # <<<<<<<<<<<<<<
  * 
  *   for x in range(sx):
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":499
+  /* "ext/skeletontricks/skeletontricks.pyx":548
  *   cdef uint32_t label = 0
  * 
  *   for x in range(sx):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       label = labels[x,y]
  */
   __pyx_t_10 = __pyx_v_sx;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_x = __pyx_t_12;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":500
+    /* "ext/skeletontricks/skeletontricks.pyx":549
  * 
  *   for x in range(sx):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       label = labels[x,y]
  *       if label == 0:
  */
     __pyx_t_13 = __pyx_v_sy;
     __pyx_t_14 = __pyx_t_13;
     for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
       __pyx_v_y = __pyx_t_15;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":501
+      /* "ext/skeletontricks/skeletontricks.pyx":550
  *   for x in range(sx):
  *     for y in range(sy):
  *       label = labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_16 = __pyx_v_x;
       __pyx_t_17 = __pyx_v_y;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_16 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_18 = 1;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 501, __pyx_L1_error)
+        __PYX_ERR(0, 550, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":502
+      /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       __pyx_t_19 = (__pyx_v_label == 0);
       if (__pyx_t_19) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":503
+        /* "ext/skeletontricks/skeletontricks.pyx":552
  *       label = labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  * 
  *       xsum[label] += x
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":502
+        /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":505
+      /* "ext/skeletontricks/skeletontricks.pyx":554
  *         continue
  * 
  *       xsum[label] += x             # <<<<<<<<<<<<<<
  *       ysum[label] += y
  *       labelct[label] += 1
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 505, __pyx_L1_error)
+        __PYX_ERR(0, 554, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_17 * __pyx_v_xsum.strides[0]) )) += __pyx_v_x;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":506
+      /* "ext/skeletontricks/skeletontricks.pyx":555
  * 
  *       xsum[label] += x
  *       ysum[label] += y             # <<<<<<<<<<<<<<
  *       labelct[label] += 1
  * 
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 506, __pyx_L1_error)
+        __PYX_ERR(0, 555, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_17 * __pyx_v_ysum.strides[0]) )) += __pyx_v_y;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":507
+      /* "ext/skeletontricks/skeletontricks.pyx":556
  *       xsum[label] += x
  *       ysum[label] += y
  *       labelct[label] += 1             # <<<<<<<<<<<<<<
  * 
  *   result = {}
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 507, __pyx_L1_error)
+        __PYX_ERR(0, 556, __pyx_L1_error)
       }
       *((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_17 * __pyx_v_labelct.strides[0]) )) += 1;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":509
+  /* "ext/skeletontricks/skeletontricks.pyx":558
  *       labelct[label] += 1
  * 
  *   result = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef float cx = wx * sx / 2
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_result = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":511
+  /* "ext/skeletontricks/skeletontricks.pyx":560
  *   result = {}
  * 
  *   cdef float cx = wx * sx / 2             # <<<<<<<<<<<<<<
  *   cdef float cy = wy * sy / 2
  * 
  */
   __pyx_v_cx = ((__pyx_v_wx * __pyx_v_sx) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":512
+  /* "ext/skeletontricks/skeletontricks.pyx":561
  * 
  *   cdef float cx = wx * sx / 2
  *   cdef float cy = wy * sy / 2             # <<<<<<<<<<<<<<
  * 
  *   cdef float px, py
  */
   __pyx_v_cy = ((__pyx_v_wy * __pyx_v_sy) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":516
+  /* "ext/skeletontricks/skeletontricks.pyx":565
  *   cdef float px, py
  * 
  *   for label in range(labels.size):             # <<<<<<<<<<<<<<
  *     if labelct[label] == 0:
  *       continue
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 516, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 565, __pyx_L1_error)
   __pyx_t_20 = __pyx_t_3;
   for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
     __pyx_v_label = __pyx_t_21;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":517
+    /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 517, __pyx_L1_error)
+      __PYX_ERR(0, 566, __pyx_L1_error)
     }
     __pyx_t_19 = ((*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))) == 0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":518
+      /* "ext/skeletontricks/skeletontricks.pyx":567
  *   for label in range(labels.size):
  *     if labelct[label] == 0:
  *       continue             # <<<<<<<<<<<<<<
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  */
       goto __pyx_L8_continue;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":517
+      /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":520
+    /* "ext/skeletontricks/skeletontricks.pyx":569
  *       continue
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  *     py = wy * <float>ysum[label] / <float>labelct[label]
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_22 = (__pyx_v_wx * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_10 * __pyx_v_xsum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_23 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_23 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_v_px = (__pyx_t_22 / __pyx_t_23);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":521
+    /* "ext/skeletontricks/skeletontricks.pyx":570
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  *     py = wy * <float>ysum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  * 
  *     # Since we don't know which coordinate frame we
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_23 = (__pyx_v_wy * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_10 * __pyx_v_ysum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_22 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_22 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_v_py = (__pyx_t_23 / __pyx_t_22);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":526
+    /* "ext/skeletontricks/skeletontricks.pyx":575
  *     # are using, round toward the center of the image
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:             # <<<<<<<<<<<<<<
  *       px = px # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_px - __pyx_v_cx) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":527
+      /* "ext/skeletontricks/skeletontricks.pyx":576
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:
  *       px = px # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       px = px + wx
  */
       goto __pyx_L11;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":529
+    /* "ext/skeletontricks/skeletontricks.pyx":578
  *       px = px # will be truncated towards center
  *     else:
  *       px = px + wx             # <<<<<<<<<<<<<<
  * 
  *     if py - cy >= 0:
  */
     /*else*/ {
       __pyx_v_px = (__pyx_v_px + __pyx_v_wx);
     }
     __pyx_L11:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":531
+    /* "ext/skeletontricks/skeletontricks.pyx":580
  *       px = px + wx
  * 
  *     if py - cy >= 0:             # <<<<<<<<<<<<<<
  *       py = py # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_py - __pyx_v_cy) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":532
+      /* "ext/skeletontricks/skeletontricks.pyx":581
  * 
  *     if py - cy >= 0:
  *       py = py # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       py = py + wy
  */
       goto __pyx_L12;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":534
+    /* "ext/skeletontricks/skeletontricks.pyx":583
  *       py = py # will be truncated towards center
  *     else:
  *       py = py + wy             # <<<<<<<<<<<<<<
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  */
     /*else*/ {
       __pyx_v_py = (__pyx_v_py + __pyx_v_wy);
     }
     __pyx_L12:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":536
+    /* "ext/skeletontricks/skeletontricks.pyx":585
  *       py = py + wy
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))             # <<<<<<<<<<<<<<
  * 
  *   return result
  */
     if (unlikely(__pyx_v_wx == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     if (unlikely(__pyx_v_wy == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_2);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_6);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error);
     __pyx_t_2 = 0;
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 536, __pyx_L1_error)
+    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_L8_continue:;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":538
+  /* "ext/skeletontricks/skeletontricks.pyx":587
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  * 
  *   return result             # <<<<<<<<<<<<<<
  * 
- * def find_border_targets(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_result);
   __pyx_r = __pyx_v_result;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":473
+  /* "ext/skeletontricks/skeletontricks.pyx":526
  *   return remap
  * 
- * def compute_centroids(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def compute_centroids(
  *     cnp.ndarray[UINT, ndim=2] labels,
- *     float wx, float wy
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4);
@@ -53477,17 +54690,17 @@
   __Pyx_XDECREF(__pyx_v_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_151compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_151compute_centroids = {"__pyx_fuse_1compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_151compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22compute_centroids};
-static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_151compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_153compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_153compute_centroids = {"__pyx_fuse_1compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_153compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24compute_centroids};
+static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_153compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[3] = {0,0,0};
   int __pyx_lineno = 0;
@@ -53519,70 +54732,70 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 526, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 526, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 473, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 526, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 3)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 473, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 526, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.compute_centroids", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 474, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_150compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 528, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_152compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -53591,15 +54804,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_150compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_152compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
   __Pyx_memviewslice __pyx_v_xsum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_ysum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_labelct = { 0, 0, { 0 }, { 0 }, { 0 } };
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
@@ -53642,555 +54855,555 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_1compute_centroids", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 526, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":488
+  /* "ext/skeletontricks/skeletontricks.pyx":537
  *   """
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 488, __pyx_L1_error)
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 537, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_4);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 488, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_xsum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":489
+  /* "ext/skeletontricks/skeletontricks.pyx":538
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 489, __pyx_L1_error)
-  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 489, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_ysum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":490
+  /* "ext/skeletontricks/skeletontricks.pyx":539
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t sx, sy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 490, __pyx_L1_error)
-  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 539, __pyx_L1_error)
+  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_labelct = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":493
+  /* "ext/skeletontricks/skeletontricks.pyx":542
  * 
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = labels.shape[1]
  * 
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 542, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_9[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":494
+  /* "ext/skeletontricks/skeletontricks.pyx":543
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 494, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_9[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":497
+  /* "ext/skeletontricks/skeletontricks.pyx":546
  * 
  *   cdef size_t x, y
  *   cdef uint32_t label = 0             # <<<<<<<<<<<<<<
  * 
  *   for x in range(sx):
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":499
+  /* "ext/skeletontricks/skeletontricks.pyx":548
  *   cdef uint32_t label = 0
  * 
  *   for x in range(sx):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       label = labels[x,y]
  */
   __pyx_t_10 = __pyx_v_sx;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_x = __pyx_t_12;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":500
+    /* "ext/skeletontricks/skeletontricks.pyx":549
  * 
  *   for x in range(sx):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       label = labels[x,y]
  *       if label == 0:
  */
     __pyx_t_13 = __pyx_v_sy;
     __pyx_t_14 = __pyx_t_13;
     for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
       __pyx_v_y = __pyx_t_15;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":501
+      /* "ext/skeletontricks/skeletontricks.pyx":550
  *   for x in range(sx):
  *     for y in range(sy):
  *       label = labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_16 = __pyx_v_x;
       __pyx_t_17 = __pyx_v_y;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_16 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_18 = 1;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 501, __pyx_L1_error)
+        __PYX_ERR(0, 550, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":502
+      /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       __pyx_t_19 = (__pyx_v_label == 0);
       if (__pyx_t_19) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":503
+        /* "ext/skeletontricks/skeletontricks.pyx":552
  *       label = labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  * 
  *       xsum[label] += x
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":502
+        /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":505
+      /* "ext/skeletontricks/skeletontricks.pyx":554
  *         continue
  * 
  *       xsum[label] += x             # <<<<<<<<<<<<<<
  *       ysum[label] += y
  *       labelct[label] += 1
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 505, __pyx_L1_error)
+        __PYX_ERR(0, 554, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_17 * __pyx_v_xsum.strides[0]) )) += __pyx_v_x;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":506
+      /* "ext/skeletontricks/skeletontricks.pyx":555
  * 
  *       xsum[label] += x
  *       ysum[label] += y             # <<<<<<<<<<<<<<
  *       labelct[label] += 1
  * 
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 506, __pyx_L1_error)
+        __PYX_ERR(0, 555, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_17 * __pyx_v_ysum.strides[0]) )) += __pyx_v_y;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":507
+      /* "ext/skeletontricks/skeletontricks.pyx":556
  *       xsum[label] += x
  *       ysum[label] += y
  *       labelct[label] += 1             # <<<<<<<<<<<<<<
  * 
  *   result = {}
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 507, __pyx_L1_error)
+        __PYX_ERR(0, 556, __pyx_L1_error)
       }
       *((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_17 * __pyx_v_labelct.strides[0]) )) += 1;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":509
+  /* "ext/skeletontricks/skeletontricks.pyx":558
  *       labelct[label] += 1
  * 
  *   result = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef float cx = wx * sx / 2
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_result = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":511
+  /* "ext/skeletontricks/skeletontricks.pyx":560
  *   result = {}
  * 
  *   cdef float cx = wx * sx / 2             # <<<<<<<<<<<<<<
  *   cdef float cy = wy * sy / 2
  * 
  */
   __pyx_v_cx = ((__pyx_v_wx * __pyx_v_sx) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":512
+  /* "ext/skeletontricks/skeletontricks.pyx":561
  * 
  *   cdef float cx = wx * sx / 2
  *   cdef float cy = wy * sy / 2             # <<<<<<<<<<<<<<
  * 
  *   cdef float px, py
  */
   __pyx_v_cy = ((__pyx_v_wy * __pyx_v_sy) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":516
+  /* "ext/skeletontricks/skeletontricks.pyx":565
  *   cdef float px, py
  * 
  *   for label in range(labels.size):             # <<<<<<<<<<<<<<
  *     if labelct[label] == 0:
  *       continue
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 516, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 565, __pyx_L1_error)
   __pyx_t_20 = __pyx_t_3;
   for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
     __pyx_v_label = __pyx_t_21;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":517
+    /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 517, __pyx_L1_error)
+      __PYX_ERR(0, 566, __pyx_L1_error)
     }
     __pyx_t_19 = ((*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))) == 0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":518
+      /* "ext/skeletontricks/skeletontricks.pyx":567
  *   for label in range(labels.size):
  *     if labelct[label] == 0:
  *       continue             # <<<<<<<<<<<<<<
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  */
       goto __pyx_L8_continue;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":517
+      /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":520
+    /* "ext/skeletontricks/skeletontricks.pyx":569
  *       continue
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  *     py = wy * <float>ysum[label] / <float>labelct[label]
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_22 = (__pyx_v_wx * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_10 * __pyx_v_xsum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_23 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_23 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_v_px = (__pyx_t_22 / __pyx_t_23);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":521
+    /* "ext/skeletontricks/skeletontricks.pyx":570
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  *     py = wy * <float>ysum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  * 
  *     # Since we don't know which coordinate frame we
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_23 = (__pyx_v_wy * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_10 * __pyx_v_ysum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_22 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_22 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_v_py = (__pyx_t_23 / __pyx_t_22);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":526
+    /* "ext/skeletontricks/skeletontricks.pyx":575
  *     # are using, round toward the center of the image
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:             # <<<<<<<<<<<<<<
  *       px = px # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_px - __pyx_v_cx) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":527
+      /* "ext/skeletontricks/skeletontricks.pyx":576
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:
  *       px = px # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       px = px + wx
  */
       goto __pyx_L11;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":529
+    /* "ext/skeletontricks/skeletontricks.pyx":578
  *       px = px # will be truncated towards center
  *     else:
  *       px = px + wx             # <<<<<<<<<<<<<<
  * 
  *     if py - cy >= 0:
  */
     /*else*/ {
       __pyx_v_px = (__pyx_v_px + __pyx_v_wx);
     }
     __pyx_L11:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":531
+    /* "ext/skeletontricks/skeletontricks.pyx":580
  *       px = px + wx
  * 
  *     if py - cy >= 0:             # <<<<<<<<<<<<<<
  *       py = py # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_py - __pyx_v_cy) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":532
+      /* "ext/skeletontricks/skeletontricks.pyx":581
  * 
  *     if py - cy >= 0:
  *       py = py # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       py = py + wy
  */
       goto __pyx_L12;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":534
+    /* "ext/skeletontricks/skeletontricks.pyx":583
  *       py = py # will be truncated towards center
  *     else:
  *       py = py + wy             # <<<<<<<<<<<<<<
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  */
     /*else*/ {
       __pyx_v_py = (__pyx_v_py + __pyx_v_wy);
     }
     __pyx_L12:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":536
+    /* "ext/skeletontricks/skeletontricks.pyx":585
  *       py = py + wy
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))             # <<<<<<<<<<<<<<
  * 
  *   return result
  */
     if (unlikely(__pyx_v_wx == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     if (unlikely(__pyx_v_wy == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_2);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_6);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error);
     __pyx_t_2 = 0;
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 536, __pyx_L1_error)
+    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_L8_continue:;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":538
+  /* "ext/skeletontricks/skeletontricks.pyx":587
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  * 
  *   return result             # <<<<<<<<<<<<<<
  * 
- * def find_border_targets(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_result);
   __pyx_r = __pyx_v_result;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":473
+  /* "ext/skeletontricks/skeletontricks.pyx":526
  *   return remap
  * 
- * def compute_centroids(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def compute_centroids(
  *     cnp.ndarray[UINT, ndim=2] labels,
- *     float wx, float wy
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4);
@@ -54216,17 +55429,17 @@
   __Pyx_XDECREF(__pyx_v_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_153compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_153compute_centroids = {"__pyx_fuse_2compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_153compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22compute_centroids};
-static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_153compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_155compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_155compute_centroids = {"__pyx_fuse_2compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_155compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24compute_centroids};
+static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_155compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[3] = {0,0,0};
   int __pyx_lineno = 0;
@@ -54258,70 +55471,70 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 526, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 526, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 473, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 526, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 3)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 473, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 526, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.compute_centroids", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 474, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_152compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 528, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_154compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -54330,15 +55543,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_152compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_154compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
   __Pyx_memviewslice __pyx_v_xsum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_ysum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_labelct = { 0, 0, { 0 }, { 0 }, { 0 } };
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
@@ -54381,555 +55594,555 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_2compute_centroids", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 526, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":488
+  /* "ext/skeletontricks/skeletontricks.pyx":537
  *   """
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 488, __pyx_L1_error)
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 537, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_4);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 488, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_xsum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":489
+  /* "ext/skeletontricks/skeletontricks.pyx":538
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 489, __pyx_L1_error)
-  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 489, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_ysum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":490
+  /* "ext/skeletontricks/skeletontricks.pyx":539
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t sx, sy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 490, __pyx_L1_error)
-  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 539, __pyx_L1_error)
+  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_labelct = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":493
+  /* "ext/skeletontricks/skeletontricks.pyx":542
  * 
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = labels.shape[1]
  * 
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 542, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_9[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":494
+  /* "ext/skeletontricks/skeletontricks.pyx":543
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 494, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_9[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":497
+  /* "ext/skeletontricks/skeletontricks.pyx":546
  * 
  *   cdef size_t x, y
  *   cdef uint32_t label = 0             # <<<<<<<<<<<<<<
  * 
  *   for x in range(sx):
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":499
+  /* "ext/skeletontricks/skeletontricks.pyx":548
  *   cdef uint32_t label = 0
  * 
  *   for x in range(sx):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       label = labels[x,y]
  */
   __pyx_t_10 = __pyx_v_sx;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_x = __pyx_t_12;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":500
+    /* "ext/skeletontricks/skeletontricks.pyx":549
  * 
  *   for x in range(sx):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       label = labels[x,y]
  *       if label == 0:
  */
     __pyx_t_13 = __pyx_v_sy;
     __pyx_t_14 = __pyx_t_13;
     for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
       __pyx_v_y = __pyx_t_15;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":501
+      /* "ext/skeletontricks/skeletontricks.pyx":550
  *   for x in range(sx):
  *     for y in range(sy):
  *       label = labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_16 = __pyx_v_x;
       __pyx_t_17 = __pyx_v_y;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_16 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_18 = 1;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 501, __pyx_L1_error)
+        __PYX_ERR(0, 550, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":502
+      /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       __pyx_t_19 = (__pyx_v_label == 0);
       if (__pyx_t_19) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":503
+        /* "ext/skeletontricks/skeletontricks.pyx":552
  *       label = labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  * 
  *       xsum[label] += x
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":502
+        /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":505
+      /* "ext/skeletontricks/skeletontricks.pyx":554
  *         continue
  * 
  *       xsum[label] += x             # <<<<<<<<<<<<<<
  *       ysum[label] += y
  *       labelct[label] += 1
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 505, __pyx_L1_error)
+        __PYX_ERR(0, 554, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_17 * __pyx_v_xsum.strides[0]) )) += __pyx_v_x;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":506
+      /* "ext/skeletontricks/skeletontricks.pyx":555
  * 
  *       xsum[label] += x
  *       ysum[label] += y             # <<<<<<<<<<<<<<
  *       labelct[label] += 1
  * 
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 506, __pyx_L1_error)
+        __PYX_ERR(0, 555, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_17 * __pyx_v_ysum.strides[0]) )) += __pyx_v_y;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":507
+      /* "ext/skeletontricks/skeletontricks.pyx":556
  *       xsum[label] += x
  *       ysum[label] += y
  *       labelct[label] += 1             # <<<<<<<<<<<<<<
  * 
  *   result = {}
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 507, __pyx_L1_error)
+        __PYX_ERR(0, 556, __pyx_L1_error)
       }
       *((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_17 * __pyx_v_labelct.strides[0]) )) += 1;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":509
+  /* "ext/skeletontricks/skeletontricks.pyx":558
  *       labelct[label] += 1
  * 
  *   result = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef float cx = wx * sx / 2
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_result = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":511
+  /* "ext/skeletontricks/skeletontricks.pyx":560
  *   result = {}
  * 
  *   cdef float cx = wx * sx / 2             # <<<<<<<<<<<<<<
  *   cdef float cy = wy * sy / 2
  * 
  */
   __pyx_v_cx = ((__pyx_v_wx * __pyx_v_sx) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":512
+  /* "ext/skeletontricks/skeletontricks.pyx":561
  * 
  *   cdef float cx = wx * sx / 2
  *   cdef float cy = wy * sy / 2             # <<<<<<<<<<<<<<
  * 
  *   cdef float px, py
  */
   __pyx_v_cy = ((__pyx_v_wy * __pyx_v_sy) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":516
+  /* "ext/skeletontricks/skeletontricks.pyx":565
  *   cdef float px, py
  * 
  *   for label in range(labels.size):             # <<<<<<<<<<<<<<
  *     if labelct[label] == 0:
  *       continue
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 516, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 565, __pyx_L1_error)
   __pyx_t_20 = __pyx_t_3;
   for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
     __pyx_v_label = __pyx_t_21;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":517
+    /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 517, __pyx_L1_error)
+      __PYX_ERR(0, 566, __pyx_L1_error)
     }
     __pyx_t_19 = ((*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))) == 0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":518
+      /* "ext/skeletontricks/skeletontricks.pyx":567
  *   for label in range(labels.size):
  *     if labelct[label] == 0:
  *       continue             # <<<<<<<<<<<<<<
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  */
       goto __pyx_L8_continue;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":517
+      /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":520
+    /* "ext/skeletontricks/skeletontricks.pyx":569
  *       continue
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  *     py = wy * <float>ysum[label] / <float>labelct[label]
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_22 = (__pyx_v_wx * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_10 * __pyx_v_xsum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_23 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_23 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_v_px = (__pyx_t_22 / __pyx_t_23);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":521
+    /* "ext/skeletontricks/skeletontricks.pyx":570
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  *     py = wy * <float>ysum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  * 
  *     # Since we don't know which coordinate frame we
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_23 = (__pyx_v_wy * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_10 * __pyx_v_ysum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_22 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_22 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_v_py = (__pyx_t_23 / __pyx_t_22);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":526
+    /* "ext/skeletontricks/skeletontricks.pyx":575
  *     # are using, round toward the center of the image
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:             # <<<<<<<<<<<<<<
  *       px = px # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_px - __pyx_v_cx) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":527
+      /* "ext/skeletontricks/skeletontricks.pyx":576
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:
  *       px = px # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       px = px + wx
  */
       goto __pyx_L11;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":529
+    /* "ext/skeletontricks/skeletontricks.pyx":578
  *       px = px # will be truncated towards center
  *     else:
  *       px = px + wx             # <<<<<<<<<<<<<<
  * 
  *     if py - cy >= 0:
  */
     /*else*/ {
       __pyx_v_px = (__pyx_v_px + __pyx_v_wx);
     }
     __pyx_L11:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":531
+    /* "ext/skeletontricks/skeletontricks.pyx":580
  *       px = px + wx
  * 
  *     if py - cy >= 0:             # <<<<<<<<<<<<<<
  *       py = py # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_py - __pyx_v_cy) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":532
+      /* "ext/skeletontricks/skeletontricks.pyx":581
  * 
  *     if py - cy >= 0:
  *       py = py # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       py = py + wy
  */
       goto __pyx_L12;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":534
+    /* "ext/skeletontricks/skeletontricks.pyx":583
  *       py = py # will be truncated towards center
  *     else:
  *       py = py + wy             # <<<<<<<<<<<<<<
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  */
     /*else*/ {
       __pyx_v_py = (__pyx_v_py + __pyx_v_wy);
     }
     __pyx_L12:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":536
+    /* "ext/skeletontricks/skeletontricks.pyx":585
  *       py = py + wy
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))             # <<<<<<<<<<<<<<
  * 
  *   return result
  */
     if (unlikely(__pyx_v_wx == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     if (unlikely(__pyx_v_wy == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_2);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_6);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error);
     __pyx_t_2 = 0;
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 536, __pyx_L1_error)
+    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_L8_continue:;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":538
+  /* "ext/skeletontricks/skeletontricks.pyx":587
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  * 
  *   return result             # <<<<<<<<<<<<<<
  * 
- * def find_border_targets(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_result);
   __pyx_r = __pyx_v_result;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":473
+  /* "ext/skeletontricks/skeletontricks.pyx":526
  *   return remap
  * 
- * def compute_centroids(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def compute_centroids(
  *     cnp.ndarray[UINT, ndim=2] labels,
- *     float wx, float wy
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4);
@@ -54955,17 +56168,17 @@
   __Pyx_XDECREF(__pyx_v_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_155compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_155compute_centroids = {"__pyx_fuse_3compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_155compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22compute_centroids};
-static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_155compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_157compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_157compute_centroids = {"__pyx_fuse_3compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_157compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24compute_centroids};
+static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_157compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[3] = {0,0,0};
   int __pyx_lineno = 0;
@@ -54997,70 +56210,70 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 526, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 526, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 473, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 526, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 3)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 473, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 526, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.compute_centroids", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 474, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_154compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 528, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_156compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -55069,15 +56282,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_154compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_156compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
   __Pyx_memviewslice __pyx_v_xsum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_ysum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_labelct = { 0, 0, { 0 }, { 0 }, { 0 } };
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
@@ -55120,555 +56333,555 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_3compute_centroids", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 526, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":488
+  /* "ext/skeletontricks/skeletontricks.pyx":537
  *   """
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 488, __pyx_L1_error)
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 537, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_4);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 488, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_xsum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":489
+  /* "ext/skeletontricks/skeletontricks.pyx":538
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 489, __pyx_L1_error)
-  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 489, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_ysum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":490
+  /* "ext/skeletontricks/skeletontricks.pyx":539
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t sx, sy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 490, __pyx_L1_error)
-  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 539, __pyx_L1_error)
+  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_labelct = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":493
+  /* "ext/skeletontricks/skeletontricks.pyx":542
  * 
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = labels.shape[1]
  * 
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 542, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_9[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":494
+  /* "ext/skeletontricks/skeletontricks.pyx":543
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 494, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_9[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":497
+  /* "ext/skeletontricks/skeletontricks.pyx":546
  * 
  *   cdef size_t x, y
  *   cdef uint32_t label = 0             # <<<<<<<<<<<<<<
  * 
  *   for x in range(sx):
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":499
+  /* "ext/skeletontricks/skeletontricks.pyx":548
  *   cdef uint32_t label = 0
  * 
  *   for x in range(sx):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       label = labels[x,y]
  */
   __pyx_t_10 = __pyx_v_sx;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_x = __pyx_t_12;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":500
+    /* "ext/skeletontricks/skeletontricks.pyx":549
  * 
  *   for x in range(sx):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       label = labels[x,y]
  *       if label == 0:
  */
     __pyx_t_13 = __pyx_v_sy;
     __pyx_t_14 = __pyx_t_13;
     for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
       __pyx_v_y = __pyx_t_15;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":501
+      /* "ext/skeletontricks/skeletontricks.pyx":550
  *   for x in range(sx):
  *     for y in range(sy):
  *       label = labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_16 = __pyx_v_x;
       __pyx_t_17 = __pyx_v_y;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_16 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_18 = 1;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 501, __pyx_L1_error)
+        __PYX_ERR(0, 550, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":502
+      /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       __pyx_t_19 = (__pyx_v_label == 0);
       if (__pyx_t_19) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":503
+        /* "ext/skeletontricks/skeletontricks.pyx":552
  *       label = labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  * 
  *       xsum[label] += x
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":502
+        /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":505
+      /* "ext/skeletontricks/skeletontricks.pyx":554
  *         continue
  * 
  *       xsum[label] += x             # <<<<<<<<<<<<<<
  *       ysum[label] += y
  *       labelct[label] += 1
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 505, __pyx_L1_error)
+        __PYX_ERR(0, 554, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_17 * __pyx_v_xsum.strides[0]) )) += __pyx_v_x;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":506
+      /* "ext/skeletontricks/skeletontricks.pyx":555
  * 
  *       xsum[label] += x
  *       ysum[label] += y             # <<<<<<<<<<<<<<
  *       labelct[label] += 1
  * 
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 506, __pyx_L1_error)
+        __PYX_ERR(0, 555, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_17 * __pyx_v_ysum.strides[0]) )) += __pyx_v_y;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":507
+      /* "ext/skeletontricks/skeletontricks.pyx":556
  *       xsum[label] += x
  *       ysum[label] += y
  *       labelct[label] += 1             # <<<<<<<<<<<<<<
  * 
  *   result = {}
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 507, __pyx_L1_error)
+        __PYX_ERR(0, 556, __pyx_L1_error)
       }
       *((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_17 * __pyx_v_labelct.strides[0]) )) += 1;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":509
+  /* "ext/skeletontricks/skeletontricks.pyx":558
  *       labelct[label] += 1
  * 
  *   result = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef float cx = wx * sx / 2
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_result = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":511
+  /* "ext/skeletontricks/skeletontricks.pyx":560
  *   result = {}
  * 
  *   cdef float cx = wx * sx / 2             # <<<<<<<<<<<<<<
  *   cdef float cy = wy * sy / 2
  * 
  */
   __pyx_v_cx = ((__pyx_v_wx * __pyx_v_sx) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":512
+  /* "ext/skeletontricks/skeletontricks.pyx":561
  * 
  *   cdef float cx = wx * sx / 2
  *   cdef float cy = wy * sy / 2             # <<<<<<<<<<<<<<
  * 
  *   cdef float px, py
  */
   __pyx_v_cy = ((__pyx_v_wy * __pyx_v_sy) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":516
+  /* "ext/skeletontricks/skeletontricks.pyx":565
  *   cdef float px, py
  * 
  *   for label in range(labels.size):             # <<<<<<<<<<<<<<
  *     if labelct[label] == 0:
  *       continue
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 516, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 565, __pyx_L1_error)
   __pyx_t_20 = __pyx_t_3;
   for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
     __pyx_v_label = __pyx_t_21;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":517
+    /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 517, __pyx_L1_error)
+      __PYX_ERR(0, 566, __pyx_L1_error)
     }
     __pyx_t_19 = ((*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))) == 0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":518
+      /* "ext/skeletontricks/skeletontricks.pyx":567
  *   for label in range(labels.size):
  *     if labelct[label] == 0:
  *       continue             # <<<<<<<<<<<<<<
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  */
       goto __pyx_L8_continue;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":517
+      /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":520
+    /* "ext/skeletontricks/skeletontricks.pyx":569
  *       continue
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  *     py = wy * <float>ysum[label] / <float>labelct[label]
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_22 = (__pyx_v_wx * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_10 * __pyx_v_xsum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_23 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_23 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_v_px = (__pyx_t_22 / __pyx_t_23);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":521
+    /* "ext/skeletontricks/skeletontricks.pyx":570
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  *     py = wy * <float>ysum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  * 
  *     # Since we don't know which coordinate frame we
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_23 = (__pyx_v_wy * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_10 * __pyx_v_ysum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_22 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_22 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_v_py = (__pyx_t_23 / __pyx_t_22);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":526
+    /* "ext/skeletontricks/skeletontricks.pyx":575
  *     # are using, round toward the center of the image
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:             # <<<<<<<<<<<<<<
  *       px = px # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_px - __pyx_v_cx) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":527
+      /* "ext/skeletontricks/skeletontricks.pyx":576
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:
  *       px = px # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       px = px + wx
  */
       goto __pyx_L11;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":529
+    /* "ext/skeletontricks/skeletontricks.pyx":578
  *       px = px # will be truncated towards center
  *     else:
  *       px = px + wx             # <<<<<<<<<<<<<<
  * 
  *     if py - cy >= 0:
  */
     /*else*/ {
       __pyx_v_px = (__pyx_v_px + __pyx_v_wx);
     }
     __pyx_L11:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":531
+    /* "ext/skeletontricks/skeletontricks.pyx":580
  *       px = px + wx
  * 
  *     if py - cy >= 0:             # <<<<<<<<<<<<<<
  *       py = py # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_py - __pyx_v_cy) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":532
+      /* "ext/skeletontricks/skeletontricks.pyx":581
  * 
  *     if py - cy >= 0:
  *       py = py # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       py = py + wy
  */
       goto __pyx_L12;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":534
+    /* "ext/skeletontricks/skeletontricks.pyx":583
  *       py = py # will be truncated towards center
  *     else:
  *       py = py + wy             # <<<<<<<<<<<<<<
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  */
     /*else*/ {
       __pyx_v_py = (__pyx_v_py + __pyx_v_wy);
     }
     __pyx_L12:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":536
+    /* "ext/skeletontricks/skeletontricks.pyx":585
  *       py = py + wy
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))             # <<<<<<<<<<<<<<
  * 
  *   return result
  */
     if (unlikely(__pyx_v_wx == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     if (unlikely(__pyx_v_wy == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_2);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_6);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error);
     __pyx_t_2 = 0;
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 536, __pyx_L1_error)
+    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_L8_continue:;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":538
+  /* "ext/skeletontricks/skeletontricks.pyx":587
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  * 
  *   return result             # <<<<<<<<<<<<<<
  * 
- * def find_border_targets(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_result);
   __pyx_r = __pyx_v_result;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":473
+  /* "ext/skeletontricks/skeletontricks.pyx":526
  *   return remap
  * 
- * def compute_centroids(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def compute_centroids(
  *     cnp.ndarray[UINT, ndim=2] labels,
- *     float wx, float wy
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4);
@@ -55694,17 +56907,17 @@
   __Pyx_XDECREF(__pyx_v_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_157compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_157compute_centroids = {"__pyx_fuse_4compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_157compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_22compute_centroids};
-static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_157compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_159compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_159compute_centroids = {"__pyx_fuse_4compute_centroids", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_159compute_centroids, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24compute_centroids};
+static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_159compute_centroids(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[3] = {0,0,0};
   int __pyx_lineno = 0;
@@ -55736,70 +56949,70 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 1); __PYX_ERR(0, 526, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 473, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 473, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, 2); __PYX_ERR(0, 526, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 473, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_centroids") < 0)) __PYX_ERR(0, 526, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 3)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 475, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 473, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("compute_centroids", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 526, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.compute_centroids", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 474, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_156compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 528, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_158compute_centroids(__pyx_self, __pyx_v_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -55808,15 +57021,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_156compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_158compute_centroids(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, float __pyx_v_wx, float __pyx_v_wy) {
   __Pyx_memviewslice __pyx_v_xsum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_ysum = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_labelct = { 0, 0, { 0 }, { 0 }, { 0 } };
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
@@ -55859,555 +57072,555 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_4compute_centroids", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 473, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 526, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":488
+  /* "ext/skeletontricks/skeletontricks.pyx":537
  *   """
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 488, __pyx_L1_error)
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 537, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_4);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 488, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 488, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 537, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_xsum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":489
+  /* "ext/skeletontricks/skeletontricks.pyx":538
  * 
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)             # <<<<<<<<<<<<<<
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 489, __pyx_L1_error)
-  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 489, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_float(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 538, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_ysum = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":490
+  /* "ext/skeletontricks/skeletontricks.pyx":539
  *   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
  *   cdef uint32_t[:] labelct = np.zeros( (labels.size,), dtype=np.uint32)             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t sx, sy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 490, __pyx_L1_error)
-  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 539, __pyx_L1_error)
+  __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 490, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 490, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint32_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 539, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_labelct = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":493
+  /* "ext/skeletontricks/skeletontricks.pyx":542
  * 
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = labels.shape[1]
  * 
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 493, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 542, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_9[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":494
+  /* "ext/skeletontricks/skeletontricks.pyx":543
  *   cdef size_t sx, sy
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 494, __pyx_L1_error)
+  __pyx_t_9 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_9 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_9[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":497
+  /* "ext/skeletontricks/skeletontricks.pyx":546
  * 
  *   cdef size_t x, y
  *   cdef uint32_t label = 0             # <<<<<<<<<<<<<<
  * 
  *   for x in range(sx):
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":499
+  /* "ext/skeletontricks/skeletontricks.pyx":548
  *   cdef uint32_t label = 0
  * 
  *   for x in range(sx):             # <<<<<<<<<<<<<<
  *     for y in range(sy):
  *       label = labels[x,y]
  */
   __pyx_t_10 = __pyx_v_sx;
   __pyx_t_11 = __pyx_t_10;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_x = __pyx_t_12;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":500
+    /* "ext/skeletontricks/skeletontricks.pyx":549
  * 
  *   for x in range(sx):
  *     for y in range(sy):             # <<<<<<<<<<<<<<
  *       label = labels[x,y]
  *       if label == 0:
  */
     __pyx_t_13 = __pyx_v_sy;
     __pyx_t_14 = __pyx_t_13;
     for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
       __pyx_v_y = __pyx_t_15;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":501
+      /* "ext/skeletontricks/skeletontricks.pyx":550
  *   for x in range(sx):
  *     for y in range(sy):
  *       label = labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_16 = __pyx_v_x;
       __pyx_t_17 = __pyx_v_y;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_16 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_18 = 1;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 501, __pyx_L1_error)
+        __PYX_ERR(0, 550, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":502
+      /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       __pyx_t_19 = (__pyx_v_label == 0);
       if (__pyx_t_19) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":503
+        /* "ext/skeletontricks/skeletontricks.pyx":552
  *       label = labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  * 
  *       xsum[label] += x
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":502
+        /* "ext/skeletontricks/skeletontricks.pyx":551
  *     for y in range(sy):
  *       label = labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  * 
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":505
+      /* "ext/skeletontricks/skeletontricks.pyx":554
  *         continue
  * 
  *       xsum[label] += x             # <<<<<<<<<<<<<<
  *       ysum[label] += y
  *       labelct[label] += 1
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 505, __pyx_L1_error)
+        __PYX_ERR(0, 554, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_17 * __pyx_v_xsum.strides[0]) )) += __pyx_v_x;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":506
+      /* "ext/skeletontricks/skeletontricks.pyx":555
  * 
  *       xsum[label] += x
  *       ysum[label] += y             # <<<<<<<<<<<<<<
  *       labelct[label] += 1
  * 
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 506, __pyx_L1_error)
+        __PYX_ERR(0, 555, __pyx_L1_error)
       }
       *((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_17 * __pyx_v_ysum.strides[0]) )) += __pyx_v_y;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":507
+      /* "ext/skeletontricks/skeletontricks.pyx":556
  *       xsum[label] += x
  *       ysum[label] += y
  *       labelct[label] += 1             # <<<<<<<<<<<<<<
  * 
  *   result = {}
  */
       __pyx_t_17 = __pyx_v_label;
       __pyx_t_18 = -1;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 507, __pyx_L1_error)
+        __PYX_ERR(0, 556, __pyx_L1_error)
       }
       *((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_17 * __pyx_v_labelct.strides[0]) )) += 1;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":509
+  /* "ext/skeletontricks/skeletontricks.pyx":558
  *       labelct[label] += 1
  * 
  *   result = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef float cx = wx * sx / 2
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 509, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 558, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_result = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":511
+  /* "ext/skeletontricks/skeletontricks.pyx":560
  *   result = {}
  * 
  *   cdef float cx = wx * sx / 2             # <<<<<<<<<<<<<<
  *   cdef float cy = wy * sy / 2
  * 
  */
   __pyx_v_cx = ((__pyx_v_wx * __pyx_v_sx) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":512
+  /* "ext/skeletontricks/skeletontricks.pyx":561
  * 
  *   cdef float cx = wx * sx / 2
  *   cdef float cy = wy * sy / 2             # <<<<<<<<<<<<<<
  * 
  *   cdef float px, py
  */
   __pyx_v_cy = ((__pyx_v_wy * __pyx_v_sy) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":516
+  /* "ext/skeletontricks/skeletontricks.pyx":565
  *   cdef float px, py
  * 
  *   for label in range(labels.size):             # <<<<<<<<<<<<<<
  *     if labelct[label] == 0:
  *       continue
  */
-  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 516, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_3 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 565, __pyx_L1_error)
   __pyx_t_20 = __pyx_t_3;
   for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
     __pyx_v_label = __pyx_t_21;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":517
+    /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 517, __pyx_L1_error)
+      __PYX_ERR(0, 566, __pyx_L1_error)
     }
     __pyx_t_19 = ((*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))) == 0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":518
+      /* "ext/skeletontricks/skeletontricks.pyx":567
  *   for label in range(labels.size):
  *     if labelct[label] == 0:
  *       continue             # <<<<<<<<<<<<<<
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  */
       goto __pyx_L8_continue;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":517
+      /* "ext/skeletontricks/skeletontricks.pyx":566
  * 
  *   for label in range(labels.size):
  *     if labelct[label] == 0:             # <<<<<<<<<<<<<<
  *       continue
  * 
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":520
+    /* "ext/skeletontricks/skeletontricks.pyx":569
  *       continue
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  *     py = wy * <float>ysum[label] / <float>labelct[label]
  * 
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_xsum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_22 = (__pyx_v_wx * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_xsum.data + __pyx_t_10 * __pyx_v_xsum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_t_23 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_23 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 520, __pyx_L1_error)
+      __PYX_ERR(0, 569, __pyx_L1_error)
     }
     __pyx_v_px = (__pyx_t_22 / __pyx_t_23);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":521
+    /* "ext/skeletontricks/skeletontricks.pyx":570
  * 
  *     px = wx * <float>xsum[label] / <float>labelct[label]
  *     py = wy * <float>ysum[label] / <float>labelct[label]             # <<<<<<<<<<<<<<
  * 
  *     # Since we don't know which coordinate frame we
  */
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_ysum.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_23 = (__pyx_v_wy * ((float)(*((float *) ( /* dim=0 */ (__pyx_v_ysum.data + __pyx_t_10 * __pyx_v_ysum.strides[0]) )))));
     __pyx_t_10 = __pyx_v_label;
     __pyx_t_18 = -1;
     if (unlikely(__pyx_t_10 >= (size_t)__pyx_v_labelct.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_t_22 = ((float)(*((uint32_t *) ( /* dim=0 */ (__pyx_v_labelct.data + __pyx_t_10 * __pyx_v_labelct.strides[0]) ))));
     if (unlikely(__pyx_t_22 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 521, __pyx_L1_error)
+      __PYX_ERR(0, 570, __pyx_L1_error)
     }
     __pyx_v_py = (__pyx_t_23 / __pyx_t_22);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":526
+    /* "ext/skeletontricks/skeletontricks.pyx":575
  *     # are using, round toward the center of the image
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:             # <<<<<<<<<<<<<<
  *       px = px # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_px - __pyx_v_cx) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":527
+      /* "ext/skeletontricks/skeletontricks.pyx":576
  *     # to ensure we get the same pixel every time.
  *     if px - cx >= 0:
  *       px = px # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       px = px + wx
  */
       goto __pyx_L11;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":529
+    /* "ext/skeletontricks/skeletontricks.pyx":578
  *       px = px # will be truncated towards center
  *     else:
  *       px = px + wx             # <<<<<<<<<<<<<<
  * 
  *     if py - cy >= 0:
  */
     /*else*/ {
       __pyx_v_px = (__pyx_v_px + __pyx_v_wx);
     }
     __pyx_L11:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":531
+    /* "ext/skeletontricks/skeletontricks.pyx":580
  *       px = px + wx
  * 
  *     if py - cy >= 0:             # <<<<<<<<<<<<<<
  *       py = py # will be truncated towards center
  *     else:
  */
     __pyx_t_19 = ((__pyx_v_py - __pyx_v_cy) >= 0.0);
     if (__pyx_t_19) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":532
+      /* "ext/skeletontricks/skeletontricks.pyx":581
  * 
  *     if py - cy >= 0:
  *       py = py # will be truncated towards center             # <<<<<<<<<<<<<<
  *     else:
  *       py = py + wy
  */
       goto __pyx_L12;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":534
+    /* "ext/skeletontricks/skeletontricks.pyx":583
  *       py = py # will be truncated towards center
  *     else:
  *       py = py + wy             # <<<<<<<<<<<<<<
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  */
     /*else*/ {
       __pyx_v_py = (__pyx_v_py + __pyx_v_wy);
     }
     __pyx_L12:;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":536
+    /* "ext/skeletontricks/skeletontricks.pyx":585
  *       py = py + wy
  * 
  *     result[label] = (<int>(px / wx), <int>(py / wy))             # <<<<<<<<<<<<<<
  * 
  *   return result
  */
     if (unlikely(__pyx_v_wx == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_From_int(((int)(__pyx_v_px / __pyx_v_wx))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     if (unlikely(__pyx_v_wy == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 536, __pyx_L1_error)
+      __PYX_ERR(0, 585, __pyx_L1_error)
     }
-    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_int(((int)(__pyx_v_py / __pyx_v_wy))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_2);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 585, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_6);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error);
     __pyx_t_2 = 0;
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 536, __pyx_L1_error)
+    if (unlikely((PyDict_SetItem(__pyx_v_result, __pyx_t_6, __pyx_t_5) < 0))) __PYX_ERR(0, 585, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_L8_continue:;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":538
+  /* "ext/skeletontricks/skeletontricks.pyx":587
  *     result[label] = (<int>(px / wx), <int>(py / wy))
  * 
  *   return result             # <<<<<<<<<<<<<<
  * 
- * def find_border_targets(
+ * @cython.binding(True)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_result);
   __pyx_r = __pyx_v_result;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":473
+  /* "ext/skeletontricks/skeletontricks.pyx":526
  *   return remap
  * 
- * def compute_centroids(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def compute_centroids(
  *     cnp.ndarray[UINT, ndim=2] labels,
- *     float wx, float wy
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4);
@@ -56432,27 +57645,27 @@
   __PYX_XCLEAR_MEMVIEW(&__pyx_v_labelct, 1);
   __Pyx_XDECREF(__pyx_v_result);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":540
+/* "ext/skeletontricks/skeletontricks.pyx":589
  *   return result
  * 
- * def find_border_targets(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def find_border_targets(
  *     cnp.ndarray[float, ndim=2] dt,
- *     cnp.ndarray[UINT, ndim=2] cc_labels,
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_25find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_24find_border_targets, "\n  find_border_targets(\n    ndarray[float, ndim=2] dt, \n    ndarray[UINT, ndim=2] cc_labels,\n    float wx, float wy\n  )\n\n  Given a set of connected components that line within \n  a plane and their distance transform, return a map of\n  label ID to the coordinate of its maximum distance \n  transform value. If there are multiple maxima, we \n  disambiguate based on topological criteria that are\n  coordinate frame independent in order to avoid dealing\n  with issues that come from the six rotated frames and\n  their mirrored partners.\n\n  The purpose of this function is to fix the edge effect\n  the standard TEASAR algorithm generates and ensure that\n  we can trivially join skeletons from adjacent chunks.  \n\n  Rotating the (x,y) pairs into their appropriate frame\n  is performed in the function that calls this one.\n\n  Returns: { $SEGID: (x, y), ... }\n  ");
-static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_25find_border_targets = {"find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_25find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24find_border_targets};
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_25find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_27find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_26find_border_targets, "\n  Given a set of connected components that line within \n  a plane and their distance transform, return a map of\n  label ID to the coordinate of its maximum distance \n  transform value. If there are multiple maxima, we \n  disambiguate based on topological criteria that are\n  coordinate frame independent in order to avoid dealing\n  with issues that come from the six rotated frames and\n  their mirrored partners.\n\n  The purpose of this function is to fix the edge effect\n  the standard TEASAR algorithm generates and ensure that\n  we can trivially join skeletons from adjacent chunks.  \n\n  Rotating the (x,y) pairs into their appropriate frame\n  is performed in the function that calls this one.\n\n  Returns: { $SEGID: (x, y), ... }\n  ");
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_27find_border_targets = {"find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_27find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_26find_border_targets};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_27find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_signatures = 0;
   PyObject *__pyx_v_args = 0;
   PyObject *__pyx_v_kwargs = 0;
   CYTHON_UNUSED PyObject *__pyx_v_defaults = 0;
   PyObject *__pyx_v__fused_sigindex = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -56492,57 +57705,57 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_signatures)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_args)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_kwargs)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_defaults)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_fused_sigindex);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 540, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 589, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
@@ -56556,42 +57769,42 @@
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
     __pyx_v__fused_sigindex = values[4];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 540, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 589, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_24find_border_targets(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults, __pyx_v__fused_sigindex);
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_26find_border_targets(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults, __pyx_v__fused_sigindex);
 
   /* function exit code */
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_24find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_26find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex) {
   PyObject *__pyx_v_search_list = 0;
   PyObject *__pyx_v_sigindex_node = 0;
   PyObject *__pyx_v_dest_sig = NULL;
   PyTypeObject *__pyx_v_ndarray = 0;
   PyObject *__pyx_v_arg_as_memoryview = 0;
   __Pyx_memviewslice __pyx_v_memslice;
   Py_ssize_t __pyx_v_itemsize;
@@ -56639,136 +57852,136 @@
   Py_ssize_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("find_border_targets", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, Py_None)) __PYX_ERR(0, 540, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, Py_None)) __PYX_ERR(0, 589, __pyx_L1_error);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   if (__pyx_t_3) {
   } else {
     __pyx_t_2 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_3);
   __pyx_t_2 = __pyx_t_4;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v___pyx_fused_dtype_uint8__t_is_signed = (!(((uint8_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint16__t_is_signed = (!(((uint16_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint32__t_is_signed = (!(((uint32_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint64__t_is_signed = (!(((uint64_t)-1L) > 0));
   __pyx_v_unsigned_char_is_signed = (!(((unsigned char)-1L) > 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 540, __pyx_L1_error)
+    __PYX_ERR(0, 589, __pyx_L1_error)
   }
-  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 589, __pyx_L1_error)
   __pyx_t_2 = (1 < __pyx_t_5);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 540, __pyx_L1_error)
+      __PYX_ERR(0, 589, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_GetItemInt_Tuple(((PyObject*)__pyx_v_args), 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt_Tuple(((PyObject*)__pyx_v_args), 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   __pyx_t_4 = (__pyx_v_kwargs != Py_None);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 540, __pyx_L1_error)
+    __PYX_ERR(0, 589, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_cc_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_cc_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
   __pyx_t_2 = __pyx_t_4;
   __pyx_L7_bool_binop_done:;
   if (likely(__pyx_t_2)) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 540, __pyx_L1_error)
+      __PYX_ERR(0, 589, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_cc_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_cc_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 540, __pyx_L1_error)
+      __PYX_ERR(0, 589, __pyx_L1_error)
     }
-    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 540, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 589, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4)) __PYX_ERR(0, 540, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4)) __PYX_ERR(0, 589, __pyx_L1_error);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 540, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 589, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_1);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 540, __pyx_L1_error)
+    __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -56781,141 +57994,141 @@
         __Pyx_INCREF(Py_None);
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 0x69);
         switch (__pyx_v_kind) {
           case 0x69:
           case 0x75:
           __pyx_t_4 = ((sizeof(uint8_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint8__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint16_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint16__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L20_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint32_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint32__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L24_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint64_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint64__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L28_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(unsigned char)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 2);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v_unsigned_char_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L32_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 0x66:
           break;
           case 99:
           break;
@@ -56923,205 +58136,205 @@
           break;
           default: break;
         }
       }
     }
     __pyx_t_2 = (__pyx_v_arg == Py_None);
     if (__pyx_t_2) {
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
       goto __pyx_L10_break;
     }
     {
       __Pyx_PyThreadState_declare
       __Pyx_PyThreadState_assign
       __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
       __Pyx_XGOTREF(__pyx_t_8);
       __Pyx_XGOTREF(__pyx_t_9);
       __Pyx_XGOTREF(__pyx_t_10);
       /*try:*/ {
-        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L36_error)
+        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L36_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_as_memoryview = ((PyObject*)__pyx_t_6);
         __pyx_t_6 = 0;
       }
       /*else:*/ {
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L47_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint8_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L46_next_and;
         }
         __pyx_L47_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint8_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L45_bool_binop_done;
         }
         __pyx_L46_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L45_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn_uint8_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L53_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint16_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L52_next_and;
         }
         __pyx_L53_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint16_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L51_bool_binop_done;
         }
         __pyx_L52_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L51_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn_uint16_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L59_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint32_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L58_next_and;
         }
         __pyx_L59_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint32_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L57_bool_binop_done;
         }
         __pyx_L58_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L57_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn_uint32_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L65_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint64_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L64_next_and;
         }
         __pyx_L65_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint64_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L63_bool_binop_done;
         }
         __pyx_L64_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L63_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn_uint64_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L71_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(unsigned char)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L70_next_and;
         }
         __pyx_L71_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(unsigned char)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L69_bool_binop_done;
         }
         __pyx_L70_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __pyx_t_4 = (__pyx_t_11 == 2);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L69_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_unsigned_char(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L38_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L38_except_error)
             goto __pyx_L41_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
       }
@@ -57131,15 +58344,15 @@
       goto __pyx_L43_try_end;
       __pyx_L36_error:;
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_11 = __Pyx_PyErr_ExceptionMatches2(__pyx_builtin_ValueError, __pyx_builtin_TypeError);
       if (__pyx_t_11) {
         __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
-        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 540, __pyx_L38_except_error)
+        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 589, __pyx_L38_except_error)
         __Pyx_XGOTREF(__pyx_t_6);
         __Pyx_XGOTREF(__pyx_t_1);
         __Pyx_XGOTREF(__pyx_t_13);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         goto __pyx_L37_exception_handled;
@@ -57160,43 +58373,43 @@
       __pyx_L37_exception_handled:;
       __Pyx_XGIVEREF(__pyx_t_8);
       __Pyx_XGIVEREF(__pyx_t_9);
       __Pyx_XGIVEREF(__pyx_t_10);
       __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
       __pyx_L43_try_end:;
     }
-    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_2);
   if (__pyx_t_4) {
     __pyx_t_5 = 0;
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 540, __pyx_L1_error)
+      __PYX_ERR(0, 589, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF(__pyx_t_13);
     __pyx_t_13 = __pyx_t_1;
     __pyx_t_1 = 0;
     while (1) {
       __pyx_t_15 = __Pyx_dict_iter_next(__pyx_t_13, __pyx_t_14, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_11);
       if (unlikely(__pyx_t_15 == 0)) break;
-      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_1 = __pyx_v__fused_sigindex;
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_1));
       __pyx_t_1 = 0;
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 589, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __pyx_t_17 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_17 = PyMethod_GET_SELF(__pyx_t_16);
         if (likely(__pyx_t_17)) {
@@ -57208,19 +58421,19 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_17, __pyx_kp_s__13};
         __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 589, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_6 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_16);
@@ -57233,34 +58446,34 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_kp_s__14};
         __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 589, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_18 = PyList_GET_SIZE(__pyx_t_16);
       if (unlikely(__pyx_t_18 < 1)) {
-        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 540, __pyx_L1_error)
+        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 589, __pyx_L1_error)
       }
       #if CYTHON_COMPILING_IN_CPYTHON
       __pyx_t_6 = PyList_GET_ITEM(__pyx_t_16, __pyx_t_18-1); 
       ((PyVarObject*)__pyx_t_16)->ob_size--;
       #else
       __pyx_t_6 = PySequence_ITEM(__pyx_t_16, __pyx_t_18-1); 
       #endif
       __Pyx_GOTREF(__pyx_t_6);
       #if !CYTHON_COMPILING_IN_CPYTHON
-      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 540, __pyx_L1_error)
+      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 589, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_17);
       __Pyx_DECREF(__pyx_t_16);
       __pyx_t_16 = __pyx_t_17; __pyx_t_17 = NULL;
       #else
       CYTHON_UNUSED_VAR(__pyx_t_17);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_sig_series, ((PyObject*)__pyx_t_16));
@@ -57269,220 +58482,220 @@
       __pyx_t_6 = 0;
       __pyx_t_1 = __pyx_v_sig_series; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_18 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
           #endif
           if (__pyx_t_18 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
         #else
-        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sig_type, __pyx_t_6);
         __pyx_t_6 = 0;
         if (unlikely(__pyx_v_sigindex_node == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 540, __pyx_L1_error)
+          __PYX_ERR(0, 589, __pyx_L1_error)
         }
-        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
         if (__pyx_t_4) {
-          __pyx_t_6 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 540, __pyx_L1_error)
+            __PYX_ERR(0, 589, __pyx_L1_error)
           }
-          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_6) < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_6) < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, __pyx_t_6);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           goto __pyx_L81;
         }
         /*else*/ {
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 540, __pyx_L1_error)
+            __PYX_ERR(0, 589, __pyx_L1_error)
           }
-          __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_t_16 = __pyx_t_6;
           __Pyx_INCREF(__pyx_t_16);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_16));
           __pyx_t_16 = 0;
         }
         __pyx_L81:;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       if (unlikely(__pyx_v_sigindex_node == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 540, __pyx_L1_error)
+        __PYX_ERR(0, 589, __pyx_L1_error)
       }
-      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   }
-  __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __pyx_v_sigindex_matches = ((PyObject*)__pyx_t_13);
   __pyx_t_13 = 0;
-  __pyx_t_13 = PyList_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_13 = PyList_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_INCREF(__pyx_v__fused_sigindex);
   __Pyx_GIVEREF(__pyx_v__fused_sigindex);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_13, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 540, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_13, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 589, __pyx_L1_error);
   __pyx_v_sigindex_candidates = ((PyObject*)__pyx_t_13);
   __pyx_t_13 = 0;
   __pyx_t_13 = __pyx_v_dest_sig; __Pyx_INCREF(__pyx_t_13);
   __pyx_t_14 = 0;
   for (;;) {
     {
       Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_13);
       #if !CYTHON_ASSUME_SAFE_MACROS
-      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
       #endif
       if (__pyx_t_14 >= __pyx_temp) break;
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
     #else
-    __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_found_matches, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_found_candidates, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
     __pyx_t_4 = (__pyx_v_dst_type == Py_None);
     if (__pyx_t_4) {
       __pyx_t_1 = __pyx_v_sigindex_matches; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 540, __pyx_L1_error)
+          __PYX_ERR(0, 589, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_1 = __pyx_v_sigindex_candidates; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 540, __pyx_L1_error)
+          __PYX_ERR(0, 589, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       goto __pyx_L85;
     }
     /*else*/ {
-      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_INCREF(__pyx_v_sigindex_matches);
       __Pyx_GIVEREF(__pyx_v_sigindex_matches);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 540, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 589, __pyx_L1_error);
       __Pyx_INCREF(__pyx_v_sigindex_candidates);
       __Pyx_GIVEREF(__pyx_v_sigindex_candidates);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 540, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 589, __pyx_L1_error);
       __pyx_t_16 = __pyx_t_1; __Pyx_INCREF(__pyx_t_16);
       __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       for (;;) {
         if (__pyx_t_5 >= 2) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
         #else
-        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 540, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_search_list, ((PyObject*)__pyx_t_1));
         __pyx_t_1 = 0;
         if (unlikely(__pyx_v_search_list == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 540, __pyx_L1_error)
+          __PYX_ERR(0, 589, __pyx_L1_error)
         }
         __pyx_t_1 = __pyx_v_search_list; __Pyx_INCREF(__pyx_t_1);
         __pyx_t_18 = 0;
         for (;;) {
           {
             Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
             #if !CYTHON_ASSUME_SAFE_MACROS
-            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
             #endif
             if (__pyx_t_18 >= __pyx_temp) break;
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 589, __pyx_L1_error)
           #else
-          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
           __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_6);
           __pyx_t_6 = 0;
           if (unlikely(__pyx_v_sn == Py_None)) {
             PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-            __PYX_ERR(0, 540, __pyx_L1_error)
+            __PYX_ERR(0, 589, __pyx_L1_error)
           }
-          __pyx_t_6 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 540, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 589, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_XDECREF_SET(__pyx_v_type_match, __pyx_t_6);
           __pyx_t_6 = 0;
           __pyx_t_4 = (__pyx_v_type_match != Py_None);
           if (__pyx_t_4) {
-            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 540, __pyx_L1_error)
+            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 589, __pyx_L1_error)
           }
         }
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       }
       __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
     }
     __pyx_L85:;
@@ -57511,38 +58724,38 @@
   goto __pyx_L102_for_end;
   __pyx_L102_for_end:;
   __Pyx_INCREF(__pyx_v_sigindex_matches);
   __pyx_v_candidates = __pyx_v_sigindex_matches;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_4 = (!__pyx_t_2);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_Raise(__pyx_t_13, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __PYX_ERR(0, 540, __pyx_L1_error)
+    __PYX_ERR(0, 589, __pyx_L1_error)
   }
-  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 589, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_14 > 1);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_Raise(__pyx_t_13, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __PYX_ERR(0, 540, __pyx_L1_error)
+    __PYX_ERR(0, 589, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 540, __pyx_L1_error)
+      __PYX_ERR(0, 589, __pyx_L1_error)
     }
-    __pyx_t_13 = __Pyx_GetItemInt_List(__pyx_v_candidates, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_GetItemInt_List(__pyx_v_candidates, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_16 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), __pyx_t_13); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 540, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), __pyx_t_13); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 589, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_16);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_r = __pyx_t_16;
     __pyx_t_16 = 0;
     goto __pyx_L0;
   }
 
@@ -57579,17 +58792,17 @@
   __Pyx_XDECREF(__pyx_v_kwargs);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_161find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_161find_border_targets = {"__pyx_fuse_0find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_161find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24find_border_targets};
-static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_161find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_163find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_163find_border_targets = {"__pyx_fuse_0find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_163find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_26find_border_targets};
+static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_163find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_dt = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[4] = {0,0,0,0};
@@ -57624,83 +58837,83 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_dt)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 589, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 540, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 589, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 4)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
       values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
     }
     __pyx_v_dt = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 540, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 589, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_border_targets", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 541, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 542, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_160find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_162find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -57709,15 +58922,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_160find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_162find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   PyObject *__pyx_v_mx = NULL;
   PyObject *__pyx_v_pts = NULL;
   uint8_t __pyx_v_label;
@@ -57769,51 +58982,51 @@
   __pyx_pybuffernd_dt.rcbuffer = &__pyx_pybuffer_dt;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_dt.diminfo[0].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dt.diminfo[0].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_dt.diminfo[1].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_dt.diminfo[1].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":571
+  /* "ext/skeletontricks/skeletontricks.pyx":615
  *   """
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]             # <<<<<<<<<<<<<<
  *   sy = dt.shape[1]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 615, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":572
+  /* "ext/skeletontricks/skeletontricks.pyx":616
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]
  *   sy = dt.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 616, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":576
+  /* "ext/skeletontricks/skeletontricks.pyx":620
  *   cdef size_t x, y
  * 
  *   mx = defaultdict(float)             # <<<<<<<<<<<<<<
  *   pts = {}
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 576, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 620, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
@@ -57825,54 +59038,54 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_4, ((PyObject *)(&PyFloat_Type))};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 576, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __pyx_v_mx = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":577
+  /* "ext/skeletontricks/skeletontricks.pyx":621
  * 
  *   mx = defaultdict(float)
  *   pts = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT label = 0
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 577, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 621, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_pts = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":579
+  /* "ext/skeletontricks/skeletontricks.pyx":623
  *   pts = {}
  * 
  *   cdef UINT label = 0             # <<<<<<<<<<<<<<
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)
  *   cdef float px, py
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":580
+  /* "ext/skeletontricks/skeletontricks.pyx":624
  * 
  *   cdef UINT label = 0
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)             # <<<<<<<<<<<<<<
  *   cdef float px, py
  *   cdef float centx, centy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_7 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_7)) {
@@ -57886,425 +59099,425 @@
   #endif
   {
     PyObject *__pyx_callargs[4] = {__pyx_t_7, ((PyObject *)__pyx_v_cc_labels), __pyx_t_4, __pyx_t_6};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 580, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 624, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
-  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 580, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 624, __pyx_L1_error)
   __pyx_v_centroids = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":584
+  /* "ext/skeletontricks/skeletontricks.pyx":628
  *   cdef float centx, centy
  * 
  *   for y in range(sy):             # <<<<<<<<<<<<<<
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  */
   __pyx_t_8 = __pyx_v_sy;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_y = __pyx_t_10;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":585
+    /* "ext/skeletontricks/skeletontricks.pyx":629
  * 
  *   for y in range(sy):
  *     for x in range(sx):             # <<<<<<<<<<<<<<
  *       label = cc_labels[x,y]
  *       if label == 0:
  */
     __pyx_t_11 = __pyx_v_sx;
     __pyx_t_12 = __pyx_t_11;
     for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
       __pyx_v_x = __pyx_t_13;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":586
+      /* "ext/skeletontricks/skeletontricks.pyx":630
  *   for y in range(sy):
  *     for x in range(sx):
  *       label = cc_labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 586, __pyx_L1_error)
+        __PYX_ERR(0, 630, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(uint8_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_cc_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":587
+      /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       __pyx_t_16 = (__pyx_v_label == 0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":588
+        /* "ext/skeletontricks/skeletontricks.pyx":632
  *       label = cc_labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] == 0:
  *         continue
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":587
+        /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":589
+      /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       __pyx_t_15 = __pyx_v_x;
       __pyx_t_14 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 589, __pyx_L1_error)
+        __PYX_ERR(0, 633, __pyx_L1_error)
       }
       __pyx_t_16 = ((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides)) == 0.0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":590
+        /* "ext/skeletontricks/skeletontricks.pyx":634
  *         continue
  *       elif dt[x,y] == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":589
+        /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":591
+      /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 591, __pyx_L1_error)
+        __PYX_ERR(0, 635, __pyx_L1_error)
       }
-      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint8_t, 0, __Pyx_PyInt_From_uint8_t, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint8_t, 0, __Pyx_PyInt_From_uint8_t, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":592
+        /* "ext/skeletontricks/skeletontricks.pyx":636
  *         continue
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]             # <<<<<<<<<<<<<<
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  */
         __pyx_t_15 = __pyx_v_x;
         __pyx_t_14 = __pyx_v_y;
         __pyx_t_5 = -1;
         if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
         if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
         if (unlikely(__pyx_t_5 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_5);
-          __PYX_ERR(0, 592, __pyx_L1_error)
+          __PYX_ERR(0, 636, __pyx_L1_error)
         }
-        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 592, __pyx_L1_error)
+        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, uint8_t, 0, __Pyx_PyInt_From_uint8_t, 0, 0, 1) < 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, uint8_t, 0, __Pyx_PyInt_From_uint8_t, 0, 0, 1) < 0))) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":593
+        /* "ext/skeletontricks/skeletontricks.pyx":637
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)             # <<<<<<<<<<<<<<
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  */
-        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_GIVEREF(__pyx_t_6);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error);
         __Pyx_GIVEREF(__pyx_t_3);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error);
         __pyx_t_6 = 0;
         __pyx_t_3 = 0;
-        __pyx_t_3 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 593, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":591
+        /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
         goto __pyx_L7;
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":594
+      /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
-      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint8_t, 0, __Pyx_PyInt_From_uint8_t, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint8_t, 0, __Pyx_PyInt_From_uint8_t, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 594, __pyx_L1_error)
+        __PYX_ERR(0, 638, __pyx_L1_error)
       }
-      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":595
+        /* "ext/skeletontricks/skeletontricks.pyx":639
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]             # <<<<<<<<<<<<<<
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  */
-        __pyx_t_6 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
           PyObject* sequence = __pyx_t_3;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 595, __pyx_L1_error)
+            __PYX_ERR(0, 639, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_INCREF(__pyx_t_2);
           #else
-          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           #endif
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
           index = 1; __pyx_t_2 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_2);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 595, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L9_unpacking_done;
           __pyx_L8_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 595, __pyx_L1_error)
+          __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_L9_unpacking_done:;
         }
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_v_px = __pyx_t_18;
         __pyx_v_py = __pyx_t_19;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":596
+        /* "ext/skeletontricks/skeletontricks.pyx":640
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  *         centx, centy = centroids[label]             # <<<<<<<<<<<<<<
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  */
         if (unlikely(__pyx_v_centroids == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
         }
-        __pyx_t_3 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
           PyObject* sequence = __pyx_t_2;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 596, __pyx_L1_error)
+            __PYX_ERR(0, 640, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_3);
           __Pyx_INCREF(__pyx_t_6);
           #else
-          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_3 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_3);
           index = 1; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 596, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L11_unpacking_done;
           __pyx_L10_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_L11_unpacking_done:;
         }
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_centx = __pyx_t_19;
         __pyx_v_centy = __pyx_t_18;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":598
+        /* "ext/skeletontricks/skeletontricks.pyx":642
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,             # <<<<<<<<<<<<<<
  *           centx, centy,
  *           sx, sy, wx, wy
  */
-        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_20);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":599
+        /* "ext/skeletontricks/skeletontricks.pyx":643
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  *           centx, centy,             # <<<<<<<<<<<<<<
  *           sx, sy, wx, wy
  *         )
  */
-        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_21);
-        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_22);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":600
+        /* "ext/skeletontricks/skeletontricks.pyx":644
  *           px, py, x, y,
  *           centx, centy,
  *           sx, sy, wx, wy             # <<<<<<<<<<<<<<
  *         )
  * 
  */
-        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_23);
-        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_24);
-        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_25);
-        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_26);
         __pyx_t_27 = NULL;
         __pyx_t_5 = 0;
         #if CYTHON_UNPACK_METHODS
         if (unlikely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_27 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_27)) {
@@ -58326,63 +59539,63 @@
           __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
           __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
           __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
           __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
           __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
           __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
           __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
-          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 597, __pyx_L1_error)
+          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 641, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __pyx_t_6 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 597, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":594
+        /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
       }
       __pyx_L7:;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":603
+  /* "ext/skeletontricks/skeletontricks.pyx":647
  *         )
  * 
  *   return pts             # <<<<<<<<<<<<<<
  * 
  * def compute_tiebreaker_maxima(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_pts);
   __pyx_r = __pyx_v_pts;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":540
+  /* "ext/skeletontricks/skeletontricks.pyx":589
  *   return result
  * 
- * def find_border_targets(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def find_border_targets(
  *     cnp.ndarray[float, ndim=2] dt,
- *     cnp.ndarray[UINT, ndim=2] cc_labels,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
@@ -58415,17 +59628,17 @@
   __Pyx_XDECREF(__pyx_v_centroids);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_163find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_163find_border_targets = {"__pyx_fuse_1find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_163find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24find_border_targets};
-static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_163find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_165find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_165find_border_targets = {"__pyx_fuse_1find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_165find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_26find_border_targets};
+static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_165find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_dt = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[4] = {0,0,0,0};
@@ -58460,83 +59673,83 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_dt)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 589, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 540, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 589, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 4)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
       values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
     }
     __pyx_v_dt = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 540, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 589, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_border_targets", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 541, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 542, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_162find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_164find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -58545,15 +59758,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_162find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_164find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   PyObject *__pyx_v_mx = NULL;
   PyObject *__pyx_v_pts = NULL;
   uint16_t __pyx_v_label;
@@ -58605,51 +59818,51 @@
   __pyx_pybuffernd_dt.rcbuffer = &__pyx_pybuffer_dt;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_dt.diminfo[0].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dt.diminfo[0].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_dt.diminfo[1].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_dt.diminfo[1].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":571
+  /* "ext/skeletontricks/skeletontricks.pyx":615
  *   """
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]             # <<<<<<<<<<<<<<
  *   sy = dt.shape[1]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 615, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":572
+  /* "ext/skeletontricks/skeletontricks.pyx":616
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]
  *   sy = dt.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 616, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":576
+  /* "ext/skeletontricks/skeletontricks.pyx":620
  *   cdef size_t x, y
  * 
  *   mx = defaultdict(float)             # <<<<<<<<<<<<<<
  *   pts = {}
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 576, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 620, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
@@ -58661,54 +59874,54 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_4, ((PyObject *)(&PyFloat_Type))};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 576, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __pyx_v_mx = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":577
+  /* "ext/skeletontricks/skeletontricks.pyx":621
  * 
  *   mx = defaultdict(float)
  *   pts = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT label = 0
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 577, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 621, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_pts = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":579
+  /* "ext/skeletontricks/skeletontricks.pyx":623
  *   pts = {}
  * 
  *   cdef UINT label = 0             # <<<<<<<<<<<<<<
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)
  *   cdef float px, py
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":580
+  /* "ext/skeletontricks/skeletontricks.pyx":624
  * 
  *   cdef UINT label = 0
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)             # <<<<<<<<<<<<<<
  *   cdef float px, py
  *   cdef float centx, centy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_7 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_7)) {
@@ -58722,425 +59935,425 @@
   #endif
   {
     PyObject *__pyx_callargs[4] = {__pyx_t_7, ((PyObject *)__pyx_v_cc_labels), __pyx_t_4, __pyx_t_6};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 580, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 624, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
-  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 580, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 624, __pyx_L1_error)
   __pyx_v_centroids = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":584
+  /* "ext/skeletontricks/skeletontricks.pyx":628
  *   cdef float centx, centy
  * 
  *   for y in range(sy):             # <<<<<<<<<<<<<<
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  */
   __pyx_t_8 = __pyx_v_sy;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_y = __pyx_t_10;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":585
+    /* "ext/skeletontricks/skeletontricks.pyx":629
  * 
  *   for y in range(sy):
  *     for x in range(sx):             # <<<<<<<<<<<<<<
  *       label = cc_labels[x,y]
  *       if label == 0:
  */
     __pyx_t_11 = __pyx_v_sx;
     __pyx_t_12 = __pyx_t_11;
     for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
       __pyx_v_x = __pyx_t_13;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":586
+      /* "ext/skeletontricks/skeletontricks.pyx":630
  *   for y in range(sy):
  *     for x in range(sx):
  *       label = cc_labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 586, __pyx_L1_error)
+        __PYX_ERR(0, 630, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(uint16_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_cc_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":587
+      /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       __pyx_t_16 = (__pyx_v_label == 0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":588
+        /* "ext/skeletontricks/skeletontricks.pyx":632
  *       label = cc_labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] == 0:
  *         continue
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":587
+        /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":589
+      /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       __pyx_t_15 = __pyx_v_x;
       __pyx_t_14 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 589, __pyx_L1_error)
+        __PYX_ERR(0, 633, __pyx_L1_error)
       }
       __pyx_t_16 = ((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides)) == 0.0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":590
+        /* "ext/skeletontricks/skeletontricks.pyx":634
  *         continue
  *       elif dt[x,y] == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":589
+        /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":591
+      /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 591, __pyx_L1_error)
+        __PYX_ERR(0, 635, __pyx_L1_error)
       }
-      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint16_t, 0, __Pyx_PyInt_From_uint16_t, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint16_t, 0, __Pyx_PyInt_From_uint16_t, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":592
+        /* "ext/skeletontricks/skeletontricks.pyx":636
  *         continue
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]             # <<<<<<<<<<<<<<
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  */
         __pyx_t_15 = __pyx_v_x;
         __pyx_t_14 = __pyx_v_y;
         __pyx_t_5 = -1;
         if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
         if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
         if (unlikely(__pyx_t_5 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_5);
-          __PYX_ERR(0, 592, __pyx_L1_error)
+          __PYX_ERR(0, 636, __pyx_L1_error)
         }
-        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 592, __pyx_L1_error)
+        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, uint16_t, 0, __Pyx_PyInt_From_uint16_t, 0, 0, 1) < 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, uint16_t, 0, __Pyx_PyInt_From_uint16_t, 0, 0, 1) < 0))) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":593
+        /* "ext/skeletontricks/skeletontricks.pyx":637
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)             # <<<<<<<<<<<<<<
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  */
-        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_GIVEREF(__pyx_t_6);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error);
         __Pyx_GIVEREF(__pyx_t_3);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error);
         __pyx_t_6 = 0;
         __pyx_t_3 = 0;
-        __pyx_t_3 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 593, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":591
+        /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
         goto __pyx_L7;
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":594
+      /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
-      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint16_t, 0, __Pyx_PyInt_From_uint16_t, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint16_t, 0, __Pyx_PyInt_From_uint16_t, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 594, __pyx_L1_error)
+        __PYX_ERR(0, 638, __pyx_L1_error)
       }
-      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":595
+        /* "ext/skeletontricks/skeletontricks.pyx":639
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]             # <<<<<<<<<<<<<<
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  */
-        __pyx_t_6 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
           PyObject* sequence = __pyx_t_3;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 595, __pyx_L1_error)
+            __PYX_ERR(0, 639, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_INCREF(__pyx_t_2);
           #else
-          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           #endif
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
           index = 1; __pyx_t_2 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_2);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 595, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L9_unpacking_done;
           __pyx_L8_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 595, __pyx_L1_error)
+          __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_L9_unpacking_done:;
         }
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_v_px = __pyx_t_18;
         __pyx_v_py = __pyx_t_19;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":596
+        /* "ext/skeletontricks/skeletontricks.pyx":640
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  *         centx, centy = centroids[label]             # <<<<<<<<<<<<<<
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  */
         if (unlikely(__pyx_v_centroids == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
         }
-        __pyx_t_3 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
           PyObject* sequence = __pyx_t_2;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 596, __pyx_L1_error)
+            __PYX_ERR(0, 640, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_3);
           __Pyx_INCREF(__pyx_t_6);
           #else
-          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_3 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_3);
           index = 1; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 596, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L11_unpacking_done;
           __pyx_L10_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_L11_unpacking_done:;
         }
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_centx = __pyx_t_19;
         __pyx_v_centy = __pyx_t_18;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":598
+        /* "ext/skeletontricks/skeletontricks.pyx":642
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,             # <<<<<<<<<<<<<<
  *           centx, centy,
  *           sx, sy, wx, wy
  */
-        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_20);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":599
+        /* "ext/skeletontricks/skeletontricks.pyx":643
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  *           centx, centy,             # <<<<<<<<<<<<<<
  *           sx, sy, wx, wy
  *         )
  */
-        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_21);
-        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_22);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":600
+        /* "ext/skeletontricks/skeletontricks.pyx":644
  *           px, py, x, y,
  *           centx, centy,
  *           sx, sy, wx, wy             # <<<<<<<<<<<<<<
  *         )
  * 
  */
-        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_23);
-        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_24);
-        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_25);
-        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_26);
         __pyx_t_27 = NULL;
         __pyx_t_5 = 0;
         #if CYTHON_UNPACK_METHODS
         if (unlikely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_27 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_27)) {
@@ -59162,63 +60375,63 @@
           __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
           __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
           __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
           __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
           __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
           __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
           __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
-          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 597, __pyx_L1_error)
+          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 641, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __pyx_t_6 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 597, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":594
+        /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
       }
       __pyx_L7:;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":603
+  /* "ext/skeletontricks/skeletontricks.pyx":647
  *         )
  * 
  *   return pts             # <<<<<<<<<<<<<<
  * 
  * def compute_tiebreaker_maxima(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_pts);
   __pyx_r = __pyx_v_pts;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":540
+  /* "ext/skeletontricks/skeletontricks.pyx":589
  *   return result
  * 
- * def find_border_targets(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def find_border_targets(
  *     cnp.ndarray[float, ndim=2] dt,
- *     cnp.ndarray[UINT, ndim=2] cc_labels,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
@@ -59251,17 +60464,17 @@
   __Pyx_XDECREF(__pyx_v_centroids);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_165find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_165find_border_targets = {"__pyx_fuse_2find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_165find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24find_border_targets};
-static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_165find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_167find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_167find_border_targets = {"__pyx_fuse_2find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_167find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_26find_border_targets};
+static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_167find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_dt = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[4] = {0,0,0,0};
@@ -59296,83 +60509,83 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_dt)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 589, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 540, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 589, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 4)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
       values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
     }
     __pyx_v_dt = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 540, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 589, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_border_targets", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 541, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 542, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_164find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_166find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -59381,15 +60594,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_164find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_166find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   PyObject *__pyx_v_mx = NULL;
   PyObject *__pyx_v_pts = NULL;
   uint32_t __pyx_v_label;
@@ -59441,51 +60654,51 @@
   __pyx_pybuffernd_dt.rcbuffer = &__pyx_pybuffer_dt;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_dt.diminfo[0].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dt.diminfo[0].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_dt.diminfo[1].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_dt.diminfo[1].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":571
+  /* "ext/skeletontricks/skeletontricks.pyx":615
  *   """
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]             # <<<<<<<<<<<<<<
  *   sy = dt.shape[1]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 615, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":572
+  /* "ext/skeletontricks/skeletontricks.pyx":616
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]
  *   sy = dt.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 616, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":576
+  /* "ext/skeletontricks/skeletontricks.pyx":620
  *   cdef size_t x, y
  * 
  *   mx = defaultdict(float)             # <<<<<<<<<<<<<<
  *   pts = {}
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 576, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 620, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
@@ -59497,54 +60710,54 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_4, ((PyObject *)(&PyFloat_Type))};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 576, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __pyx_v_mx = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":577
+  /* "ext/skeletontricks/skeletontricks.pyx":621
  * 
  *   mx = defaultdict(float)
  *   pts = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT label = 0
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 577, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 621, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_pts = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":579
+  /* "ext/skeletontricks/skeletontricks.pyx":623
  *   pts = {}
  * 
  *   cdef UINT label = 0             # <<<<<<<<<<<<<<
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)
  *   cdef float px, py
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":580
+  /* "ext/skeletontricks/skeletontricks.pyx":624
  * 
  *   cdef UINT label = 0
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)             # <<<<<<<<<<<<<<
  *   cdef float px, py
  *   cdef float centx, centy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_7 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_7)) {
@@ -59558,425 +60771,425 @@
   #endif
   {
     PyObject *__pyx_callargs[4] = {__pyx_t_7, ((PyObject *)__pyx_v_cc_labels), __pyx_t_4, __pyx_t_6};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 580, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 624, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
-  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 580, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 624, __pyx_L1_error)
   __pyx_v_centroids = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":584
+  /* "ext/skeletontricks/skeletontricks.pyx":628
  *   cdef float centx, centy
  * 
  *   for y in range(sy):             # <<<<<<<<<<<<<<
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  */
   __pyx_t_8 = __pyx_v_sy;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_y = __pyx_t_10;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":585
+    /* "ext/skeletontricks/skeletontricks.pyx":629
  * 
  *   for y in range(sy):
  *     for x in range(sx):             # <<<<<<<<<<<<<<
  *       label = cc_labels[x,y]
  *       if label == 0:
  */
     __pyx_t_11 = __pyx_v_sx;
     __pyx_t_12 = __pyx_t_11;
     for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
       __pyx_v_x = __pyx_t_13;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":586
+      /* "ext/skeletontricks/skeletontricks.pyx":630
  *   for y in range(sy):
  *     for x in range(sx):
  *       label = cc_labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 586, __pyx_L1_error)
+        __PYX_ERR(0, 630, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(uint32_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_cc_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":587
+      /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       __pyx_t_16 = (__pyx_v_label == 0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":588
+        /* "ext/skeletontricks/skeletontricks.pyx":632
  *       label = cc_labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] == 0:
  *         continue
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":587
+        /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":589
+      /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       __pyx_t_15 = __pyx_v_x;
       __pyx_t_14 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 589, __pyx_L1_error)
+        __PYX_ERR(0, 633, __pyx_L1_error)
       }
       __pyx_t_16 = ((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides)) == 0.0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":590
+        /* "ext/skeletontricks/skeletontricks.pyx":634
  *         continue
  *       elif dt[x,y] == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":589
+        /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":591
+      /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 591, __pyx_L1_error)
+        __PYX_ERR(0, 635, __pyx_L1_error)
       }
-      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint32_t, 0, __Pyx_PyInt_From_uint32_t, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint32_t, 0, __Pyx_PyInt_From_uint32_t, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":592
+        /* "ext/skeletontricks/skeletontricks.pyx":636
  *         continue
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]             # <<<<<<<<<<<<<<
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  */
         __pyx_t_15 = __pyx_v_x;
         __pyx_t_14 = __pyx_v_y;
         __pyx_t_5 = -1;
         if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
         if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
         if (unlikely(__pyx_t_5 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_5);
-          __PYX_ERR(0, 592, __pyx_L1_error)
+          __PYX_ERR(0, 636, __pyx_L1_error)
         }
-        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 592, __pyx_L1_error)
+        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, uint32_t, 0, __Pyx_PyInt_From_uint32_t, 0, 0, 1) < 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, uint32_t, 0, __Pyx_PyInt_From_uint32_t, 0, 0, 1) < 0))) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":593
+        /* "ext/skeletontricks/skeletontricks.pyx":637
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)             # <<<<<<<<<<<<<<
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  */
-        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_GIVEREF(__pyx_t_6);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error);
         __Pyx_GIVEREF(__pyx_t_3);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error);
         __pyx_t_6 = 0;
         __pyx_t_3 = 0;
-        __pyx_t_3 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 593, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":591
+        /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
         goto __pyx_L7;
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":594
+      /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
-      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint32_t, 0, __Pyx_PyInt_From_uint32_t, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint32_t, 0, __Pyx_PyInt_From_uint32_t, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 594, __pyx_L1_error)
+        __PYX_ERR(0, 638, __pyx_L1_error)
       }
-      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":595
+        /* "ext/skeletontricks/skeletontricks.pyx":639
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]             # <<<<<<<<<<<<<<
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  */
-        __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
           PyObject* sequence = __pyx_t_3;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 595, __pyx_L1_error)
+            __PYX_ERR(0, 639, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_INCREF(__pyx_t_2);
           #else
-          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           #endif
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
           index = 1; __pyx_t_2 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_2);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 595, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L9_unpacking_done;
           __pyx_L8_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 595, __pyx_L1_error)
+          __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_L9_unpacking_done:;
         }
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_v_px = __pyx_t_18;
         __pyx_v_py = __pyx_t_19;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":596
+        /* "ext/skeletontricks/skeletontricks.pyx":640
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  *         centx, centy = centroids[label]             # <<<<<<<<<<<<<<
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  */
         if (unlikely(__pyx_v_centroids == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
         }
-        __pyx_t_3 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
           PyObject* sequence = __pyx_t_2;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 596, __pyx_L1_error)
+            __PYX_ERR(0, 640, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_3);
           __Pyx_INCREF(__pyx_t_6);
           #else
-          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_3 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_3);
           index = 1; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 596, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L11_unpacking_done;
           __pyx_L10_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_L11_unpacking_done:;
         }
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_centx = __pyx_t_19;
         __pyx_v_centy = __pyx_t_18;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":598
+        /* "ext/skeletontricks/skeletontricks.pyx":642
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,             # <<<<<<<<<<<<<<
  *           centx, centy,
  *           sx, sy, wx, wy
  */
-        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_20);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":599
+        /* "ext/skeletontricks/skeletontricks.pyx":643
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  *           centx, centy,             # <<<<<<<<<<<<<<
  *           sx, sy, wx, wy
  *         )
  */
-        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_21);
-        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_22);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":600
+        /* "ext/skeletontricks/skeletontricks.pyx":644
  *           px, py, x, y,
  *           centx, centy,
  *           sx, sy, wx, wy             # <<<<<<<<<<<<<<
  *         )
  * 
  */
-        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_23);
-        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_24);
-        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_25);
-        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_26);
         __pyx_t_27 = NULL;
         __pyx_t_5 = 0;
         #if CYTHON_UNPACK_METHODS
         if (unlikely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_27 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_27)) {
@@ -59998,63 +61211,63 @@
           __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
           __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
           __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
           __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
           __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
           __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
           __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
-          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 597, __pyx_L1_error)
+          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 641, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 597, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":594
+        /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
       }
       __pyx_L7:;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":603
+  /* "ext/skeletontricks/skeletontricks.pyx":647
  *         )
  * 
  *   return pts             # <<<<<<<<<<<<<<
  * 
  * def compute_tiebreaker_maxima(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_pts);
   __pyx_r = __pyx_v_pts;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":540
+  /* "ext/skeletontricks/skeletontricks.pyx":589
  *   return result
  * 
- * def find_border_targets(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def find_border_targets(
  *     cnp.ndarray[float, ndim=2] dt,
- *     cnp.ndarray[UINT, ndim=2] cc_labels,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
@@ -60087,17 +61300,17 @@
   __Pyx_XDECREF(__pyx_v_centroids);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_167find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_167find_border_targets = {"__pyx_fuse_3find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_167find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24find_border_targets};
-static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_167find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_169find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_169find_border_targets = {"__pyx_fuse_3find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_169find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_26find_border_targets};
+static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_169find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_dt = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[4] = {0,0,0,0};
@@ -60132,83 +61345,83 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_dt)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 589, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 540, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 589, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 4)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
       values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
     }
     __pyx_v_dt = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 540, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 589, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_border_targets", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 541, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 542, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_166find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_168find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -60217,15 +61430,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_166find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_168find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   PyObject *__pyx_v_mx = NULL;
   PyObject *__pyx_v_pts = NULL;
   uint64_t __pyx_v_label;
@@ -60277,51 +61490,51 @@
   __pyx_pybuffernd_dt.rcbuffer = &__pyx_pybuffer_dt;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_dt.diminfo[0].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dt.diminfo[0].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_dt.diminfo[1].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_dt.diminfo[1].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":571
+  /* "ext/skeletontricks/skeletontricks.pyx":615
  *   """
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]             # <<<<<<<<<<<<<<
  *   sy = dt.shape[1]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 615, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":572
+  /* "ext/skeletontricks/skeletontricks.pyx":616
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]
  *   sy = dt.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 616, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":576
+  /* "ext/skeletontricks/skeletontricks.pyx":620
  *   cdef size_t x, y
  * 
  *   mx = defaultdict(float)             # <<<<<<<<<<<<<<
  *   pts = {}
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 576, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 620, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
@@ -60333,54 +61546,54 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_4, ((PyObject *)(&PyFloat_Type))};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 576, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __pyx_v_mx = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":577
+  /* "ext/skeletontricks/skeletontricks.pyx":621
  * 
  *   mx = defaultdict(float)
  *   pts = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT label = 0
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 577, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 621, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_pts = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":579
+  /* "ext/skeletontricks/skeletontricks.pyx":623
  *   pts = {}
  * 
  *   cdef UINT label = 0             # <<<<<<<<<<<<<<
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)
  *   cdef float px, py
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":580
+  /* "ext/skeletontricks/skeletontricks.pyx":624
  * 
  *   cdef UINT label = 0
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)             # <<<<<<<<<<<<<<
  *   cdef float px, py
  *   cdef float centx, centy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_7 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_7)) {
@@ -60394,425 +61607,425 @@
   #endif
   {
     PyObject *__pyx_callargs[4] = {__pyx_t_7, ((PyObject *)__pyx_v_cc_labels), __pyx_t_4, __pyx_t_6};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 580, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 624, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
-  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 580, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 624, __pyx_L1_error)
   __pyx_v_centroids = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":584
+  /* "ext/skeletontricks/skeletontricks.pyx":628
  *   cdef float centx, centy
  * 
  *   for y in range(sy):             # <<<<<<<<<<<<<<
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  */
   __pyx_t_8 = __pyx_v_sy;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_y = __pyx_t_10;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":585
+    /* "ext/skeletontricks/skeletontricks.pyx":629
  * 
  *   for y in range(sy):
  *     for x in range(sx):             # <<<<<<<<<<<<<<
  *       label = cc_labels[x,y]
  *       if label == 0:
  */
     __pyx_t_11 = __pyx_v_sx;
     __pyx_t_12 = __pyx_t_11;
     for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
       __pyx_v_x = __pyx_t_13;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":586
+      /* "ext/skeletontricks/skeletontricks.pyx":630
  *   for y in range(sy):
  *     for x in range(sx):
  *       label = cc_labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 586, __pyx_L1_error)
+        __PYX_ERR(0, 630, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(uint64_t *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_cc_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":587
+      /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       __pyx_t_16 = (__pyx_v_label == 0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":588
+        /* "ext/skeletontricks/skeletontricks.pyx":632
  *       label = cc_labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] == 0:
  *         continue
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":587
+        /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":589
+      /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       __pyx_t_15 = __pyx_v_x;
       __pyx_t_14 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 589, __pyx_L1_error)
+        __PYX_ERR(0, 633, __pyx_L1_error)
       }
       __pyx_t_16 = ((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides)) == 0.0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":590
+        /* "ext/skeletontricks/skeletontricks.pyx":634
  *         continue
  *       elif dt[x,y] == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":589
+        /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":591
+      /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 591, __pyx_L1_error)
+        __PYX_ERR(0, 635, __pyx_L1_error)
       }
-      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint64_t, 0, __Pyx_PyInt_From_uint64_t, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint64_t, 0, __Pyx_PyInt_From_uint64_t, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":592
+        /* "ext/skeletontricks/skeletontricks.pyx":636
  *         continue
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]             # <<<<<<<<<<<<<<
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  */
         __pyx_t_15 = __pyx_v_x;
         __pyx_t_14 = __pyx_v_y;
         __pyx_t_5 = -1;
         if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
         if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
         if (unlikely(__pyx_t_5 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_5);
-          __PYX_ERR(0, 592, __pyx_L1_error)
+          __PYX_ERR(0, 636, __pyx_L1_error)
         }
-        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 592, __pyx_L1_error)
+        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, uint64_t, 0, __Pyx_PyInt_From_uint64_t, 0, 0, 1) < 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, uint64_t, 0, __Pyx_PyInt_From_uint64_t, 0, 0, 1) < 0))) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":593
+        /* "ext/skeletontricks/skeletontricks.pyx":637
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)             # <<<<<<<<<<<<<<
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  */
-        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_GIVEREF(__pyx_t_6);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error);
         __Pyx_GIVEREF(__pyx_t_3);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error);
         __pyx_t_6 = 0;
         __pyx_t_3 = 0;
-        __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 593, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":591
+        /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
         goto __pyx_L7;
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":594
+      /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
-      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint64_t, 0, __Pyx_PyInt_From_uint64_t, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, uint64_t, 0, __Pyx_PyInt_From_uint64_t, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 594, __pyx_L1_error)
+        __PYX_ERR(0, 638, __pyx_L1_error)
       }
-      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":595
+        /* "ext/skeletontricks/skeletontricks.pyx":639
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]             # <<<<<<<<<<<<<<
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  */
-        __pyx_t_6 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
           PyObject* sequence = __pyx_t_3;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 595, __pyx_L1_error)
+            __PYX_ERR(0, 639, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_INCREF(__pyx_t_2);
           #else
-          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           #endif
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
           index = 1; __pyx_t_2 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_2);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 595, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L9_unpacking_done;
           __pyx_L8_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 595, __pyx_L1_error)
+          __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_L9_unpacking_done:;
         }
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_v_px = __pyx_t_18;
         __pyx_v_py = __pyx_t_19;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":596
+        /* "ext/skeletontricks/skeletontricks.pyx":640
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  *         centx, centy = centroids[label]             # <<<<<<<<<<<<<<
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  */
         if (unlikely(__pyx_v_centroids == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
         }
-        __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
           PyObject* sequence = __pyx_t_2;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 596, __pyx_L1_error)
+            __PYX_ERR(0, 640, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_3);
           __Pyx_INCREF(__pyx_t_6);
           #else
-          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_3 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_3);
           index = 1; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 596, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L11_unpacking_done;
           __pyx_L10_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_L11_unpacking_done:;
         }
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_centx = __pyx_t_19;
         __pyx_v_centy = __pyx_t_18;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":598
+        /* "ext/skeletontricks/skeletontricks.pyx":642
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,             # <<<<<<<<<<<<<<
  *           centx, centy,
  *           sx, sy, wx, wy
  */
-        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_20);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":599
+        /* "ext/skeletontricks/skeletontricks.pyx":643
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  *           centx, centy,             # <<<<<<<<<<<<<<
  *           sx, sy, wx, wy
  *         )
  */
-        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_21);
-        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_22);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":600
+        /* "ext/skeletontricks/skeletontricks.pyx":644
  *           px, py, x, y,
  *           centx, centy,
  *           sx, sy, wx, wy             # <<<<<<<<<<<<<<
  *         )
  * 
  */
-        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_23);
-        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_24);
-        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_25);
-        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_26);
         __pyx_t_27 = NULL;
         __pyx_t_5 = 0;
         #if CYTHON_UNPACK_METHODS
         if (unlikely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_27 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_27)) {
@@ -60834,63 +62047,63 @@
           __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
           __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
           __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
           __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
           __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
           __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
           __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
-          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 597, __pyx_L1_error)
+          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 641, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __pyx_t_6 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 597, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":594
+        /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
       }
       __pyx_L7:;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":603
+  /* "ext/skeletontricks/skeletontricks.pyx":647
  *         )
  * 
  *   return pts             # <<<<<<<<<<<<<<
  * 
  * def compute_tiebreaker_maxima(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_pts);
   __pyx_r = __pyx_v_pts;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":540
+  /* "ext/skeletontricks/skeletontricks.pyx":589
  *   return result
  * 
- * def find_border_targets(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def find_border_targets(
  *     cnp.ndarray[float, ndim=2] dt,
- *     cnp.ndarray[UINT, ndim=2] cc_labels,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
@@ -60923,17 +62136,17 @@
   __Pyx_XDECREF(__pyx_v_centroids);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_169find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_169find_border_targets = {"__pyx_fuse_4find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_169find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_24find_border_targets};
-static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_169find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_171find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_171find_border_targets = {"__pyx_fuse_4find_border_targets", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_171find_border_targets, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_26find_border_targets};
+static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_171find_border_targets(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_dt = 0;
   PyArrayObject *__pyx_v_cc_labels = 0;
   float __pyx_v_wx;
   float __pyx_v_wy;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
   PyObject* values[4] = {0,0,0,0};
@@ -60968,83 +62181,83 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_dt)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cc_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 1); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 2); __PYX_ERR(0, 589, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 540, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 589, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 540, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, 3); __PYX_ERR(0, 589, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 540, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_border_targets") < 0)) __PYX_ERR(0, 589, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 4)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
       values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
       values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
       values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
     }
     __pyx_v_dt = ((PyArrayObject *)values[0]);
     __pyx_v_cc_labels = ((PyArrayObject *)values[1]);
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 593, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 540, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_border_targets", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 589, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_border_targets", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 541, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 542, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_168find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_dt), __pyx_ptype_5numpy_ndarray, 1, "dt", 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_cc_labels), __pyx_ptype_5numpy_ndarray, 1, "cc_labels", 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_170find_border_targets(__pyx_self, __pyx_v_dt, __pyx_v_cc_labels, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -61053,15 +62266,15 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_168find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_170find_border_targets(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_dt, PyArrayObject *__pyx_v_cc_labels, float __pyx_v_wx, float __pyx_v_wy) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   PyObject *__pyx_v_mx = NULL;
   PyObject *__pyx_v_pts = NULL;
   unsigned char __pyx_v_label;
@@ -61113,51 +62326,51 @@
   __pyx_pybuffernd_dt.rcbuffer = &__pyx_pybuffer_dt;
   __pyx_pybuffer_cc_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_cc_labels.refcount = 0;
   __pyx_pybuffernd_cc_labels.data = NULL;
   __pyx_pybuffernd_cc_labels.rcbuffer = &__pyx_pybuffer_cc_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_dt.rcbuffer->pybuffer, (PyObject*)__pyx_v_dt, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_dt.diminfo[0].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_dt.diminfo[0].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_dt.diminfo[1].strides = __pyx_pybuffernd_dt.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_dt.diminfo[1].shape = __pyx_pybuffernd_dt.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 540, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_cc_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_cc_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 589, __pyx_L1_error)
   }
   __pyx_pybuffernd_cc_labels.diminfo[0].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_cc_labels.diminfo[0].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_cc_labels.diminfo[1].strides = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_cc_labels.diminfo[1].shape = __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":571
+  /* "ext/skeletontricks/skeletontricks.pyx":615
  *   """
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]             # <<<<<<<<<<<<<<
  *   sy = dt.shape[1]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 615, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":572
+  /* "ext/skeletontricks/skeletontricks.pyx":616
  *   cdef size_t sx, sy
  *   sx = dt.shape[0]
  *   sy = dt.shape[1]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t x, y
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_dt)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 616, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":576
+  /* "ext/skeletontricks/skeletontricks.pyx":620
  *   cdef size_t x, y
  * 
  *   mx = defaultdict(float)             # <<<<<<<<<<<<<<
  *   pts = {}
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 576, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 620, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
@@ -61169,54 +62382,54 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_4, ((PyObject *)(&PyFloat_Type))};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 576, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 620, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __pyx_v_mx = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":577
+  /* "ext/skeletontricks/skeletontricks.pyx":621
  * 
  *   mx = defaultdict(float)
  *   pts = {}             # <<<<<<<<<<<<<<
  * 
  *   cdef UINT label = 0
  */
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 577, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 621, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_pts = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":579
+  /* "ext/skeletontricks/skeletontricks.pyx":623
  *   pts = {}
  * 
  *   cdef UINT label = 0             # <<<<<<<<<<<<<<
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)
  *   cdef float px, py
  */
   __pyx_v_label = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":580
+  /* "ext/skeletontricks/skeletontricks.pyx":624
  * 
  *   cdef UINT label = 0
  *   cdef dict centroids = compute_centroids(cc_labels, wx, wy)             # <<<<<<<<<<<<<<
  *   cdef float px, py
  *   cdef float centx, centy
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_centroids); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __pyx_t_6 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 624, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_7 = NULL;
   __pyx_t_5 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_7)) {
@@ -61230,425 +62443,425 @@
   #endif
   {
     PyObject *__pyx_callargs[4] = {__pyx_t_7, ((PyObject *)__pyx_v_cc_labels), __pyx_t_4, __pyx_t_6};
     __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 580, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 624, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
-  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 580, __pyx_L1_error)
+  if (!(likely(PyDict_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_2))) __PYX_ERR(0, 624, __pyx_L1_error)
   __pyx_v_centroids = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":584
+  /* "ext/skeletontricks/skeletontricks.pyx":628
  *   cdef float centx, centy
  * 
  *   for y in range(sy):             # <<<<<<<<<<<<<<
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  */
   __pyx_t_8 = __pyx_v_sy;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_y = __pyx_t_10;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":585
+    /* "ext/skeletontricks/skeletontricks.pyx":629
  * 
  *   for y in range(sy):
  *     for x in range(sx):             # <<<<<<<<<<<<<<
  *       label = cc_labels[x,y]
  *       if label == 0:
  */
     __pyx_t_11 = __pyx_v_sx;
     __pyx_t_12 = __pyx_t_11;
     for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
       __pyx_v_x = __pyx_t_13;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":586
+      /* "ext/skeletontricks/skeletontricks.pyx":630
  *   for y in range(sy):
  *     for x in range(sx):
  *       label = cc_labels[x,y]             # <<<<<<<<<<<<<<
  *       if label == 0:
  *         continue
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_cc_labels.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 586, __pyx_L1_error)
+        __PYX_ERR(0, 630, __pyx_L1_error)
       }
       __pyx_v_label = (*__Pyx_BufPtrStrided2d(unsigned char *, __pyx_pybuffernd_cc_labels.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_cc_labels.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_cc_labels.diminfo[1].strides));
 
-      /* "ext/skeletontricks/skeletontricks.pyx":587
+      /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       __pyx_t_16 = (__pyx_v_label == 0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":588
+        /* "ext/skeletontricks/skeletontricks.pyx":632
  *       label = cc_labels[x,y]
  *       if label == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] == 0:
  *         continue
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":587
+        /* "ext/skeletontricks/skeletontricks.pyx":631
  *     for x in range(sx):
  *       label = cc_labels[x,y]
  *       if label == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] == 0:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":589
+      /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       __pyx_t_15 = __pyx_v_x;
       __pyx_t_14 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 589, __pyx_L1_error)
+        __PYX_ERR(0, 633, __pyx_L1_error)
       }
       __pyx_t_16 = ((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides)) == 0.0);
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":590
+        /* "ext/skeletontricks/skeletontricks.pyx":634
  *         continue
  *       elif dt[x,y] == 0:
  *         continue             # <<<<<<<<<<<<<<
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  */
         goto __pyx_L5_continue;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":589
+        /* "ext/skeletontricks/skeletontricks.pyx":633
  *       if label == 0:
  *         continue
  *       elif dt[x,y] == 0:             # <<<<<<<<<<<<<<
  *         continue
  *       elif dt[x,y] > mx[label]:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":591
+      /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 591, __pyx_L1_error)
+        __PYX_ERR(0, 635, __pyx_L1_error)
       }
-      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, unsigned char, 0, __Pyx_PyInt_From_unsigned_char, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, unsigned char, 0, __Pyx_PyInt_From_unsigned_char, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 591, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 635, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":592
+        /* "ext/skeletontricks/skeletontricks.pyx":636
  *         continue
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]             # <<<<<<<<<<<<<<
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  */
         __pyx_t_15 = __pyx_v_x;
         __pyx_t_14 = __pyx_v_y;
         __pyx_t_5 = -1;
         if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
         if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
         if (unlikely(__pyx_t_5 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_5);
-          __PYX_ERR(0, 592, __pyx_L1_error)
+          __PYX_ERR(0, 636, __pyx_L1_error)
         }
-        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 592, __pyx_L1_error)
+        __pyx_t_6 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, unsigned char, 0, __Pyx_PyInt_From_unsigned_char, 0, 0, 1) < 0))) __PYX_ERR(0, 592, __pyx_L1_error)
+        if (unlikely((__Pyx_SetItemInt(__pyx_v_mx, __pyx_v_label, __pyx_t_6, unsigned char, 0, __Pyx_PyInt_From_unsigned_char, 0, 0, 1) < 0))) __PYX_ERR(0, 636, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":593
+        /* "ext/skeletontricks/skeletontricks.pyx":637
  *       elif dt[x,y] > mx[label]:
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)             # <<<<<<<<<<<<<<
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  */
-        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_GIVEREF(__pyx_t_6);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6)) __PYX_ERR(0, 637, __pyx_L1_error);
         __Pyx_GIVEREF(__pyx_t_3);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error);
         __pyx_t_6 = 0;
         __pyx_t_3 = 0;
-        __pyx_t_3 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 593, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_3, __pyx_t_2) < 0))) __PYX_ERR(0, 637, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":591
+        /* "ext/skeletontricks/skeletontricks.pyx":635
  *       elif dt[x,y] == 0:
  *         continue
  *       elif dt[x,y] > mx[label]:             # <<<<<<<<<<<<<<
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  */
         goto __pyx_L7;
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":594
+      /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
-      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, unsigned char, 0, __Pyx_PyInt_From_unsigned_char, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_mx, __pyx_v_label, unsigned char, 0, __Pyx_PyInt_From_unsigned_char, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_14 = __pyx_v_x;
       __pyx_t_15 = __pyx_v_y;
       __pyx_t_5 = -1;
       if (unlikely(__pyx_t_14 >= (size_t)__pyx_pybuffernd_dt.diminfo[0].shape)) __pyx_t_5 = 0;
       if (unlikely(__pyx_t_15 >= (size_t)__pyx_pybuffernd_dt.diminfo[1].shape)) __pyx_t_5 = 1;
       if (unlikely(__pyx_t_5 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_5);
-        __PYX_ERR(0, 594, __pyx_L1_error)
+        __PYX_ERR(0, 638, __pyx_L1_error)
       }
-      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided2d(float *, __pyx_pybuffernd_dt.rcbuffer->pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_dt.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_dt.diminfo[1].strides))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 594, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 638, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":595
+        /* "ext/skeletontricks/skeletontricks.pyx":639
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]             # <<<<<<<<<<<<<<
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  */
-        __pyx_t_6 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_pts, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
           PyObject* sequence = __pyx_t_3;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 595, __pyx_L1_error)
+            __PYX_ERR(0, 639, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_INCREF(__pyx_t_2);
           #else
-          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           #endif
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 595, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 639, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
           index = 1; __pyx_t_2 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L8_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_2);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 595, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L9_unpacking_done;
           __pyx_L8_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 595, __pyx_L1_error)
+          __PYX_ERR(0, 639, __pyx_L1_error)
           __pyx_L9_unpacking_done:;
         }
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 595, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 639, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_v_px = __pyx_t_18;
         __pyx_v_py = __pyx_t_19;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":596
+        /* "ext/skeletontricks/skeletontricks.pyx":640
  *       elif mx[label] == dt[x,y]:
  *         px, py = pts[label]
  *         centx, centy = centroids[label]             # <<<<<<<<<<<<<<
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  */
         if (unlikely(__pyx_v_centroids == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
         }
-        __pyx_t_3 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyDict_GetItem(__pyx_v_centroids, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
           PyObject* sequence = __pyx_t_2;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 596, __pyx_L1_error)
+            __PYX_ERR(0, 640, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_3);
           __Pyx_INCREF(__pyx_t_6);
           #else
-          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 596, __pyx_L1_error)
+          __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 640, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
           __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
           index = 0; __pyx_t_3 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_3);
           index = 1; __pyx_t_6 = __pyx_t_17(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L10_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_6);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 596, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_4), 2) < 0) __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_t_17 = NULL;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           goto __pyx_L11_unpacking_done;
           __pyx_L10_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_17 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 596, __pyx_L1_error)
+          __PYX_ERR(0, 640, __pyx_L1_error)
           __pyx_L11_unpacking_done:;
         }
-        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_19 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_19 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 596, __pyx_L1_error)
+        __pyx_t_18 = __pyx_PyFloat_AsFloat(__pyx_t_6); if (unlikely((__pyx_t_18 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_centx = __pyx_t_19;
         __pyx_v_centy = __pyx_t_18;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_compute_tiebreaker_maxima); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":598
+        /* "ext/skeletontricks/skeletontricks.pyx":642
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,             # <<<<<<<<<<<<<<
  *           centx, centy,
  *           sx, sy, wx, wy
  */
-        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 598, __pyx_L1_error)
+        __pyx_t_20 = __Pyx_PyInt_FromSize_t(__pyx_v_y); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 642, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_20);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":599
+        /* "ext/skeletontricks/skeletontricks.pyx":643
  *         pts[label] = compute_tiebreaker_maxima(
  *           px, py, x, y,
  *           centx, centy,             # <<<<<<<<<<<<<<
  *           sx, sy, wx, wy
  *         )
  */
-        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_21 = PyFloat_FromDouble(__pyx_v_centx); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_21);
-        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 599, __pyx_L1_error)
+        __pyx_t_22 = PyFloat_FromDouble(__pyx_v_centy); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 643, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_22);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":600
+        /* "ext/skeletontricks/skeletontricks.pyx":644
  *           px, py, x, y,
  *           centx, centy,
  *           sx, sy, wx, wy             # <<<<<<<<<<<<<<
  *         )
  * 
  */
-        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_23 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_23);
-        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_24 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_24);
-        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_25 = PyFloat_FromDouble(__pyx_v_wx); if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_25);
-        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 600, __pyx_L1_error)
+        __pyx_t_26 = PyFloat_FromDouble(__pyx_v_wy); if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 644, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_26);
         __pyx_t_27 = NULL;
         __pyx_t_5 = 0;
         #if CYTHON_UNPACK_METHODS
         if (unlikely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_27 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_27)) {
@@ -61670,63 +62883,63 @@
           __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
           __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
           __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
           __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
           __Pyx_DECREF(__pyx_t_24); __pyx_t_24 = 0;
           __Pyx_DECREF(__pyx_t_25); __pyx_t_25 = 0;
           __Pyx_DECREF(__pyx_t_26); __pyx_t_26 = 0;
-          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 597, __pyx_L1_error)
+          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 641, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":597
+        /* "ext/skeletontricks/skeletontricks.pyx":641
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  *         pts[label] = compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *           px, py, x, y,
  *           centx, centy,
  */
-        __pyx_t_6 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 597, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 597, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_pts, __pyx_t_6, __pyx_t_2) < 0))) __PYX_ERR(0, 641, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":594
+        /* "ext/skeletontricks/skeletontricks.pyx":638
  *         mx[label] = dt[x,y]
  *         pts[label] = (x,y)
  *       elif mx[label] == dt[x,y]:             # <<<<<<<<<<<<<<
  *         px, py = pts[label]
  *         centx, centy = centroids[label]
  */
       }
       __pyx_L7:;
       __pyx_L5_continue:;
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":603
+  /* "ext/skeletontricks/skeletontricks.pyx":647
  *         )
  * 
  *   return pts             # <<<<<<<<<<<<<<
  * 
  * def compute_tiebreaker_maxima(
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_pts);
   __pyx_r = __pyx_v_pts;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":540
+  /* "ext/skeletontricks/skeletontricks.pyx":589
  *   return result
  * 
- * def find_border_targets(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def find_border_targets(
  *     cnp.ndarray[float, ndim=2] dt,
- *     cnp.ndarray[UINT, ndim=2] cc_labels,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
@@ -61758,33 +62971,33 @@
   __Pyx_XDECREF(__pyx_v_pts);
   __Pyx_XDECREF(__pyx_v_centroids);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":605
+/* "ext/skeletontricks/skeletontricks.pyx":649
  *   return pts
  * 
  * def compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *     float px, float py,
  *     float x, float y,
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_27compute_tiebreaker_maxima(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_29compute_tiebreaker_maxima(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_26compute_tiebreaker_maxima, "\n  compute_tiebreaker_maxima(\n    float px, float py, \n    float x, float y, \n    float centx, float centy,\n    float sx, float sy,\n    float wx, float wy\n  )\n\n  This function breaks ties for `compute_border_targets`.\n\n  (px,py): A previously found distance transform maxima \n  (x,y): The coordinate of the newly found maxima\n  (sx,sy): The length and width of the image plane.\n  (wx,wy): Weighting for anisotropy.\n  (centx, centy): The centroid of the current label.\n\n  We use following topolological criteria to achieve\n  a coordinate frame-free voxel selection. We pick\n  the result of the first criterion that is satisfied.\n\n  1) Pick the voxel closest to the centroid of the label.\n  2) The voxel closest to the centroid of the plane.\n  3) Closest to a corner of the plane.\n  4) Closest to an edge of the plane.\n  5) The previous maxima.\n\n  The worst case would be an annulus drawn around the center,\n  which would result in four equally eligible pixels....\n\n  Hopefully this won't happen too often...\n\n  Returns: some (x, y)\n  ");
-static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_27compute_tiebreaker_maxima = {"compute_tiebreaker_maxima", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_27compute_tiebreaker_maxima, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_26compute_tiebreaker_maxima};
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_27compute_tiebreaker_maxima(PyObject *__pyx_self, 
+PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_28compute_tiebreaker_maxima, "\n  compute_tiebreaker_maxima(\n    float px, float py, \n    float x, float y, \n    float centx, float centy,\n    float sx, float sy,\n    float wx, float wy\n  )\n\n  This function breaks ties for `compute_border_targets`.\n\n  (px,py): A previously found distance transform maxima \n  (x,y): The coordinate of the newly found maxima\n  (sx,sy): The length and width of the image plane.\n  (wx,wy): Weighting for anisotropy.\n  (centx, centy): The centroid of the current label.\n\n  We use following topolological criteria to achieve\n  a coordinate frame-free voxel selection. We pick\n  the result of the first criterion that is satisfied.\n\n  1) Pick the voxel closest to the centroid of the label.\n  2) The voxel closest to the centroid of the plane.\n  3) Closest to a corner of the plane.\n  4) Closest to an edge of the plane.\n  5) The previous maxima.\n\n  The worst case would be an annulus drawn around the center,\n  which would result in four equally eligible pixels....\n\n  Hopefully this won't happen too often...\n\n  Returns: some (x, y)\n  ");
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_29compute_tiebreaker_maxima = {"compute_tiebreaker_maxima", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_29compute_tiebreaker_maxima, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_28compute_tiebreaker_maxima};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_29compute_tiebreaker_maxima(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   float __pyx_v_px;
@@ -61847,110 +63060,110 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_px)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_py)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 1); __PYX_ERR(0, 605, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 1); __PYX_ERR(0, 649, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 2); __PYX_ERR(0, 605, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 2); __PYX_ERR(0, 649, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 3); __PYX_ERR(0, 605, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 3); __PYX_ERR(0, 649, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_centx)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[4]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 4); __PYX_ERR(0, 605, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 4); __PYX_ERR(0, 649, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_centy)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[5]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 5); __PYX_ERR(0, 605, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 5); __PYX_ERR(0, 649, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sx)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[6]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 6); __PYX_ERR(0, 605, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 6); __PYX_ERR(0, 649, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  7:
         if (likely((values[7] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sy)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[7]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 7); __PYX_ERR(0, 605, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 7); __PYX_ERR(0, 649, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  8:
         if (likely((values[8] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wx)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[8]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 8); __PYX_ERR(0, 605, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 8); __PYX_ERR(0, 649, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  9:
         if (likely((values[9] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wy)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[9]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 605, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 9); __PYX_ERR(0, 605, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, 9); __PYX_ERR(0, 649, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_tiebreaker_maxima") < 0)) __PYX_ERR(0, 605, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_tiebreaker_maxima") < 0)) __PYX_ERR(0, 649, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 10)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
       values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
@@ -61958,55 +63171,55 @@
       values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
       values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
       values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
       values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
       values[8] = __Pyx_Arg_FASTCALL(__pyx_args, 8);
       values[9] = __Pyx_Arg_FASTCALL(__pyx_args, 9);
     }
-    __pyx_v_px = __pyx_PyFloat_AsFloat(values[0]); if (unlikely((__pyx_v_px == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 606, __pyx_L3_error)
-    __pyx_v_py = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_py == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 606, __pyx_L3_error)
-    __pyx_v_x = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_x == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 607, __pyx_L3_error)
-    __pyx_v_y = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_y == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 607, __pyx_L3_error)
-    __pyx_v_centx = __pyx_PyFloat_AsFloat(values[4]); if (unlikely((__pyx_v_centx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 608, __pyx_L3_error)
-    __pyx_v_centy = __pyx_PyFloat_AsFloat(values[5]); if (unlikely((__pyx_v_centy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 608, __pyx_L3_error)
-    __pyx_v_sx = __pyx_PyFloat_AsFloat(values[6]); if (unlikely((__pyx_v_sx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 609, __pyx_L3_error)
-    __pyx_v_sy = __pyx_PyFloat_AsFloat(values[7]); if (unlikely((__pyx_v_sy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 609, __pyx_L3_error)
-    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[8]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 610, __pyx_L3_error)
-    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[9]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 610, __pyx_L3_error)
+    __pyx_v_px = __pyx_PyFloat_AsFloat(values[0]); if (unlikely((__pyx_v_px == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 650, __pyx_L3_error)
+    __pyx_v_py = __pyx_PyFloat_AsFloat(values[1]); if (unlikely((__pyx_v_py == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 650, __pyx_L3_error)
+    __pyx_v_x = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_x == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 651, __pyx_L3_error)
+    __pyx_v_y = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_y == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 651, __pyx_L3_error)
+    __pyx_v_centx = __pyx_PyFloat_AsFloat(values[4]); if (unlikely((__pyx_v_centx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 652, __pyx_L3_error)
+    __pyx_v_centy = __pyx_PyFloat_AsFloat(values[5]); if (unlikely((__pyx_v_centy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 652, __pyx_L3_error)
+    __pyx_v_sx = __pyx_PyFloat_AsFloat(values[6]); if (unlikely((__pyx_v_sx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 653, __pyx_L3_error)
+    __pyx_v_sy = __pyx_PyFloat_AsFloat(values[7]); if (unlikely((__pyx_v_sy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 653, __pyx_L3_error)
+    __pyx_v_wx = __pyx_PyFloat_AsFloat(values[8]); if (unlikely((__pyx_v_wx == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 654, __pyx_L3_error)
+    __pyx_v_wy = __pyx_PyFloat_AsFloat(values[9]); if (unlikely((__pyx_v_wy == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 654, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, __pyx_nargs); __PYX_ERR(0, 605, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("compute_tiebreaker_maxima", 1, 10, 10, __pyx_nargs); __PYX_ERR(0, 649, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.compute_tiebreaker_maxima", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_26compute_tiebreaker_maxima(__pyx_self, __pyx_v_px, __pyx_v_py, __pyx_v_x, __pyx_v_y, __pyx_v_centx, __pyx_v_centy, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy);
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_28compute_tiebreaker_maxima(__pyx_self, __pyx_v_px, __pyx_v_py, __pyx_v_x, __pyx_v_y, __pyx_v_centx, __pyx_v_centy, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy);
 
   /* function exit code */
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_26compute_tiebreaker_maxima(CYTHON_UNUSED PyObject *__pyx_self, float __pyx_v_px, float __pyx_v_py, float __pyx_v_x, float __pyx_v_y, float __pyx_v_centx, float __pyx_v_centy, float __pyx_v_sx, float __pyx_v_sy, float __pyx_v_wx, float __pyx_v_wy) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_28compute_tiebreaker_maxima(CYTHON_UNUSED PyObject *__pyx_self, float __pyx_v_px, float __pyx_v_py, float __pyx_v_x, float __pyx_v_y, float __pyx_v_centx, float __pyx_v_centy, float __pyx_v_sx, float __pyx_v_sy, float __pyx_v_wx, float __pyx_v_wy) {
   float __pyx_v_cx;
   float __pyx_v_cy;
   float __pyx_v_dist1;
   float __pyx_v_dist2;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   float __pyx_t_1;
@@ -62015,366 +63228,366 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("compute_tiebreaker_maxima", 1);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":646
+  /* "ext/skeletontricks/skeletontricks.pyx":690
  *   Returns: some (x, y)
  *   """
  *   cdef float cx = wx * sx / 2.0             # <<<<<<<<<<<<<<
  *   cdef float cy = wy * sy / 2.0
  * 
  */
   __pyx_v_cx = (((double)(__pyx_v_wx * __pyx_v_sx)) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":647
+  /* "ext/skeletontricks/skeletontricks.pyx":691
  *   """
  *   cdef float cx = wx * sx / 2.0
  *   cdef float cy = wy * sy / 2.0             # <<<<<<<<<<<<<<
  * 
  *   cdef float dist1 = distsq(px,py, centx,centy, wx,wy)
  */
   __pyx_v_cy = (((double)(__pyx_v_wy * __pyx_v_sy)) / 2.0);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":649
+  /* "ext/skeletontricks/skeletontricks.pyx":693
  *   cdef float cy = wy * sy / 2.0
  * 
  *   cdef float dist1 = distsq(px,py, centx,centy, wx,wy)             # <<<<<<<<<<<<<<
  *   cdef float dist2 = distsq( x, y, centx,centy, wx,wy)
  * 
  */
-  __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_px, __pyx_v_py, __pyx_v_centx, __pyx_v_centy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 649, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_px, __pyx_v_py, __pyx_v_centx, __pyx_v_centy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 693, __pyx_L1_error)
   __pyx_v_dist1 = __pyx_t_1;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":650
+  /* "ext/skeletontricks/skeletontricks.pyx":694
  * 
  *   cdef float dist1 = distsq(px,py, centx,centy, wx,wy)
  *   cdef float dist2 = distsq( x, y, centx,centy, wx,wy)             # <<<<<<<<<<<<<<
  * 
  *   if dist2 < dist1:
  */
-  __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, __pyx_v_centx, __pyx_v_centy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 650, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, __pyx_v_centx, __pyx_v_centy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 694, __pyx_L1_error)
   __pyx_v_dist2 = __pyx_t_1;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":652
+  /* "ext/skeletontricks/skeletontricks.pyx":696
  *   cdef float dist2 = distsq( x, y, centx,centy, wx,wy)
  * 
  *   if dist2 < dist1:             # <<<<<<<<<<<<<<
  *     return (x, y)
  *   elif dist1 == dist2:
  */
   __pyx_t_2 = (__pyx_v_dist2 < __pyx_v_dist1);
   if (__pyx_t_2) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":653
+    /* "ext/skeletontricks/skeletontricks.pyx":697
  * 
  *   if dist2 < dist1:
  *     return (x, y)             # <<<<<<<<<<<<<<
  *   elif dist1 == dist2:
  *     dist1 = distsq(px,py, cx,cy, wx,wy)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 653, __pyx_L1_error)
+    __pyx_t_3 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 697, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 653, __pyx_L1_error)
+    __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 697, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 653, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 697, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_3);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3)) __PYX_ERR(0, 653, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3)) __PYX_ERR(0, 697, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_4);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4)) __PYX_ERR(0, 653, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4)) __PYX_ERR(0, 697, __pyx_L1_error);
     __pyx_t_3 = 0;
     __pyx_t_4 = 0;
     __pyx_r = __pyx_t_5;
     __pyx_t_5 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":652
+    /* "ext/skeletontricks/skeletontricks.pyx":696
  *   cdef float dist2 = distsq( x, y, centx,centy, wx,wy)
  * 
  *   if dist2 < dist1:             # <<<<<<<<<<<<<<
  *     return (x, y)
  *   elif dist1 == dist2:
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":654
+  /* "ext/skeletontricks/skeletontricks.pyx":698
  *   if dist2 < dist1:
  *     return (x, y)
  *   elif dist1 == dist2:             # <<<<<<<<<<<<<<
  *     dist1 = distsq(px,py, cx,cy, wx,wy)
  *     dist2 = distsq( x, y, cx,cy, wx,wy)
  */
   __pyx_t_2 = (__pyx_v_dist1 == __pyx_v_dist2);
   if (__pyx_t_2) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":655
+    /* "ext/skeletontricks/skeletontricks.pyx":699
  *     return (x, y)
  *   elif dist1 == dist2:
  *     dist1 = distsq(px,py, cx,cy, wx,wy)             # <<<<<<<<<<<<<<
  *     dist2 = distsq( x, y, cx,cy, wx,wy)
  *     if dist2 < dist1:
  */
-    __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_px, __pyx_v_py, __pyx_v_cx, __pyx_v_cy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 655, __pyx_L1_error)
+    __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_px, __pyx_v_py, __pyx_v_cx, __pyx_v_cy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 699, __pyx_L1_error)
     __pyx_v_dist1 = __pyx_t_1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":656
+    /* "ext/skeletontricks/skeletontricks.pyx":700
  *   elif dist1 == dist2:
  *     dist1 = distsq(px,py, cx,cy, wx,wy)
  *     dist2 = distsq( x, y, cx,cy, wx,wy)             # <<<<<<<<<<<<<<
  *     if dist2 < dist1:
  *       return (x,y)
  */
-    __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, __pyx_v_cx, __pyx_v_cy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 656, __pyx_L1_error)
+    __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, __pyx_v_cx, __pyx_v_cy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 700, __pyx_L1_error)
     __pyx_v_dist2 = __pyx_t_1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":657
+    /* "ext/skeletontricks/skeletontricks.pyx":701
  *     dist1 = distsq(px,py, cx,cy, wx,wy)
  *     dist2 = distsq( x, y, cx,cy, wx,wy)
  *     if dist2 < dist1:             # <<<<<<<<<<<<<<
  *       return (x,y)
  *     elif dist1 == dist2:
  */
     __pyx_t_2 = (__pyx_v_dist2 < __pyx_v_dist1);
     if (__pyx_t_2) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":658
+      /* "ext/skeletontricks/skeletontricks.pyx":702
  *     dist2 = distsq( x, y, cx,cy, wx,wy)
  *     if dist2 < dist1:
  *       return (x,y)             # <<<<<<<<<<<<<<
  *     elif dist1 == dist2:
  *       dist1 = cornerness(px, py, sx, sy, wx,wy)
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 658, __pyx_L1_error)
+      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 702, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 658, __pyx_L1_error)
+      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 702, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 658, __pyx_L1_error)
+      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 702, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_GIVEREF(__pyx_t_5);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5)) __PYX_ERR(0, 658, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5)) __PYX_ERR(0, 702, __pyx_L1_error);
       __Pyx_GIVEREF(__pyx_t_4);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4)) __PYX_ERR(0, 658, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4)) __PYX_ERR(0, 702, __pyx_L1_error);
       __pyx_t_5 = 0;
       __pyx_t_4 = 0;
       __pyx_r = __pyx_t_3;
       __pyx_t_3 = 0;
       goto __pyx_L0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":657
+      /* "ext/skeletontricks/skeletontricks.pyx":701
  *     dist1 = distsq(px,py, cx,cy, wx,wy)
  *     dist2 = distsq( x, y, cx,cy, wx,wy)
  *     if dist2 < dist1:             # <<<<<<<<<<<<<<
  *       return (x,y)
  *     elif dist1 == dist2:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":659
+    /* "ext/skeletontricks/skeletontricks.pyx":703
  *     if dist2 < dist1:
  *       return (x,y)
  *     elif dist1 == dist2:             # <<<<<<<<<<<<<<
  *       dist1 = cornerness(px, py, sx, sy, wx,wy)
  *       dist2 = cornerness( x,  y, sx, sy, wx,wy)
  */
     __pyx_t_2 = (__pyx_v_dist1 == __pyx_v_dist2);
     if (__pyx_t_2) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":660
+      /* "ext/skeletontricks/skeletontricks.pyx":704
  *       return (x,y)
  *     elif dist1 == dist2:
  *       dist1 = cornerness(px, py, sx, sy, wx,wy)             # <<<<<<<<<<<<<<
  *       dist2 = cornerness( x,  y, sx, sy, wx,wy)
  *       if dist2 < dist1:
  */
-      __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_cornerness(__pyx_v_px, __pyx_v_py, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 660, __pyx_L1_error)
+      __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_cornerness(__pyx_v_px, __pyx_v_py, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 704, __pyx_L1_error)
       __pyx_v_dist1 = __pyx_t_1;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":661
+      /* "ext/skeletontricks/skeletontricks.pyx":705
  *     elif dist1 == dist2:
  *       dist1 = cornerness(px, py, sx, sy, wx,wy)
  *       dist2 = cornerness( x,  y, sx, sy, wx,wy)             # <<<<<<<<<<<<<<
  *       if dist2 < dist1:
  *         return (x, y)
  */
-      __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_cornerness(__pyx_v_x, __pyx_v_y, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 661, __pyx_L1_error)
+      __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_cornerness(__pyx_v_x, __pyx_v_y, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 705, __pyx_L1_error)
       __pyx_v_dist2 = __pyx_t_1;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":662
+      /* "ext/skeletontricks/skeletontricks.pyx":706
  *       dist1 = cornerness(px, py, sx, sy, wx,wy)
  *       dist2 = cornerness( x,  y, sx, sy, wx,wy)
  *       if dist2 < dist1:             # <<<<<<<<<<<<<<
  *         return (x, y)
  *       elif dist1 == dist2:
  */
       __pyx_t_2 = (__pyx_v_dist2 < __pyx_v_dist1);
       if (__pyx_t_2) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":663
+        /* "ext/skeletontricks/skeletontricks.pyx":707
  *       dist2 = cornerness( x,  y, sx, sy, wx,wy)
  *       if dist2 < dist1:
  *         return (x, y)             # <<<<<<<<<<<<<<
  *       elif dist1 == dist2:
  *         dist1 = edgeness(px, py, sx, sy, wx,wy)
  */
         __Pyx_XDECREF(__pyx_r);
-        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 663, __pyx_L1_error)
+        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 707, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 663, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 707, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 663, __pyx_L1_error)
+        __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 707, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_GIVEREF(__pyx_t_3);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3)) __PYX_ERR(0, 663, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3)) __PYX_ERR(0, 707, __pyx_L1_error);
         __Pyx_GIVEREF(__pyx_t_4);
-        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4)) __PYX_ERR(0, 663, __pyx_L1_error);
+        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4)) __PYX_ERR(0, 707, __pyx_L1_error);
         __pyx_t_3 = 0;
         __pyx_t_4 = 0;
         __pyx_r = __pyx_t_5;
         __pyx_t_5 = 0;
         goto __pyx_L0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":662
+        /* "ext/skeletontricks/skeletontricks.pyx":706
  *       dist1 = cornerness(px, py, sx, sy, wx,wy)
  *       dist2 = cornerness( x,  y, sx, sy, wx,wy)
  *       if dist2 < dist1:             # <<<<<<<<<<<<<<
  *         return (x, y)
  *       elif dist1 == dist2:
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":664
+      /* "ext/skeletontricks/skeletontricks.pyx":708
  *       if dist2 < dist1:
  *         return (x, y)
  *       elif dist1 == dist2:             # <<<<<<<<<<<<<<
  *         dist1 = edgeness(px, py, sx, sy, wx,wy)
  *         dist2 = edgeness( x,  y, sx, sy, wx,wy)
  */
       __pyx_t_2 = (__pyx_v_dist1 == __pyx_v_dist2);
       if (__pyx_t_2) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":665
+        /* "ext/skeletontricks/skeletontricks.pyx":709
  *         return (x, y)
  *       elif dist1 == dist2:
  *         dist1 = edgeness(px, py, sx, sy, wx,wy)             # <<<<<<<<<<<<<<
  *         dist2 = edgeness( x,  y, sx, sy, wx,wy)
  *         if dist2 < dist1:
  */
-        __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_edgeness(__pyx_v_px, __pyx_v_py, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 665, __pyx_L1_error)
+        __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_edgeness(__pyx_v_px, __pyx_v_py, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 709, __pyx_L1_error)
         __pyx_v_dist1 = __pyx_t_1;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":666
+        /* "ext/skeletontricks/skeletontricks.pyx":710
  *       elif dist1 == dist2:
  *         dist1 = edgeness(px, py, sx, sy, wx,wy)
  *         dist2 = edgeness( x,  y, sx, sy, wx,wy)             # <<<<<<<<<<<<<<
  *         if dist2 < dist1:
  *           return (x, y)
  */
-        __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_edgeness(__pyx_v_x, __pyx_v_y, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 666, __pyx_L1_error)
+        __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_edgeness(__pyx_v_x, __pyx_v_y, __pyx_v_sx, __pyx_v_sy, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 710, __pyx_L1_error)
         __pyx_v_dist2 = __pyx_t_1;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":667
+        /* "ext/skeletontricks/skeletontricks.pyx":711
  *         dist1 = edgeness(px, py, sx, sy, wx,wy)
  *         dist2 = edgeness( x,  y, sx, sy, wx,wy)
  *         if dist2 < dist1:             # <<<<<<<<<<<<<<
  *           return (x, y)
  * 
  */
         __pyx_t_2 = (__pyx_v_dist2 < __pyx_v_dist1);
         if (__pyx_t_2) {
 
-          /* "ext/skeletontricks/skeletontricks.pyx":668
+          /* "ext/skeletontricks/skeletontricks.pyx":712
  *         dist2 = edgeness( x,  y, sx, sy, wx,wy)
  *         if dist2 < dist1:
  *           return (x, y)             # <<<<<<<<<<<<<<
  * 
  *   return (px, py)
  */
           __Pyx_XDECREF(__pyx_r);
-          __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 668, __pyx_L1_error)
+          __pyx_t_5 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 712, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 668, __pyx_L1_error)
+          __pyx_t_4 = PyFloat_FromDouble(__pyx_v_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 712, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 668, __pyx_L1_error)
+          __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 712, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_GIVEREF(__pyx_t_5);
-          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5)) __PYX_ERR(0, 668, __pyx_L1_error);
+          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5)) __PYX_ERR(0, 712, __pyx_L1_error);
           __Pyx_GIVEREF(__pyx_t_4);
-          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4)) __PYX_ERR(0, 668, __pyx_L1_error);
+          if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4)) __PYX_ERR(0, 712, __pyx_L1_error);
           __pyx_t_5 = 0;
           __pyx_t_4 = 0;
           __pyx_r = __pyx_t_3;
           __pyx_t_3 = 0;
           goto __pyx_L0;
 
-          /* "ext/skeletontricks/skeletontricks.pyx":667
+          /* "ext/skeletontricks/skeletontricks.pyx":711
  *         dist1 = edgeness(px, py, sx, sy, wx,wy)
  *         dist2 = edgeness( x,  y, sx, sy, wx,wy)
  *         if dist2 < dist1:             # <<<<<<<<<<<<<<
  *           return (x, y)
  * 
  */
         }
 
-        /* "ext/skeletontricks/skeletontricks.pyx":664
+        /* "ext/skeletontricks/skeletontricks.pyx":708
  *       if dist2 < dist1:
  *         return (x, y)
  *       elif dist1 == dist2:             # <<<<<<<<<<<<<<
  *         dist1 = edgeness(px, py, sx, sy, wx,wy)
  *         dist2 = edgeness( x,  y, sx, sy, wx,wy)
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":659
+      /* "ext/skeletontricks/skeletontricks.pyx":703
  *     if dist2 < dist1:
  *       return (x,y)
  *     elif dist1 == dist2:             # <<<<<<<<<<<<<<
  *       dist1 = cornerness(px, py, sx, sy, wx,wy)
  *       dist2 = cornerness( x,  y, sx, sy, wx,wy)
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":654
+    /* "ext/skeletontricks/skeletontricks.pyx":698
  *   if dist2 < dist1:
  *     return (x, y)
  *   elif dist1 == dist2:             # <<<<<<<<<<<<<<
  *     dist1 = distsq(px,py, cx,cy, wx,wy)
  *     dist2 = distsq( x, y, cx,cy, wx,wy)
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":670
+  /* "ext/skeletontricks/skeletontricks.pyx":714
  *           return (x, y)
  * 
  *   return (px, py)             # <<<<<<<<<<<<<<
  * 
  * cdef float edgeness(
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 670, __pyx_L1_error)
+  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_px); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 714, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 670, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_v_py); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 714, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 670, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 714, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3)) __PYX_ERR(0, 670, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3)) __PYX_ERR(0, 714, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_4);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4)) __PYX_ERR(0, 670, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4)) __PYX_ERR(0, 714, __pyx_L1_error);
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":605
+  /* "ext/skeletontricks/skeletontricks.pyx":649
  *   return pts
  * 
  * def compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *     float px, float py,
  *     float x, float y,
  */
 
@@ -62387,15 +63600,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":672
+/* "ext/skeletontricks/skeletontricks.pyx":716
  *   return (px, py)
  * 
  * cdef float edgeness(             # <<<<<<<<<<<<<<
  *     float x, float y, float sx, float sy,
  *     float wx, float wy
  */
 
@@ -62404,81 +63617,81 @@
   double __pyx_t_1;
   double __pyx_t_2;
   double __pyx_t_3;
   double __pyx_t_4;
   double __pyx_t_5;
   int __pyx_t_6;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":683
+  /* "ext/skeletontricks/skeletontricks.pyx":727
  *   return min(
  *     wx * (x - 0.5),
  *     wx * (sx - 0.5 - x),             # <<<<<<<<<<<<<<
  *     wy * (y - 0.5),
  *     wy * (sy - 0.5 - y)
  */
   __pyx_t_1 = (__pyx_v_wx * ((__pyx_v_sx - 0.5) - __pyx_v_x));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":684
+  /* "ext/skeletontricks/skeletontricks.pyx":728
  *     wx * (x - 0.5),
  *     wx * (sx - 0.5 - x),
  *     wy * (y - 0.5),             # <<<<<<<<<<<<<<
  *     wy * (sy - 0.5 - y)
  *   )
  */
   __pyx_t_2 = (__pyx_v_wy * (__pyx_v_y - 0.5));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":685
+  /* "ext/skeletontricks/skeletontricks.pyx":729
  *     wx * (sx - 0.5 - x),
  *     wy * (y - 0.5),
  *     wy * (sy - 0.5 - y)             # <<<<<<<<<<<<<<
  *   )
  * 
  */
   __pyx_t_3 = (__pyx_v_wy * ((__pyx_v_sy - 0.5) - __pyx_v_y));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":682
+  /* "ext/skeletontricks/skeletontricks.pyx":726
  *   """
  *   return min(
  *     wx * (x - 0.5),             # <<<<<<<<<<<<<<
  *     wx * (sx - 0.5 - x),
  *     wy * (y - 0.5),
  */
   __pyx_t_4 = (__pyx_v_wx * (__pyx_v_x - 0.5));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":683
+  /* "ext/skeletontricks/skeletontricks.pyx":727
  *   return min(
  *     wx * (x - 0.5),
  *     wx * (sx - 0.5 - x),             # <<<<<<<<<<<<<<
  *     wy * (y - 0.5),
  *     wy * (sy - 0.5 - y)
  */
   __pyx_t_6 = (__pyx_t_1 < __pyx_t_4);
   if (__pyx_t_6) {
     __pyx_t_5 = __pyx_t_1;
   } else {
     __pyx_t_5 = __pyx_t_4;
   }
   __pyx_t_4 = __pyx_t_5;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":684
+  /* "ext/skeletontricks/skeletontricks.pyx":728
  *     wx * (x - 0.5),
  *     wx * (sx - 0.5 - x),
  *     wy * (y - 0.5),             # <<<<<<<<<<<<<<
  *     wy * (sy - 0.5 - y)
  *   )
  */
   __pyx_t_6 = (__pyx_t_2 < __pyx_t_4);
   if (__pyx_t_6) {
     __pyx_t_5 = __pyx_t_2;
   } else {
     __pyx_t_5 = __pyx_t_4;
   }
   __pyx_t_4 = __pyx_t_5;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":685
+  /* "ext/skeletontricks/skeletontricks.pyx":729
  *     wx * (sx - 0.5 - x),
  *     wy * (y - 0.5),
  *     wy * (sy - 0.5 - y)             # <<<<<<<<<<<<<<
  *   )
  * 
  */
   __pyx_t_6 = (__pyx_t_3 < __pyx_t_4);
@@ -62486,28 +63699,28 @@
     __pyx_t_5 = __pyx_t_3;
   } else {
     __pyx_t_5 = __pyx_t_4;
   }
   __pyx_r = __pyx_t_5;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":672
+  /* "ext/skeletontricks/skeletontricks.pyx":716
  *   return (px, py)
  * 
  * cdef float edgeness(             # <<<<<<<<<<<<<<
  *     float x, float y, float sx, float sy,
  *     float wx, float wy
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":688
+/* "ext/skeletontricks/skeletontricks.pyx":732
  *   )
  * 
  * cdef float cornerness(             # <<<<<<<<<<<<<<
  *     float x, float y, float sx, float sy,
  *     float wx, float wy
  */
 
@@ -62519,81 +63732,81 @@
   float __pyx_t_4;
   float __pyx_t_5;
   int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":702
+  /* "ext/skeletontricks/skeletontricks.pyx":746
  *   return min(
  *     distsq(x,y,-0.5,-0.5, wx, wy),
  *     distsq(x,y,sx-0.5,-0.5, wx, wy),             # <<<<<<<<<<<<<<
  *     distsq(x,y,sx-0.5,sy-0.5, wx, wy),
  *     distsq(x,y,-0.5,sx-0.5, wx, wy)
  */
-  __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, (__pyx_v_sx - 0.5), -0.5, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 702, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, (__pyx_v_sx - 0.5), -0.5, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_1 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 746, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":703
+  /* "ext/skeletontricks/skeletontricks.pyx":747
  *     distsq(x,y,-0.5,-0.5, wx, wy),
  *     distsq(x,y,sx-0.5,-0.5, wx, wy),
  *     distsq(x,y,sx-0.5,sy-0.5, wx, wy),             # <<<<<<<<<<<<<<
  *     distsq(x,y,-0.5,sx-0.5, wx, wy)
  *   )
  */
-  __pyx_t_2 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, (__pyx_v_sx - 0.5), (__pyx_v_sy - 0.5), __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_2 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 703, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, (__pyx_v_sx - 0.5), (__pyx_v_sy - 0.5), __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_2 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 747, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":704
+  /* "ext/skeletontricks/skeletontricks.pyx":748
  *     distsq(x,y,sx-0.5,-0.5, wx, wy),
  *     distsq(x,y,sx-0.5,sy-0.5, wx, wy),
  *     distsq(x,y,-0.5,sx-0.5, wx, wy)             # <<<<<<<<<<<<<<
  *   )
  * 
  */
-  __pyx_t_3 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, -0.5, (__pyx_v_sx - 0.5), __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_3 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 704, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, -0.5, (__pyx_v_sx - 0.5), __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_3 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 748, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":701
+  /* "ext/skeletontricks/skeletontricks.pyx":745
  *   """
  *   return min(
  *     distsq(x,y,-0.5,-0.5, wx, wy),             # <<<<<<<<<<<<<<
  *     distsq(x,y,sx-0.5,-0.5, wx, wy),
  *     distsq(x,y,sx-0.5,sy-0.5, wx, wy),
  */
-  __pyx_t_4 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, -0.5, -0.5, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_4 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 701, __pyx_L1_error)
+  __pyx_t_4 = __pyx_f_8kimimaro_14skeletontricks_distsq(__pyx_v_x, __pyx_v_y, -0.5, -0.5, __pyx_v_wx, __pyx_v_wy); if (unlikely(__pyx_t_4 == ((float)-1) && PyErr_Occurred())) __PYX_ERR(0, 745, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":702
+  /* "ext/skeletontricks/skeletontricks.pyx":746
  *   return min(
  *     distsq(x,y,-0.5,-0.5, wx, wy),
  *     distsq(x,y,sx-0.5,-0.5, wx, wy),             # <<<<<<<<<<<<<<
  *     distsq(x,y,sx-0.5,sy-0.5, wx, wy),
  *     distsq(x,y,-0.5,sx-0.5, wx, wy)
  */
   __pyx_t_6 = (__pyx_t_1 < __pyx_t_4);
   if (__pyx_t_6) {
     __pyx_t_5 = __pyx_t_1;
   } else {
     __pyx_t_5 = __pyx_t_4;
   }
   __pyx_t_4 = __pyx_t_5;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":703
+  /* "ext/skeletontricks/skeletontricks.pyx":747
  *     distsq(x,y,-0.5,-0.5, wx, wy),
  *     distsq(x,y,sx-0.5,-0.5, wx, wy),
  *     distsq(x,y,sx-0.5,sy-0.5, wx, wy),             # <<<<<<<<<<<<<<
  *     distsq(x,y,-0.5,sx-0.5, wx, wy)
  *   )
  */
   __pyx_t_6 = (__pyx_t_2 < __pyx_t_4);
   if (__pyx_t_6) {
     __pyx_t_5 = __pyx_t_2;
   } else {
     __pyx_t_5 = __pyx_t_4;
   }
   __pyx_t_4 = __pyx_t_5;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":704
+  /* "ext/skeletontricks/skeletontricks.pyx":748
  *     distsq(x,y,sx-0.5,-0.5, wx, wy),
  *     distsq(x,y,sx-0.5,sy-0.5, wx, wy),
  *     distsq(x,y,-0.5,sx-0.5, wx, wy)             # <<<<<<<<<<<<<<
  *   )
  * 
  */
   __pyx_t_6 = (__pyx_t_3 < __pyx_t_4);
@@ -62601,15 +63814,15 @@
     __pyx_t_5 = __pyx_t_3;
   } else {
     __pyx_t_5 = __pyx_t_4;
   }
   __pyx_r = __pyx_t_5;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":688
+  /* "ext/skeletontricks/skeletontricks.pyx":732
  *   )
  * 
  * cdef float cornerness(             # <<<<<<<<<<<<<<
  *     float x, float y, float sx, float sy,
  *     float wx, float wy
  */
 
@@ -62617,115 +63830,115 @@
   __pyx_L1_error:;
   __Pyx_AddTraceback("kimimaro.skeletontricks.cornerness", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":707
+/* "ext/skeletontricks/skeletontricks.pyx":751
  *   )
  * 
  * cdef float distsq(             # <<<<<<<<<<<<<<
  *     float p1x, float p1y,
  *     float p2x, float p2y,
  */
 
 static float __pyx_f_8kimimaro_14skeletontricks_distsq(float __pyx_v_p1x, float __pyx_v_p1y, float __pyx_v_p2x, float __pyx_v_p2y, float __pyx_v_wx, float __pyx_v_wy) {
   float __pyx_r;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":713
+  /* "ext/skeletontricks/skeletontricks.pyx":757
  *   ):
  * 
  *   p1x = wx * (p1x - p2x)             # <<<<<<<<<<<<<<
  *   p1y = wy * (p1y - p2y)
  *   return p1x * p1x + p1y * p1y
  */
   __pyx_v_p1x = (__pyx_v_wx * (__pyx_v_p1x - __pyx_v_p2x));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":714
+  /* "ext/skeletontricks/skeletontricks.pyx":758
  * 
  *   p1x = wx * (p1x - p2x)
  *   p1y = wy * (p1y - p2y)             # <<<<<<<<<<<<<<
  *   return p1x * p1x + p1y * p1y
  * 
  */
   __pyx_v_p1y = (__pyx_v_wy * (__pyx_v_p1y - __pyx_v_p2y));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":715
+  /* "ext/skeletontricks/skeletontricks.pyx":759
  *   p1x = wx * (p1x - p2x)
  *   p1y = wy * (p1y - p2y)
  *   return p1x * p1x + p1y * p1y             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __pyx_r = ((__pyx_v_p1x * __pyx_v_p1x) + (__pyx_v_p1y * __pyx_v_p1y));
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":707
+  /* "ext/skeletontricks/skeletontricks.pyx":751
  *   )
  * 
  * cdef float distsq(             # <<<<<<<<<<<<<<
  *     float p1x, float p1y,
  *     float p2x, float p2y,
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":717
+/* "ext/skeletontricks/skeletontricks.pyx":761
  *   return p1x * p1x + p1y * p1y
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_194__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_196__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__defaults__", 1);
   __Pyx_XDECREF(__pyx_r);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":724
+  /* "ext/skeletontricks/skeletontricks.pyx":769
  *     cnp.ndarray[float, ndim=3] DBF,
  *     path, float scale, float const,
  *     anisotropy=(1,1,1),             # <<<<<<<<<<<<<<
  *     invalid_vertices={},
  *   ):
  */
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 717, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 761, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(((PyObject*)__pyx_tuple__17));
   __Pyx_GIVEREF(((PyObject*)__pyx_tuple__17));
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject*)__pyx_tuple__17))) __PYX_ERR(0, 717, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject*)__pyx_tuple__17))) __PYX_ERR(0, 761, __pyx_L1_error);
   __Pyx_INCREF(__Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_self)->__pyx_arg_invalid_vertices);
   __Pyx_GIVEREF(__Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_self)->__pyx_arg_invalid_vertices);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_self)->__pyx_arg_invalid_vertices)) __PYX_ERR(0, 717, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_self)->__pyx_arg_invalid_vertices)) __PYX_ERR(0, 761, __pyx_L1_error);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":717
+  /* "ext/skeletontricks/skeletontricks.pyx":761
  *   return p1x * p1x + p1y * p1y
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 717, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 761, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 717, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 761, __pyx_L1_error);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None)) __PYX_ERR(0, 717, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None)) __PYX_ERR(0, 761, __pyx_L1_error);
   __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -62736,24 +63949,24 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_29roll_invalidation_cube(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_31roll_invalidation_cube(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_28roll_invalidation_cube, "\n  roll_invalidation_cube(\n    ndarray[uint8_t, cast=True, ndim=3] labels, \n    ndarray[float, ndim=3] DBF, \n    path, float scale, float const,\n    anisotropy=(1,1,1),\n    invalid_vertices={},\n  )\n\n  Given an anisotropic binary image, its distance transform, and a path \n  traversing the binary image, erase the voxels surrounding the path\n  in a cube around each vertex. In contrast to `roll_invalidation_ball`,\n  this function runs in time linear in the number of image pixels.\n  ");
-static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_29roll_invalidation_cube = {"roll_invalidation_cube", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_29roll_invalidation_cube, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_28roll_invalidation_cube};
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_29roll_invalidation_cube(PyObject *__pyx_self, 
+PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_30roll_invalidation_cube, "\n  Given an anisotropic binary image, its distance transform, and a path \n  traversing the binary image, erase the voxels surrounding the path\n  in a cube around each vertex. In contrast to `roll_invalidation_ball`,\n  this function runs in time linear in the number of image pixels.\n  ");
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_31roll_invalidation_cube = {"roll_invalidation_cube", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_31roll_invalidation_cube, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_30roll_invalidation_cube};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_31roll_invalidation_cube(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyArrayObject *__pyx_v_labels = 0;
@@ -62810,74 +64023,74 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 717, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 761, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_DBF)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 717, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 761, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, 1); __PYX_ERR(0, 717, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, 1); __PYX_ERR(0, 761, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_path)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 717, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 761, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, 2); __PYX_ERR(0, 717, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, 2); __PYX_ERR(0, 761, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_scale)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 717, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 761, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, 3); __PYX_ERR(0, 717, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, 3); __PYX_ERR(0, 761, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_const)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[4]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 717, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 761, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, 4); __PYX_ERR(0, 717, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, 4); __PYX_ERR(0, 761, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_anisotropy);
           if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 717, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 761, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_invalid_vertices);
           if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 717, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 761, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "roll_invalidation_cube") < 0)) __PYX_ERR(0, 717, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "roll_invalidation_cube") < 0)) __PYX_ERR(0, 761, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
         case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
@@ -62889,38 +64102,38 @@
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
     __pyx_v_DBF = ((PyArrayObject *)values[1]);
     __pyx_v_path = values[2];
-    __pyx_v_scale = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_scale == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 723, __pyx_L3_error)
-    __pyx_v_const = __pyx_PyFloat_AsFloat(values[4]); if (unlikely((__pyx_v_const == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 723, __pyx_L3_error)
+    __pyx_v_scale = __pyx_PyFloat_AsFloat(values[3]); if (unlikely((__pyx_v_scale == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 768, __pyx_L3_error)
+    __pyx_v_const = __pyx_PyFloat_AsFloat(values[4]); if (unlikely((__pyx_v_const == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 768, __pyx_L3_error)
     __pyx_v_anisotropy = values[5];
     __pyx_v_invalid_vertices = values[6];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, __pyx_nargs); __PYX_ERR(0, 717, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("roll_invalidation_cube", 0, 5, 7, __pyx_nargs); __PYX_ERR(0, 761, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.roll_invalidation_cube", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 721, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_DBF), __pyx_ptype_5numpy_ndarray, 1, "DBF", 0))) __PYX_ERR(0, 722, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_28roll_invalidation_cube(__pyx_self, __pyx_v_labels, __pyx_v_DBF, __pyx_v_path, __pyx_v_scale, __pyx_v_const, __pyx_v_anisotropy, __pyx_v_invalid_vertices);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 766, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_DBF), __pyx_ptype_5numpy_ndarray, 1, "DBF", 0))) __PYX_ERR(0, 767, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_30roll_invalidation_cube(__pyx_self, __pyx_v_labels, __pyx_v_DBF, __pyx_v_path, __pyx_v_scale, __pyx_v_const, __pyx_v_anisotropy, __pyx_v_invalid_vertices);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -62929,25 +64142,25 @@
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_28roll_invalidation_cube(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, PyObject *__pyx_v_path, float __pyx_v_scale, float __pyx_v_const, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_invalid_vertices) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_30roll_invalidation_cube(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, PyArrayObject *__pyx_v_DBF, PyObject *__pyx_v_path, float __pyx_v_scale, float __pyx_v_const, PyObject *__pyx_v_anisotropy, PyObject *__pyx_v_invalid_vertices) {
   int64_t __pyx_v_sx;
   int64_t __pyx_v_sy;
   int64_t __pyx_v_sz;
   size_t __pyx_v_sxy;
   float __pyx_v_wx;
   float __pyx_v_wy;
   float __pyx_v_wz;
   __Pyx_memviewslice __pyx_v_pathview = { 0, 0, { 0 }, { 0 }, { 0 } };
   size_t __pyx_v_invalidated;
-  PyObject *__pyx_7genexpr__pyx_v_coord = NULL;
+  PyObject *__pyx_8genexpr2__pyx_v_coord = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_DBF;
   __Pyx_Buffer __pyx_pybuffer_DBF;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
@@ -62984,76 +64197,76 @@
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   __pyx_pybuffer_DBF.pybuffer.buf = NULL;
   __pyx_pybuffer_DBF.refcount = 0;
   __pyx_pybuffernd_DBF.data = NULL;
   __pyx_pybuffernd_DBF.rcbuffer = &__pyx_pybuffer_DBF;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 717, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 1, __pyx_stack) == -1)) __PYX_ERR(0, 761, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_DBF.rcbuffer->pybuffer, (PyObject*)__pyx_v_DBF, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 717, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_DBF.rcbuffer->pybuffer, (PyObject*)__pyx_v_DBF, &__Pyx_TypeInfo_float, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 761, __pyx_L1_error)
   }
   __pyx_pybuffernd_DBF.diminfo[0].strides = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_DBF.diminfo[0].shape = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_DBF.diminfo[1].strides = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_DBF.diminfo[1].shape = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_DBF.diminfo[2].strides = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_DBF.diminfo[2].shape = __pyx_pybuffernd_DBF.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":742
+  /* "ext/skeletontricks/skeletontricks.pyx":779
  *   """
  *   cdef int64_t sx, sy, sz
  *   sx = labels.shape[0]             # <<<<<<<<<<<<<<
  *   sy = labels.shape[1]
  *   sz = labels.shape[2]
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 742, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 779, __pyx_L1_error)
   __pyx_v_sx = (__pyx_t_1[0]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":743
+  /* "ext/skeletontricks/skeletontricks.pyx":780
  *   cdef int64_t sx, sy, sz
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]             # <<<<<<<<<<<<<<
  *   sz = labels.shape[2]
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 743, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 780, __pyx_L1_error)
   __pyx_v_sy = (__pyx_t_1[1]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":744
+  /* "ext/skeletontricks/skeletontricks.pyx":781
  *   sx = labels.shape[0]
  *   sy = labels.shape[1]
  *   sz = labels.shape[2]             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t sxy = sx * sy
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 744, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 781, __pyx_L1_error)
   __pyx_v_sz = (__pyx_t_1[2]);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":746
+  /* "ext/skeletontricks/skeletontricks.pyx":783
  *   sz = labels.shape[2]
  * 
  *   cdef size_t sxy = sx * sy             # <<<<<<<<<<<<<<
  * 
  *   cdef float wx, wy, wz
  */
   __pyx_v_sxy = (__pyx_v_sx * __pyx_v_sy);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":749
+  /* "ext/skeletontricks/skeletontricks.pyx":786
  * 
  *   cdef float wx, wy, wz
  *   (wx, wy, wz) = anisotropy             # <<<<<<<<<<<<<<
  * 
  *   path = [
  */
   if ((likely(PyTuple_CheckExact(__pyx_v_anisotropy))) || (PyList_CheckExact(__pyx_v_anisotropy))) {
     PyObject* sequence = __pyx_v_anisotropy;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 3)) {
       if (size > 3) __Pyx_RaiseTooManyValuesError(3);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 749, __pyx_L1_error)
+      __PYX_ERR(0, 786, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
       __pyx_t_4 = PyTuple_GET_ITEM(sequence, 2); 
     } else {
@@ -63061,292 +64274,292 @@
       __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
       __pyx_t_4 = PyList_GET_ITEM(sequence, 2); 
     }
     __Pyx_INCREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_t_4);
     #else
-    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 749, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 786, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 749, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 786, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 749, __pyx_L1_error)
+    __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 786, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     #endif
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_5 = PyObject_GetIter(__pyx_v_anisotropy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 749, __pyx_L1_error)
+    __pyx_t_5 = PyObject_GetIter(__pyx_v_anisotropy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 786, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
     index = 0; __pyx_t_2 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_2);
     index = 1; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_3);
     index = 2; __pyx_t_4 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_4);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 749, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 786, __pyx_L1_error)
     __pyx_t_6 = NULL;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     goto __pyx_L4_unpacking_done;
     __pyx_L3_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_6 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 749, __pyx_L1_error)
+    __PYX_ERR(0, 786, __pyx_L1_error)
     __pyx_L4_unpacking_done:;
   }
-  __pyx_t_7 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_7 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 749, __pyx_L1_error)
+  __pyx_t_7 = __pyx_PyFloat_AsFloat(__pyx_t_2); if (unlikely((__pyx_t_7 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 786, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_8 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_8 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 749, __pyx_L1_error)
+  __pyx_t_8 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_8 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 786, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_9 = __pyx_PyFloat_AsFloat(__pyx_t_4); if (unlikely((__pyx_t_9 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 749, __pyx_L1_error)
+  __pyx_t_9 = __pyx_PyFloat_AsFloat(__pyx_t_4); if (unlikely((__pyx_t_9 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 786, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_wx = __pyx_t_7;
   __pyx_v_wy = __pyx_t_8;
   __pyx_v_wz = __pyx_t_9;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":751
+  /* "ext/skeletontricks/skeletontricks.pyx":788
  *   (wx, wy, wz) = anisotropy
  * 
  *   path = [             # <<<<<<<<<<<<<<
  *     coord[0] + sx * coord[1] + sxy * coord[2]
  *     for coord in path if tuple(coord) not in invalid_vertices
  */
   { /* enter inner scope */
-    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 751, __pyx_L7_error)
+    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 788, __pyx_L7_error)
     __Pyx_GOTREF(__pyx_t_4);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":753
+    /* "ext/skeletontricks/skeletontricks.pyx":790
  *   path = [
  *     coord[0] + sx * coord[1] + sxy * coord[2]
  *     for coord in path if tuple(coord) not in invalid_vertices             # <<<<<<<<<<<<<<
  *   ]
  *   path = np.array(path, dtype=np.uintp)
  */
     if (likely(PyList_CheckExact(__pyx_v_path)) || PyTuple_CheckExact(__pyx_v_path)) {
       __pyx_t_3 = __pyx_v_path; __Pyx_INCREF(__pyx_t_3);
       __pyx_t_10 = 0;
       __pyx_t_11 = NULL;
     } else {
-      __pyx_t_10 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_path); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 753, __pyx_L7_error)
+      __pyx_t_10 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_path); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 790, __pyx_L7_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 753, __pyx_L7_error)
+      __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 790, __pyx_L7_error)
     }
     for (;;) {
       if (likely(!__pyx_t_11)) {
         if (likely(PyList_CheckExact(__pyx_t_3))) {
           {
             Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
             #if !CYTHON_ASSUME_SAFE_MACROS
-            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 753, __pyx_L7_error)
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 790, __pyx_L7_error)
             #endif
             if (__pyx_t_10 >= __pyx_temp) break;
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 753, __pyx_L7_error)
+          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 790, __pyx_L7_error)
           #else
-          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 753, __pyx_L7_error)
+          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 790, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_2);
           #endif
         } else {
           {
             Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
             #if !CYTHON_ASSUME_SAFE_MACROS
-            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 753, __pyx_L7_error)
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 790, __pyx_L7_error)
             #endif
             if (__pyx_t_10 >= __pyx_temp) break;
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 753, __pyx_L7_error)
+          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_2); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 790, __pyx_L7_error)
           #else
-          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 753, __pyx_L7_error)
+          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 790, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_2);
           #endif
         }
       } else {
         __pyx_t_2 = __pyx_t_11(__pyx_t_3);
         if (unlikely(!__pyx_t_2)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 753, __pyx_L7_error)
+            else __PYX_ERR(0, 790, __pyx_L7_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_2);
       }
-      __Pyx_XDECREF_SET(__pyx_7genexpr__pyx_v_coord, __pyx_t_2);
+      __Pyx_XDECREF_SET(__pyx_8genexpr2__pyx_v_coord, __pyx_t_2);
       __pyx_t_2 = 0;
-      __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_7genexpr__pyx_v_coord); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 753, __pyx_L7_error)
+      __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_8genexpr2__pyx_v_coord); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 790, __pyx_L7_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_12 = (__Pyx_PySequence_ContainsTF(__pyx_t_2, __pyx_v_invalid_vertices, Py_NE)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 753, __pyx_L7_error)
+      __pyx_t_12 = (__Pyx_PySequence_ContainsTF(__pyx_t_2, __pyx_v_invalid_vertices, Py_NE)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 790, __pyx_L7_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       if (__pyx_t_12) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":752
+        /* "ext/skeletontricks/skeletontricks.pyx":789
  * 
  *   path = [
  *     coord[0] + sx * coord[1] + sxy * coord[2]             # <<<<<<<<<<<<<<
  *     for coord in path if tuple(coord) not in invalid_vertices
  *   ]
  */
-        __pyx_t_2 = __Pyx_GetItemInt(__pyx_7genexpr__pyx_v_coord, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 752, __pyx_L7_error)
+        __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr2__pyx_v_coord, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 789, __pyx_L7_error)
         __Pyx_GOTREF(__pyx_t_2);
-        __pyx_t_5 = __Pyx_PyInt_From_int64_t(__pyx_v_sx); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 752, __pyx_L7_error)
+        __pyx_t_5 = __Pyx_PyInt_From_int64_t(__pyx_v_sx); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 789, __pyx_L7_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_13 = __Pyx_GetItemInt(__pyx_7genexpr__pyx_v_coord, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 752, __pyx_L7_error)
+        __pyx_t_13 = __Pyx_GetItemInt(__pyx_8genexpr2__pyx_v_coord, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 789, __pyx_L7_error)
         __Pyx_GOTREF(__pyx_t_13);
-        __pyx_t_14 = PyNumber_Multiply(__pyx_t_5, __pyx_t_13); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 752, __pyx_L7_error)
+        __pyx_t_14 = PyNumber_Multiply(__pyx_t_5, __pyx_t_13); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 789, __pyx_L7_error)
         __Pyx_GOTREF(__pyx_t_14);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-        __pyx_t_13 = PyNumber_Add(__pyx_t_2, __pyx_t_14); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 752, __pyx_L7_error)
+        __pyx_t_13 = PyNumber_Add(__pyx_t_2, __pyx_t_14); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 789, __pyx_L7_error)
         __Pyx_GOTREF(__pyx_t_13);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-        __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sxy); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 752, __pyx_L7_error)
+        __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sxy); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 789, __pyx_L7_error)
         __Pyx_GOTREF(__pyx_t_14);
-        __pyx_t_2 = __Pyx_GetItemInt(__pyx_7genexpr__pyx_v_coord, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 752, __pyx_L7_error)
+        __pyx_t_2 = __Pyx_GetItemInt(__pyx_8genexpr2__pyx_v_coord, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 789, __pyx_L7_error)
         __Pyx_GOTREF(__pyx_t_2);
-        __pyx_t_5 = PyNumber_Multiply(__pyx_t_14, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 752, __pyx_L7_error)
+        __pyx_t_5 = PyNumber_Multiply(__pyx_t_14, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 789, __pyx_L7_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_2 = PyNumber_Add(__pyx_t_13, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 752, __pyx_L7_error)
+        __pyx_t_2 = PyNumber_Add(__pyx_t_13, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 789, __pyx_L7_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 751, __pyx_L7_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 788, __pyx_L7_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":753
+        /* "ext/skeletontricks/skeletontricks.pyx":790
  *   path = [
  *     coord[0] + sx * coord[1] + sxy * coord[2]
  *     for coord in path if tuple(coord) not in invalid_vertices             # <<<<<<<<<<<<<<
  *   ]
  *   path = np.array(path, dtype=np.uintp)
  */
       }
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_coord); __pyx_7genexpr__pyx_v_coord = 0;
+    __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_coord); __pyx_8genexpr2__pyx_v_coord = 0;
     goto __pyx_L12_exit_scope;
     __pyx_L7_error:;
-    __Pyx_XDECREF(__pyx_7genexpr__pyx_v_coord); __pyx_7genexpr__pyx_v_coord = 0;
+    __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_coord); __pyx_8genexpr2__pyx_v_coord = 0;
     goto __pyx_L1_error;
     __pyx_L12_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_path, __pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":755
+  /* "ext/skeletontricks/skeletontricks.pyx":792
  *     for coord in path if tuple(coord) not in invalid_vertices
  *   ]
  *   path = np.array(path, dtype=np.uintp)             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t[:] pathview = path
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 792, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 792, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 792, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_INCREF(__pyx_v_path);
   __Pyx_GIVEREF(__pyx_v_path);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_path)) __PYX_ERR(0, 755, __pyx_L1_error);
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 755, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_path)) __PYX_ERR(0, 792, __pyx_L1_error);
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 792, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 792, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uintp); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_uintp); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 792, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_13) < 0) __PYX_ERR(0, 755, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_13) < 0) __PYX_ERR(0, 792, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 755, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 792, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF_SET(__pyx_v_path, __pyx_t_13);
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":757
+  /* "ext/skeletontricks/skeletontricks.pyx":794
  *   path = np.array(path, dtype=np.uintp)
  * 
  *   cdef size_t[:] pathview = path             # <<<<<<<<<<<<<<
  * 
  *   cdef size_t invalidated = _roll_invalidation_cube(
  */
-  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_size_t(__pyx_v_path, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 757, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_size_t(__pyx_v_path, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 794, __pyx_L1_error)
   __pyx_v_pathview = __pyx_t_15;
   __pyx_t_15.memview = NULL;
   __pyx_t_15.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":760
+  /* "ext/skeletontricks/skeletontricks.pyx":797
  * 
  *   cdef size_t invalidated = _roll_invalidation_cube(
  *     <uint8_t*>&labels[0,0,0], <float*>&DBF[0,0,0],             # <<<<<<<<<<<<<<
  *     sx, sy, sz,
  *     wx, wy, wz,
  */
   __pyx_t_16 = 0;
   __pyx_t_17 = 0;
   __pyx_t_18 = 0;
   __pyx_t_19 = 0;
   __pyx_t_20 = 0;
   __pyx_t_21 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":763
+  /* "ext/skeletontricks/skeletontricks.pyx":800
  *     sx, sy, sz,
  *     wx, wy, wz,
  *     <size_t*>&pathview[0], path.size,             # <<<<<<<<<<<<<<
  *     scale, const
  *   )
  */
   __pyx_t_22 = 0;
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_path, __pyx_n_s_size); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 763, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_path, __pyx_n_s_size); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 800, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_23 = __Pyx_PyInt_As_size_t(__pyx_t_13); if (unlikely((__pyx_t_23 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 763, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyInt_As_size_t(__pyx_t_13); if (unlikely((__pyx_t_23 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 800, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":759
+  /* "ext/skeletontricks/skeletontricks.pyx":796
  *   cdef size_t[:] pathview = path
  * 
  *   cdef size_t invalidated = _roll_invalidation_cube(             # <<<<<<<<<<<<<<
  *     <uint8_t*>&labels[0,0,0], <float*>&DBF[0,0,0],
  *     sx, sy, sz,
  */
   __pyx_v_invalidated = skeletontricks::_roll_invalidation_cube(((uint8_t *)(&(*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_16, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)))), ((float *)(&(*__Pyx_BufPtrStrided3d(float *, __pyx_pybuffernd_DBF.rcbuffer->pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_DBF.diminfo[0].strides, __pyx_t_20, __pyx_pybuffernd_DBF.diminfo[1].strides, __pyx_t_21, __pyx_pybuffernd_DBF.diminfo[2].strides)))), __pyx_v_sx, __pyx_v_sy, __pyx_v_sz, __pyx_v_wx, __pyx_v_wy, __pyx_v_wz, ((size_t *)(&(*((size_t *) ( /* dim=0 */ (__pyx_v_pathview.data + __pyx_t_22 * __pyx_v_pathview.strides[0]) ))))), __pyx_t_23, __pyx_v_scale, __pyx_v_const);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":767
+  /* "ext/skeletontricks/skeletontricks.pyx":804
  *   )
  * 
  *   return invalidated, labels             # <<<<<<<<<<<<<<
  * 
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_invalidated); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 767, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_invalidated); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 804, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 767, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 804, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_13)) __PYX_ERR(0, 767, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_13)) __PYX_ERR(0, 804, __pyx_L1_error);
   __Pyx_INCREF((PyObject *)__pyx_v_labels);
   __Pyx_GIVEREF((PyObject *)__pyx_v_labels);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_labels))) __PYX_ERR(0, 767, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_labels))) __PYX_ERR(0, 804, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":717
+  /* "ext/skeletontricks/skeletontricks.pyx":761
  *   return p1x * p1x + p1y * p1y
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -63370,40 +64583,40 @@
   __pyx_r = NULL;
   goto __pyx_L2;
   __pyx_L0:;
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_DBF.rcbuffer->pybuffer);
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __PYX_XCLEAR_MEMVIEW(&__pyx_v_pathview, 1);
-  __Pyx_XDECREF(__pyx_7genexpr__pyx_v_coord);
+  __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_coord);
   __Pyx_XDECREF(__pyx_v_path);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":769
+/* "ext/skeletontricks/skeletontricks.pyx":806
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_31find_cycle_cython(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_33find_cycle_cython(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_30find_cycle_cython, "\n  Given a graph of edges that are a single connected component,\n  find a cycle via depth first search.\n\n  Returns: list of edges in a cycle (empty list if no cycle is found)\n  ");
-static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_31find_cycle_cython = {"find_cycle_cython", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_31find_cycle_cython, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_30find_cycle_cython};
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_31find_cycle_cython(PyObject *__pyx_self, 
+PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_32find_cycle_cython, "\n  Given a graph of edges that are a single connected component,\n  find a cycle via depth first search.\n\n  Returns: list of edges in a cycle (empty list if no cycle is found)\n  ");
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_33find_cycle_cython = {"find_cycle_cython", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_33find_cycle_cython, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_cycle_cython};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_33find_cycle_cython(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyArrayObject *__pyx_v_edges = 0;
@@ -63439,46 +64652,46 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_edges)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 769, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 806, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_cycle_cython") < 0)) __PYX_ERR(0, 769, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_cycle_cython") < 0)) __PYX_ERR(0, 806, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_edges = ((PyArrayObject *)values[0]);
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_cycle_cython", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 769, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_cycle_cython", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 806, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_cycle_cython", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_edges), __pyx_ptype_5numpy_ndarray, 1, "edges", 0))) __PYX_ERR(0, 772, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_30find_cycle_cython(__pyx_self, __pyx_v_edges);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_edges), __pyx_ptype_5numpy_ndarray, 1, "edges", 0))) __PYX_ERR(0, 809, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_32find_cycle_cython(__pyx_self, __pyx_v_edges);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -63487,15 +64700,15 @@
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_30find_cycle_cython(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_edges) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_32find_cycle_cython(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_edges) {
   PyObject *__pyx_v_index = NULL;
   PyObject *__pyx_v_visited = NULL;
   PyObject *__pyx_v_e1 = NULL;
   PyObject *__pyx_v_e2 = NULL;
   int __pyx_v_root;
   int __pyx_v_node;
   int __pyx_v_child;
@@ -63531,26 +64744,26 @@
   __Pyx_RefNannySetupContext("find_cycle_cython", 1);
   __pyx_pybuffer_edges.pybuffer.buf = NULL;
   __pyx_pybuffer_edges.refcount = 0;
   __pyx_pybuffernd_edges.data = NULL;
   __pyx_pybuffernd_edges.rcbuffer = &__pyx_pybuffer_edges;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_edges.rcbuffer->pybuffer, (PyObject*)__pyx_v_edges, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 769, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_edges.rcbuffer->pybuffer, (PyObject*)__pyx_v_edges, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 806, __pyx_L1_error)
   }
   __pyx_pybuffernd_edges.diminfo[0].strides = __pyx_pybuffernd_edges.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_edges.diminfo[0].shape = __pyx_pybuffernd_edges.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_edges.diminfo[1].strides = __pyx_pybuffernd_edges.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_edges.diminfo[1].shape = __pyx_pybuffernd_edges.rcbuffer->pybuffer.shape[1];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":779
+  /* "ext/skeletontricks/skeletontricks.pyx":816
  *   Returns: list of edges in a cycle (empty list if no cycle is found)
  *   """
  *   index = defaultdict(set)             # <<<<<<<<<<<<<<
  *   visited = defaultdict(int)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 779, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 816, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
@@ -63562,29 +64775,29 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_3, ((PyObject *)(&PySet_Type))};
     __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 779, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 816, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
   __pyx_v_index = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":780
+  /* "ext/skeletontricks/skeletontricks.pyx":817
  *   """
  *   index = defaultdict(set)
  *   visited = defaultdict(int)             # <<<<<<<<<<<<<<
  * 
  *   if edges.size == 0:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 780, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 817, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
@@ -63596,199 +64809,199 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_3, ((PyObject *)(&PyInt_Type))};
     __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 780, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 817, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
   __pyx_v_visited = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":782
+  /* "ext/skeletontricks/skeletontricks.pyx":819
  *   visited = defaultdict(int)
  * 
  *   if edges.size == 0:             # <<<<<<<<<<<<<<
  *     return np.array([], dtype=np.int32)
  * 
  */
-  __pyx_t_5 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_edges)); if (unlikely(__pyx_t_5 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 782, __pyx_L1_error)
+  __pyx_t_5 = __pyx_f_5numpy_7ndarray_4size_size(((PyArrayObject *)__pyx_v_edges)); if (unlikely(__pyx_t_5 == ((npy_intp)-1) && PyErr_Occurred())) __PYX_ERR(0, 819, __pyx_L1_error)
   __pyx_t_6 = (__pyx_t_5 == 0);
   if (__pyx_t_6) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":783
+    /* "ext/skeletontricks/skeletontricks.pyx":820
  * 
  *   if edges.size == 0:
  *     return np.array([], dtype=np.int32)             # <<<<<<<<<<<<<<
  * 
  *   for e1, e2 in edges:
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 783, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 820, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 783, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 820, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 783, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 820, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 783, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 820, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_1);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1)) __PYX_ERR(0, 783, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1)) __PYX_ERR(0, 820, __pyx_L1_error);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 783, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 820, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 783, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 820, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 783, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 820, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 783, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 820, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 783, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 820, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_r = __pyx_t_8;
     __pyx_t_8 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":782
+    /* "ext/skeletontricks/skeletontricks.pyx":819
  *   visited = defaultdict(int)
  * 
  *   if edges.size == 0:             # <<<<<<<<<<<<<<
  *     return np.array([], dtype=np.int32)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":785
+  /* "ext/skeletontricks/skeletontricks.pyx":822
  *     return np.array([], dtype=np.int32)
  * 
  *   for e1, e2 in edges:             # <<<<<<<<<<<<<<
  *     index[e1].add(e2)
  *     index[e2].add(e1)
  */
   if (likely(PyList_CheckExact(((PyObject *)__pyx_v_edges))) || PyTuple_CheckExact(((PyObject *)__pyx_v_edges))) {
     __pyx_t_8 = ((PyObject *)__pyx_v_edges); __Pyx_INCREF(__pyx_t_8);
     __pyx_t_9 = 0;
     __pyx_t_10 = NULL;
   } else {
-    __pyx_t_9 = -1; __pyx_t_8 = PyObject_GetIter(((PyObject *)__pyx_v_edges)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 785, __pyx_L1_error)
+    __pyx_t_9 = -1; __pyx_t_8 = PyObject_GetIter(((PyObject *)__pyx_v_edges)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 822, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 785, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 822, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_10)) {
       if (likely(PyList_CheckExact(__pyx_t_8))) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_8);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 785, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 822, __pyx_L1_error)
           #endif
           if (__pyx_t_9 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 785, __pyx_L1_error)
+        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 822, __pyx_L1_error)
         #else
-        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 785, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 822, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       } else {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_8);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 785, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 822, __pyx_L1_error)
           #endif
           if (__pyx_t_9 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 785, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_9); __Pyx_INCREF(__pyx_t_1); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 822, __pyx_L1_error)
         #else
-        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 785, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 822, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       }
     } else {
       __pyx_t_1 = __pyx_t_10(__pyx_t_8);
       if (unlikely(!__pyx_t_1)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 785, __pyx_L1_error)
+          else __PYX_ERR(0, 822, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_1);
     }
     if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
       PyObject* sequence = __pyx_t_1;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 2)) {
         if (size > 2) __Pyx_RaiseTooManyValuesError(2);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 785, __pyx_L1_error)
+        __PYX_ERR(0, 822, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
       } else {
         __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
         __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
       }
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       #else
-      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 785, __pyx_L1_error)
+      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 822, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 785, __pyx_L1_error)
+      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 822, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_7 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 785, __pyx_L1_error)
+      __pyx_t_7 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 822, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
       index = 0; __pyx_t_3 = __pyx_t_11(__pyx_t_7); if (unlikely(!__pyx_t_3)) goto __pyx_L6_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_3);
       index = 1; __pyx_t_2 = __pyx_t_11(__pyx_t_7); if (unlikely(!__pyx_t_2)) goto __pyx_L6_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_2);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_11(__pyx_t_7), 2) < 0) __PYX_ERR(0, 785, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_11(__pyx_t_7), 2) < 0) __PYX_ERR(0, 822, __pyx_L1_error)
       __pyx_t_11 = NULL;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       goto __pyx_L7_unpacking_done;
       __pyx_L6_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __pyx_t_11 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 785, __pyx_L1_error)
+      __PYX_ERR(0, 822, __pyx_L1_error)
       __pyx_L7_unpacking_done:;
     }
     __Pyx_XDECREF_SET(__pyx_v_e1, __pyx_t_3);
     __pyx_t_3 = 0;
     __Pyx_XDECREF_SET(__pyx_v_e2, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":786
+    /* "ext/skeletontricks/skeletontricks.pyx":823
  * 
  *   for e1, e2 in edges:
  *     index[e1].add(e2)             # <<<<<<<<<<<<<<
  *     index[e2].add(e1)
  * 
  */
-    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_index, __pyx_v_e1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 786, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_index, __pyx_v_e1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_add); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 786, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_add); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = NULL;
     __pyx_t_4 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
@@ -63801,30 +65014,30 @@
       }
     }
     #endif
     {
       PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_e2};
       __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
       __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 786, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":787
+    /* "ext/skeletontricks/skeletontricks.pyx":824
  *   for e1, e2 in edges:
  *     index[e1].add(e2)
  *     index[e2].add(e1)             # <<<<<<<<<<<<<<
  * 
  *   cdef int root = edges[0,0]
  */
-    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_index, __pyx_v_e2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 787, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_index, __pyx_v_e2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 824, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_add); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 787, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_add); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 824, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     __pyx_t_4 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
@@ -63837,618 +65050,618 @@
       }
     }
     #endif
     {
       PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_e1};
       __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
       __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 787, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 824, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":785
+    /* "ext/skeletontricks/skeletontricks.pyx":822
  *     return np.array([], dtype=np.int32)
  * 
  *   for e1, e2 in edges:             # <<<<<<<<<<<<<<
  *     index[e1].add(e2)
  *     index[e2].add(e1)
  */
   }
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":789
+  /* "ext/skeletontricks/skeletontricks.pyx":826
  *     index[e2].add(e1)
  * 
  *   cdef int root = edges[0,0]             # <<<<<<<<<<<<<<
  *   cdef int node = -1
  *   cdef int child = -1
  */
   __pyx_t_12 = 0;
   __pyx_t_13 = 0;
   __pyx_v_root = (*__Pyx_BufPtrStrided2d(int32_t *, __pyx_pybuffernd_edges.rcbuffer->pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_edges.diminfo[0].strides, __pyx_t_13, __pyx_pybuffernd_edges.diminfo[1].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":790
+  /* "ext/skeletontricks/skeletontricks.pyx":827
  * 
  *   cdef int root = edges[0,0]
  *   cdef int node = -1             # <<<<<<<<<<<<<<
  *   cdef int child = -1
  *   cdef int parent = -1
  */
   __pyx_v_node = -1;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":791
+  /* "ext/skeletontricks/skeletontricks.pyx":828
  *   cdef int root = edges[0,0]
  *   cdef int node = -1
  *   cdef int child = -1             # <<<<<<<<<<<<<<
  *   cdef int parent = -1
  *   cdef int depth = -1
  */
   __pyx_v_child = -1;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":792
+  /* "ext/skeletontricks/skeletontricks.pyx":829
  *   cdef int node = -1
  *   cdef int child = -1
  *   cdef int parent = -1             # <<<<<<<<<<<<<<
  *   cdef int depth = -1
  *   cdef int i = 0
  */
   __pyx_v_parent = -1;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":793
+  /* "ext/skeletontricks/skeletontricks.pyx":830
  *   cdef int child = -1
  *   cdef int parent = -1
  *   cdef int depth = -1             # <<<<<<<<<<<<<<
  *   cdef int i = 0
  * 
  */
   __pyx_v_depth = -1;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":794
+  /* "ext/skeletontricks/skeletontricks.pyx":831
  *   cdef int parent = -1
  *   cdef int depth = -1
  *   cdef int i = 0             # <<<<<<<<<<<<<<
  * 
  *   cdef list stack = [root]
  */
   __pyx_v_i = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":796
+  /* "ext/skeletontricks/skeletontricks.pyx":833
  *   cdef int i = 0
  * 
  *   cdef list stack = [root]             # <<<<<<<<<<<<<<
  *   cdef list parents = [-1]
  *   cdef list depth_stack = [0]
  */
-  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_root); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 796, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_root); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 833, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 796, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 833, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_8);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_8)) __PYX_ERR(0, 796, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_8)) __PYX_ERR(0, 833, __pyx_L1_error);
   __pyx_t_8 = 0;
   __pyx_v_stack = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":797
+  /* "ext/skeletontricks/skeletontricks.pyx":834
  * 
  *   cdef list stack = [root]
  *   cdef list parents = [-1]             # <<<<<<<<<<<<<<
  *   cdef list depth_stack = [0]
  *   cdef list path = []
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 797, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 834, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1)) __PYX_ERR(0, 797, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_neg_1)) __PYX_ERR(0, 834, __pyx_L1_error);
   __pyx_v_parents = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":798
+  /* "ext/skeletontricks/skeletontricks.pyx":835
  *   cdef list stack = [root]
  *   cdef list parents = [-1]
  *   cdef list depth_stack = [0]             # <<<<<<<<<<<<<<
  *   cdef list path = []
  * 
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 798, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 835, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_int_0);
   __Pyx_GIVEREF(__pyx_int_0);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0)) __PYX_ERR(0, 798, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0)) __PYX_ERR(0, 835, __pyx_L1_error);
   __pyx_v_depth_stack = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":799
+  /* "ext/skeletontricks/skeletontricks.pyx":836
  *   cdef list parents = [-1]
  *   cdef list depth_stack = [0]
  *   cdef list path = []             # <<<<<<<<<<<<<<
  * 
  *   while stack:
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 799, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_path = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":801
+  /* "ext/skeletontricks/skeletontricks.pyx":838
  *   cdef list path = []
  * 
  *   while stack:             # <<<<<<<<<<<<<<
  *     node = stack.pop()
  *     parent = parents.pop()
  */
   while (1) {
     __pyx_t_6 = (PyList_GET_SIZE(__pyx_v_stack) != 0);
     if (!__pyx_t_6) break;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":802
+    /* "ext/skeletontricks/skeletontricks.pyx":839
  * 
  *   while stack:
  *     node = stack.pop()             # <<<<<<<<<<<<<<
  *     parent = parents.pop()
  *     depth = depth_stack.pop()
  */
-    __pyx_t_1 = __Pyx_PyList_Pop(__pyx_v_stack); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 802, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyList_Pop(__pyx_v_stack); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 839, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 802, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_v_node = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":803
+    /* "ext/skeletontricks/skeletontricks.pyx":840
  *   while stack:
  *     node = stack.pop()
  *     parent = parents.pop()             # <<<<<<<<<<<<<<
  *     depth = depth_stack.pop()
  * 
  */
-    __pyx_t_1 = __Pyx_PyList_Pop(__pyx_v_parents); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 803, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyList_Pop(__pyx_v_parents); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 840, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 803, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 840, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_v_parent = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":804
+    /* "ext/skeletontricks/skeletontricks.pyx":841
  *     node = stack.pop()
  *     parent = parents.pop()
  *     depth = depth_stack.pop()             # <<<<<<<<<<<<<<
  * 
  *     for i in range(len(path) - depth):
  */
-    __pyx_t_1 = __Pyx_PyList_Pop(__pyx_v_depth_stack); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 804, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyList_Pop(__pyx_v_depth_stack); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 841, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 804, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 841, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_v_depth = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":806
+    /* "ext/skeletontricks/skeletontricks.pyx":843
  *     depth = depth_stack.pop()
  * 
  *     for i in range(len(path) - depth):             # <<<<<<<<<<<<<<
  *       path.pop()
  * 
  */
-    __pyx_t_9 = __Pyx_PyList_GET_SIZE(__pyx_v_path); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 806, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyList_GET_SIZE(__pyx_v_path); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 843, __pyx_L1_error)
     __pyx_t_14 = (__pyx_t_9 - __pyx_v_depth);
     __pyx_t_9 = __pyx_t_14;
     for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_9; __pyx_t_4+=1) {
       __pyx_v_i = __pyx_t_4;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":807
+      /* "ext/skeletontricks/skeletontricks.pyx":844
  * 
  *     for i in range(len(path) - depth):
  *       path.pop()             # <<<<<<<<<<<<<<
  * 
  *     path.append(node)
  */
-      __pyx_t_1 = __Pyx_PyList_Pop(__pyx_v_path); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 807, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyList_Pop(__pyx_v_path); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 844, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":809
+    /* "ext/skeletontricks/skeletontricks.pyx":846
  *       path.pop()
  * 
  *     path.append(node)             # <<<<<<<<<<<<<<
  * 
  *     if visited[node] == 1:
  */
-    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_node); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_node); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 846, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_15 = __Pyx_PyList_Append(__pyx_v_path, __pyx_t_1); if (unlikely(__pyx_t_15 == ((int)-1))) __PYX_ERR(0, 809, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyList_Append(__pyx_v_path, __pyx_t_1); if (unlikely(__pyx_t_15 == ((int)-1))) __PYX_ERR(0, 846, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":811
+    /* "ext/skeletontricks/skeletontricks.pyx":848
  *     path.append(node)
  * 
  *     if visited[node] == 1:             # <<<<<<<<<<<<<<
  *       break
  * 
  */
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_visited, __pyx_v_node, int, 1, __Pyx_PyInt_From_int, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 811, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_visited, __pyx_v_node, int, 1, __Pyx_PyInt_From_int, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 848, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = (__Pyx_PyInt_BoolEqObjC(__pyx_t_1, __pyx_int_1, 1, 0)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 811, __pyx_L1_error)
+    __pyx_t_6 = (__Pyx_PyInt_BoolEqObjC(__pyx_t_1, __pyx_int_1, 1, 0)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 848, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (__pyx_t_6) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":812
+      /* "ext/skeletontricks/skeletontricks.pyx":849
  * 
  *     if visited[node] == 1:
  *       break             # <<<<<<<<<<<<<<
  * 
  *     visited[node] = 1
  */
       goto __pyx_L10_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":811
+      /* "ext/skeletontricks/skeletontricks.pyx":848
  *     path.append(node)
  * 
  *     if visited[node] == 1:             # <<<<<<<<<<<<<<
  *       break
  * 
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":814
+    /* "ext/skeletontricks/skeletontricks.pyx":851
  *       break
  * 
  *     visited[node] = 1             # <<<<<<<<<<<<<<
  * 
  *     for child in index[node]:
  */
-    if (unlikely((__Pyx_SetItemInt(__pyx_v_visited, __pyx_v_node, __pyx_int_1, int, 1, __Pyx_PyInt_From_int, 0, 0, 0) < 0))) __PYX_ERR(0, 814, __pyx_L1_error)
+    if (unlikely((__Pyx_SetItemInt(__pyx_v_visited, __pyx_v_node, __pyx_int_1, int, 1, __Pyx_PyInt_From_int, 0, 0, 0) < 0))) __PYX_ERR(0, 851, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":816
+    /* "ext/skeletontricks/skeletontricks.pyx":853
  *     visited[node] = 1
  * 
  *     for child in index[node]:             # <<<<<<<<<<<<<<
  *       if child != parent:
  *         stack.append(child)
  */
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_index, __pyx_v_node, int, 1, __Pyx_PyInt_From_int, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 816, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_index, __pyx_v_node, int, 1, __Pyx_PyInt_From_int, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 853, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
       __pyx_t_8 = __pyx_t_1; __Pyx_INCREF(__pyx_t_8);
       __pyx_t_14 = 0;
       __pyx_t_10 = NULL;
     } else {
-      __pyx_t_14 = -1; __pyx_t_8 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 816, __pyx_L1_error)
+      __pyx_t_14 = -1; __pyx_t_8 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 816, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 853, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     for (;;) {
       if (likely(!__pyx_t_10)) {
         if (likely(PyList_CheckExact(__pyx_t_8))) {
           {
             Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_8);
             #if !CYTHON_ASSUME_SAFE_MACROS
-            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 816, __pyx_L1_error)
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 853, __pyx_L1_error)
             #endif
             if (__pyx_t_14 >= __pyx_temp) break;
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 816, __pyx_L1_error)
+          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 853, __pyx_L1_error)
           #else
-          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 816, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 853, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           #endif
         } else {
           {
             Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_8);
             #if !CYTHON_ASSUME_SAFE_MACROS
-            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 816, __pyx_L1_error)
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 853, __pyx_L1_error)
             #endif
             if (__pyx_t_14 >= __pyx_temp) break;
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 816, __pyx_L1_error)
+          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 853, __pyx_L1_error)
           #else
-          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 816, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 853, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           #endif
         }
       } else {
         __pyx_t_1 = __pyx_t_10(__pyx_t_8);
         if (unlikely(!__pyx_t_1)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 816, __pyx_L1_error)
+            else __PYX_ERR(0, 853, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_1);
       }
-      __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 816, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_t_1); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 853, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_v_child = __pyx_t_4;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":817
+      /* "ext/skeletontricks/skeletontricks.pyx":854
  * 
  *     for child in index[node]:
  *       if child != parent:             # <<<<<<<<<<<<<<
  *         stack.append(child)
  *         parents.append(node)
  */
       __pyx_t_6 = (__pyx_v_child != __pyx_v_parent);
       if (__pyx_t_6) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":818
+        /* "ext/skeletontricks/skeletontricks.pyx":855
  *     for child in index[node]:
  *       if child != parent:
  *         stack.append(child)             # <<<<<<<<<<<<<<
  *         parents.append(node)
  *         depth_stack.append(depth + 1)
  */
-        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_child); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 818, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_child); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 855, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_15 = __Pyx_PyList_Append(__pyx_v_stack, __pyx_t_1); if (unlikely(__pyx_t_15 == ((int)-1))) __PYX_ERR(0, 818, __pyx_L1_error)
+        __pyx_t_15 = __Pyx_PyList_Append(__pyx_v_stack, __pyx_t_1); if (unlikely(__pyx_t_15 == ((int)-1))) __PYX_ERR(0, 855, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":819
+        /* "ext/skeletontricks/skeletontricks.pyx":856
  *       if child != parent:
  *         stack.append(child)
  *         parents.append(node)             # <<<<<<<<<<<<<<
  *         depth_stack.append(depth + 1)
  * 
  */
-        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_node); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 819, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_node); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 856, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_15 = __Pyx_PyList_Append(__pyx_v_parents, __pyx_t_1); if (unlikely(__pyx_t_15 == ((int)-1))) __PYX_ERR(0, 819, __pyx_L1_error)
+        __pyx_t_15 = __Pyx_PyList_Append(__pyx_v_parents, __pyx_t_1); if (unlikely(__pyx_t_15 == ((int)-1))) __PYX_ERR(0, 856, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":820
+        /* "ext/skeletontricks/skeletontricks.pyx":857
  *         stack.append(child)
  *         parents.append(node)
  *         depth_stack.append(depth + 1)             # <<<<<<<<<<<<<<
  * 
  *   if len(path) <= 1:
  */
-        __pyx_t_1 = __Pyx_PyInt_From_long((__pyx_v_depth + 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 820, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyInt_From_long((__pyx_v_depth + 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 857, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_15 = __Pyx_PyList_Append(__pyx_v_depth_stack, __pyx_t_1); if (unlikely(__pyx_t_15 == ((int)-1))) __PYX_ERR(0, 820, __pyx_L1_error)
+        __pyx_t_15 = __Pyx_PyList_Append(__pyx_v_depth_stack, __pyx_t_1); if (unlikely(__pyx_t_15 == ((int)-1))) __PYX_ERR(0, 857, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":817
+        /* "ext/skeletontricks/skeletontricks.pyx":854
  * 
  *     for child in index[node]:
  *       if child != parent:             # <<<<<<<<<<<<<<
  *         stack.append(child)
  *         parents.append(node)
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":816
+      /* "ext/skeletontricks/skeletontricks.pyx":853
  *     visited[node] = 1
  * 
  *     for child in index[node]:             # <<<<<<<<<<<<<<
  *       if child != parent:
  *         stack.append(child)
  */
     }
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_L10_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":822
+  /* "ext/skeletontricks/skeletontricks.pyx":859
  *         depth_stack.append(depth + 1)
  * 
  *   if len(path) <= 1:             # <<<<<<<<<<<<<<
  *     return np.array([], dtype=np.int32)
  * 
  */
-  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_path); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 822, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_path); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 859, __pyx_L1_error)
   __pyx_t_6 = (__pyx_t_14 <= 1);
   if (__pyx_t_6) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":823
+    /* "ext/skeletontricks/skeletontricks.pyx":860
  * 
  *   if len(path) <= 1:
  *     return np.array([], dtype=np.int32)             # <<<<<<<<<<<<<<
  * 
  *   for i in range(len(path) - 1):
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 860, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 860, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_8)) __PYX_ERR(0, 823, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error);
     __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 860, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 860, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 823, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 860, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 823, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 860, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_r = __pyx_t_7;
     __pyx_t_7 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":822
+    /* "ext/skeletontricks/skeletontricks.pyx":859
  *         depth_stack.append(depth + 1)
  * 
  *   if len(path) <= 1:             # <<<<<<<<<<<<<<
  *     return np.array([], dtype=np.int32)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":825
+  /* "ext/skeletontricks/skeletontricks.pyx":862
  *     return np.array([], dtype=np.int32)
  * 
  *   for i in range(len(path) - 1):             # <<<<<<<<<<<<<<
  *     if path[i] == node:
  *       break
  */
-  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_path); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 825, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_path); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 862, __pyx_L1_error)
   __pyx_t_9 = (__pyx_t_14 - 1);
   __pyx_t_14 = __pyx_t_9;
   for (__pyx_t_4 = 0; __pyx_t_4 < __pyx_t_14; __pyx_t_4+=1) {
     __pyx_v_i = __pyx_t_4;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":826
+    /* "ext/skeletontricks/skeletontricks.pyx":863
  * 
  *   for i in range(len(path) - 1):
  *     if path[i] == node:             # <<<<<<<<<<<<<<
  *       break
  * 
  */
-    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_node); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 826, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_node); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 863, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = PyObject_RichCompare(PyList_GET_ITEM(__pyx_v_path, __pyx_v_i), __pyx_t_7, Py_EQ); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 826, __pyx_L1_error)
+    __pyx_t_8 = PyObject_RichCompare(PyList_GET_ITEM(__pyx_v_path, __pyx_v_i), __pyx_t_7, Py_EQ); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 863, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 826, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 863, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     if (__pyx_t_6) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":827
+      /* "ext/skeletontricks/skeletontricks.pyx":864
  *   for i in range(len(path) - 1):
  *     if path[i] == node:
  *       break             # <<<<<<<<<<<<<<
  * 
  *   path = path[i:]
  */
       goto __pyx_L20_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":826
+      /* "ext/skeletontricks/skeletontricks.pyx":863
  * 
  *   for i in range(len(path) - 1):
  *     if path[i] == node:             # <<<<<<<<<<<<<<
  *       break
  * 
  */
     }
   }
   __pyx_L20_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":829
+  /* "ext/skeletontricks/skeletontricks.pyx":866
  *       break
  * 
  *   path = path[i:]             # <<<<<<<<<<<<<<
  * 
  *   if len(path) < 3:
  */
-  __pyx_t_8 = __Pyx_PyList_GetSlice(__pyx_v_path, __pyx_v_i, PY_SSIZE_T_MAX); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 829, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyList_GetSlice(__pyx_v_path, __pyx_v_i, PY_SSIZE_T_MAX); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF_SET(__pyx_v_path, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":831
+  /* "ext/skeletontricks/skeletontricks.pyx":868
  *   path = path[i:]
  * 
  *   if len(path) < 3:             # <<<<<<<<<<<<<<
  *     return np.array([], dtype=np.int32)
  * 
  */
-  __pyx_t_9 = __Pyx_PyList_GET_SIZE(__pyx_v_path); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 831, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyList_GET_SIZE(__pyx_v_path); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 868, __pyx_L1_error)
   __pyx_t_6 = (__pyx_t_9 < 3);
   if (__pyx_t_6) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":832
+    /* "ext/skeletontricks/skeletontricks.pyx":869
  * 
  *   if len(path) < 3:
  *     return np.array([], dtype=np.int32)             # <<<<<<<<<<<<<<
  * 
  *   return np.array(path, dtype=np.int32)
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 869, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_array); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_array); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 869, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 869, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 869, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_8)) __PYX_ERR(0, 832, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_8)) __PYX_ERR(0, 869, __pyx_L1_error);
     __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 869, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 869, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 869, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 832, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 869, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_2, __pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_2, __pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 869, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":831
+    /* "ext/skeletontricks/skeletontricks.pyx":868
  *   path = path[i:]
  * 
  *   if len(path) < 3:             # <<<<<<<<<<<<<<
  *     return np.array([], dtype=np.int32)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":834
+  /* "ext/skeletontricks/skeletontricks.pyx":871
  *     return np.array([], dtype=np.int32)
  * 
  *   return np.array(path, dtype=np.int32)             # <<<<<<<<<<<<<<
  * 
  * def find_avocado_fruit(
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 834, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 871, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 834, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 871, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 834, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 871, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_v_path);
   __Pyx_GIVEREF(__pyx_v_path);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_path)) __PYX_ERR(0, 834, __pyx_L1_error);
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 834, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_path)) __PYX_ERR(0, 871, __pyx_L1_error);
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 871, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 834, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 871, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 834, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int32); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 871, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 834, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 871, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 834, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 871, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":769
+  /* "ext/skeletontricks/skeletontricks.pyx":806
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
 
@@ -64480,27 +65693,27 @@
   __Pyx_XDECREF(__pyx_v_depth_stack);
   __Pyx_XDECREF(__pyx_v_path);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":836
+/* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_33find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit, "\n  Tests to see if the current coordinate is inside \n  the nucleus of a somata that has been assigned\n  to a separate label from the rest of the cell.\n\n  Returns: (pit, fruit)\n  ");
-static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_33find_avocado_fruit = {"find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_33find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_33find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_35find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+PyDoc_STRVAR(__pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit, "\n  Tests to see if the current coordinate is inside \n  the nucleus of a somata that has been assigned\n  to a separate label from the rest of the cell.\n\n  Returns: (pit, fruit)\n  ");
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_35find_avocado_fruit = {"find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_35find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_35find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_signatures = 0;
   PyObject *__pyx_v_args = 0;
   PyObject *__pyx_v_kwargs = 0;
   CYTHON_UNUSED PyObject *__pyx_v_defaults = 0;
   PyObject *__pyx_v__fused_sigindex = 0;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -64540,57 +65753,57 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_signatures)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_args)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_kwargs)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_defaults)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_fused_sigindex);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_fused_cpdef") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
@@ -64604,42 +65817,42 @@
     __pyx_v_args = values[1];
     __pyx_v_kwargs = values[2];
     __pyx_v_defaults = values[3];
     __pyx_v__fused_sigindex = values[4];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__pyx_fused_cpdef", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_32find_avocado_fruit(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults, __pyx_v__fused_sigindex);
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_34find_avocado_fruit(__pyx_self, __pyx_v_signatures, __pyx_v_args, __pyx_v_kwargs, __pyx_v_defaults, __pyx_v__fused_sigindex);
 
   /* function exit code */
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_32find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_34find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_signatures, PyObject *__pyx_v_args, PyObject *__pyx_v_kwargs, CYTHON_UNUSED PyObject *__pyx_v_defaults, PyObject *__pyx_v__fused_sigindex) {
   PyObject *__pyx_v_search_list = 0;
   PyObject *__pyx_v_sigindex_node = 0;
   PyObject *__pyx_v_dest_sig = NULL;
   PyTypeObject *__pyx_v_ndarray = 0;
   PyObject *__pyx_v_arg_as_memoryview = 0;
   __Pyx_memviewslice __pyx_v_memslice;
   Py_ssize_t __pyx_v_itemsize;
@@ -64691,36 +65904,36 @@
   Py_ssize_t __pyx_t_18;
   int __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("find_avocado_fruit", 0);
   __Pyx_INCREF(__pyx_v_kwargs);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, Py_None)) __PYX_ERR(0, 836, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, Py_None)) __PYX_ERR(0, 873, __pyx_L1_error);
   __pyx_v_dest_sig = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_t_3 = (__pyx_v_kwargs != Py_None);
   if (__pyx_t_3) {
   } else {
     __pyx_t_2 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_kwargs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_3);
   __pyx_t_2 = __pyx_t_4;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_kwargs, Py_None);
   }
-  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__Pyx_ImportNumPyArrayTypeIfAvailable()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_ndarray = ((PyTypeObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   __pyx_v_itemsize = -1L;
   __pyx_v___pyx_fused_dtype_int8__t_is_signed = (!(((int8_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_int16__t_is_signed = (!(((int16_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_int32__t_is_signed = (!(((int32_t)-1L) > 0));
@@ -64728,103 +65941,103 @@
   __pyx_v___pyx_fused_dtype_uint8__t_is_signed = (!(((uint8_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint16__t_is_signed = (!(((uint16_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint32__t_is_signed = (!(((uint32_t)-1L) > 0));
   __pyx_v___pyx_fused_dtype_uint64__t_is_signed = (!(((uint64_t)-1L) > 0));
   __pyx_v_unsigned_char_is_signed = (!(((unsigned char)-1L) > 0));
   if (unlikely(__pyx_v_args == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 836, __pyx_L1_error)
+    __PYX_ERR(0, 873, __pyx_L1_error)
   }
-  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 873, __pyx_L1_error)
   __pyx_t_2 = (0 < __pyx_t_5);
   if (__pyx_t_2) {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 836, __pyx_L1_error)
+      __PYX_ERR(0, 873, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_GetItemInt_Tuple(((PyObject*)__pyx_v_args), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt_Tuple(((PyObject*)__pyx_v_args), 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   __pyx_t_4 = (__pyx_v_kwargs != Py_None);
   if (__pyx_t_4) {
   } else {
     __pyx_t_2 = __pyx_t_4;
     goto __pyx_L7_bool_binop_done;
   }
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-    __PYX_ERR(0, 836, __pyx_L1_error)
+    __PYX_ERR(0, 873, __pyx_L1_error)
   }
-  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_n_s_labels, ((PyObject*)__pyx_v_kwargs), Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
   __pyx_t_2 = __pyx_t_4;
   __pyx_L7_bool_binop_done:;
   if (likely(__pyx_t_2)) {
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 836, __pyx_L1_error)
+      __PYX_ERR(0, 873, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_kwargs), __pyx_n_s_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_arg = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L6;
   }
   /*else*/ {
     if (unlikely(__pyx_v_args == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 836, __pyx_L1_error)
+      __PYX_ERR(0, 873, __pyx_L1_error)
     }
-    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 836, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyTuple_GET_SIZE(((PyObject*)__pyx_v_args)); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 873, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_int_4);
     __Pyx_GIVEREF(__pyx_int_4);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4)) __PYX_ERR(0, 836, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_int_4)) __PYX_ERR(0, 873, __pyx_L1_error);
     __Pyx_INCREF(__pyx_n_s_s);
     __Pyx_GIVEREF(__pyx_n_s_s);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 836, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_n_s_s)) __PYX_ERR(0, 873, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_1);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Expected_at_least_d_argument_s_g, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_Raise(__pyx_t_6, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __PYX_ERR(0, 836, __pyx_L1_error)
+    __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_L6:;
   while (1) {
     __pyx_t_2 = (__pyx_v_ndarray != ((PyTypeObject*)Py_None));
     if (__pyx_t_2) {
       __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg, __pyx_v_ndarray); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_dtype = __pyx_t_6;
         __pyx_t_6 = 0;
         goto __pyx_L12;
       }
       __pyx_t_2 = __pyx_memoryview_check(__pyx_v_arg); 
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_base); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_base = __pyx_t_6;
         __pyx_t_6 = 0;
         __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_arg_base, __pyx_v_ndarray); 
         if (__pyx_t_2) {
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg_base, __pyx_n_s_dtype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_v_dtype = __pyx_t_6;
           __pyx_t_6 = 0;
           goto __pyx_L13;
         }
         /*else*/ {
           __Pyx_INCREF(Py_None);
@@ -64837,233 +66050,233 @@
         __Pyx_INCREF(Py_None);
         __pyx_v_dtype = Py_None;
       }
       __pyx_L12:;
       __pyx_v_itemsize = -1L;
       __pyx_t_2 = (__pyx_v_dtype != Py_None);
       if (__pyx_t_2) {
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_itemsize); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_itemsize = __pyx_t_5;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_dtype, __pyx_n_s_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_Ord(__pyx_t_6); if (unlikely(__pyx_t_7 == ((long)(long)(Py_UCS4)-1))) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_v_kind = __pyx_t_7;
         __pyx_v_dtype_signed = (__pyx_v_kind == 0x69);
         switch (__pyx_v_kind) {
           case 0x69:
           case 0x75:
           __pyx_t_4 = ((sizeof(int8_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L16_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int8__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L16_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(int16_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L20_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int16__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L20_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(int32_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L24_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int32__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L24_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(int64_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L28_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_int64__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L28_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint8_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L32_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint8__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L32_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint16_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L36_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L36_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint16__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L36_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint32_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L40_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L40_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint32__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L40_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(uint64_t)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L44_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L44_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v___pyx_fused_dtype_uint64__t_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L44_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           __pyx_t_4 = ((sizeof(unsigned char)) == __pyx_v_itemsize);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L48_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_arg, __pyx_n_s_ndim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_4 = (((Py_ssize_t)__pyx_t_5) == 3);
           if (__pyx_t_4) {
           } else {
             __pyx_t_2 = __pyx_t_4;
             goto __pyx_L48_bool_binop_done;
           }
           __pyx_t_4 = (!(__pyx_v_unsigned_char_is_signed ^ __pyx_v_dtype_signed));
           __pyx_t_2 = __pyx_t_4;
           __pyx_L48_bool_binop_done:;
           if (__pyx_t_2) {
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             goto __pyx_L10_break;
           }
           break;
           case 0x66:
           break;
           case 99:
           break;
@@ -65071,349 +66284,349 @@
           break;
           default: break;
         }
       }
     }
     __pyx_t_2 = (__pyx_v_arg == Py_None);
     if (__pyx_t_2) {
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
       goto __pyx_L10_break;
     }
     {
       __Pyx_PyThreadState_declare
       __Pyx_PyThreadState_assign
       __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
       __Pyx_XGOTREF(__pyx_t_8);
       __Pyx_XGOTREF(__pyx_t_9);
       __Pyx_XGOTREF(__pyx_t_10);
       /*try:*/ {
-        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L52_error)
+        __pyx_t_6 = PyMemoryView_FromObject(__pyx_v_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L52_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_v_arg_as_memoryview = ((PyObject*)__pyx_t_6);
         __pyx_t_6 = 0;
       }
       /*else:*/ {
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L63_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int8_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L62_next_and;
         }
         __pyx_L63_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int8_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L61_bool_binop_done;
         }
         __pyx_L62_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L61_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int8_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L69_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int16_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L68_next_and;
         }
         __pyx_L69_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int16_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L67_bool_binop_done;
         }
         __pyx_L68_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L67_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int16_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L75_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int32_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L74_next_and;
         }
         __pyx_L75_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int32_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L73_bool_binop_done;
         }
         __pyx_L74_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L73_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int32_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L81_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(int64_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L80_next_and;
         }
         __pyx_L81_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(int64_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L79_bool_binop_done;
         }
         __pyx_L80_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L79_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_int64_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_int64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L87_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint8_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L86_next_and;
         }
         __pyx_L87_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint8_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L85_bool_binop_done;
         }
         __pyx_L86_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L85_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint8_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint8_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L93_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint16_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L92_next_and;
         }
         __pyx_L93_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint16_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L91_bool_binop_done;
         }
         __pyx_L92_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L91_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint16_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint16_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L99_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint32_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L98_next_and;
         }
         __pyx_L99_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint32_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L97_bool_binop_done;
         }
         __pyx_L98_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L97_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint32_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint32_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L105_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(uint64_t)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L104_next_and;
         }
         __pyx_L105_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(uint64_t)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L103_bool_binop_done;
         }
         __pyx_L104_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L103_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint64_t(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_n_s_uint64_t, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
         __pyx_t_4 = (__pyx_v_itemsize == -1L);
         if (!__pyx_t_4) {
           goto __pyx_L111_next_or;
         } else {
         }
-        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_5 = __Pyx_PyMemoryView_Get_itemsize(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_5 == (sizeof(unsigned char)));
         if (!__pyx_t_4) {
         } else {
           goto __pyx_L110_next_and;
         }
         __pyx_L111_next_or:;
         __pyx_t_4 = (__pyx_v_itemsize == (sizeof(unsigned char)));
         if (__pyx_t_4) {
         } else {
           __pyx_t_2 = __pyx_t_4;
           goto __pyx_L109_bool_binop_done;
         }
         __pyx_L110_next_and:;
-        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        __pyx_t_11 = __Pyx_PyMemoryView_Get_ndim(__pyx_v_arg_as_memoryview); if (unlikely(__pyx_t_11 == ((int)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __pyx_t_4 = (__pyx_t_11 == 3);
         __pyx_t_2 = __pyx_t_4;
         __pyx_L109_bool_binop_done:;
         if (__pyx_t_2) {
           __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_unsigned_char(__pyx_v_arg_as_memoryview, 0); 
           __pyx_v_memslice = __pyx_t_12;
           __pyx_t_2 = (__pyx_v_memslice.memview != 0);
           if (__pyx_t_2) {
             __PYX_XCLEAR_MEMVIEW((&__pyx_v_memslice), 1); 
-            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L54_except_error)
+            if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, __pyx_kp_s_unsigned_char, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L54_except_error)
             goto __pyx_L57_try_break;
           }
           /*else*/ {
             PyErr_Clear(); 
           }
         }
       }
@@ -65423,15 +66636,15 @@
       goto __pyx_L59_try_end;
       __pyx_L52_error:;
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_11 = __Pyx_PyErr_ExceptionMatches2(__pyx_builtin_ValueError, __pyx_builtin_TypeError);
       if (__pyx_t_11) {
         __Pyx_AddTraceback("kimimaro.skeletontricks.__pyx_fused_cpdef", __pyx_clineno, __pyx_lineno, __pyx_filename);
-        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 836, __pyx_L54_except_error)
+        if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_1, &__pyx_t_13) < 0) __PYX_ERR(0, 873, __pyx_L54_except_error)
         __Pyx_XGOTREF(__pyx_t_6);
         __Pyx_XGOTREF(__pyx_t_1);
         __Pyx_XGOTREF(__pyx_t_13);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
         goto __pyx_L53_exception_handled;
@@ -65452,43 +66665,43 @@
       __pyx_L53_exception_handled:;
       __Pyx_XGIVEREF(__pyx_t_8);
       __Pyx_XGIVEREF(__pyx_t_9);
       __Pyx_XGIVEREF(__pyx_t_10);
       __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
       __pyx_L59_try_end:;
     }
-    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely((__Pyx_SetItemInt(__pyx_v_dest_sig, 0, Py_None, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
     goto __pyx_L10_break;
   }
   __pyx_L10_break:;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v__fused_sigindex); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
   __pyx_t_4 = (!__pyx_t_2);
   if (__pyx_t_4) {
     __pyx_t_5 = 0;
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 836, __pyx_L1_error)
+      __PYX_ERR(0, 873, __pyx_L1_error)
     }
-    __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_dict_iterator(((PyObject*)__pyx_v_signatures), 1, ((PyObject *)NULL), (&__pyx_t_14), (&__pyx_t_11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF(__pyx_t_13);
     __pyx_t_13 = __pyx_t_1;
     __pyx_t_1 = 0;
     while (1) {
       __pyx_t_15 = __Pyx_dict_iter_next(__pyx_t_13, __pyx_t_14, &__pyx_t_5, &__pyx_t_1, NULL, NULL, __pyx_t_11);
       if (unlikely(__pyx_t_15 == 0)) break;
-      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+      if (unlikely(__pyx_t_15 == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_sig, __pyx_t_1);
       __pyx_t_1 = 0;
       __pyx_t_1 = __pyx_v__fused_sigindex;
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_1));
       __pyx_t_1 = 0;
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 836, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_sig, __pyx_n_s_strip); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 873, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __pyx_t_17 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_17 = PyMethod_GET_SELF(__pyx_t_16);
         if (likely(__pyx_t_17)) {
@@ -65500,19 +66713,19 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_17, __pyx_kp_s__13};
         __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 836, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_split); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 873, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_6 = NULL;
       __pyx_t_15 = 0;
       #if CYTHON_UNPACK_METHODS
       if (likely(PyMethod_Check(__pyx_t_16))) {
         __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_16);
@@ -65525,34 +66738,34 @@
         }
       }
       #endif
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_kp_s__14};
         __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_15, 1+__pyx_t_15);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
-      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 836, __pyx_L1_error)
+      __pyx_t_16 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 873, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_16);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_18 = PyList_GET_SIZE(__pyx_t_16);
       if (unlikely(__pyx_t_18 < 1)) {
-        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 836, __pyx_L1_error)
+        __Pyx_RaiseNeedMoreValuesError(0+__pyx_t_18); __PYX_ERR(0, 873, __pyx_L1_error)
       }
       #if CYTHON_COMPILING_IN_CPYTHON
       __pyx_t_6 = PyList_GET_ITEM(__pyx_t_16, __pyx_t_18-1); 
       ((PyVarObject*)__pyx_t_16)->ob_size--;
       #else
       __pyx_t_6 = PySequence_ITEM(__pyx_t_16, __pyx_t_18-1); 
       #endif
       __Pyx_GOTREF(__pyx_t_6);
       #if !CYTHON_COMPILING_IN_CPYTHON
-      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 836, __pyx_L1_error)
+      __pyx_t_17 = PySequence_GetSlice(__pyx_t_16, 0, __pyx_t_18-1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 873, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_17);
       __Pyx_DECREF(__pyx_t_16);
       __pyx_t_16 = __pyx_t_17; __pyx_t_17 = NULL;
       #else
       CYTHON_UNUSED_VAR(__pyx_t_17);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_sig_series, ((PyObject*)__pyx_t_16));
@@ -65561,220 +66774,220 @@
       __pyx_t_6 = 0;
       __pyx_t_1 = __pyx_v_sig_series; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_18 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
           #endif
           if (__pyx_t_18 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
         #else
-        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sig_type, __pyx_t_6);
         __pyx_t_6 = 0;
         if (unlikely(__pyx_v_sigindex_node == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 836, __pyx_L1_error)
+          __PYX_ERR(0, 873, __pyx_L1_error)
         }
-        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_4 = (__Pyx_PyDict_ContainsTF(__pyx_v_sig_type, __pyx_v_sigindex_node, Py_NE)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
         if (__pyx_t_4) {
-          __pyx_t_6 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 836, __pyx_L1_error)
+            __PYX_ERR(0, 873, __pyx_L1_error)
           }
-          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_6) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+          if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_sig_type, __pyx_t_6) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, __pyx_t_6);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           goto __pyx_L121;
         }
         /*else*/ {
           if (unlikely(__pyx_v_sigindex_node == Py_None)) {
             PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-            __PYX_ERR(0, 836, __pyx_L1_error)
+            __PYX_ERR(0, 873, __pyx_L1_error)
           }
-          __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_GetItem(__pyx_v_sigindex_node, __pyx_v_sig_type); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __pyx_t_16 = __pyx_t_6;
           __Pyx_INCREF(__pyx_t_16);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF_SET(__pyx_v_sigindex_node, ((PyObject*)__pyx_t_16));
           __pyx_t_16 = 0;
         }
         __pyx_L121:;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       if (unlikely(__pyx_v_sigindex_node == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-        __PYX_ERR(0, 836, __pyx_L1_error)
+        __PYX_ERR(0, 873, __pyx_L1_error)
       }
-      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+      if (unlikely((PyDict_SetItem(__pyx_v_sigindex_node, __pyx_v_last_type, __pyx_v_sig) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   }
-  __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_13 = PyList_New(0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __pyx_v_sigindex_matches = ((PyObject*)__pyx_t_13);
   __pyx_t_13 = 0;
-  __pyx_t_13 = PyList_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_13 = PyList_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_INCREF(__pyx_v__fused_sigindex);
   __Pyx_GIVEREF(__pyx_v__fused_sigindex);
-  if (__Pyx_PyList_SET_ITEM(__pyx_t_13, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 836, __pyx_L1_error);
+  if (__Pyx_PyList_SET_ITEM(__pyx_t_13, 0, __pyx_v__fused_sigindex)) __PYX_ERR(0, 873, __pyx_L1_error);
   __pyx_v_sigindex_candidates = ((PyObject*)__pyx_t_13);
   __pyx_t_13 = 0;
   __pyx_t_13 = __pyx_v_dest_sig; __Pyx_INCREF(__pyx_t_13);
   __pyx_t_14 = 0;
   for (;;) {
     {
       Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_13);
       #if !CYTHON_ASSUME_SAFE_MACROS
-      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+      if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
       #endif
       if (__pyx_t_14 >= __pyx_temp) break;
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_1 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_14); __Pyx_INCREF(__pyx_t_1); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
     #else
-    __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_13, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_dst_type, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_found_matches, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_found_candidates, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
     __pyx_t_4 = (__pyx_v_dst_type == Py_None);
     if (__pyx_t_4) {
       __pyx_t_1 = __pyx_v_sigindex_matches; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 836, __pyx_L1_error)
+          __PYX_ERR(0, 873, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_matches, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_1 = __pyx_v_sigindex_candidates; __Pyx_INCREF(__pyx_t_1);
       __pyx_t_5 = 0;
       for (;;) {
         {
           Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
           #if !CYTHON_ASSUME_SAFE_MACROS
-          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
           #endif
           if (__pyx_t_5 >= __pyx_temp) break;
         }
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_16 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_16); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
         #else
-        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_16);
         __pyx_t_16 = 0;
         if (unlikely(__pyx_v_sn == Py_None)) {
           PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "values");
-          __PYX_ERR(0, 836, __pyx_L1_error)
+          __PYX_ERR(0, 873, __pyx_L1_error)
         }
-        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_16 = __Pyx_PyDict_Values(((PyObject*)__pyx_v_sn)); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_16);
-        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyList_Extend(__pyx_v_found_candidates, __pyx_t_16); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
       }
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       goto __pyx_L125;
     }
     /*else*/ {
-      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_INCREF(__pyx_v_sigindex_matches);
       __Pyx_GIVEREF(__pyx_v_sigindex_matches);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 836, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sigindex_matches)) __PYX_ERR(0, 873, __pyx_L1_error);
       __Pyx_INCREF(__pyx_v_sigindex_candidates);
       __Pyx_GIVEREF(__pyx_v_sigindex_candidates);
-      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 836, __pyx_L1_error);
+      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_sigindex_candidates)) __PYX_ERR(0, 873, __pyx_L1_error);
       __pyx_t_16 = __pyx_t_1; __Pyx_INCREF(__pyx_t_16);
       __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       for (;;) {
         if (__pyx_t_5 >= 2) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_16, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
         #else
-        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 836, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_16, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 873, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_search_list, ((PyObject*)__pyx_t_1));
         __pyx_t_1 = 0;
         if (unlikely(__pyx_v_search_list == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-          __PYX_ERR(0, 836, __pyx_L1_error)
+          __PYX_ERR(0, 873, __pyx_L1_error)
         }
         __pyx_t_1 = __pyx_v_search_list; __Pyx_INCREF(__pyx_t_1);
         __pyx_t_18 = 0;
         for (;;) {
           {
             Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
             #if !CYTHON_ASSUME_SAFE_MACROS
-            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
             #endif
             if (__pyx_t_18 >= __pyx_temp) break;
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_18); __Pyx_INCREF(__pyx_t_6); __pyx_t_18++; if (unlikely((0 < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
           #else
-          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_18); __pyx_t_18++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           #endif
           __Pyx_XDECREF_SET(__pyx_v_sn, __pyx_t_6);
           __pyx_t_6 = 0;
           if (unlikely(__pyx_v_sn == Py_None)) {
             PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
-            __PYX_ERR(0, 836, __pyx_L1_error)
+            __PYX_ERR(0, 873, __pyx_L1_error)
           }
-          __pyx_t_6 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 836, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyDict_GetItemDefault(((PyObject*)__pyx_v_sn), __pyx_v_dst_type, Py_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_XDECREF_SET(__pyx_v_type_match, __pyx_t_6);
           __pyx_t_6 = 0;
           __pyx_t_4 = (__pyx_v_type_match != Py_None);
           if (__pyx_t_4) {
-            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 836, __pyx_L1_error)
+            __pyx_t_19 = __Pyx_PyList_Append(__pyx_v_found_matches, __pyx_v_type_match); if (unlikely(__pyx_t_19 == ((int)-1))) __PYX_ERR(0, 873, __pyx_L1_error)
           }
         }
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       }
       __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
     }
     __pyx_L125:;
@@ -65803,38 +67016,38 @@
   goto __pyx_L142_for_end;
   __pyx_L142_for_end:;
   __Pyx_INCREF(__pyx_v_sigindex_matches);
   __pyx_v_candidates = __pyx_v_sigindex_matches;
   __pyx_t_2 = (PyList_GET_SIZE(__pyx_v_candidates) != 0);
   __pyx_t_4 = (!__pyx_t_2);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_Raise(__pyx_t_13, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __PYX_ERR(0, 836, __pyx_L1_error)
+    __PYX_ERR(0, 873, __pyx_L1_error)
   }
-  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyList_GET_SIZE(__pyx_v_candidates); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 873, __pyx_L1_error)
   __pyx_t_4 = (__pyx_t_14 > 1);
   if (unlikely(__pyx_t_4)) {
-    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_Raise(__pyx_t_13, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __PYX_ERR(0, 836, __pyx_L1_error)
+    __PYX_ERR(0, 873, __pyx_L1_error)
   }
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
     if (unlikely(__pyx_v_signatures == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-      __PYX_ERR(0, 836, __pyx_L1_error)
+      __PYX_ERR(0, 873, __pyx_L1_error)
     }
-    __pyx_t_13 = __Pyx_GetItemInt_List(__pyx_v_candidates, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_GetItemInt_List(__pyx_v_candidates, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_16 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), __pyx_t_13); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 836, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyDict_GetItem(((PyObject*)__pyx_v_signatures), __pyx_t_13); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_16);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_r = __pyx_t_16;
     __pyx_t_16 = 0;
     goto __pyx_L0;
   }
 
@@ -65871,17 +67084,17 @@
   __Pyx_XDECREF(__pyx_v_kwargs);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_173find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_173find_avocado_fruit = {"__pyx_fuse_0find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_173find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_173find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_175find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_175find_avocado_fruit = {"__pyx_fuse_0find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_175find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_fuse_0__pyx_pw_8kimimaro_14skeletontricks_175find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   size_t __pyx_v_cx;
   size_t __pyx_v_cy;
   size_t __pyx_v_cz;
   int8_t __pyx_v_background;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -65919,98 +67132,98 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cz)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_background);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
         values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
         values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
+    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_background = __Pyx_PyInt_As_int8_t(values[4]); if (unlikely((__pyx_v_background == ((int8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L3_error)
+      __pyx_v_background = __Pyx_PyInt_As_int8_t(values[4]); if (unlikely((__pyx_v_background == ((int8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
     } else {
       __pyx_v_background = ((int8_t)((int8_t)((int8_t)0)));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_avocado_fruit", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 837, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_172find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 874, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_174find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -66019,30 +67232,30 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_172find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int8_t __pyx_v_background) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_174find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int8_t __pyx_v_background) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   CYTHON_UNUSED size_t __pyx_v_voxels;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   int8_t __pyx_v_label;
   PyObject *__pyx_v_changes = 0;
   long __pyx_v_allowed_differences;
   PyObject *__pyx_v_uniq = NULL;
   PyObject *__pyx_v_cts = NULL;
   PyObject *__pyx_v_candidate_fruit_index = NULL;
   PyObject *__pyx_v_differences = NULL;
-  PyObject *__pyx_8genexpr1__pyx_v__ = NULL;
+  PyObject *__pyx_8genexpr3__pyx_v__ = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
   npy_intp __pyx_t_2;
   npy_intp __pyx_t_3;
@@ -66073,43 +67286,43 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_0find_avocado_fruit", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":849
+  /* "ext/skeletontricks/skeletontricks.pyx":886
  *   """
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]             # <<<<<<<<<<<<<<
  *   cdef size_t voxels = sx * sy * sz
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 886, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1[0]);
   __pyx_t_3 = (__pyx_t_1[1]);
   __pyx_t_4 = (__pyx_t_1[2]);
   __pyx_v_sx = __pyx_t_2;
   __pyx_v_sy = __pyx_t_3;
   __pyx_v_sz = __pyx_t_4;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":850
+  /* "ext/skeletontricks/skeletontricks.pyx":887
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]
  *   cdef size_t voxels = sx * sy * sz             # <<<<<<<<<<<<<<
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  */
   __pyx_v_voxels = ((__pyx_v_sx * __pyx_v_sy) * __pyx_v_sz);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":852
+  /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   __pyx_t_6 = (__pyx_v_cx >= __pyx_v_sx);
@@ -66125,42 +67338,42 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_cz >= __pyx_v_sz);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":854
+    /* "ext/skeletontricks/skeletontricks.pyx":891
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(             # <<<<<<<<<<<<<<
  *         cx,cy,cz,sx,sy,sz
  *     ))
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 891, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":855
+    /* "ext/skeletontricks/skeletontricks.pyx":892
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz             # <<<<<<<<<<<<<<
  *     ))
  * 
  */
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __pyx_t_15 = NULL;
     __pyx_t_16 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_15)) {
@@ -66178,43 +67391,43 @@
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 891, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":853
+    /* "ext/skeletontricks/skeletontricks.pyx":890
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(             # <<<<<<<<<<<<<<
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz
  */
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 890, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_8, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 853, __pyx_L1_error)
+    __PYX_ERR(0, 890, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":852
+    /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":859
+  /* "ext/skeletontricks/skeletontricks.pyx":896
  * 
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]             # <<<<<<<<<<<<<<
  *   cdef list changes = [ None ] * 6
  * 
  */
   __pyx_t_17 = __pyx_v_cx;
@@ -66222,50 +67435,50 @@
   __pyx_t_19 = __pyx_v_cz;
   __pyx_t_16 = -1;
   if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
   if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
   if (unlikely(__pyx_t_19 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
   if (unlikely(__pyx_t_16 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_16);
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
   __pyx_v_label = (*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":860
+  /* "ext/skeletontricks/skeletontricks.pyx":897
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]
  *   cdef list changes = [ None ] * 6             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, sx):
  */
-  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 6; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 860, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 897, __pyx_L1_error);
     }
   }
   __pyx_v_changes = ((PyObject*)__pyx_t_8);
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":862
+  /* "ext/skeletontricks/skeletontricks.pyx":899
  *   cdef list changes = [ None ] * 6
  * 
  *   for x in range(cx, sx):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sx;
   __pyx_t_18 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cx; __pyx_t_17 < __pyx_t_18; __pyx_t_17+=1) {
     __pyx_v_x = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":863
+    /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_20 = __pyx_v_x;
@@ -66273,38 +67486,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 863, __pyx_L1_error)
+      __PYX_ERR(0, 900, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":864
+      /* "ext/skeletontricks/skeletontricks.pyx":901
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":863
+      /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":865
+    /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -66312,20 +67525,20 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 865, __pyx_L1_error)
+      __PYX_ERR(0, 902, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":866
+      /* "ext/skeletontricks/skeletontricks.pyx":903
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_x;
@@ -66333,52 +67546,52 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 903, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 866, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":867
+      /* "ext/skeletontricks/skeletontricks.pyx":904
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, 0, -1):
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":865
+      /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L8_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":869
+  /* "ext/skeletontricks/skeletontricks.pyx":906
  *       break
  * 
  *   for x in range(cx, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cx + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_x = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":870
+    /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_18 = __pyx_v_x;
@@ -66386,38 +67599,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 870, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":871
+      /* "ext/skeletontricks/skeletontricks.pyx":908
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":870
+      /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":872
+    /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -66425,20 +67638,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 872, __pyx_L1_error)
+      __PYX_ERR(0, 909, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":873
+      /* "ext/skeletontricks/skeletontricks.pyx":910
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_x;
@@ -66446,54 +67659,54 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 873, __pyx_L1_error)
+        __PYX_ERR(0, 910, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 873, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":874
+      /* "ext/skeletontricks/skeletontricks.pyx":911
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, sy):
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":872
+      /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L11_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":876
+  /* "ext/skeletontricks/skeletontricks.pyx":913
  *       break
  * 
  *   for y in range(cy, sy):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sy;
   __pyx_t_22 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cy; __pyx_t_17 < __pyx_t_22; __pyx_t_17+=1) {
     __pyx_v_y = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":877
+    /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -66501,38 +67714,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 877, __pyx_L1_error)
+      __PYX_ERR(0, 914, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":878
+      /* "ext/skeletontricks/skeletontricks.pyx":915
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":877
+      /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":879
+    /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -66540,20 +67753,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 879, __pyx_L1_error)
+      __PYX_ERR(0, 916, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":880
+      /* "ext/skeletontricks/skeletontricks.pyx":917
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_cx;
@@ -66561,52 +67774,52 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 880, __pyx_L1_error)
+        __PYX_ERR(0, 917, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 880, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 880, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":881
+      /* "ext/skeletontricks/skeletontricks.pyx":918
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, 0, -1):
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":879
+      /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L14_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":883
+  /* "ext/skeletontricks/skeletontricks.pyx":920
  *       break
  * 
  *   for y in range(cy, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cy + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_y = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":884
+    /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -66614,38 +67827,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 884, __pyx_L1_error)
+      __PYX_ERR(0, 921, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":885
+      /* "ext/skeletontricks/skeletontricks.pyx":922
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":884
+      /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":886
+    /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -66653,20 +67866,20 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 886, __pyx_L1_error)
+      __PYX_ERR(0, 923, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":887
+      /* "ext/skeletontricks/skeletontricks.pyx":924
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -66674,54 +67887,54 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 887, __pyx_L1_error)
+        __PYX_ERR(0, 924, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":888
+      /* "ext/skeletontricks/skeletontricks.pyx":925
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, sz):
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":886
+      /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L18_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":890
+  /* "ext/skeletontricks/skeletontricks.pyx":927
  *       break
  * 
  *   for z in range(cz, sz):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sz;
   __pyx_t_20 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cz; __pyx_t_17 < __pyx_t_20; __pyx_t_17+=1) {
     __pyx_v_z = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":891
+    /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -66729,38 +67942,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 891, __pyx_L1_error)
+      __PYX_ERR(0, 928, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":892
+      /* "ext/skeletontricks/skeletontricks.pyx":929
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":891
+      /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":893
+    /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -66768,20 +67981,20 @@
     __pyx_t_22 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 893, __pyx_L1_error)
+      __PYX_ERR(0, 930, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":894
+      /* "ext/skeletontricks/skeletontricks.pyx":931
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -66789,52 +68002,52 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 931, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 894, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":895
+      /* "ext/skeletontricks/skeletontricks.pyx":932
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, 0, -1):
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":893
+      /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L22_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":897
+  /* "ext/skeletontricks/skeletontricks.pyx":934
  *       break
  * 
  *   for z in range(cz, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cz + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_z = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":898
+    /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -66842,38 +68055,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 898, __pyx_L1_error)
+      __PYX_ERR(0, 935, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":899
+      /* "ext/skeletontricks/skeletontricks.pyx":936
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":898
+      /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":900
+    /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -66881,20 +68094,20 @@
     __pyx_t_20 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 937, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":901
+      /* "ext/skeletontricks/skeletontricks.pyx":938
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_cx;
@@ -66902,257 +68115,257 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 901, __pyx_L1_error)
+        __PYX_ERR(0, 938, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int8_t((*__Pyx_BufPtrStrided3d(int8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 901, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":902
+      /* "ext/skeletontricks/skeletontricks.pyx":939
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   changes = [ _ for _ in changes if _ is not None ]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":900
+      /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L26_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":904
+  /* "ext/skeletontricks/skeletontricks.pyx":941
  *       break
  * 
  *   changes = [ _ for _ in changes if _ is not None ]             # <<<<<<<<<<<<<<
  * 
  *   # Too little info to make a decision
  */
   { /* enter inner scope */
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L31_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 941, __pyx_L31_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = __pyx_v_changes; __Pyx_INCREF(__pyx_t_7);
     __pyx_t_23 = 0;
     for (;;) {
       {
         Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_7);
         #if !CYTHON_ASSUME_SAFE_MACROS
-        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
         #endif
         if (__pyx_t_23 >= __pyx_temp) break;
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
       #else
-      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 941, __pyx_L31_error)
       __Pyx_GOTREF(__pyx_t_14);
       #endif
-      __Pyx_XDECREF_SET(__pyx_8genexpr1__pyx_v__, __pyx_t_14);
+      __Pyx_XDECREF_SET(__pyx_8genexpr3__pyx_v__, __pyx_t_14);
       __pyx_t_14 = 0;
-      __pyx_t_5 = (__pyx_8genexpr1__pyx_v__ != Py_None);
+      __pyx_t_5 = (__pyx_8genexpr3__pyx_v__ != Py_None);
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr1__pyx_v__))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr3__pyx_v__))) __PYX_ERR(0, 941, __pyx_L31_error)
       }
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_XDECREF(__pyx_8genexpr1__pyx_v__); __pyx_8genexpr1__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr3__pyx_v__); __pyx_8genexpr3__pyx_v__ = 0;
     goto __pyx_L36_exit_scope;
     __pyx_L31_error:;
-    __Pyx_XDECREF(__pyx_8genexpr1__pyx_v__); __pyx_8genexpr1__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr3__pyx_v__); __pyx_8genexpr3__pyx_v__ = 0;
     goto __pyx_L1_error;
     __pyx_L36_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_changes, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":907
+  /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 944, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 < 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":908
+    /* "ext/skeletontricks/skeletontricks.pyx":945
  *   # Too little info to make a decision
  *   if len(changes) < 3:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_7);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
     __pyx_r = __pyx_t_14;
     __pyx_t_14 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":907
+    /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":910
+  /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 > 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":911
+    /* "ext/skeletontricks/skeletontricks.pyx":948
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  *     allowed_differences = 1             # <<<<<<<<<<<<<<
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0
  */
     __pyx_v_allowed_differences = 1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":910
+    /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
     goto __pyx_L38;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":913
+  /* "ext/skeletontricks/skeletontricks.pyx":950
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0             # <<<<<<<<<<<<<<
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  */
   /*else*/ {
     __pyx_v_allowed_differences = 0;
   }
   __pyx_L38:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":915
+  /* "ext/skeletontricks/skeletontricks.pyx":952
  *     allowed_differences = 0
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)             # <<<<<<<<<<<<<<
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_INCREF(__pyx_v_changes);
   __Pyx_GIVEREF(__pyx_v_changes);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 915, __pyx_L1_error);
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 952, __pyx_L1_error);
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_13))) || (PyList_CheckExact(__pyx_t_13))) {
     PyObject* sequence = __pyx_t_13;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 915, __pyx_L1_error)
+      __PYX_ERR(0, 952, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_8 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_8 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_t_14);
     #else
-    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     #endif
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_24 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
     index = 0; __pyx_t_8 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_8)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_8);
     index = 1; __pyx_t_14 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_14)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_14);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_t_24 = NULL;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L40_unpacking_done;
     __pyx_L39_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_24 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_L40_unpacking_done:;
   }
   __pyx_v_uniq = __pyx_t_8;
   __pyx_t_8 = 0;
   __pyx_v_cts = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":916
+  /* "ext/skeletontricks/skeletontricks.pyx":953
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)             # <<<<<<<<<<<<<<
  *   differences = len(changes) - cts[candidate_fruit_index]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   __pyx_t_16 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
@@ -67165,113 +68378,113 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_cts};
     __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_16, 1+__pyx_t_16);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 916, __pyx_L1_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_v_candidate_fruit_index = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":917
+  /* "ext/skeletontricks/skeletontricks.pyx":954
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]             # <<<<<<<<<<<<<<
  * 
  *   # it's not an avocado if there's lots of
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_differences = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":921
+  /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":922
+    /* "ext/skeletontricks/skeletontricks.pyx":959
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   return (label, uniq[candidate_fruit_index])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_14);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_14 = 0;
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":921
+    /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":924
+  /* "ext/skeletontricks/skeletontricks.pyx":961
  *     return (label, label)
  * 
  *   return (label, uniq[candidate_fruit_index])             # <<<<<<<<<<<<<<
  * 
  * class CachedTargetFinder:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_int8_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_14);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_t_14 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
@@ -67299,24 +68512,24 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_changes);
   __Pyx_XDECREF(__pyx_v_uniq);
   __Pyx_XDECREF(__pyx_v_cts);
   __Pyx_XDECREF(__pyx_v_candidate_fruit_index);
   __Pyx_XDECREF(__pyx_v_differences);
-  __Pyx_XDECREF(__pyx_8genexpr1__pyx_v__);
+  __Pyx_XDECREF(__pyx_8genexpr3__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_175find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_175find_avocado_fruit = {"__pyx_fuse_1find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_175find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_175find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_177find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_177find_avocado_fruit = {"__pyx_fuse_1find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_177find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_fuse_1__pyx_pw_8kimimaro_14skeletontricks_177find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   size_t __pyx_v_cx;
   size_t __pyx_v_cy;
   size_t __pyx_v_cz;
   int16_t __pyx_v_background;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -67354,98 +68567,98 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cz)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_background);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
         values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
         values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
+    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_background = __Pyx_PyInt_As_int16_t(values[4]); if (unlikely((__pyx_v_background == ((int16_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L3_error)
+      __pyx_v_background = __Pyx_PyInt_As_int16_t(values[4]); if (unlikely((__pyx_v_background == ((int16_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
     } else {
       __pyx_v_background = ((int16_t)((int16_t)((int16_t)0)));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_avocado_fruit", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 837, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_174find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 874, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_176find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -67454,30 +68667,30 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_174find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int16_t __pyx_v_background) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_176find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int16_t __pyx_v_background) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   CYTHON_UNUSED size_t __pyx_v_voxels;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   int16_t __pyx_v_label;
   PyObject *__pyx_v_changes = 0;
   long __pyx_v_allowed_differences;
   PyObject *__pyx_v_uniq = NULL;
   PyObject *__pyx_v_cts = NULL;
   PyObject *__pyx_v_candidate_fruit_index = NULL;
   PyObject *__pyx_v_differences = NULL;
-  PyObject *__pyx_8genexpr2__pyx_v__ = NULL;
+  PyObject *__pyx_8genexpr4__pyx_v__ = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
   npy_intp __pyx_t_2;
   npy_intp __pyx_t_3;
@@ -67508,43 +68721,43 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_1find_avocado_fruit", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_int16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":849
+  /* "ext/skeletontricks/skeletontricks.pyx":886
  *   """
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]             # <<<<<<<<<<<<<<
  *   cdef size_t voxels = sx * sy * sz
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 886, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1[0]);
   __pyx_t_3 = (__pyx_t_1[1]);
   __pyx_t_4 = (__pyx_t_1[2]);
   __pyx_v_sx = __pyx_t_2;
   __pyx_v_sy = __pyx_t_3;
   __pyx_v_sz = __pyx_t_4;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":850
+  /* "ext/skeletontricks/skeletontricks.pyx":887
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]
  *   cdef size_t voxels = sx * sy * sz             # <<<<<<<<<<<<<<
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  */
   __pyx_v_voxels = ((__pyx_v_sx * __pyx_v_sy) * __pyx_v_sz);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":852
+  /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   __pyx_t_6 = (__pyx_v_cx >= __pyx_v_sx);
@@ -67560,42 +68773,42 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_cz >= __pyx_v_sz);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":854
+    /* "ext/skeletontricks/skeletontricks.pyx":891
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(             # <<<<<<<<<<<<<<
  *         cx,cy,cz,sx,sy,sz
  *     ))
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 891, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":855
+    /* "ext/skeletontricks/skeletontricks.pyx":892
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz             # <<<<<<<<<<<<<<
  *     ))
  * 
  */
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __pyx_t_15 = NULL;
     __pyx_t_16 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_15)) {
@@ -67613,43 +68826,43 @@
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 891, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":853
+    /* "ext/skeletontricks/skeletontricks.pyx":890
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(             # <<<<<<<<<<<<<<
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz
  */
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 890, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_8, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 853, __pyx_L1_error)
+    __PYX_ERR(0, 890, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":852
+    /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":859
+  /* "ext/skeletontricks/skeletontricks.pyx":896
  * 
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]             # <<<<<<<<<<<<<<
  *   cdef list changes = [ None ] * 6
  * 
  */
   __pyx_t_17 = __pyx_v_cx;
@@ -67657,50 +68870,50 @@
   __pyx_t_19 = __pyx_v_cz;
   __pyx_t_16 = -1;
   if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
   if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
   if (unlikely(__pyx_t_19 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
   if (unlikely(__pyx_t_16 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_16);
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
   __pyx_v_label = (*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":860
+  /* "ext/skeletontricks/skeletontricks.pyx":897
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]
  *   cdef list changes = [ None ] * 6             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, sx):
  */
-  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 6; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 860, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 897, __pyx_L1_error);
     }
   }
   __pyx_v_changes = ((PyObject*)__pyx_t_8);
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":862
+  /* "ext/skeletontricks/skeletontricks.pyx":899
  *   cdef list changes = [ None ] * 6
  * 
  *   for x in range(cx, sx):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sx;
   __pyx_t_18 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cx; __pyx_t_17 < __pyx_t_18; __pyx_t_17+=1) {
     __pyx_v_x = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":863
+    /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_20 = __pyx_v_x;
@@ -67708,38 +68921,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 863, __pyx_L1_error)
+      __PYX_ERR(0, 900, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":864
+      /* "ext/skeletontricks/skeletontricks.pyx":901
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":863
+      /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":865
+    /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -67747,20 +68960,20 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 865, __pyx_L1_error)
+      __PYX_ERR(0, 902, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":866
+      /* "ext/skeletontricks/skeletontricks.pyx":903
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_x;
@@ -67768,52 +68981,52 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 903, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 866, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":867
+      /* "ext/skeletontricks/skeletontricks.pyx":904
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, 0, -1):
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":865
+      /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L8_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":869
+  /* "ext/skeletontricks/skeletontricks.pyx":906
  *       break
  * 
  *   for x in range(cx, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cx + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_x = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":870
+    /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_18 = __pyx_v_x;
@@ -67821,38 +69034,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 870, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":871
+      /* "ext/skeletontricks/skeletontricks.pyx":908
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":870
+      /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":872
+    /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -67860,20 +69073,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 872, __pyx_L1_error)
+      __PYX_ERR(0, 909, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":873
+      /* "ext/skeletontricks/skeletontricks.pyx":910
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_x;
@@ -67881,54 +69094,54 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 873, __pyx_L1_error)
+        __PYX_ERR(0, 910, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 873, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":874
+      /* "ext/skeletontricks/skeletontricks.pyx":911
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, sy):
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":872
+      /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L11_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":876
+  /* "ext/skeletontricks/skeletontricks.pyx":913
  *       break
  * 
  *   for y in range(cy, sy):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sy;
   __pyx_t_22 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cy; __pyx_t_17 < __pyx_t_22; __pyx_t_17+=1) {
     __pyx_v_y = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":877
+    /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -67936,38 +69149,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 877, __pyx_L1_error)
+      __PYX_ERR(0, 914, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":878
+      /* "ext/skeletontricks/skeletontricks.pyx":915
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":877
+      /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":879
+    /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -67975,20 +69188,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 879, __pyx_L1_error)
+      __PYX_ERR(0, 916, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":880
+      /* "ext/skeletontricks/skeletontricks.pyx":917
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_cx;
@@ -67996,52 +69209,52 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 880, __pyx_L1_error)
+        __PYX_ERR(0, 917, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 880, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 880, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":881
+      /* "ext/skeletontricks/skeletontricks.pyx":918
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, 0, -1):
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":879
+      /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L14_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":883
+  /* "ext/skeletontricks/skeletontricks.pyx":920
  *       break
  * 
  *   for y in range(cy, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cy + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_y = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":884
+    /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -68049,38 +69262,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 884, __pyx_L1_error)
+      __PYX_ERR(0, 921, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":885
+      /* "ext/skeletontricks/skeletontricks.pyx":922
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":884
+      /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":886
+    /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -68088,20 +69301,20 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 886, __pyx_L1_error)
+      __PYX_ERR(0, 923, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":887
+      /* "ext/skeletontricks/skeletontricks.pyx":924
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -68109,54 +69322,54 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 887, __pyx_L1_error)
+        __PYX_ERR(0, 924, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":888
+      /* "ext/skeletontricks/skeletontricks.pyx":925
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, sz):
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":886
+      /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L18_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":890
+  /* "ext/skeletontricks/skeletontricks.pyx":927
  *       break
  * 
  *   for z in range(cz, sz):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sz;
   __pyx_t_20 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cz; __pyx_t_17 < __pyx_t_20; __pyx_t_17+=1) {
     __pyx_v_z = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":891
+    /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -68164,38 +69377,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 891, __pyx_L1_error)
+      __PYX_ERR(0, 928, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":892
+      /* "ext/skeletontricks/skeletontricks.pyx":929
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":891
+      /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":893
+    /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -68203,20 +69416,20 @@
     __pyx_t_22 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 893, __pyx_L1_error)
+      __PYX_ERR(0, 930, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":894
+      /* "ext/skeletontricks/skeletontricks.pyx":931
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -68224,52 +69437,52 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 931, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 894, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":895
+      /* "ext/skeletontricks/skeletontricks.pyx":932
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, 0, -1):
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":893
+      /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L22_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":897
+  /* "ext/skeletontricks/skeletontricks.pyx":934
  *       break
  * 
  *   for z in range(cz, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cz + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_z = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":898
+    /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -68277,38 +69490,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 898, __pyx_L1_error)
+      __PYX_ERR(0, 935, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":899
+      /* "ext/skeletontricks/skeletontricks.pyx":936
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":898
+      /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":900
+    /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -68316,20 +69529,20 @@
     __pyx_t_20 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 937, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":901
+      /* "ext/skeletontricks/skeletontricks.pyx":938
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_cx;
@@ -68337,257 +69550,257 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 901, __pyx_L1_error)
+        __PYX_ERR(0, 938, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int16_t((*__Pyx_BufPtrStrided3d(int16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 901, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":902
+      /* "ext/skeletontricks/skeletontricks.pyx":939
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   changes = [ _ for _ in changes if _ is not None ]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":900
+      /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L26_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":904
+  /* "ext/skeletontricks/skeletontricks.pyx":941
  *       break
  * 
  *   changes = [ _ for _ in changes if _ is not None ]             # <<<<<<<<<<<<<<
  * 
  *   # Too little info to make a decision
  */
   { /* enter inner scope */
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L31_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 941, __pyx_L31_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = __pyx_v_changes; __Pyx_INCREF(__pyx_t_7);
     __pyx_t_23 = 0;
     for (;;) {
       {
         Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_7);
         #if !CYTHON_ASSUME_SAFE_MACROS
-        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
         #endif
         if (__pyx_t_23 >= __pyx_temp) break;
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
       #else
-      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 941, __pyx_L31_error)
       __Pyx_GOTREF(__pyx_t_14);
       #endif
-      __Pyx_XDECREF_SET(__pyx_8genexpr2__pyx_v__, __pyx_t_14);
+      __Pyx_XDECREF_SET(__pyx_8genexpr4__pyx_v__, __pyx_t_14);
       __pyx_t_14 = 0;
-      __pyx_t_5 = (__pyx_8genexpr2__pyx_v__ != Py_None);
+      __pyx_t_5 = (__pyx_8genexpr4__pyx_v__ != Py_None);
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr2__pyx_v__))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr4__pyx_v__))) __PYX_ERR(0, 941, __pyx_L31_error)
       }
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_XDECREF(__pyx_8genexpr2__pyx_v__); __pyx_8genexpr2__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr4__pyx_v__); __pyx_8genexpr4__pyx_v__ = 0;
     goto __pyx_L36_exit_scope;
     __pyx_L31_error:;
-    __Pyx_XDECREF(__pyx_8genexpr2__pyx_v__); __pyx_8genexpr2__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr4__pyx_v__); __pyx_8genexpr4__pyx_v__ = 0;
     goto __pyx_L1_error;
     __pyx_L36_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_changes, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":907
+  /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 944, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 < 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":908
+    /* "ext/skeletontricks/skeletontricks.pyx":945
  *   # Too little info to make a decision
  *   if len(changes) < 3:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_7);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
     __pyx_r = __pyx_t_14;
     __pyx_t_14 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":907
+    /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":910
+  /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 > 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":911
+    /* "ext/skeletontricks/skeletontricks.pyx":948
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  *     allowed_differences = 1             # <<<<<<<<<<<<<<
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0
  */
     __pyx_v_allowed_differences = 1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":910
+    /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
     goto __pyx_L38;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":913
+  /* "ext/skeletontricks/skeletontricks.pyx":950
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0             # <<<<<<<<<<<<<<
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  */
   /*else*/ {
     __pyx_v_allowed_differences = 0;
   }
   __pyx_L38:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":915
+  /* "ext/skeletontricks/skeletontricks.pyx":952
  *     allowed_differences = 0
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)             # <<<<<<<<<<<<<<
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_INCREF(__pyx_v_changes);
   __Pyx_GIVEREF(__pyx_v_changes);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 915, __pyx_L1_error);
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 952, __pyx_L1_error);
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_13))) || (PyList_CheckExact(__pyx_t_13))) {
     PyObject* sequence = __pyx_t_13;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 915, __pyx_L1_error)
+      __PYX_ERR(0, 952, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_8 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_8 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_t_14);
     #else
-    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     #endif
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_24 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
     index = 0; __pyx_t_8 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_8)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_8);
     index = 1; __pyx_t_14 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_14)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_14);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_t_24 = NULL;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L40_unpacking_done;
     __pyx_L39_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_24 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_L40_unpacking_done:;
   }
   __pyx_v_uniq = __pyx_t_8;
   __pyx_t_8 = 0;
   __pyx_v_cts = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":916
+  /* "ext/skeletontricks/skeletontricks.pyx":953
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)             # <<<<<<<<<<<<<<
  *   differences = len(changes) - cts[candidate_fruit_index]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   __pyx_t_16 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
@@ -68600,113 +69813,113 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_cts};
     __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_16, 1+__pyx_t_16);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 916, __pyx_L1_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_v_candidate_fruit_index = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":917
+  /* "ext/skeletontricks/skeletontricks.pyx":954
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]             # <<<<<<<<<<<<<<
  * 
  *   # it's not an avocado if there's lots of
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_differences = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":921
+  /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":922
+    /* "ext/skeletontricks/skeletontricks.pyx":959
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   return (label, uniq[candidate_fruit_index])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_14);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_14 = 0;
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":921
+    /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":924
+  /* "ext/skeletontricks/skeletontricks.pyx":961
  *     return (label, label)
  * 
  *   return (label, uniq[candidate_fruit_index])             # <<<<<<<<<<<<<<
  * 
  * class CachedTargetFinder:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_int16_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_14);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_t_14 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
@@ -68734,24 +69947,24 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_changes);
   __Pyx_XDECREF(__pyx_v_uniq);
   __Pyx_XDECREF(__pyx_v_cts);
   __Pyx_XDECREF(__pyx_v_candidate_fruit_index);
   __Pyx_XDECREF(__pyx_v_differences);
-  __Pyx_XDECREF(__pyx_8genexpr2__pyx_v__);
+  __Pyx_XDECREF(__pyx_8genexpr4__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_177find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_177find_avocado_fruit = {"__pyx_fuse_2find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_177find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_177find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_179find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_179find_avocado_fruit = {"__pyx_fuse_2find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_179find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_fuse_2__pyx_pw_8kimimaro_14skeletontricks_179find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   size_t __pyx_v_cx;
   size_t __pyx_v_cy;
   size_t __pyx_v_cz;
   int32_t __pyx_v_background;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -68789,98 +70002,98 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cz)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_background);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
         values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
         values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
+    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_background = __Pyx_PyInt_As_int32_t(values[4]); if (unlikely((__pyx_v_background == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L3_error)
+      __pyx_v_background = __Pyx_PyInt_As_int32_t(values[4]); if (unlikely((__pyx_v_background == ((int32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
     } else {
       __pyx_v_background = ((int32_t)((int32_t)((int32_t)0)));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_avocado_fruit", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 837, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_176find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 874, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_178find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -68889,30 +70102,30 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_176find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int32_t __pyx_v_background) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_178find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int32_t __pyx_v_background) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   CYTHON_UNUSED size_t __pyx_v_voxels;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   int32_t __pyx_v_label;
   PyObject *__pyx_v_changes = 0;
   long __pyx_v_allowed_differences;
   PyObject *__pyx_v_uniq = NULL;
   PyObject *__pyx_v_cts = NULL;
   PyObject *__pyx_v_candidate_fruit_index = NULL;
   PyObject *__pyx_v_differences = NULL;
-  PyObject *__pyx_8genexpr3__pyx_v__ = NULL;
+  PyObject *__pyx_8genexpr5__pyx_v__ = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
   npy_intp __pyx_t_2;
   npy_intp __pyx_t_3;
@@ -68943,43 +70156,43 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_2find_avocado_fruit", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_int32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":849
+  /* "ext/skeletontricks/skeletontricks.pyx":886
  *   """
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]             # <<<<<<<<<<<<<<
  *   cdef size_t voxels = sx * sy * sz
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 886, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1[0]);
   __pyx_t_3 = (__pyx_t_1[1]);
   __pyx_t_4 = (__pyx_t_1[2]);
   __pyx_v_sx = __pyx_t_2;
   __pyx_v_sy = __pyx_t_3;
   __pyx_v_sz = __pyx_t_4;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":850
+  /* "ext/skeletontricks/skeletontricks.pyx":887
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]
  *   cdef size_t voxels = sx * sy * sz             # <<<<<<<<<<<<<<
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  */
   __pyx_v_voxels = ((__pyx_v_sx * __pyx_v_sy) * __pyx_v_sz);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":852
+  /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   __pyx_t_6 = (__pyx_v_cx >= __pyx_v_sx);
@@ -68995,42 +70208,42 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_cz >= __pyx_v_sz);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":854
+    /* "ext/skeletontricks/skeletontricks.pyx":891
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(             # <<<<<<<<<<<<<<
  *         cx,cy,cz,sx,sy,sz
  *     ))
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 891, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":855
+    /* "ext/skeletontricks/skeletontricks.pyx":892
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz             # <<<<<<<<<<<<<<
  *     ))
  * 
  */
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __pyx_t_15 = NULL;
     __pyx_t_16 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_15)) {
@@ -69048,43 +70261,43 @@
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 891, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":853
+    /* "ext/skeletontricks/skeletontricks.pyx":890
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(             # <<<<<<<<<<<<<<
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz
  */
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 890, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_8, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 853, __pyx_L1_error)
+    __PYX_ERR(0, 890, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":852
+    /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":859
+  /* "ext/skeletontricks/skeletontricks.pyx":896
  * 
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]             # <<<<<<<<<<<<<<
  *   cdef list changes = [ None ] * 6
  * 
  */
   __pyx_t_17 = __pyx_v_cx;
@@ -69092,50 +70305,50 @@
   __pyx_t_19 = __pyx_v_cz;
   __pyx_t_16 = -1;
   if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
   if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
   if (unlikely(__pyx_t_19 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
   if (unlikely(__pyx_t_16 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_16);
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
   __pyx_v_label = (*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":860
+  /* "ext/skeletontricks/skeletontricks.pyx":897
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]
  *   cdef list changes = [ None ] * 6             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, sx):
  */
-  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 6; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 860, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 897, __pyx_L1_error);
     }
   }
   __pyx_v_changes = ((PyObject*)__pyx_t_8);
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":862
+  /* "ext/skeletontricks/skeletontricks.pyx":899
  *   cdef list changes = [ None ] * 6
  * 
  *   for x in range(cx, sx):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sx;
   __pyx_t_18 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cx; __pyx_t_17 < __pyx_t_18; __pyx_t_17+=1) {
     __pyx_v_x = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":863
+    /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_20 = __pyx_v_x;
@@ -69143,38 +70356,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 863, __pyx_L1_error)
+      __PYX_ERR(0, 900, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":864
+      /* "ext/skeletontricks/skeletontricks.pyx":901
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":863
+      /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":865
+    /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -69182,20 +70395,20 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 865, __pyx_L1_error)
+      __PYX_ERR(0, 902, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":866
+      /* "ext/skeletontricks/skeletontricks.pyx":903
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_x;
@@ -69203,52 +70416,52 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 903, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 866, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":867
+      /* "ext/skeletontricks/skeletontricks.pyx":904
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, 0, -1):
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":865
+      /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L8_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":869
+  /* "ext/skeletontricks/skeletontricks.pyx":906
  *       break
  * 
  *   for x in range(cx, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cx + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_x = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":870
+    /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_18 = __pyx_v_x;
@@ -69256,38 +70469,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 870, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":871
+      /* "ext/skeletontricks/skeletontricks.pyx":908
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":870
+      /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":872
+    /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -69295,20 +70508,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 872, __pyx_L1_error)
+      __PYX_ERR(0, 909, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":873
+      /* "ext/skeletontricks/skeletontricks.pyx":910
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_x;
@@ -69316,54 +70529,54 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 873, __pyx_L1_error)
+        __PYX_ERR(0, 910, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 873, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":874
+      /* "ext/skeletontricks/skeletontricks.pyx":911
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, sy):
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":872
+      /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L11_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":876
+  /* "ext/skeletontricks/skeletontricks.pyx":913
  *       break
  * 
  *   for y in range(cy, sy):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sy;
   __pyx_t_22 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cy; __pyx_t_17 < __pyx_t_22; __pyx_t_17+=1) {
     __pyx_v_y = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":877
+    /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -69371,38 +70584,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 877, __pyx_L1_error)
+      __PYX_ERR(0, 914, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":878
+      /* "ext/skeletontricks/skeletontricks.pyx":915
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":877
+      /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":879
+    /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -69410,20 +70623,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 879, __pyx_L1_error)
+      __PYX_ERR(0, 916, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":880
+      /* "ext/skeletontricks/skeletontricks.pyx":917
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_cx;
@@ -69431,52 +70644,52 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 880, __pyx_L1_error)
+        __PYX_ERR(0, 917, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 880, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 880, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":881
+      /* "ext/skeletontricks/skeletontricks.pyx":918
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, 0, -1):
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":879
+      /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L14_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":883
+  /* "ext/skeletontricks/skeletontricks.pyx":920
  *       break
  * 
  *   for y in range(cy, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cy + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_y = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":884
+    /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -69484,38 +70697,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 884, __pyx_L1_error)
+      __PYX_ERR(0, 921, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":885
+      /* "ext/skeletontricks/skeletontricks.pyx":922
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":884
+      /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":886
+    /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -69523,20 +70736,20 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 886, __pyx_L1_error)
+      __PYX_ERR(0, 923, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":887
+      /* "ext/skeletontricks/skeletontricks.pyx":924
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -69544,54 +70757,54 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 887, __pyx_L1_error)
+        __PYX_ERR(0, 924, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":888
+      /* "ext/skeletontricks/skeletontricks.pyx":925
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, sz):
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":886
+      /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L18_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":890
+  /* "ext/skeletontricks/skeletontricks.pyx":927
  *       break
  * 
  *   for z in range(cz, sz):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sz;
   __pyx_t_20 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cz; __pyx_t_17 < __pyx_t_20; __pyx_t_17+=1) {
     __pyx_v_z = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":891
+    /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -69599,38 +70812,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 891, __pyx_L1_error)
+      __PYX_ERR(0, 928, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":892
+      /* "ext/skeletontricks/skeletontricks.pyx":929
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":891
+      /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":893
+    /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -69638,20 +70851,20 @@
     __pyx_t_22 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 893, __pyx_L1_error)
+      __PYX_ERR(0, 930, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":894
+      /* "ext/skeletontricks/skeletontricks.pyx":931
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -69659,52 +70872,52 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 931, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 894, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":895
+      /* "ext/skeletontricks/skeletontricks.pyx":932
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, 0, -1):
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":893
+      /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L22_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":897
+  /* "ext/skeletontricks/skeletontricks.pyx":934
  *       break
  * 
  *   for z in range(cz, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cz + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_z = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":898
+    /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -69712,38 +70925,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 898, __pyx_L1_error)
+      __PYX_ERR(0, 935, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":899
+      /* "ext/skeletontricks/skeletontricks.pyx":936
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":898
+      /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":900
+    /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -69751,20 +70964,20 @@
     __pyx_t_20 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 937, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":901
+      /* "ext/skeletontricks/skeletontricks.pyx":938
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_cx;
@@ -69772,257 +70985,257 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 901, __pyx_L1_error)
+        __PYX_ERR(0, 938, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int32_t((*__Pyx_BufPtrStrided3d(int32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 901, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":902
+      /* "ext/skeletontricks/skeletontricks.pyx":939
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   changes = [ _ for _ in changes if _ is not None ]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":900
+      /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L26_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":904
+  /* "ext/skeletontricks/skeletontricks.pyx":941
  *       break
  * 
  *   changes = [ _ for _ in changes if _ is not None ]             # <<<<<<<<<<<<<<
  * 
  *   # Too little info to make a decision
  */
   { /* enter inner scope */
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L31_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 941, __pyx_L31_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = __pyx_v_changes; __Pyx_INCREF(__pyx_t_7);
     __pyx_t_23 = 0;
     for (;;) {
       {
         Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_7);
         #if !CYTHON_ASSUME_SAFE_MACROS
-        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
         #endif
         if (__pyx_t_23 >= __pyx_temp) break;
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
       #else
-      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 941, __pyx_L31_error)
       __Pyx_GOTREF(__pyx_t_14);
       #endif
-      __Pyx_XDECREF_SET(__pyx_8genexpr3__pyx_v__, __pyx_t_14);
+      __Pyx_XDECREF_SET(__pyx_8genexpr5__pyx_v__, __pyx_t_14);
       __pyx_t_14 = 0;
-      __pyx_t_5 = (__pyx_8genexpr3__pyx_v__ != Py_None);
+      __pyx_t_5 = (__pyx_8genexpr5__pyx_v__ != Py_None);
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr3__pyx_v__))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr5__pyx_v__))) __PYX_ERR(0, 941, __pyx_L31_error)
       }
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_XDECREF(__pyx_8genexpr3__pyx_v__); __pyx_8genexpr3__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr5__pyx_v__); __pyx_8genexpr5__pyx_v__ = 0;
     goto __pyx_L36_exit_scope;
     __pyx_L31_error:;
-    __Pyx_XDECREF(__pyx_8genexpr3__pyx_v__); __pyx_8genexpr3__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr5__pyx_v__); __pyx_8genexpr5__pyx_v__ = 0;
     goto __pyx_L1_error;
     __pyx_L36_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_changes, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":907
+  /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 944, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 < 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":908
+    /* "ext/skeletontricks/skeletontricks.pyx":945
  *   # Too little info to make a decision
  *   if len(changes) < 3:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_7);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
     __pyx_r = __pyx_t_14;
     __pyx_t_14 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":907
+    /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":910
+  /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 > 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":911
+    /* "ext/skeletontricks/skeletontricks.pyx":948
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  *     allowed_differences = 1             # <<<<<<<<<<<<<<
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0
  */
     __pyx_v_allowed_differences = 1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":910
+    /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
     goto __pyx_L38;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":913
+  /* "ext/skeletontricks/skeletontricks.pyx":950
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0             # <<<<<<<<<<<<<<
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  */
   /*else*/ {
     __pyx_v_allowed_differences = 0;
   }
   __pyx_L38:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":915
+  /* "ext/skeletontricks/skeletontricks.pyx":952
  *     allowed_differences = 0
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)             # <<<<<<<<<<<<<<
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_INCREF(__pyx_v_changes);
   __Pyx_GIVEREF(__pyx_v_changes);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 915, __pyx_L1_error);
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 952, __pyx_L1_error);
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_13))) || (PyList_CheckExact(__pyx_t_13))) {
     PyObject* sequence = __pyx_t_13;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 915, __pyx_L1_error)
+      __PYX_ERR(0, 952, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_8 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_8 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_t_14);
     #else
-    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     #endif
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_24 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
     index = 0; __pyx_t_8 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_8)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_8);
     index = 1; __pyx_t_14 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_14)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_14);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_t_24 = NULL;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L40_unpacking_done;
     __pyx_L39_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_24 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_L40_unpacking_done:;
   }
   __pyx_v_uniq = __pyx_t_8;
   __pyx_t_8 = 0;
   __pyx_v_cts = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":916
+  /* "ext/skeletontricks/skeletontricks.pyx":953
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)             # <<<<<<<<<<<<<<
  *   differences = len(changes) - cts[candidate_fruit_index]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   __pyx_t_16 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
@@ -70035,113 +71248,113 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_cts};
     __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_16, 1+__pyx_t_16);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 916, __pyx_L1_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_v_candidate_fruit_index = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":917
+  /* "ext/skeletontricks/skeletontricks.pyx":954
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]             # <<<<<<<<<<<<<<
  * 
  *   # it's not an avocado if there's lots of
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_differences = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":921
+  /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":922
+    /* "ext/skeletontricks/skeletontricks.pyx":959
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   return (label, uniq[candidate_fruit_index])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_14);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_14 = 0;
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":921
+    /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":924
+  /* "ext/skeletontricks/skeletontricks.pyx":961
  *     return (label, label)
  * 
  *   return (label, uniq[candidate_fruit_index])             # <<<<<<<<<<<<<<
  * 
  * class CachedTargetFinder:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_int32_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_14);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_t_14 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
@@ -70169,24 +71382,24 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_changes);
   __Pyx_XDECREF(__pyx_v_uniq);
   __Pyx_XDECREF(__pyx_v_cts);
   __Pyx_XDECREF(__pyx_v_candidate_fruit_index);
   __Pyx_XDECREF(__pyx_v_differences);
-  __Pyx_XDECREF(__pyx_8genexpr3__pyx_v__);
+  __Pyx_XDECREF(__pyx_8genexpr5__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_179find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_179find_avocado_fruit = {"__pyx_fuse_3find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_179find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_179find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_181find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_181find_avocado_fruit = {"__pyx_fuse_3find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_181find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_fuse_3__pyx_pw_8kimimaro_14skeletontricks_181find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   size_t __pyx_v_cx;
   size_t __pyx_v_cy;
   size_t __pyx_v_cz;
   int64_t __pyx_v_background;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -70224,98 +71437,98 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cz)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_background);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
         values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
         values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
+    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_background = __Pyx_PyInt_As_int64_t(values[4]); if (unlikely((__pyx_v_background == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L3_error)
+      __pyx_v_background = __Pyx_PyInt_As_int64_t(values[4]); if (unlikely((__pyx_v_background == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
     } else {
       __pyx_v_background = ((int64_t)((int64_t)((int64_t)0)));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_avocado_fruit", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 837, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_178find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 874, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_180find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -70324,30 +71537,30 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_178find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int64_t __pyx_v_background) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_180find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, int64_t __pyx_v_background) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   CYTHON_UNUSED size_t __pyx_v_voxels;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   int64_t __pyx_v_label;
   PyObject *__pyx_v_changes = 0;
   long __pyx_v_allowed_differences;
   PyObject *__pyx_v_uniq = NULL;
   PyObject *__pyx_v_cts = NULL;
   PyObject *__pyx_v_candidate_fruit_index = NULL;
   PyObject *__pyx_v_differences = NULL;
-  PyObject *__pyx_8genexpr4__pyx_v__ = NULL;
+  PyObject *__pyx_8genexpr6__pyx_v__ = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
   npy_intp __pyx_t_2;
   npy_intp __pyx_t_3;
@@ -70378,43 +71591,43 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_3find_avocado_fruit", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_int64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":849
+  /* "ext/skeletontricks/skeletontricks.pyx":886
  *   """
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]             # <<<<<<<<<<<<<<
  *   cdef size_t voxels = sx * sy * sz
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 886, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1[0]);
   __pyx_t_3 = (__pyx_t_1[1]);
   __pyx_t_4 = (__pyx_t_1[2]);
   __pyx_v_sx = __pyx_t_2;
   __pyx_v_sy = __pyx_t_3;
   __pyx_v_sz = __pyx_t_4;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":850
+  /* "ext/skeletontricks/skeletontricks.pyx":887
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]
  *   cdef size_t voxels = sx * sy * sz             # <<<<<<<<<<<<<<
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  */
   __pyx_v_voxels = ((__pyx_v_sx * __pyx_v_sy) * __pyx_v_sz);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":852
+  /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   __pyx_t_6 = (__pyx_v_cx >= __pyx_v_sx);
@@ -70430,42 +71643,42 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_cz >= __pyx_v_sz);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":854
+    /* "ext/skeletontricks/skeletontricks.pyx":891
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(             # <<<<<<<<<<<<<<
  *         cx,cy,cz,sx,sy,sz
  *     ))
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 891, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":855
+    /* "ext/skeletontricks/skeletontricks.pyx":892
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz             # <<<<<<<<<<<<<<
  *     ))
  * 
  */
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __pyx_t_15 = NULL;
     __pyx_t_16 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_15)) {
@@ -70483,43 +71696,43 @@
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 891, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":853
+    /* "ext/skeletontricks/skeletontricks.pyx":890
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(             # <<<<<<<<<<<<<<
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz
  */
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 890, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_8, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 853, __pyx_L1_error)
+    __PYX_ERR(0, 890, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":852
+    /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":859
+  /* "ext/skeletontricks/skeletontricks.pyx":896
  * 
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]             # <<<<<<<<<<<<<<
  *   cdef list changes = [ None ] * 6
  * 
  */
   __pyx_t_17 = __pyx_v_cx;
@@ -70527,50 +71740,50 @@
   __pyx_t_19 = __pyx_v_cz;
   __pyx_t_16 = -1;
   if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
   if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
   if (unlikely(__pyx_t_19 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
   if (unlikely(__pyx_t_16 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_16);
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
   __pyx_v_label = (*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":860
+  /* "ext/skeletontricks/skeletontricks.pyx":897
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]
  *   cdef list changes = [ None ] * 6             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, sx):
  */
-  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 6; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 860, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 897, __pyx_L1_error);
     }
   }
   __pyx_v_changes = ((PyObject*)__pyx_t_8);
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":862
+  /* "ext/skeletontricks/skeletontricks.pyx":899
  *   cdef list changes = [ None ] * 6
  * 
  *   for x in range(cx, sx):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sx;
   __pyx_t_18 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cx; __pyx_t_17 < __pyx_t_18; __pyx_t_17+=1) {
     __pyx_v_x = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":863
+    /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_20 = __pyx_v_x;
@@ -70578,38 +71791,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 863, __pyx_L1_error)
+      __PYX_ERR(0, 900, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":864
+      /* "ext/skeletontricks/skeletontricks.pyx":901
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":863
+      /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":865
+    /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -70617,20 +71830,20 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 865, __pyx_L1_error)
+      __PYX_ERR(0, 902, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":866
+      /* "ext/skeletontricks/skeletontricks.pyx":903
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_x;
@@ -70638,52 +71851,52 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 903, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 866, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":867
+      /* "ext/skeletontricks/skeletontricks.pyx":904
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, 0, -1):
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":865
+      /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L8_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":869
+  /* "ext/skeletontricks/skeletontricks.pyx":906
  *       break
  * 
  *   for x in range(cx, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cx + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_x = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":870
+    /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_18 = __pyx_v_x;
@@ -70691,38 +71904,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 870, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":871
+      /* "ext/skeletontricks/skeletontricks.pyx":908
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":870
+      /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":872
+    /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -70730,20 +71943,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 872, __pyx_L1_error)
+      __PYX_ERR(0, 909, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":873
+      /* "ext/skeletontricks/skeletontricks.pyx":910
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_x;
@@ -70751,54 +71964,54 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 873, __pyx_L1_error)
+        __PYX_ERR(0, 910, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 873, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":874
+      /* "ext/skeletontricks/skeletontricks.pyx":911
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, sy):
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":872
+      /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L11_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":876
+  /* "ext/skeletontricks/skeletontricks.pyx":913
  *       break
  * 
  *   for y in range(cy, sy):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sy;
   __pyx_t_22 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cy; __pyx_t_17 < __pyx_t_22; __pyx_t_17+=1) {
     __pyx_v_y = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":877
+    /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -70806,38 +72019,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 877, __pyx_L1_error)
+      __PYX_ERR(0, 914, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":878
+      /* "ext/skeletontricks/skeletontricks.pyx":915
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":877
+      /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":879
+    /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -70845,20 +72058,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 879, __pyx_L1_error)
+      __PYX_ERR(0, 916, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":880
+      /* "ext/skeletontricks/skeletontricks.pyx":917
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_cx;
@@ -70866,52 +72079,52 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 880, __pyx_L1_error)
+        __PYX_ERR(0, 917, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 880, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 880, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":881
+      /* "ext/skeletontricks/skeletontricks.pyx":918
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, 0, -1):
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":879
+      /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L14_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":883
+  /* "ext/skeletontricks/skeletontricks.pyx":920
  *       break
  * 
  *   for y in range(cy, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cy + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_y = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":884
+    /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -70919,38 +72132,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 884, __pyx_L1_error)
+      __PYX_ERR(0, 921, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":885
+      /* "ext/skeletontricks/skeletontricks.pyx":922
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":884
+      /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":886
+    /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -70958,20 +72171,20 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 886, __pyx_L1_error)
+      __PYX_ERR(0, 923, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":887
+      /* "ext/skeletontricks/skeletontricks.pyx":924
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -70979,54 +72192,54 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 887, __pyx_L1_error)
+        __PYX_ERR(0, 924, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":888
+      /* "ext/skeletontricks/skeletontricks.pyx":925
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, sz):
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":886
+      /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L18_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":890
+  /* "ext/skeletontricks/skeletontricks.pyx":927
  *       break
  * 
  *   for z in range(cz, sz):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sz;
   __pyx_t_20 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cz; __pyx_t_17 < __pyx_t_20; __pyx_t_17+=1) {
     __pyx_v_z = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":891
+    /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -71034,38 +72247,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 891, __pyx_L1_error)
+      __PYX_ERR(0, 928, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":892
+      /* "ext/skeletontricks/skeletontricks.pyx":929
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":891
+      /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":893
+    /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -71073,20 +72286,20 @@
     __pyx_t_22 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 893, __pyx_L1_error)
+      __PYX_ERR(0, 930, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":894
+      /* "ext/skeletontricks/skeletontricks.pyx":931
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -71094,52 +72307,52 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 931, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 894, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":895
+      /* "ext/skeletontricks/skeletontricks.pyx":932
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, 0, -1):
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":893
+      /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L22_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":897
+  /* "ext/skeletontricks/skeletontricks.pyx":934
  *       break
  * 
  *   for z in range(cz, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cz + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_z = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":898
+    /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -71147,38 +72360,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 898, __pyx_L1_error)
+      __PYX_ERR(0, 935, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":899
+      /* "ext/skeletontricks/skeletontricks.pyx":936
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":898
+      /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":900
+    /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -71186,20 +72399,20 @@
     __pyx_t_20 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 937, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":901
+      /* "ext/skeletontricks/skeletontricks.pyx":938
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_cx;
@@ -71207,257 +72420,257 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 901, __pyx_L1_error)
+        __PYX_ERR(0, 938, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int64_t((*__Pyx_BufPtrStrided3d(int64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 901, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":902
+      /* "ext/skeletontricks/skeletontricks.pyx":939
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   changes = [ _ for _ in changes if _ is not None ]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":900
+      /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L26_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":904
+  /* "ext/skeletontricks/skeletontricks.pyx":941
  *       break
  * 
  *   changes = [ _ for _ in changes if _ is not None ]             # <<<<<<<<<<<<<<
  * 
  *   # Too little info to make a decision
  */
   { /* enter inner scope */
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L31_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 941, __pyx_L31_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = __pyx_v_changes; __Pyx_INCREF(__pyx_t_7);
     __pyx_t_23 = 0;
     for (;;) {
       {
         Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_7);
         #if !CYTHON_ASSUME_SAFE_MACROS
-        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
         #endif
         if (__pyx_t_23 >= __pyx_temp) break;
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
       #else
-      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 941, __pyx_L31_error)
       __Pyx_GOTREF(__pyx_t_14);
       #endif
-      __Pyx_XDECREF_SET(__pyx_8genexpr4__pyx_v__, __pyx_t_14);
+      __Pyx_XDECREF_SET(__pyx_8genexpr6__pyx_v__, __pyx_t_14);
       __pyx_t_14 = 0;
-      __pyx_t_5 = (__pyx_8genexpr4__pyx_v__ != Py_None);
+      __pyx_t_5 = (__pyx_8genexpr6__pyx_v__ != Py_None);
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr4__pyx_v__))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr6__pyx_v__))) __PYX_ERR(0, 941, __pyx_L31_error)
       }
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_XDECREF(__pyx_8genexpr4__pyx_v__); __pyx_8genexpr4__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v__); __pyx_8genexpr6__pyx_v__ = 0;
     goto __pyx_L36_exit_scope;
     __pyx_L31_error:;
-    __Pyx_XDECREF(__pyx_8genexpr4__pyx_v__); __pyx_8genexpr4__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v__); __pyx_8genexpr6__pyx_v__ = 0;
     goto __pyx_L1_error;
     __pyx_L36_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_changes, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":907
+  /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 944, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 < 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":908
+    /* "ext/skeletontricks/skeletontricks.pyx":945
  *   # Too little info to make a decision
  *   if len(changes) < 3:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_7);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
     __pyx_r = __pyx_t_14;
     __pyx_t_14 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":907
+    /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":910
+  /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 > 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":911
+    /* "ext/skeletontricks/skeletontricks.pyx":948
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  *     allowed_differences = 1             # <<<<<<<<<<<<<<
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0
  */
     __pyx_v_allowed_differences = 1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":910
+    /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
     goto __pyx_L38;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":913
+  /* "ext/skeletontricks/skeletontricks.pyx":950
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0             # <<<<<<<<<<<<<<
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  */
   /*else*/ {
     __pyx_v_allowed_differences = 0;
   }
   __pyx_L38:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":915
+  /* "ext/skeletontricks/skeletontricks.pyx":952
  *     allowed_differences = 0
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)             # <<<<<<<<<<<<<<
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_INCREF(__pyx_v_changes);
   __Pyx_GIVEREF(__pyx_v_changes);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 915, __pyx_L1_error);
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 952, __pyx_L1_error);
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_13))) || (PyList_CheckExact(__pyx_t_13))) {
     PyObject* sequence = __pyx_t_13;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 915, __pyx_L1_error)
+      __PYX_ERR(0, 952, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_8 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_8 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_t_14);
     #else
-    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     #endif
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_24 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
     index = 0; __pyx_t_8 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_8)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_8);
     index = 1; __pyx_t_14 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_14)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_14);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_t_24 = NULL;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L40_unpacking_done;
     __pyx_L39_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_24 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_L40_unpacking_done:;
   }
   __pyx_v_uniq = __pyx_t_8;
   __pyx_t_8 = 0;
   __pyx_v_cts = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":916
+  /* "ext/skeletontricks/skeletontricks.pyx":953
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)             # <<<<<<<<<<<<<<
  *   differences = len(changes) - cts[candidate_fruit_index]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   __pyx_t_16 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
@@ -71470,113 +72683,113 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_cts};
     __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_16, 1+__pyx_t_16);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 916, __pyx_L1_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_v_candidate_fruit_index = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":917
+  /* "ext/skeletontricks/skeletontricks.pyx":954
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]             # <<<<<<<<<<<<<<
  * 
  *   # it's not an avocado if there's lots of
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_differences = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":921
+  /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":922
+    /* "ext/skeletontricks/skeletontricks.pyx":959
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   return (label, uniq[candidate_fruit_index])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_14);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_14 = 0;
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":921
+    /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":924
+  /* "ext/skeletontricks/skeletontricks.pyx":961
  *     return (label, label)
  * 
  *   return (label, uniq[candidate_fruit_index])             # <<<<<<<<<<<<<<
  * 
  * class CachedTargetFinder:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_int64_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_14);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_t_14 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
@@ -71604,24 +72817,24 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_changes);
   __Pyx_XDECREF(__pyx_v_uniq);
   __Pyx_XDECREF(__pyx_v_cts);
   __Pyx_XDECREF(__pyx_v_candidate_fruit_index);
   __Pyx_XDECREF(__pyx_v_differences);
-  __Pyx_XDECREF(__pyx_8genexpr4__pyx_v__);
+  __Pyx_XDECREF(__pyx_8genexpr6__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_181find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_181find_avocado_fruit = {"__pyx_fuse_4find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_181find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_181find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_183find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_183find_avocado_fruit = {"__pyx_fuse_4find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_183find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_fuse_4__pyx_pw_8kimimaro_14skeletontricks_183find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   size_t __pyx_v_cx;
   size_t __pyx_v_cy;
   size_t __pyx_v_cz;
   uint8_t __pyx_v_background;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -71659,98 +72872,98 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cz)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_background);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
         values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
         values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
+    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_background = __Pyx_PyInt_As_uint8_t(values[4]); if (unlikely((__pyx_v_background == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L3_error)
+      __pyx_v_background = __Pyx_PyInt_As_uint8_t(values[4]); if (unlikely((__pyx_v_background == ((uint8_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
     } else {
       __pyx_v_background = ((uint8_t)((uint8_t)((uint8_t)0)));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_avocado_fruit", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 837, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_180find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 874, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_182find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -71759,30 +72972,30 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_180find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint8_t __pyx_v_background) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_182find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint8_t __pyx_v_background) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   CYTHON_UNUSED size_t __pyx_v_voxels;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   uint8_t __pyx_v_label;
   PyObject *__pyx_v_changes = 0;
   long __pyx_v_allowed_differences;
   PyObject *__pyx_v_uniq = NULL;
   PyObject *__pyx_v_cts = NULL;
   PyObject *__pyx_v_candidate_fruit_index = NULL;
   PyObject *__pyx_v_differences = NULL;
-  PyObject *__pyx_8genexpr5__pyx_v__ = NULL;
+  PyObject *__pyx_8genexpr7__pyx_v__ = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
   npy_intp __pyx_t_2;
   npy_intp __pyx_t_3;
@@ -71813,43 +73026,43 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_4find_avocado_fruit", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint8_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":849
+  /* "ext/skeletontricks/skeletontricks.pyx":886
  *   """
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]             # <<<<<<<<<<<<<<
  *   cdef size_t voxels = sx * sy * sz
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 886, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1[0]);
   __pyx_t_3 = (__pyx_t_1[1]);
   __pyx_t_4 = (__pyx_t_1[2]);
   __pyx_v_sx = __pyx_t_2;
   __pyx_v_sy = __pyx_t_3;
   __pyx_v_sz = __pyx_t_4;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":850
+  /* "ext/skeletontricks/skeletontricks.pyx":887
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]
  *   cdef size_t voxels = sx * sy * sz             # <<<<<<<<<<<<<<
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  */
   __pyx_v_voxels = ((__pyx_v_sx * __pyx_v_sy) * __pyx_v_sz);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":852
+  /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   __pyx_t_6 = (__pyx_v_cx >= __pyx_v_sx);
@@ -71865,42 +73078,42 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_cz >= __pyx_v_sz);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":854
+    /* "ext/skeletontricks/skeletontricks.pyx":891
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(             # <<<<<<<<<<<<<<
  *         cx,cy,cz,sx,sy,sz
  *     ))
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 891, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":855
+    /* "ext/skeletontricks/skeletontricks.pyx":892
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz             # <<<<<<<<<<<<<<
  *     ))
  * 
  */
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __pyx_t_15 = NULL;
     __pyx_t_16 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_15)) {
@@ -71918,43 +73131,43 @@
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 891, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":853
+    /* "ext/skeletontricks/skeletontricks.pyx":890
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(             # <<<<<<<<<<<<<<
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz
  */
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 890, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_8, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 853, __pyx_L1_error)
+    __PYX_ERR(0, 890, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":852
+    /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":859
+  /* "ext/skeletontricks/skeletontricks.pyx":896
  * 
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]             # <<<<<<<<<<<<<<
  *   cdef list changes = [ None ] * 6
  * 
  */
   __pyx_t_17 = __pyx_v_cx;
@@ -71962,50 +73175,50 @@
   __pyx_t_19 = __pyx_v_cz;
   __pyx_t_16 = -1;
   if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
   if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
   if (unlikely(__pyx_t_19 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
   if (unlikely(__pyx_t_16 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_16);
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
   __pyx_v_label = (*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":860
+  /* "ext/skeletontricks/skeletontricks.pyx":897
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]
  *   cdef list changes = [ None ] * 6             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, sx):
  */
-  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 6; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 860, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 897, __pyx_L1_error);
     }
   }
   __pyx_v_changes = ((PyObject*)__pyx_t_8);
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":862
+  /* "ext/skeletontricks/skeletontricks.pyx":899
  *   cdef list changes = [ None ] * 6
  * 
  *   for x in range(cx, sx):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sx;
   __pyx_t_18 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cx; __pyx_t_17 < __pyx_t_18; __pyx_t_17+=1) {
     __pyx_v_x = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":863
+    /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_20 = __pyx_v_x;
@@ -72013,38 +73226,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 863, __pyx_L1_error)
+      __PYX_ERR(0, 900, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":864
+      /* "ext/skeletontricks/skeletontricks.pyx":901
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":863
+      /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":865
+    /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -72052,20 +73265,20 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 865, __pyx_L1_error)
+      __PYX_ERR(0, 902, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":866
+      /* "ext/skeletontricks/skeletontricks.pyx":903
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_x;
@@ -72073,52 +73286,52 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 903, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 866, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":867
+      /* "ext/skeletontricks/skeletontricks.pyx":904
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, 0, -1):
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":865
+      /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L8_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":869
+  /* "ext/skeletontricks/skeletontricks.pyx":906
  *       break
  * 
  *   for x in range(cx, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cx + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_x = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":870
+    /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_18 = __pyx_v_x;
@@ -72126,38 +73339,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 870, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":871
+      /* "ext/skeletontricks/skeletontricks.pyx":908
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":870
+      /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":872
+    /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -72165,20 +73378,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 872, __pyx_L1_error)
+      __PYX_ERR(0, 909, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":873
+      /* "ext/skeletontricks/skeletontricks.pyx":910
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_x;
@@ -72186,54 +73399,54 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 873, __pyx_L1_error)
+        __PYX_ERR(0, 910, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 873, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":874
+      /* "ext/skeletontricks/skeletontricks.pyx":911
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, sy):
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":872
+      /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L11_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":876
+  /* "ext/skeletontricks/skeletontricks.pyx":913
  *       break
  * 
  *   for y in range(cy, sy):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sy;
   __pyx_t_22 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cy; __pyx_t_17 < __pyx_t_22; __pyx_t_17+=1) {
     __pyx_v_y = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":877
+    /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -72241,38 +73454,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 877, __pyx_L1_error)
+      __PYX_ERR(0, 914, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":878
+      /* "ext/skeletontricks/skeletontricks.pyx":915
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":877
+      /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":879
+    /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -72280,20 +73493,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 879, __pyx_L1_error)
+      __PYX_ERR(0, 916, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":880
+      /* "ext/skeletontricks/skeletontricks.pyx":917
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_cx;
@@ -72301,52 +73514,52 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 880, __pyx_L1_error)
+        __PYX_ERR(0, 917, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 880, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 880, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":881
+      /* "ext/skeletontricks/skeletontricks.pyx":918
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, 0, -1):
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":879
+      /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L14_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":883
+  /* "ext/skeletontricks/skeletontricks.pyx":920
  *       break
  * 
  *   for y in range(cy, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cy + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_y = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":884
+    /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -72354,38 +73567,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 884, __pyx_L1_error)
+      __PYX_ERR(0, 921, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":885
+      /* "ext/skeletontricks/skeletontricks.pyx":922
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":884
+      /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":886
+    /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -72393,20 +73606,20 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 886, __pyx_L1_error)
+      __PYX_ERR(0, 923, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":887
+      /* "ext/skeletontricks/skeletontricks.pyx":924
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -72414,54 +73627,54 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 887, __pyx_L1_error)
+        __PYX_ERR(0, 924, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":888
+      /* "ext/skeletontricks/skeletontricks.pyx":925
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, sz):
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":886
+      /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L18_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":890
+  /* "ext/skeletontricks/skeletontricks.pyx":927
  *       break
  * 
  *   for z in range(cz, sz):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sz;
   __pyx_t_20 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cz; __pyx_t_17 < __pyx_t_20; __pyx_t_17+=1) {
     __pyx_v_z = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":891
+    /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -72469,38 +73682,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 891, __pyx_L1_error)
+      __PYX_ERR(0, 928, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":892
+      /* "ext/skeletontricks/skeletontricks.pyx":929
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":891
+      /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":893
+    /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -72508,20 +73721,20 @@
     __pyx_t_22 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 893, __pyx_L1_error)
+      __PYX_ERR(0, 930, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":894
+      /* "ext/skeletontricks/skeletontricks.pyx":931
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -72529,52 +73742,52 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 931, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 894, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":895
+      /* "ext/skeletontricks/skeletontricks.pyx":932
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, 0, -1):
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":893
+      /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L22_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":897
+  /* "ext/skeletontricks/skeletontricks.pyx":934
  *       break
  * 
  *   for z in range(cz, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cz + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_z = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":898
+    /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -72582,38 +73795,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 898, __pyx_L1_error)
+      __PYX_ERR(0, 935, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":899
+      /* "ext/skeletontricks/skeletontricks.pyx":936
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":898
+      /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":900
+    /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -72621,20 +73834,20 @@
     __pyx_t_20 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 937, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":901
+      /* "ext/skeletontricks/skeletontricks.pyx":938
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_cx;
@@ -72642,257 +73855,257 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 901, __pyx_L1_error)
+        __PYX_ERR(0, 938, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint8_t((*__Pyx_BufPtrStrided3d(uint8_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 901, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":902
+      /* "ext/skeletontricks/skeletontricks.pyx":939
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   changes = [ _ for _ in changes if _ is not None ]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":900
+      /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L26_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":904
+  /* "ext/skeletontricks/skeletontricks.pyx":941
  *       break
  * 
  *   changes = [ _ for _ in changes if _ is not None ]             # <<<<<<<<<<<<<<
  * 
  *   # Too little info to make a decision
  */
   { /* enter inner scope */
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L31_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 941, __pyx_L31_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = __pyx_v_changes; __Pyx_INCREF(__pyx_t_7);
     __pyx_t_23 = 0;
     for (;;) {
       {
         Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_7);
         #if !CYTHON_ASSUME_SAFE_MACROS
-        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
         #endif
         if (__pyx_t_23 >= __pyx_temp) break;
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
       #else
-      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 941, __pyx_L31_error)
       __Pyx_GOTREF(__pyx_t_14);
       #endif
-      __Pyx_XDECREF_SET(__pyx_8genexpr5__pyx_v__, __pyx_t_14);
+      __Pyx_XDECREF_SET(__pyx_8genexpr7__pyx_v__, __pyx_t_14);
       __pyx_t_14 = 0;
-      __pyx_t_5 = (__pyx_8genexpr5__pyx_v__ != Py_None);
+      __pyx_t_5 = (__pyx_8genexpr7__pyx_v__ != Py_None);
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr5__pyx_v__))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr7__pyx_v__))) __PYX_ERR(0, 941, __pyx_L31_error)
       }
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_XDECREF(__pyx_8genexpr5__pyx_v__); __pyx_8genexpr5__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr7__pyx_v__); __pyx_8genexpr7__pyx_v__ = 0;
     goto __pyx_L36_exit_scope;
     __pyx_L31_error:;
-    __Pyx_XDECREF(__pyx_8genexpr5__pyx_v__); __pyx_8genexpr5__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr7__pyx_v__); __pyx_8genexpr7__pyx_v__ = 0;
     goto __pyx_L1_error;
     __pyx_L36_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_changes, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":907
+  /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 944, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 < 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":908
+    /* "ext/skeletontricks/skeletontricks.pyx":945
  *   # Too little info to make a decision
  *   if len(changes) < 3:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_7);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
     __pyx_r = __pyx_t_14;
     __pyx_t_14 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":907
+    /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":910
+  /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 > 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":911
+    /* "ext/skeletontricks/skeletontricks.pyx":948
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  *     allowed_differences = 1             # <<<<<<<<<<<<<<
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0
  */
     __pyx_v_allowed_differences = 1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":910
+    /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
     goto __pyx_L38;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":913
+  /* "ext/skeletontricks/skeletontricks.pyx":950
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0             # <<<<<<<<<<<<<<
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  */
   /*else*/ {
     __pyx_v_allowed_differences = 0;
   }
   __pyx_L38:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":915
+  /* "ext/skeletontricks/skeletontricks.pyx":952
  *     allowed_differences = 0
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)             # <<<<<<<<<<<<<<
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_INCREF(__pyx_v_changes);
   __Pyx_GIVEREF(__pyx_v_changes);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 915, __pyx_L1_error);
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 952, __pyx_L1_error);
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_13))) || (PyList_CheckExact(__pyx_t_13))) {
     PyObject* sequence = __pyx_t_13;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 915, __pyx_L1_error)
+      __PYX_ERR(0, 952, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_8 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_8 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_t_14);
     #else
-    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     #endif
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_24 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
     index = 0; __pyx_t_8 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_8)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_8);
     index = 1; __pyx_t_14 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_14)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_14);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_t_24 = NULL;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L40_unpacking_done;
     __pyx_L39_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_24 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_L40_unpacking_done:;
   }
   __pyx_v_uniq = __pyx_t_8;
   __pyx_t_8 = 0;
   __pyx_v_cts = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":916
+  /* "ext/skeletontricks/skeletontricks.pyx":953
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)             # <<<<<<<<<<<<<<
  *   differences = len(changes) - cts[candidate_fruit_index]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   __pyx_t_16 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
@@ -72905,113 +74118,113 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_cts};
     __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_16, 1+__pyx_t_16);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 916, __pyx_L1_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_v_candidate_fruit_index = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":917
+  /* "ext/skeletontricks/skeletontricks.pyx":954
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]             # <<<<<<<<<<<<<<
  * 
  *   # it's not an avocado if there's lots of
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_differences = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":921
+  /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":922
+    /* "ext/skeletontricks/skeletontricks.pyx":959
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   return (label, uniq[candidate_fruit_index])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_14);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_14 = 0;
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":921
+    /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":924
+  /* "ext/skeletontricks/skeletontricks.pyx":961
  *     return (label, label)
  * 
  *   return (label, uniq[candidate_fruit_index])             # <<<<<<<<<<<<<<
  * 
  * class CachedTargetFinder:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_uint8_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_14);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_t_14 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
@@ -73039,24 +74252,24 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_changes);
   __Pyx_XDECREF(__pyx_v_uniq);
   __Pyx_XDECREF(__pyx_v_cts);
   __Pyx_XDECREF(__pyx_v_candidate_fruit_index);
   __Pyx_XDECREF(__pyx_v_differences);
-  __Pyx_XDECREF(__pyx_8genexpr5__pyx_v__);
+  __Pyx_XDECREF(__pyx_8genexpr7__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_183find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_5__pyx_mdef_8kimimaro_14skeletontricks_183find_avocado_fruit = {"__pyx_fuse_5find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_183find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_183find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_185find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_5__pyx_mdef_8kimimaro_14skeletontricks_185find_avocado_fruit = {"__pyx_fuse_5find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_185find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_fuse_5__pyx_pw_8kimimaro_14skeletontricks_185find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   size_t __pyx_v_cx;
   size_t __pyx_v_cy;
   size_t __pyx_v_cz;
   uint16_t __pyx_v_background;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -73094,98 +74307,98 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cz)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_background);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
         values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
         values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
+    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_background = __Pyx_PyInt_As_uint16_t(values[4]); if (unlikely((__pyx_v_background == ((uint16_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L3_error)
+      __pyx_v_background = __Pyx_PyInt_As_uint16_t(values[4]); if (unlikely((__pyx_v_background == ((uint16_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
     } else {
       __pyx_v_background = ((uint16_t)((uint16_t)((uint16_t)0)));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_avocado_fruit", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 837, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_182find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 874, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_184find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -73194,30 +74407,30 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_182find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint16_t __pyx_v_background) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_184find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint16_t __pyx_v_background) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   CYTHON_UNUSED size_t __pyx_v_voxels;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   uint16_t __pyx_v_label;
   PyObject *__pyx_v_changes = 0;
   long __pyx_v_allowed_differences;
   PyObject *__pyx_v_uniq = NULL;
   PyObject *__pyx_v_cts = NULL;
   PyObject *__pyx_v_candidate_fruit_index = NULL;
   PyObject *__pyx_v_differences = NULL;
-  PyObject *__pyx_8genexpr6__pyx_v__ = NULL;
+  PyObject *__pyx_8genexpr8__pyx_v__ = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
   npy_intp __pyx_t_2;
   npy_intp __pyx_t_3;
@@ -73248,43 +74461,43 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_5find_avocado_fruit", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint16_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":849
+  /* "ext/skeletontricks/skeletontricks.pyx":886
  *   """
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]             # <<<<<<<<<<<<<<
  *   cdef size_t voxels = sx * sy * sz
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 886, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1[0]);
   __pyx_t_3 = (__pyx_t_1[1]);
   __pyx_t_4 = (__pyx_t_1[2]);
   __pyx_v_sx = __pyx_t_2;
   __pyx_v_sy = __pyx_t_3;
   __pyx_v_sz = __pyx_t_4;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":850
+  /* "ext/skeletontricks/skeletontricks.pyx":887
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]
  *   cdef size_t voxels = sx * sy * sz             # <<<<<<<<<<<<<<
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  */
   __pyx_v_voxels = ((__pyx_v_sx * __pyx_v_sy) * __pyx_v_sz);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":852
+  /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   __pyx_t_6 = (__pyx_v_cx >= __pyx_v_sx);
@@ -73300,42 +74513,42 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_cz >= __pyx_v_sz);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":854
+    /* "ext/skeletontricks/skeletontricks.pyx":891
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(             # <<<<<<<<<<<<<<
  *         cx,cy,cz,sx,sy,sz
  *     ))
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 891, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":855
+    /* "ext/skeletontricks/skeletontricks.pyx":892
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz             # <<<<<<<<<<<<<<
  *     ))
  * 
  */
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __pyx_t_15 = NULL;
     __pyx_t_16 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_15)) {
@@ -73353,43 +74566,43 @@
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 891, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":853
+    /* "ext/skeletontricks/skeletontricks.pyx":890
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(             # <<<<<<<<<<<<<<
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz
  */
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 890, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_8, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 853, __pyx_L1_error)
+    __PYX_ERR(0, 890, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":852
+    /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":859
+  /* "ext/skeletontricks/skeletontricks.pyx":896
  * 
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]             # <<<<<<<<<<<<<<
  *   cdef list changes = [ None ] * 6
  * 
  */
   __pyx_t_17 = __pyx_v_cx;
@@ -73397,50 +74610,50 @@
   __pyx_t_19 = __pyx_v_cz;
   __pyx_t_16 = -1;
   if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
   if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
   if (unlikely(__pyx_t_19 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
   if (unlikely(__pyx_t_16 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_16);
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
   __pyx_v_label = (*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":860
+  /* "ext/skeletontricks/skeletontricks.pyx":897
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]
  *   cdef list changes = [ None ] * 6             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, sx):
  */
-  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 6; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 860, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 897, __pyx_L1_error);
     }
   }
   __pyx_v_changes = ((PyObject*)__pyx_t_8);
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":862
+  /* "ext/skeletontricks/skeletontricks.pyx":899
  *   cdef list changes = [ None ] * 6
  * 
  *   for x in range(cx, sx):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sx;
   __pyx_t_18 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cx; __pyx_t_17 < __pyx_t_18; __pyx_t_17+=1) {
     __pyx_v_x = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":863
+    /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_20 = __pyx_v_x;
@@ -73448,38 +74661,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 863, __pyx_L1_error)
+      __PYX_ERR(0, 900, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":864
+      /* "ext/skeletontricks/skeletontricks.pyx":901
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":863
+      /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":865
+    /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -73487,20 +74700,20 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 865, __pyx_L1_error)
+      __PYX_ERR(0, 902, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":866
+      /* "ext/skeletontricks/skeletontricks.pyx":903
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_x;
@@ -73508,52 +74721,52 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 903, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 866, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":867
+      /* "ext/skeletontricks/skeletontricks.pyx":904
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, 0, -1):
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":865
+      /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L8_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":869
+  /* "ext/skeletontricks/skeletontricks.pyx":906
  *       break
  * 
  *   for x in range(cx, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cx + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_x = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":870
+    /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_18 = __pyx_v_x;
@@ -73561,38 +74774,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 870, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":871
+      /* "ext/skeletontricks/skeletontricks.pyx":908
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":870
+      /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":872
+    /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -73600,20 +74813,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 872, __pyx_L1_error)
+      __PYX_ERR(0, 909, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":873
+      /* "ext/skeletontricks/skeletontricks.pyx":910
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_x;
@@ -73621,54 +74834,54 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 873, __pyx_L1_error)
+        __PYX_ERR(0, 910, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 873, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":874
+      /* "ext/skeletontricks/skeletontricks.pyx":911
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, sy):
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":872
+      /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L11_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":876
+  /* "ext/skeletontricks/skeletontricks.pyx":913
  *       break
  * 
  *   for y in range(cy, sy):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sy;
   __pyx_t_22 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cy; __pyx_t_17 < __pyx_t_22; __pyx_t_17+=1) {
     __pyx_v_y = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":877
+    /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -73676,38 +74889,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 877, __pyx_L1_error)
+      __PYX_ERR(0, 914, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":878
+      /* "ext/skeletontricks/skeletontricks.pyx":915
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":877
+      /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":879
+    /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -73715,20 +74928,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 879, __pyx_L1_error)
+      __PYX_ERR(0, 916, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":880
+      /* "ext/skeletontricks/skeletontricks.pyx":917
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_cx;
@@ -73736,52 +74949,52 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 880, __pyx_L1_error)
+        __PYX_ERR(0, 917, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 880, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 880, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":881
+      /* "ext/skeletontricks/skeletontricks.pyx":918
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, 0, -1):
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":879
+      /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L14_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":883
+  /* "ext/skeletontricks/skeletontricks.pyx":920
  *       break
  * 
  *   for y in range(cy, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cy + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_y = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":884
+    /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -73789,38 +75002,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 884, __pyx_L1_error)
+      __PYX_ERR(0, 921, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":885
+      /* "ext/skeletontricks/skeletontricks.pyx":922
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":884
+      /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":886
+    /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -73828,20 +75041,20 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 886, __pyx_L1_error)
+      __PYX_ERR(0, 923, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":887
+      /* "ext/skeletontricks/skeletontricks.pyx":924
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -73849,54 +75062,54 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 887, __pyx_L1_error)
+        __PYX_ERR(0, 924, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":888
+      /* "ext/skeletontricks/skeletontricks.pyx":925
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, sz):
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":886
+      /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L18_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":890
+  /* "ext/skeletontricks/skeletontricks.pyx":927
  *       break
  * 
  *   for z in range(cz, sz):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sz;
   __pyx_t_20 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cz; __pyx_t_17 < __pyx_t_20; __pyx_t_17+=1) {
     __pyx_v_z = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":891
+    /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -73904,38 +75117,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 891, __pyx_L1_error)
+      __PYX_ERR(0, 928, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":892
+      /* "ext/skeletontricks/skeletontricks.pyx":929
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":891
+      /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":893
+    /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -73943,20 +75156,20 @@
     __pyx_t_22 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 893, __pyx_L1_error)
+      __PYX_ERR(0, 930, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":894
+      /* "ext/skeletontricks/skeletontricks.pyx":931
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -73964,52 +75177,52 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 931, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 894, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":895
+      /* "ext/skeletontricks/skeletontricks.pyx":932
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, 0, -1):
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":893
+      /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L22_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":897
+  /* "ext/skeletontricks/skeletontricks.pyx":934
  *       break
  * 
  *   for z in range(cz, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cz + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_z = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":898
+    /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -74017,38 +75230,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 898, __pyx_L1_error)
+      __PYX_ERR(0, 935, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":899
+      /* "ext/skeletontricks/skeletontricks.pyx":936
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":898
+      /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":900
+    /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -74056,20 +75269,20 @@
     __pyx_t_20 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 937, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":901
+      /* "ext/skeletontricks/skeletontricks.pyx":938
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_cx;
@@ -74077,257 +75290,257 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 901, __pyx_L1_error)
+        __PYX_ERR(0, 938, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint16_t((*__Pyx_BufPtrStrided3d(uint16_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 901, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":902
+      /* "ext/skeletontricks/skeletontricks.pyx":939
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   changes = [ _ for _ in changes if _ is not None ]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":900
+      /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L26_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":904
+  /* "ext/skeletontricks/skeletontricks.pyx":941
  *       break
  * 
  *   changes = [ _ for _ in changes if _ is not None ]             # <<<<<<<<<<<<<<
  * 
  *   # Too little info to make a decision
  */
   { /* enter inner scope */
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L31_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 941, __pyx_L31_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = __pyx_v_changes; __Pyx_INCREF(__pyx_t_7);
     __pyx_t_23 = 0;
     for (;;) {
       {
         Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_7);
         #if !CYTHON_ASSUME_SAFE_MACROS
-        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
         #endif
         if (__pyx_t_23 >= __pyx_temp) break;
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
       #else
-      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 941, __pyx_L31_error)
       __Pyx_GOTREF(__pyx_t_14);
       #endif
-      __Pyx_XDECREF_SET(__pyx_8genexpr6__pyx_v__, __pyx_t_14);
+      __Pyx_XDECREF_SET(__pyx_8genexpr8__pyx_v__, __pyx_t_14);
       __pyx_t_14 = 0;
-      __pyx_t_5 = (__pyx_8genexpr6__pyx_v__ != Py_None);
+      __pyx_t_5 = (__pyx_8genexpr8__pyx_v__ != Py_None);
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr6__pyx_v__))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr8__pyx_v__))) __PYX_ERR(0, 941, __pyx_L31_error)
       }
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v__); __pyx_8genexpr6__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr8__pyx_v__); __pyx_8genexpr8__pyx_v__ = 0;
     goto __pyx_L36_exit_scope;
     __pyx_L31_error:;
-    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v__); __pyx_8genexpr6__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr8__pyx_v__); __pyx_8genexpr8__pyx_v__ = 0;
     goto __pyx_L1_error;
     __pyx_L36_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_changes, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":907
+  /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 944, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 < 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":908
+    /* "ext/skeletontricks/skeletontricks.pyx":945
  *   # Too little info to make a decision
  *   if len(changes) < 3:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_7);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
     __pyx_r = __pyx_t_14;
     __pyx_t_14 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":907
+    /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":910
+  /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 > 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":911
+    /* "ext/skeletontricks/skeletontricks.pyx":948
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  *     allowed_differences = 1             # <<<<<<<<<<<<<<
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0
  */
     __pyx_v_allowed_differences = 1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":910
+    /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
     goto __pyx_L38;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":913
+  /* "ext/skeletontricks/skeletontricks.pyx":950
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0             # <<<<<<<<<<<<<<
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  */
   /*else*/ {
     __pyx_v_allowed_differences = 0;
   }
   __pyx_L38:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":915
+  /* "ext/skeletontricks/skeletontricks.pyx":952
  *     allowed_differences = 0
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)             # <<<<<<<<<<<<<<
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_INCREF(__pyx_v_changes);
   __Pyx_GIVEREF(__pyx_v_changes);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 915, __pyx_L1_error);
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 952, __pyx_L1_error);
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_13))) || (PyList_CheckExact(__pyx_t_13))) {
     PyObject* sequence = __pyx_t_13;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 915, __pyx_L1_error)
+      __PYX_ERR(0, 952, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_8 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_8 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_t_14);
     #else
-    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     #endif
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_24 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
     index = 0; __pyx_t_8 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_8)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_8);
     index = 1; __pyx_t_14 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_14)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_14);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_t_24 = NULL;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L40_unpacking_done;
     __pyx_L39_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_24 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_L40_unpacking_done:;
   }
   __pyx_v_uniq = __pyx_t_8;
   __pyx_t_8 = 0;
   __pyx_v_cts = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":916
+  /* "ext/skeletontricks/skeletontricks.pyx":953
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)             # <<<<<<<<<<<<<<
  *   differences = len(changes) - cts[candidate_fruit_index]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   __pyx_t_16 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
@@ -74340,113 +75553,113 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_cts};
     __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_16, 1+__pyx_t_16);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 916, __pyx_L1_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_v_candidate_fruit_index = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":917
+  /* "ext/skeletontricks/skeletontricks.pyx":954
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]             # <<<<<<<<<<<<<<
  * 
  *   # it's not an avocado if there's lots of
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_differences = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":921
+  /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":922
+    /* "ext/skeletontricks/skeletontricks.pyx":959
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   return (label, uniq[candidate_fruit_index])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_14);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_14 = 0;
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":921
+    /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":924
+  /* "ext/skeletontricks/skeletontricks.pyx":961
  *     return (label, label)
  * 
  *   return (label, uniq[candidate_fruit_index])             # <<<<<<<<<<<<<<
  * 
  * class CachedTargetFinder:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_uint16_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_14);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_t_14 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
@@ -74474,24 +75687,24 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_changes);
   __Pyx_XDECREF(__pyx_v_uniq);
   __Pyx_XDECREF(__pyx_v_cts);
   __Pyx_XDECREF(__pyx_v_candidate_fruit_index);
   __Pyx_XDECREF(__pyx_v_differences);
-  __Pyx_XDECREF(__pyx_8genexpr6__pyx_v__);
+  __Pyx_XDECREF(__pyx_8genexpr8__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_185find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_6__pyx_mdef_8kimimaro_14skeletontricks_185find_avocado_fruit = {"__pyx_fuse_6find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_185find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_185find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_187find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_6__pyx_mdef_8kimimaro_14skeletontricks_187find_avocado_fruit = {"__pyx_fuse_6find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_187find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_fuse_6__pyx_pw_8kimimaro_14skeletontricks_187find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   size_t __pyx_v_cx;
   size_t __pyx_v_cy;
   size_t __pyx_v_cz;
   uint32_t __pyx_v_background;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -74529,98 +75742,98 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cz)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_background);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
         values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
         values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
+    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_background = __Pyx_PyInt_As_uint32_t(values[4]); if (unlikely((__pyx_v_background == ((uint32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L3_error)
+      __pyx_v_background = __Pyx_PyInt_As_uint32_t(values[4]); if (unlikely((__pyx_v_background == ((uint32_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
     } else {
       __pyx_v_background = ((uint32_t)((uint32_t)((uint32_t)0)));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_avocado_fruit", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 837, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_184find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 874, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_186find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -74629,30 +75842,30 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_184find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint32_t __pyx_v_background) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_186find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint32_t __pyx_v_background) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   CYTHON_UNUSED size_t __pyx_v_voxels;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   uint32_t __pyx_v_label;
   PyObject *__pyx_v_changes = 0;
   long __pyx_v_allowed_differences;
   PyObject *__pyx_v_uniq = NULL;
   PyObject *__pyx_v_cts = NULL;
   PyObject *__pyx_v_candidate_fruit_index = NULL;
   PyObject *__pyx_v_differences = NULL;
-  PyObject *__pyx_8genexpr7__pyx_v__ = NULL;
+  PyObject *__pyx_8genexpr9__pyx_v__ = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
   npy_intp __pyx_t_2;
   npy_intp __pyx_t_3;
@@ -74683,43 +75896,43 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_6find_avocado_fruit", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint32_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":849
+  /* "ext/skeletontricks/skeletontricks.pyx":886
  *   """
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]             # <<<<<<<<<<<<<<
  *   cdef size_t voxels = sx * sy * sz
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 886, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1[0]);
   __pyx_t_3 = (__pyx_t_1[1]);
   __pyx_t_4 = (__pyx_t_1[2]);
   __pyx_v_sx = __pyx_t_2;
   __pyx_v_sy = __pyx_t_3;
   __pyx_v_sz = __pyx_t_4;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":850
+  /* "ext/skeletontricks/skeletontricks.pyx":887
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]
  *   cdef size_t voxels = sx * sy * sz             # <<<<<<<<<<<<<<
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  */
   __pyx_v_voxels = ((__pyx_v_sx * __pyx_v_sy) * __pyx_v_sz);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":852
+  /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   __pyx_t_6 = (__pyx_v_cx >= __pyx_v_sx);
@@ -74735,42 +75948,42 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_cz >= __pyx_v_sz);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":854
+    /* "ext/skeletontricks/skeletontricks.pyx":891
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(             # <<<<<<<<<<<<<<
  *         cx,cy,cz,sx,sy,sz
  *     ))
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 891, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":855
+    /* "ext/skeletontricks/skeletontricks.pyx":892
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz             # <<<<<<<<<<<<<<
  *     ))
  * 
  */
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __pyx_t_15 = NULL;
     __pyx_t_16 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_15)) {
@@ -74788,43 +76001,43 @@
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 891, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":853
+    /* "ext/skeletontricks/skeletontricks.pyx":890
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(             # <<<<<<<<<<<<<<
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz
  */
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 890, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_8, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 853, __pyx_L1_error)
+    __PYX_ERR(0, 890, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":852
+    /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":859
+  /* "ext/skeletontricks/skeletontricks.pyx":896
  * 
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]             # <<<<<<<<<<<<<<
  *   cdef list changes = [ None ] * 6
  * 
  */
   __pyx_t_17 = __pyx_v_cx;
@@ -74832,50 +76045,50 @@
   __pyx_t_19 = __pyx_v_cz;
   __pyx_t_16 = -1;
   if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
   if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
   if (unlikely(__pyx_t_19 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
   if (unlikely(__pyx_t_16 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_16);
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
   __pyx_v_label = (*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":860
+  /* "ext/skeletontricks/skeletontricks.pyx":897
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]
  *   cdef list changes = [ None ] * 6             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, sx):
  */
-  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 6; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 860, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 897, __pyx_L1_error);
     }
   }
   __pyx_v_changes = ((PyObject*)__pyx_t_8);
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":862
+  /* "ext/skeletontricks/skeletontricks.pyx":899
  *   cdef list changes = [ None ] * 6
  * 
  *   for x in range(cx, sx):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sx;
   __pyx_t_18 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cx; __pyx_t_17 < __pyx_t_18; __pyx_t_17+=1) {
     __pyx_v_x = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":863
+    /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_20 = __pyx_v_x;
@@ -74883,38 +76096,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 863, __pyx_L1_error)
+      __PYX_ERR(0, 900, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":864
+      /* "ext/skeletontricks/skeletontricks.pyx":901
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":863
+      /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":865
+    /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -74922,20 +76135,20 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 865, __pyx_L1_error)
+      __PYX_ERR(0, 902, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":866
+      /* "ext/skeletontricks/skeletontricks.pyx":903
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_x;
@@ -74943,52 +76156,52 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 903, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 866, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":867
+      /* "ext/skeletontricks/skeletontricks.pyx":904
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, 0, -1):
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":865
+      /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L8_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":869
+  /* "ext/skeletontricks/skeletontricks.pyx":906
  *       break
  * 
  *   for x in range(cx, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cx + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_x = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":870
+    /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_18 = __pyx_v_x;
@@ -74996,38 +76209,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 870, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":871
+      /* "ext/skeletontricks/skeletontricks.pyx":908
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":870
+      /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":872
+    /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -75035,20 +76248,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 872, __pyx_L1_error)
+      __PYX_ERR(0, 909, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":873
+      /* "ext/skeletontricks/skeletontricks.pyx":910
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_x;
@@ -75056,54 +76269,54 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 873, __pyx_L1_error)
+        __PYX_ERR(0, 910, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 873, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":874
+      /* "ext/skeletontricks/skeletontricks.pyx":911
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, sy):
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":872
+      /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L11_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":876
+  /* "ext/skeletontricks/skeletontricks.pyx":913
  *       break
  * 
  *   for y in range(cy, sy):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sy;
   __pyx_t_22 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cy; __pyx_t_17 < __pyx_t_22; __pyx_t_17+=1) {
     __pyx_v_y = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":877
+    /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -75111,38 +76324,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 877, __pyx_L1_error)
+      __PYX_ERR(0, 914, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":878
+      /* "ext/skeletontricks/skeletontricks.pyx":915
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":877
+      /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":879
+    /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -75150,20 +76363,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 879, __pyx_L1_error)
+      __PYX_ERR(0, 916, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":880
+      /* "ext/skeletontricks/skeletontricks.pyx":917
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_cx;
@@ -75171,52 +76384,52 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 880, __pyx_L1_error)
+        __PYX_ERR(0, 917, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 880, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 880, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":881
+      /* "ext/skeletontricks/skeletontricks.pyx":918
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, 0, -1):
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":879
+      /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L14_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":883
+  /* "ext/skeletontricks/skeletontricks.pyx":920
  *       break
  * 
  *   for y in range(cy, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cy + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_y = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":884
+    /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -75224,38 +76437,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 884, __pyx_L1_error)
+      __PYX_ERR(0, 921, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":885
+      /* "ext/skeletontricks/skeletontricks.pyx":922
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":884
+      /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":886
+    /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -75263,20 +76476,20 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 886, __pyx_L1_error)
+      __PYX_ERR(0, 923, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":887
+      /* "ext/skeletontricks/skeletontricks.pyx":924
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -75284,54 +76497,54 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 887, __pyx_L1_error)
+        __PYX_ERR(0, 924, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":888
+      /* "ext/skeletontricks/skeletontricks.pyx":925
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, sz):
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":886
+      /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L18_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":890
+  /* "ext/skeletontricks/skeletontricks.pyx":927
  *       break
  * 
  *   for z in range(cz, sz):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sz;
   __pyx_t_20 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cz; __pyx_t_17 < __pyx_t_20; __pyx_t_17+=1) {
     __pyx_v_z = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":891
+    /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -75339,38 +76552,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 891, __pyx_L1_error)
+      __PYX_ERR(0, 928, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":892
+      /* "ext/skeletontricks/skeletontricks.pyx":929
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":891
+      /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":893
+    /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -75378,20 +76591,20 @@
     __pyx_t_22 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 893, __pyx_L1_error)
+      __PYX_ERR(0, 930, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":894
+      /* "ext/skeletontricks/skeletontricks.pyx":931
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -75399,52 +76612,52 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 931, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 894, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":895
+      /* "ext/skeletontricks/skeletontricks.pyx":932
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, 0, -1):
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":893
+      /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L22_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":897
+  /* "ext/skeletontricks/skeletontricks.pyx":934
  *       break
  * 
  *   for z in range(cz, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cz + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_z = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":898
+    /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -75452,38 +76665,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 898, __pyx_L1_error)
+      __PYX_ERR(0, 935, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":899
+      /* "ext/skeletontricks/skeletontricks.pyx":936
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":898
+      /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":900
+    /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -75491,20 +76704,20 @@
     __pyx_t_20 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 937, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":901
+      /* "ext/skeletontricks/skeletontricks.pyx":938
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_cx;
@@ -75512,257 +76725,257 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 901, __pyx_L1_error)
+        __PYX_ERR(0, 938, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint32_t((*__Pyx_BufPtrStrided3d(uint32_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 901, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":902
+      /* "ext/skeletontricks/skeletontricks.pyx":939
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   changes = [ _ for _ in changes if _ is not None ]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":900
+      /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L26_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":904
+  /* "ext/skeletontricks/skeletontricks.pyx":941
  *       break
  * 
  *   changes = [ _ for _ in changes if _ is not None ]             # <<<<<<<<<<<<<<
  * 
  *   # Too little info to make a decision
  */
   { /* enter inner scope */
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L31_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 941, __pyx_L31_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = __pyx_v_changes; __Pyx_INCREF(__pyx_t_7);
     __pyx_t_23 = 0;
     for (;;) {
       {
         Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_7);
         #if !CYTHON_ASSUME_SAFE_MACROS
-        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
         #endif
         if (__pyx_t_23 >= __pyx_temp) break;
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
       #else
-      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 941, __pyx_L31_error)
       __Pyx_GOTREF(__pyx_t_14);
       #endif
-      __Pyx_XDECREF_SET(__pyx_8genexpr7__pyx_v__, __pyx_t_14);
+      __Pyx_XDECREF_SET(__pyx_8genexpr9__pyx_v__, __pyx_t_14);
       __pyx_t_14 = 0;
-      __pyx_t_5 = (__pyx_8genexpr7__pyx_v__ != Py_None);
+      __pyx_t_5 = (__pyx_8genexpr9__pyx_v__ != Py_None);
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr7__pyx_v__))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr9__pyx_v__))) __PYX_ERR(0, 941, __pyx_L31_error)
       }
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_XDECREF(__pyx_8genexpr7__pyx_v__); __pyx_8genexpr7__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr9__pyx_v__); __pyx_8genexpr9__pyx_v__ = 0;
     goto __pyx_L36_exit_scope;
     __pyx_L31_error:;
-    __Pyx_XDECREF(__pyx_8genexpr7__pyx_v__); __pyx_8genexpr7__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_8genexpr9__pyx_v__); __pyx_8genexpr9__pyx_v__ = 0;
     goto __pyx_L1_error;
     __pyx_L36_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_changes, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":907
+  /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 944, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 < 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":908
+    /* "ext/skeletontricks/skeletontricks.pyx":945
  *   # Too little info to make a decision
  *   if len(changes) < 3:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_7);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
     __pyx_r = __pyx_t_14;
     __pyx_t_14 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":907
+    /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":910
+  /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 > 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":911
+    /* "ext/skeletontricks/skeletontricks.pyx":948
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  *     allowed_differences = 1             # <<<<<<<<<<<<<<
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0
  */
     __pyx_v_allowed_differences = 1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":910
+    /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
     goto __pyx_L38;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":913
+  /* "ext/skeletontricks/skeletontricks.pyx":950
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0             # <<<<<<<<<<<<<<
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  */
   /*else*/ {
     __pyx_v_allowed_differences = 0;
   }
   __pyx_L38:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":915
+  /* "ext/skeletontricks/skeletontricks.pyx":952
  *     allowed_differences = 0
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)             # <<<<<<<<<<<<<<
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_INCREF(__pyx_v_changes);
   __Pyx_GIVEREF(__pyx_v_changes);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 915, __pyx_L1_error);
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 952, __pyx_L1_error);
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_13))) || (PyList_CheckExact(__pyx_t_13))) {
     PyObject* sequence = __pyx_t_13;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 915, __pyx_L1_error)
+      __PYX_ERR(0, 952, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_8 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_8 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_t_14);
     #else
-    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     #endif
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_24 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
     index = 0; __pyx_t_8 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_8)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_8);
     index = 1; __pyx_t_14 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_14)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_14);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_t_24 = NULL;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L40_unpacking_done;
     __pyx_L39_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_24 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_L40_unpacking_done:;
   }
   __pyx_v_uniq = __pyx_t_8;
   __pyx_t_8 = 0;
   __pyx_v_cts = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":916
+  /* "ext/skeletontricks/skeletontricks.pyx":953
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)             # <<<<<<<<<<<<<<
  *   differences = len(changes) - cts[candidate_fruit_index]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   __pyx_t_16 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
@@ -75775,113 +76988,113 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_cts};
     __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_16, 1+__pyx_t_16);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 916, __pyx_L1_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_v_candidate_fruit_index = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":917
+  /* "ext/skeletontricks/skeletontricks.pyx":954
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]             # <<<<<<<<<<<<<<
  * 
  *   # it's not an avocado if there's lots of
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_differences = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":921
+  /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":922
+    /* "ext/skeletontricks/skeletontricks.pyx":959
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   return (label, uniq[candidate_fruit_index])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_14);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_14 = 0;
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":921
+    /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":924
+  /* "ext/skeletontricks/skeletontricks.pyx":961
  *     return (label, label)
  * 
  *   return (label, uniq[candidate_fruit_index])             # <<<<<<<<<<<<<<
  * 
  * class CachedTargetFinder:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_uint32_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_14);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_t_14 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
@@ -75909,24 +77122,24 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_changes);
   __Pyx_XDECREF(__pyx_v_uniq);
   __Pyx_XDECREF(__pyx_v_cts);
   __Pyx_XDECREF(__pyx_v_candidate_fruit_index);
   __Pyx_XDECREF(__pyx_v_differences);
-  __Pyx_XDECREF(__pyx_8genexpr7__pyx_v__);
+  __Pyx_XDECREF(__pyx_8genexpr9__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_187find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_7__pyx_mdef_8kimimaro_14skeletontricks_187find_avocado_fruit = {"__pyx_fuse_7find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_187find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_187find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_189find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_7__pyx_mdef_8kimimaro_14skeletontricks_189find_avocado_fruit = {"__pyx_fuse_7find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_189find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_fuse_7__pyx_pw_8kimimaro_14skeletontricks_189find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   size_t __pyx_v_cx;
   size_t __pyx_v_cy;
   size_t __pyx_v_cz;
   uint64_t __pyx_v_background;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -75964,98 +77177,98 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cz)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_background);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
         values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
         values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
+    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_background = __Pyx_PyInt_As_uint64_t(values[4]); if (unlikely((__pyx_v_background == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L3_error)
+      __pyx_v_background = __Pyx_PyInt_As_uint64_t(values[4]); if (unlikely((__pyx_v_background == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
     } else {
       __pyx_v_background = ((uint64_t)((uint64_t)((uint64_t)0)));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_avocado_fruit", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 837, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_186find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 874, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_188find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -76064,30 +77277,30 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_186find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint64_t __pyx_v_background) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_188find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, uint64_t __pyx_v_background) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   CYTHON_UNUSED size_t __pyx_v_voxels;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   uint64_t __pyx_v_label;
   PyObject *__pyx_v_changes = 0;
   long __pyx_v_allowed_differences;
   PyObject *__pyx_v_uniq = NULL;
   PyObject *__pyx_v_cts = NULL;
   PyObject *__pyx_v_candidate_fruit_index = NULL;
   PyObject *__pyx_v_differences = NULL;
-  PyObject *__pyx_8genexpr8__pyx_v__ = NULL;
+  PyObject *__pyx_9genexpr10__pyx_v__ = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
   npy_intp __pyx_t_2;
   npy_intp __pyx_t_3;
@@ -76118,43 +77331,43 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_7find_avocado_fruit", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_nn_uint64_t, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":849
+  /* "ext/skeletontricks/skeletontricks.pyx":886
  *   """
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]             # <<<<<<<<<<<<<<
  *   cdef size_t voxels = sx * sy * sz
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 886, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1[0]);
   __pyx_t_3 = (__pyx_t_1[1]);
   __pyx_t_4 = (__pyx_t_1[2]);
   __pyx_v_sx = __pyx_t_2;
   __pyx_v_sy = __pyx_t_3;
   __pyx_v_sz = __pyx_t_4;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":850
+  /* "ext/skeletontricks/skeletontricks.pyx":887
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]
  *   cdef size_t voxels = sx * sy * sz             # <<<<<<<<<<<<<<
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  */
   __pyx_v_voxels = ((__pyx_v_sx * __pyx_v_sy) * __pyx_v_sz);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":852
+  /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   __pyx_t_6 = (__pyx_v_cx >= __pyx_v_sx);
@@ -76170,42 +77383,42 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_cz >= __pyx_v_sz);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":854
+    /* "ext/skeletontricks/skeletontricks.pyx":891
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(             # <<<<<<<<<<<<<<
  *         cx,cy,cz,sx,sy,sz
  *     ))
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 891, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":855
+    /* "ext/skeletontricks/skeletontricks.pyx":892
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz             # <<<<<<<<<<<<<<
  *     ))
  * 
  */
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __pyx_t_15 = NULL;
     __pyx_t_16 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_15)) {
@@ -76223,43 +77436,43 @@
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 891, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":853
+    /* "ext/skeletontricks/skeletontricks.pyx":890
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(             # <<<<<<<<<<<<<<
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz
  */
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 890, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_8, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 853, __pyx_L1_error)
+    __PYX_ERR(0, 890, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":852
+    /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":859
+  /* "ext/skeletontricks/skeletontricks.pyx":896
  * 
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]             # <<<<<<<<<<<<<<
  *   cdef list changes = [ None ] * 6
  * 
  */
   __pyx_t_17 = __pyx_v_cx;
@@ -76267,50 +77480,50 @@
   __pyx_t_19 = __pyx_v_cz;
   __pyx_t_16 = -1;
   if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
   if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
   if (unlikely(__pyx_t_19 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
   if (unlikely(__pyx_t_16 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_16);
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
   __pyx_v_label = (*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":860
+  /* "ext/skeletontricks/skeletontricks.pyx":897
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]
  *   cdef list changes = [ None ] * 6             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, sx):
  */
-  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 6; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 860, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 897, __pyx_L1_error);
     }
   }
   __pyx_v_changes = ((PyObject*)__pyx_t_8);
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":862
+  /* "ext/skeletontricks/skeletontricks.pyx":899
  *   cdef list changes = [ None ] * 6
  * 
  *   for x in range(cx, sx):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sx;
   __pyx_t_18 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cx; __pyx_t_17 < __pyx_t_18; __pyx_t_17+=1) {
     __pyx_v_x = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":863
+    /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_20 = __pyx_v_x;
@@ -76318,38 +77531,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 863, __pyx_L1_error)
+      __PYX_ERR(0, 900, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":864
+      /* "ext/skeletontricks/skeletontricks.pyx":901
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":863
+      /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":865
+    /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -76357,20 +77570,20 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 865, __pyx_L1_error)
+      __PYX_ERR(0, 902, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":866
+      /* "ext/skeletontricks/skeletontricks.pyx":903
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_x;
@@ -76378,52 +77591,52 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 903, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 866, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":867
+      /* "ext/skeletontricks/skeletontricks.pyx":904
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, 0, -1):
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":865
+      /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L8_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":869
+  /* "ext/skeletontricks/skeletontricks.pyx":906
  *       break
  * 
  *   for x in range(cx, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cx + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_x = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":870
+    /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_18 = __pyx_v_x;
@@ -76431,38 +77644,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 870, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":871
+      /* "ext/skeletontricks/skeletontricks.pyx":908
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":870
+      /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":872
+    /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -76470,20 +77683,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 872, __pyx_L1_error)
+      __PYX_ERR(0, 909, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":873
+      /* "ext/skeletontricks/skeletontricks.pyx":910
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_x;
@@ -76491,54 +77704,54 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 873, __pyx_L1_error)
+        __PYX_ERR(0, 910, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 873, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":874
+      /* "ext/skeletontricks/skeletontricks.pyx":911
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, sy):
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":872
+      /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L11_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":876
+  /* "ext/skeletontricks/skeletontricks.pyx":913
  *       break
  * 
  *   for y in range(cy, sy):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sy;
   __pyx_t_22 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cy; __pyx_t_17 < __pyx_t_22; __pyx_t_17+=1) {
     __pyx_v_y = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":877
+    /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -76546,38 +77759,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 877, __pyx_L1_error)
+      __PYX_ERR(0, 914, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":878
+      /* "ext/skeletontricks/skeletontricks.pyx":915
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":877
+      /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":879
+    /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -76585,20 +77798,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 879, __pyx_L1_error)
+      __PYX_ERR(0, 916, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":880
+      /* "ext/skeletontricks/skeletontricks.pyx":917
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_cx;
@@ -76606,52 +77819,52 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 880, __pyx_L1_error)
+        __PYX_ERR(0, 917, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 880, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 880, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":881
+      /* "ext/skeletontricks/skeletontricks.pyx":918
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, 0, -1):
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":879
+      /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L14_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":883
+  /* "ext/skeletontricks/skeletontricks.pyx":920
  *       break
  * 
  *   for y in range(cy, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cy + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_y = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":884
+    /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -76659,38 +77872,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 884, __pyx_L1_error)
+      __PYX_ERR(0, 921, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":885
+      /* "ext/skeletontricks/skeletontricks.pyx":922
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":884
+      /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":886
+    /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -76698,20 +77911,20 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 886, __pyx_L1_error)
+      __PYX_ERR(0, 923, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":887
+      /* "ext/skeletontricks/skeletontricks.pyx":924
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -76719,54 +77932,54 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 887, __pyx_L1_error)
+        __PYX_ERR(0, 924, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":888
+      /* "ext/skeletontricks/skeletontricks.pyx":925
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, sz):
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":886
+      /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L18_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":890
+  /* "ext/skeletontricks/skeletontricks.pyx":927
  *       break
  * 
  *   for z in range(cz, sz):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sz;
   __pyx_t_20 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cz; __pyx_t_17 < __pyx_t_20; __pyx_t_17+=1) {
     __pyx_v_z = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":891
+    /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -76774,38 +77987,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 891, __pyx_L1_error)
+      __PYX_ERR(0, 928, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":892
+      /* "ext/skeletontricks/skeletontricks.pyx":929
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":891
+      /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":893
+    /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -76813,20 +78026,20 @@
     __pyx_t_22 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 893, __pyx_L1_error)
+      __PYX_ERR(0, 930, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":894
+      /* "ext/skeletontricks/skeletontricks.pyx":931
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -76834,52 +78047,52 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 931, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 894, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":895
+      /* "ext/skeletontricks/skeletontricks.pyx":932
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, 0, -1):
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":893
+      /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L22_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":897
+  /* "ext/skeletontricks/skeletontricks.pyx":934
  *       break
  * 
  *   for z in range(cz, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cz + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_z = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":898
+    /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -76887,38 +78100,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 898, __pyx_L1_error)
+      __PYX_ERR(0, 935, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":899
+      /* "ext/skeletontricks/skeletontricks.pyx":936
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":898
+      /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":900
+    /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -76926,20 +78139,20 @@
     __pyx_t_20 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 937, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":901
+      /* "ext/skeletontricks/skeletontricks.pyx":938
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_cx;
@@ -76947,257 +78160,257 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 901, __pyx_L1_error)
+        __PYX_ERR(0, 938, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_uint64_t((*__Pyx_BufPtrStrided3d(uint64_t *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 901, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":902
+      /* "ext/skeletontricks/skeletontricks.pyx":939
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   changes = [ _ for _ in changes if _ is not None ]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":900
+      /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L26_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":904
+  /* "ext/skeletontricks/skeletontricks.pyx":941
  *       break
  * 
  *   changes = [ _ for _ in changes if _ is not None ]             # <<<<<<<<<<<<<<
  * 
  *   # Too little info to make a decision
  */
   { /* enter inner scope */
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L31_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 941, __pyx_L31_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = __pyx_v_changes; __Pyx_INCREF(__pyx_t_7);
     __pyx_t_23 = 0;
     for (;;) {
       {
         Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_7);
         #if !CYTHON_ASSUME_SAFE_MACROS
-        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
         #endif
         if (__pyx_t_23 >= __pyx_temp) break;
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
       #else
-      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 941, __pyx_L31_error)
       __Pyx_GOTREF(__pyx_t_14);
       #endif
-      __Pyx_XDECREF_SET(__pyx_8genexpr8__pyx_v__, __pyx_t_14);
+      __Pyx_XDECREF_SET(__pyx_9genexpr10__pyx_v__, __pyx_t_14);
       __pyx_t_14 = 0;
-      __pyx_t_5 = (__pyx_8genexpr8__pyx_v__ != Py_None);
+      __pyx_t_5 = (__pyx_9genexpr10__pyx_v__ != Py_None);
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr8__pyx_v__))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_9genexpr10__pyx_v__))) __PYX_ERR(0, 941, __pyx_L31_error)
       }
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_XDECREF(__pyx_8genexpr8__pyx_v__); __pyx_8genexpr8__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_9genexpr10__pyx_v__); __pyx_9genexpr10__pyx_v__ = 0;
     goto __pyx_L36_exit_scope;
     __pyx_L31_error:;
-    __Pyx_XDECREF(__pyx_8genexpr8__pyx_v__); __pyx_8genexpr8__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_9genexpr10__pyx_v__); __pyx_9genexpr10__pyx_v__ = 0;
     goto __pyx_L1_error;
     __pyx_L36_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_changes, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":907
+  /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 944, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 < 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":908
+    /* "ext/skeletontricks/skeletontricks.pyx":945
  *   # Too little info to make a decision
  *   if len(changes) < 3:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_7);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
     __pyx_r = __pyx_t_14;
     __pyx_t_14 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":907
+    /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":910
+  /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 > 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":911
+    /* "ext/skeletontricks/skeletontricks.pyx":948
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  *     allowed_differences = 1             # <<<<<<<<<<<<<<
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0
  */
     __pyx_v_allowed_differences = 1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":910
+    /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
     goto __pyx_L38;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":913
+  /* "ext/skeletontricks/skeletontricks.pyx":950
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0             # <<<<<<<<<<<<<<
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  */
   /*else*/ {
     __pyx_v_allowed_differences = 0;
   }
   __pyx_L38:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":915
+  /* "ext/skeletontricks/skeletontricks.pyx":952
  *     allowed_differences = 0
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)             # <<<<<<<<<<<<<<
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_INCREF(__pyx_v_changes);
   __Pyx_GIVEREF(__pyx_v_changes);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 915, __pyx_L1_error);
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 952, __pyx_L1_error);
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_13))) || (PyList_CheckExact(__pyx_t_13))) {
     PyObject* sequence = __pyx_t_13;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 915, __pyx_L1_error)
+      __PYX_ERR(0, 952, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_8 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_8 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_t_14);
     #else
-    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     #endif
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_24 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
     index = 0; __pyx_t_8 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_8)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_8);
     index = 1; __pyx_t_14 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_14)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_14);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_t_24 = NULL;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L40_unpacking_done;
     __pyx_L39_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_24 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_L40_unpacking_done:;
   }
   __pyx_v_uniq = __pyx_t_8;
   __pyx_t_8 = 0;
   __pyx_v_cts = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":916
+  /* "ext/skeletontricks/skeletontricks.pyx":953
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)             # <<<<<<<<<<<<<<
  *   differences = len(changes) - cts[candidate_fruit_index]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   __pyx_t_16 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
@@ -77210,113 +78423,113 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_cts};
     __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_16, 1+__pyx_t_16);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 916, __pyx_L1_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_v_candidate_fruit_index = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":917
+  /* "ext/skeletontricks/skeletontricks.pyx":954
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]             # <<<<<<<<<<<<<<
  * 
  *   # it's not an avocado if there's lots of
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_differences = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":921
+  /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":922
+    /* "ext/skeletontricks/skeletontricks.pyx":959
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   return (label, uniq[candidate_fruit_index])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_14);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_14 = 0;
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":921
+    /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":924
+  /* "ext/skeletontricks/skeletontricks.pyx":961
  *     return (label, label)
  * 
  *   return (label, uniq[candidate_fruit_index])             # <<<<<<<<<<<<<<
  * 
  * class CachedTargetFinder:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_uint64_t(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_14);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_t_14 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
@@ -77344,24 +78557,24 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_changes);
   __Pyx_XDECREF(__pyx_v_uniq);
   __Pyx_XDECREF(__pyx_v_cts);
   __Pyx_XDECREF(__pyx_v_candidate_fruit_index);
   __Pyx_XDECREF(__pyx_v_differences);
-  __Pyx_XDECREF(__pyx_8genexpr8__pyx_v__);
+  __Pyx_XDECREF(__pyx_9genexpr10__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_189find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_fuse_8__pyx_mdef_8kimimaro_14skeletontricks_189find_avocado_fruit = {"__pyx_fuse_8find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_189find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_32find_avocado_fruit};
-static PyObject *__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_189find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_191find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_fuse_8__pyx_mdef_8kimimaro_14skeletontricks_191find_avocado_fruit = {"__pyx_fuse_8find_avocado_fruit", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_191find_avocado_fruit, METH_VARARGS|METH_KEYWORDS, __pyx_doc_8kimimaro_14skeletontricks_34find_avocado_fruit};
+static PyObject *__pyx_fuse_8__pyx_pw_8kimimaro_14skeletontricks_191find_avocado_fruit(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_labels = 0;
   size_t __pyx_v_cx;
   size_t __pyx_v_cy;
   size_t __pyx_v_cz;
   unsigned char __pyx_v_background;
   CYTHON_UNUSED Py_ssize_t __pyx_nargs;
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
@@ -77399,98 +78612,98 @@
       kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cx)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 1); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cy)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 2); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cz)) != 0)) {
           (void)__Pyx_Arg_NewRef_VARARGS(values[3]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 836, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, 3); __PYX_ERR(0, 873, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_background);
           if (value) { values[4] = __Pyx_Arg_NewRef_VARARGS(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 836, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 836, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_avocado_fruit") < 0)) __PYX_ERR(0, 873, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  5: values[4] = __Pyx_Arg_VARARGS(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = __Pyx_Arg_VARARGS(__pyx_args, 3);
         values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
         values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
         values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_labels = ((PyArrayObject *)values[0]);
-    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
-    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 838, __pyx_L3_error)
+    __pyx_v_cx = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_cx == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cy = __Pyx_PyInt_As_size_t(values[2]); if (unlikely((__pyx_v_cy == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
+    __pyx_v_cz = __Pyx_PyInt_As_size_t(values[3]); if (unlikely((__pyx_v_cz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L3_error)
     if (values[4]) {
-      __pyx_v_background = __Pyx_PyInt_As_unsigned_char(values[4]); if (unlikely((__pyx_v_background == (unsigned char)-1) && PyErr_Occurred())) __PYX_ERR(0, 839, __pyx_L3_error)
+      __pyx_v_background = __Pyx_PyInt_As_unsigned_char(values[4]); if (unlikely((__pyx_v_background == (unsigned char)-1) && PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
     } else {
       __pyx_v_background = ((unsigned char)((unsigned char)((unsigned char)0)));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 836, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_avocado_fruit", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 873, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_AddTraceback("kimimaro.skeletontricks.find_avocado_fruit", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 837, __pyx_L1_error)
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_188find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_labels), __pyx_ptype_5numpy_ndarray, 1, "labels", 0))) __PYX_ERR(0, 874, __pyx_L1_error)
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_190find_avocado_fruit(__pyx_self, __pyx_v_labels, __pyx_v_cx, __pyx_v_cy, __pyx_v_cz, __pyx_v_background);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   {
@@ -77499,30 +78712,30 @@
       __Pyx_Arg_XDECREF_VARARGS(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_188find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, unsigned char __pyx_v_background) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_190find_avocado_fruit(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_labels, size_t __pyx_v_cx, size_t __pyx_v_cy, size_t __pyx_v_cz, unsigned char __pyx_v_background) {
   size_t __pyx_v_sx;
   size_t __pyx_v_sy;
   size_t __pyx_v_sz;
   CYTHON_UNUSED size_t __pyx_v_voxels;
   size_t __pyx_v_x;
   size_t __pyx_v_y;
   size_t __pyx_v_z;
   unsigned char __pyx_v_label;
   PyObject *__pyx_v_changes = 0;
   long __pyx_v_allowed_differences;
   PyObject *__pyx_v_uniq = NULL;
   PyObject *__pyx_v_cts = NULL;
   PyObject *__pyx_v_candidate_fruit_index = NULL;
   PyObject *__pyx_v_differences = NULL;
-  PyObject *__pyx_8genexpr9__pyx_v__ = NULL;
+  PyObject *__pyx_9genexpr11__pyx_v__ = NULL;
   __Pyx_LocalBuf_ND __pyx_pybuffernd_labels;
   __Pyx_Buffer __pyx_pybuffer_labels;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   npy_intp *__pyx_t_1;
   npy_intp __pyx_t_2;
   npy_intp __pyx_t_3;
@@ -77553,43 +78766,43 @@
   __Pyx_RefNannySetupContext("__pyx_fuse_8find_avocado_fruit", 1);
   __pyx_pybuffer_labels.pybuffer.buf = NULL;
   __pyx_pybuffer_labels.refcount = 0;
   __pyx_pybuffernd_labels.data = NULL;
   __pyx_pybuffernd_labels.rcbuffer = &__pyx_pybuffer_labels;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 836, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_labels.rcbuffer->pybuffer, (PyObject*)__pyx_v_labels, &__Pyx_TypeInfo_unsigned_char, PyBUF_FORMAT| PyBUF_STRIDES, 3, 0, __pyx_stack) == -1)) __PYX_ERR(0, 873, __pyx_L1_error)
   }
   __pyx_pybuffernd_labels.diminfo[0].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_labels.diminfo[0].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_labels.diminfo[1].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_labels.diminfo[1].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[1]; __pyx_pybuffernd_labels.diminfo[2].strides = __pyx_pybuffernd_labels.rcbuffer->pybuffer.strides[2]; __pyx_pybuffernd_labels.diminfo[2].shape = __pyx_pybuffernd_labels.rcbuffer->pybuffer.shape[2];
 
-  /* "ext/skeletontricks/skeletontricks.pyx":849
+  /* "ext/skeletontricks/skeletontricks.pyx":886
  *   """
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]             # <<<<<<<<<<<<<<
  *   cdef size_t voxels = sx * sy * sz
  * 
  */
-  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_5numpy_7ndarray_5shape_shape(((PyArrayObject *)__pyx_v_labels)); if (unlikely(__pyx_t_1 == ((npy_intp *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 886, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1[0]);
   __pyx_t_3 = (__pyx_t_1[1]);
   __pyx_t_4 = (__pyx_t_1[2]);
   __pyx_v_sx = __pyx_t_2;
   __pyx_v_sy = __pyx_t_3;
   __pyx_v_sz = __pyx_t_4;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":850
+  /* "ext/skeletontricks/skeletontricks.pyx":887
  *   cdef size_t sx, sy, sz
  *   sx, sy, sz = labels.shape[:3]
  *   cdef size_t voxels = sx * sy * sz             # <<<<<<<<<<<<<<
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  */
   __pyx_v_voxels = ((__pyx_v_sx * __pyx_v_sy) * __pyx_v_sz);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":852
+  /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   __pyx_t_6 = (__pyx_v_cx >= __pyx_v_sx);
@@ -77605,42 +78818,42 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = (__pyx_v_cz >= __pyx_v_sz);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":854
+    /* "ext/skeletontricks/skeletontricks.pyx":891
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(             # <<<<<<<<<<<<<<
  *         cx,cy,cz,sx,sy,sz
  *     ))
  */
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_must_be_be_contained_within_sha, __pyx_n_s_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 891, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":855
+    /* "ext/skeletontricks/skeletontricks.pyx":892
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz             # <<<<<<<<<<<<<<
  *     ))
  * 
  */
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_cx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_cy); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_cz); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_sx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_FromSize_t(__pyx_v_sy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 855, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_FromSize_t(__pyx_v_sz); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 892, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __pyx_t_15 = NULL;
     __pyx_t_16 = 0;
     #if CYTHON_UNPACK_METHODS
     if (likely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_15)) {
@@ -77658,43 +78871,43 @@
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 854, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 891, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":853
+    /* "ext/skeletontricks/skeletontricks.pyx":890
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:
  *     raise ValueError(             # <<<<<<<<<<<<<<
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  *         cx,cy,cz,sx,sy,sz
  */
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 853, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 890, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_Raise(__pyx_t_8, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 853, __pyx_L1_error)
+    __PYX_ERR(0, 890, __pyx_L1_error)
 
-    /* "ext/skeletontricks/skeletontricks.pyx":852
+    /* "ext/skeletontricks/skeletontricks.pyx":889
  *   cdef size_t voxels = sx * sy * sz
  * 
  *   if cx >= sx or cy >= sy or cz >= sz:             # <<<<<<<<<<<<<<
  *     raise ValueError(
  *       "<{},{},{}> must be be contained within shape <{},{},{}>".format(
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":859
+  /* "ext/skeletontricks/skeletontricks.pyx":896
  * 
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]             # <<<<<<<<<<<<<<
  *   cdef list changes = [ None ] * 6
  * 
  */
   __pyx_t_17 = __pyx_v_cx;
@@ -77702,50 +78915,50 @@
   __pyx_t_19 = __pyx_v_cz;
   __pyx_t_16 = -1;
   if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
   if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
   if (unlikely(__pyx_t_19 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
   if (unlikely(__pyx_t_16 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_16);
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 896, __pyx_L1_error)
   }
   __pyx_v_label = (*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_19, __pyx_pybuffernd_labels.diminfo[2].strides));
 
-  /* "ext/skeletontricks/skeletontricks.pyx":860
+  /* "ext/skeletontricks/skeletontricks.pyx":897
  *   cdef size_t x, y, z
  *   cdef INTEGER label = labels[cx, cy, cz]
  *   cdef list changes = [ None ] * 6             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, sx):
  */
-  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 860, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1 * 6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   { Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < 6; __pyx_temp++) {
       __Pyx_INCREF(Py_None);
       __Pyx_GIVEREF(Py_None);
-      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 860, __pyx_L1_error);
+      if (__Pyx_PyList_SET_ITEM(__pyx_t_8, __pyx_temp, Py_None)) __PYX_ERR(0, 897, __pyx_L1_error);
     }
   }
   __pyx_v_changes = ((PyObject*)__pyx_t_8);
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":862
+  /* "ext/skeletontricks/skeletontricks.pyx":899
  *   cdef list changes = [ None ] * 6
  * 
  *   for x in range(cx, sx):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sx;
   __pyx_t_18 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cx; __pyx_t_17 < __pyx_t_18; __pyx_t_17+=1) {
     __pyx_v_x = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":863
+    /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_20 = __pyx_v_x;
@@ -77753,38 +78966,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 863, __pyx_L1_error)
+      __PYX_ERR(0, 900, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":864
+      /* "ext/skeletontricks/skeletontricks.pyx":901
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":863
+      /* "ext/skeletontricks/skeletontricks.pyx":900
  * 
  *   for x in range(cx, sx):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":865
+    /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -77792,20 +79005,20 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 865, __pyx_L1_error)
+      __PYX_ERR(0, 902, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":866
+      /* "ext/skeletontricks/skeletontricks.pyx":903
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_x;
@@ -77813,52 +79026,52 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 903, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 866, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 903, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":867
+      /* "ext/skeletontricks/skeletontricks.pyx":904
  *     elif labels[x,cy,cz] != label:
  *       changes[0] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for x in range(cx, 0, -1):
  */
       goto __pyx_L8_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":865
+      /* "ext/skeletontricks/skeletontricks.pyx":902
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[0] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L8_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":869
+  /* "ext/skeletontricks/skeletontricks.pyx":906
  *       break
  * 
  *   for x in range(cx, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[x,cy,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cx + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_x = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":870
+    /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     __pyx_t_18 = __pyx_v_x;
@@ -77866,38 +79079,38 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 870, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":871
+      /* "ext/skeletontricks/skeletontricks.pyx":908
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":870
+      /* "ext/skeletontricks/skeletontricks.pyx":907
  * 
  *   for x in range(cx, 0, -1):
  *     if labels[x,cy,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     elif labels[x,cy,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":872
+    /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     __pyx_t_22 = __pyx_v_x;
@@ -77905,20 +79118,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 872, __pyx_L1_error)
+      __PYX_ERR(0, 909, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":873
+      /* "ext/skeletontricks/skeletontricks.pyx":910
  *       break
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_x;
@@ -77926,54 +79139,54 @@
       __pyx_t_22 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 873, __pyx_L1_error)
+        __PYX_ERR(0, 910, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 873, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 873, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 1, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":874
+      /* "ext/skeletontricks/skeletontricks.pyx":911
  *     elif labels[x,cy,cz] != label:
  *       changes[1] = labels[x,cy,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, sy):
  */
       goto __pyx_L11_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":872
+      /* "ext/skeletontricks/skeletontricks.pyx":909
  *     if labels[x,cy,cz] == background:
  *       break
  *     elif labels[x,cy,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[1] = labels[x,cy,cz]
  *       break
  */
     }
   }
   __pyx_L11_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":876
+  /* "ext/skeletontricks/skeletontricks.pyx":913
  *       break
  * 
  *   for y in range(cy, sy):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sy;
   __pyx_t_22 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cy; __pyx_t_17 < __pyx_t_22; __pyx_t_17+=1) {
     __pyx_v_y = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":877
+    /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -77981,38 +79194,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 877, __pyx_L1_error)
+      __PYX_ERR(0, 914, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":878
+      /* "ext/skeletontricks/skeletontricks.pyx":915
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":877
+      /* "ext/skeletontricks/skeletontricks.pyx":914
  * 
  *   for y in range(cy, sy):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":879
+    /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -78020,20 +79233,20 @@
     __pyx_t_18 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 879, __pyx_L1_error)
+      __PYX_ERR(0, 916, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":880
+      /* "ext/skeletontricks/skeletontricks.pyx":917
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_18 = __pyx_v_cx;
@@ -78041,52 +79254,52 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 880, __pyx_L1_error)
+        __PYX_ERR(0, 917, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 880, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 880, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 2, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 917, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":881
+      /* "ext/skeletontricks/skeletontricks.pyx":918
  *     if labels[cx,y,cz] != label:
  *       changes[2] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for y in range(cy, 0, -1):
  */
       goto __pyx_L14_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":879
+      /* "ext/skeletontricks/skeletontricks.pyx":916
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[2] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L14_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":883
+  /* "ext/skeletontricks/skeletontricks.pyx":920
  *       break
  * 
  *   for y in range(cy, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cy + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_y = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":884
+    /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -78094,38 +79307,38 @@
     __pyx_t_20 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 884, __pyx_L1_error)
+      __PYX_ERR(0, 921, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":885
+      /* "ext/skeletontricks/skeletontricks.pyx":922
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":884
+      /* "ext/skeletontricks/skeletontricks.pyx":921
  * 
  *   for y in range(cy, 0, -1):
  *     if labels[cx,y,cz] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,y,cz] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":886
+    /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -78133,20 +79346,20 @@
     __pyx_t_22 = __pyx_v_cz;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 886, __pyx_L1_error)
+      __PYX_ERR(0, 923, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":887
+      /* "ext/skeletontricks/skeletontricks.pyx":924
  *       break
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -78154,54 +79367,54 @@
       __pyx_t_20 = __pyx_v_cz;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 887, __pyx_L1_error)
+        __PYX_ERR(0, 924, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 887, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 3, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 924, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":888
+      /* "ext/skeletontricks/skeletontricks.pyx":925
  *     if labels[cx,y,cz] != label:
  *       changes[3] = labels[cx,y,cz]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, sz):
  */
       goto __pyx_L18_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":886
+      /* "ext/skeletontricks/skeletontricks.pyx":923
  *     if labels[cx,y,cz] == background:
  *       break
  *     if labels[cx,y,cz] != label:             # <<<<<<<<<<<<<<
  *       changes[3] = labels[cx,y,cz]
  *       break
  */
     }
   }
   __pyx_L18_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":890
+  /* "ext/skeletontricks/skeletontricks.pyx":927
  *       break
  * 
  *   for z in range(cz, sz):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   __pyx_t_19 = __pyx_v_sz;
   __pyx_t_20 = __pyx_t_19;
   for (__pyx_t_17 = __pyx_v_cz; __pyx_t_17 < __pyx_t_20; __pyx_t_17+=1) {
     __pyx_v_z = __pyx_t_17;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":891
+    /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_22 = __pyx_v_cx;
@@ -78209,38 +79422,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 891, __pyx_L1_error)
+      __PYX_ERR(0, 928, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":892
+      /* "ext/skeletontricks/skeletontricks.pyx":929
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":891
+      /* "ext/skeletontricks/skeletontricks.pyx":928
  * 
  *   for z in range(cz, sz):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":893
+    /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -78248,20 +79461,20 @@
     __pyx_t_22 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 893, __pyx_L1_error)
+      __PYX_ERR(0, 930, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":894
+      /* "ext/skeletontricks/skeletontricks.pyx":931
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_22 = __pyx_v_cx;
@@ -78269,52 +79482,52 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_22 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_21 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 931, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_22, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_21, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 894, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 4, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 931, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":895
+      /* "ext/skeletontricks/skeletontricks.pyx":932
  *     if labels[cx,cy,z] != label:
  *       changes[4] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   for z in range(cz, 0, -1):
  */
       goto __pyx_L22_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":893
+      /* "ext/skeletontricks/skeletontricks.pyx":930
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[4] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L22_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":897
+  /* "ext/skeletontricks/skeletontricks.pyx":934
  *       break
  * 
  *   for z in range(cz, 0, -1):             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] == background:
  *       break
  */
   for (__pyx_t_19 = __pyx_v_cz + 1; __pyx_t_19 > 0 + 1; ) { __pyx_t_19-=1;
     __pyx_v_z = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":898
+    /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     __pyx_t_20 = __pyx_v_cx;
@@ -78322,38 +79535,38 @@
     __pyx_t_18 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 898, __pyx_L1_error)
+      __PYX_ERR(0, 935, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides)) == __pyx_v_background);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":899
+      /* "ext/skeletontricks/skeletontricks.pyx":936
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:
  *       break             # <<<<<<<<<<<<<<
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":898
+      /* "ext/skeletontricks/skeletontricks.pyx":935
  * 
  *   for z in range(cz, 0, -1):
  *     if labels[cx,cy,z] == background:             # <<<<<<<<<<<<<<
  *       break
  *     if labels[cx,cy,z] != label:
  */
     }
 
-    /* "ext/skeletontricks/skeletontricks.pyx":900
+    /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     __pyx_t_18 = __pyx_v_cx;
@@ -78361,20 +79574,20 @@
     __pyx_t_20 = __pyx_v_z;
     __pyx_t_16 = -1;
     if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 937, __pyx_L1_error)
     }
     __pyx_t_5 = ((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[2].strides)) != __pyx_v_label);
     if (__pyx_t_5) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":901
+      /* "ext/skeletontricks/skeletontricks.pyx":938
  *       break
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]             # <<<<<<<<<<<<<<
  *       break
  * 
  */
       __pyx_t_20 = __pyx_v_cx;
@@ -78382,257 +79595,257 @@
       __pyx_t_18 = __pyx_v_z;
       __pyx_t_16 = -1;
       if (unlikely(__pyx_t_20 >= (size_t)__pyx_pybuffernd_labels.diminfo[0].shape)) __pyx_t_16 = 0;
       if (unlikely(__pyx_t_17 >= (size_t)__pyx_pybuffernd_labels.diminfo[1].shape)) __pyx_t_16 = 1;
       if (unlikely(__pyx_t_18 >= (size_t)__pyx_pybuffernd_labels.diminfo[2].shape)) __pyx_t_16 = 2;
       if (unlikely(__pyx_t_16 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        __PYX_ERR(0, 901, __pyx_L1_error)
+        __PYX_ERR(0, 938, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_unsigned_char((*__Pyx_BufPtrStrided3d(unsigned char *, __pyx_pybuffernd_labels.rcbuffer->pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_labels.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_labels.diminfo[1].strides, __pyx_t_18, __pyx_pybuffernd_labels.diminfo[2].strides))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 901, __pyx_L1_error)
+      if (unlikely((__Pyx_SetItemInt(__pyx_v_changes, 5, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":902
+      /* "ext/skeletontricks/skeletontricks.pyx":939
  *     if labels[cx,cy,z] != label:
  *       changes[5] = labels[cx,cy,z]
  *       break             # <<<<<<<<<<<<<<
  * 
  *   changes = [ _ for _ in changes if _ is not None ]
  */
       goto __pyx_L26_break;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":900
+      /* "ext/skeletontricks/skeletontricks.pyx":937
  *     if labels[cx,cy,z] == background:
  *       break
  *     if labels[cx,cy,z] != label:             # <<<<<<<<<<<<<<
  *       changes[5] = labels[cx,cy,z]
  *       break
  */
     }
   }
   __pyx_L26_break:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":904
+  /* "ext/skeletontricks/skeletontricks.pyx":941
  *       break
  * 
  *   changes = [ _ for _ in changes if _ is not None ]             # <<<<<<<<<<<<<<
  * 
  *   # Too little info to make a decision
  */
   { /* enter inner scope */
-    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L31_error)
+    __pyx_t_8 = PyList_New(0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 941, __pyx_L31_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_7 = __pyx_v_changes; __Pyx_INCREF(__pyx_t_7);
     __pyx_t_23 = 0;
     for (;;) {
       {
         Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_7);
         #if !CYTHON_ASSUME_SAFE_MACROS
-        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
         #endif
         if (__pyx_t_23 >= __pyx_temp) break;
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_23); __Pyx_INCREF(__pyx_t_14); __pyx_t_23++; if (unlikely((0 < 0))) __PYX_ERR(0, 941, __pyx_L31_error)
       #else
-      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 904, __pyx_L31_error)
+      __pyx_t_14 = __Pyx_PySequence_ITEM(__pyx_t_7, __pyx_t_23); __pyx_t_23++; if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 941, __pyx_L31_error)
       __Pyx_GOTREF(__pyx_t_14);
       #endif
-      __Pyx_XDECREF_SET(__pyx_8genexpr9__pyx_v__, __pyx_t_14);
+      __Pyx_XDECREF_SET(__pyx_9genexpr11__pyx_v__, __pyx_t_14);
       __pyx_t_14 = 0;
-      __pyx_t_5 = (__pyx_8genexpr9__pyx_v__ != Py_None);
+      __pyx_t_5 = (__pyx_9genexpr11__pyx_v__ != Py_None);
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_8genexpr9__pyx_v__))) __PYX_ERR(0, 904, __pyx_L31_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_8, (PyObject*)__pyx_9genexpr11__pyx_v__))) __PYX_ERR(0, 941, __pyx_L31_error)
       }
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_XDECREF(__pyx_8genexpr9__pyx_v__); __pyx_8genexpr9__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_9genexpr11__pyx_v__); __pyx_9genexpr11__pyx_v__ = 0;
     goto __pyx_L36_exit_scope;
     __pyx_L31_error:;
-    __Pyx_XDECREF(__pyx_8genexpr9__pyx_v__); __pyx_8genexpr9__pyx_v__ = 0;
+    __Pyx_XDECREF(__pyx_9genexpr11__pyx_v__); __pyx_9genexpr11__pyx_v__ = 0;
     goto __pyx_L1_error;
     __pyx_L36_exit_scope:;
   } /* exit inner scope */
   __Pyx_DECREF_SET(__pyx_v_changes, ((PyObject*)__pyx_t_8));
   __pyx_t_8 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":907
+  /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 944, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 < 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":908
+    /* "ext/skeletontricks/skeletontricks.pyx":945
  *   # Too little info to make a decision
  *   if len(changes) < 3:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 908, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_8)) __PYX_ERR(0, 945, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_7);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 908, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_7)) __PYX_ERR(0, 945, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
     __pyx_r = __pyx_t_14;
     __pyx_t_14 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":907
+    /* "ext/skeletontricks/skeletontricks.pyx":944
  * 
  *   # Too little info to make a decision
  *   if len(changes) < 3:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":910
+  /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 947, __pyx_L1_error)
   __pyx_t_5 = (__pyx_t_23 > 3);
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":911
+    /* "ext/skeletontricks/skeletontricks.pyx":948
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match
  *     allowed_differences = 1             # <<<<<<<<<<<<<<
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0
  */
     __pyx_v_allowed_differences = 1;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":910
+    /* "ext/skeletontricks/skeletontricks.pyx":947
  *     return (label, label)
  * 
  *   if len(changes) > 3: # if more than 3, allow one non-match             # <<<<<<<<<<<<<<
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  */
     goto __pyx_L38;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":913
+  /* "ext/skeletontricks/skeletontricks.pyx":950
  *     allowed_differences = 1
  *   else: # allow no non-matches (we're in a corner)
  *     allowed_differences = 0             # <<<<<<<<<<<<<<
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  */
   /*else*/ {
     __pyx_v_allowed_differences = 0;
   }
   __pyx_L38:;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":915
+  /* "ext/skeletontricks/skeletontricks.pyx":952
  *     allowed_differences = 0
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)             # <<<<<<<<<<<<<<
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_INCREF(__pyx_v_changes);
   __Pyx_GIVEREF(__pyx_v_changes);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 915, __pyx_L1_error);
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_changes)) __PYX_ERR(0, 952, __pyx_L1_error);
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_14, __pyx_t_8); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_13))) || (PyList_CheckExact(__pyx_t_13))) {
     PyObject* sequence = __pyx_t_13;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 915, __pyx_L1_error)
+      __PYX_ERR(0, 952, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_8 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_8 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_14 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_8);
     __Pyx_INCREF(__pyx_t_14);
     #else
-    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_8 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_14 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     #endif
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 915, __pyx_L1_error)
+    __pyx_t_7 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __pyx_t_24 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
     index = 0; __pyx_t_8 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_8)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_8);
     index = 1; __pyx_t_14 = __pyx_t_24(__pyx_t_7); if (unlikely(!__pyx_t_14)) goto __pyx_L39_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_14);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_24(__pyx_t_7), 2) < 0) __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_t_24 = NULL;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     goto __pyx_L40_unpacking_done;
     __pyx_L39_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_24 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
     __pyx_L40_unpacking_done:;
   }
   __pyx_v_uniq = __pyx_t_8;
   __pyx_t_8 = 0;
   __pyx_v_cts = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":916
+  /* "ext/skeletontricks/skeletontricks.pyx":953
  * 
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)             # <<<<<<<<<<<<<<
  *   differences = len(changes) - cts[candidate_fruit_index]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 916, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmax); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 953, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   __pyx_t_16 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_8))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
@@ -78645,113 +79858,113 @@
     }
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_cts};
     __pyx_t_13 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_16, 1+__pyx_t_16);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 916, __pyx_L1_error)
+    if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 953, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __pyx_v_candidate_fruit_index = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":917
+  /* "ext/skeletontricks/skeletontricks.pyx":954
  *   uniq, cts = np.unique(changes, return_counts=True)
  *   candidate_fruit_index = np.argmax(cts)
  *   differences = len(changes) - cts[candidate_fruit_index]             # <<<<<<<<<<<<<<
  * 
  *   # it's not an avocado if there's lots of
  */
-  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyList_GET_SIZE(__pyx_v_changes); if (unlikely(__pyx_t_23 == ((Py_ssize_t)-1))) __PYX_ERR(0, 954, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_23); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cts, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_t_13, __pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 954, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_differences = __pyx_t_14;
   __pyx_t_14 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":921
+  /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
-  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_From_long(__pyx_v_allowed_differences); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_8 = PyObject_RichCompare(__pyx_v_differences, __pyx_t_14, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 921, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 958, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_5) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":922
+    /* "ext/skeletontricks/skeletontricks.pyx":959
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:
  *     return (label, label)             # <<<<<<<<<<<<<<
  * 
  *   return (label, uniq[candidate_fruit_index])
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_14 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 922, __pyx_L1_error)
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 959, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_GIVEREF(__pyx_t_8);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_8)) __PYX_ERR(0, 959, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_14);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 922, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14)) __PYX_ERR(0, 959, __pyx_L1_error);
     __pyx_t_8 = 0;
     __pyx_t_14 = 0;
     __pyx_r = __pyx_t_13;
     __pyx_t_13 = 0;
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":921
+    /* "ext/skeletontricks/skeletontricks.pyx":958
  *   # it's not an avocado if there's lots of
  *   # labels surrounding the candidate "pit"
  *   if differences > allowed_differences:             # <<<<<<<<<<<<<<
  *     return (label, label)
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":924
+  /* "ext/skeletontricks/skeletontricks.pyx":961
  *     return (label, label)
  * 
  *   return (label, uniq[candidate_fruit_index])             # <<<<<<<<<<<<<<
  * 
  * class CachedTargetFinder:
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_13 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_unsigned_char(__pyx_v_label); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetItem(__pyx_v_uniq, __pyx_v_candidate_fruit_index); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_13);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_13)) __PYX_ERR(0, 961, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_14);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 924, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_14)) __PYX_ERR(0, 961, __pyx_L1_error);
   __pyx_t_13 = 0;
   __pyx_t_14 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
 
@@ -78779,21 +79992,21 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_labels.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XDECREF(__pyx_v_changes);
   __Pyx_XDECREF(__pyx_v_uniq);
   __Pyx_XDECREF(__pyx_v_cts);
   __Pyx_XDECREF(__pyx_v_candidate_fruit_index);
   __Pyx_XDECREF(__pyx_v_differences);
-  __Pyx_XDECREF(__pyx_8genexpr9__pyx_v__);
+  __Pyx_XDECREF(__pyx_9genexpr11__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":927
+/* "ext/skeletontricks/skeletontricks.pyx":964
  * 
  * class CachedTargetFinder:
  *   def __init__(self, mask: np.ndarray, daf: np.ndarray):             # <<<<<<<<<<<<<<
  *     """
  *     From DAF, compute a sorted list of the maximum values
  */
 
@@ -78853,55 +80066,55 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_self)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 927, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 964, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_mask)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 927, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 964, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(0, 927, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(0, 964, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_daf)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 927, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 964, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(0, 927, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(0, 964, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__init__") < 0)) __PYX_ERR(0, 927, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__init__") < 0)) __PYX_ERR(0, 964, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 3)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
       values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
     }
     __pyx_v_self = values[0];
     __pyx_v_mask = values[1];
     __pyx_v_daf = values[2];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 927, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 964, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
@@ -78936,32 +80149,32 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 1);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":932
+  /* "ext/skeletontricks/skeletontricks.pyx":969
  *     so that finding them becomes very fast.
  *     """
  *     mask_indices = np.flatnonzero(mask.ravel(order='F'))             # <<<<<<<<<<<<<<
  *     daf_sort = np.argsort(-daf.ravel(order='F')[mask_indices])
  *     self.daf_indices = mask_indices[daf_sort]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 969, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flatnonzero); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_flatnonzero); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 969, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 969, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 969, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 932, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 932, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 969, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 969, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   __pyx_t_6 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
@@ -78976,46 +80189,46 @@
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_5};
     __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 932, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 969, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __pyx_v_mask_indices = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":933
+  /* "ext/skeletontricks/skeletontricks.pyx":970
  *     """
  *     mask_indices = np.flatnonzero(mask.ravel(order='F'))
  *     daf_sort = np.argsort(-daf.ravel(order='F')[mask_indices])             # <<<<<<<<<<<<<<
  *     self.daf_indices = mask_indices[daf_sort]
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 933, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_argsort); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 933, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_argsort); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_daf, __pyx_n_s_ravel); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 933, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_daf, __pyx_n_s_ravel); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 933, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 933, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 933, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 970, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_mask_indices); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 933, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_mask_indices); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyNumber_Negative(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 933, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Negative(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   __pyx_t_6 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
@@ -79029,34 +80242,34 @@
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
     __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 933, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 970, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __pyx_v_daf_sort = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":934
+  /* "ext/skeletontricks/skeletontricks.pyx":971
  *     mask_indices = np.flatnonzero(mask.ravel(order='F'))
  *     daf_sort = np.argsort(-daf.ravel(order='F')[mask_indices])
  *     self.daf_indices = mask_indices[daf_sort]             # <<<<<<<<<<<<<<
  * 
  *   def find_target(self, mask: np.ndarray):
  */
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_mask_indices, __pyx_v_daf_sort); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 934, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_mask_indices, __pyx_v_daf_sort); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 971, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices, __pyx_t_1) < 0) __PYX_ERR(0, 934, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices, __pyx_t_1) < 0) __PYX_ERR(0, 971, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":927
+  /* "ext/skeletontricks/skeletontricks.pyx":964
  * 
  * class CachedTargetFinder:
  *   def __init__(self, mask: np.ndarray, daf: np.ndarray):             # <<<<<<<<<<<<<<
  *     """
  *     From DAF, compute a sorted list of the maximum values
  */
 
@@ -79075,15 +80288,15 @@
   __Pyx_XDECREF(__pyx_v_mask_indices);
   __Pyx_XDECREF(__pyx_v_daf_sort);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":936
+/* "ext/skeletontricks/skeletontricks.pyx":973
  *     self.daf_indices = mask_indices[daf_sort]
  * 
  *   def find_target(self, mask: np.ndarray):             # <<<<<<<<<<<<<<
  *     """
  *     Find the coordinate of a voxel corresponding
  */
 
@@ -79140,43 +80353,43 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_self)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 936, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 973, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_mask)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 936, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 973, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("find_target", 1, 2, 2, 1); __PYX_ERR(0, 936, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_target", 1, 2, 2, 1); __PYX_ERR(0, 973, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_target") < 0)) __PYX_ERR(0, 936, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_target") < 0)) __PYX_ERR(0, 973, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
     __pyx_v_mask = values[1];
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_target", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 936, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_target", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 973, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
@@ -79211,41 +80424,41 @@
   int __pyx_t_6;
   int __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("find_target", 1);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":943
+  /* "ext/skeletontricks/skeletontricks.pyx":980
  *     Returns: (x, y, z)
  *     """
  *     first_positive_index = self.first_label_indexed(             # <<<<<<<<<<<<<<
  *       mask.ravel(order='F'), self.daf_indices
  *     )
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_first_label_indexed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 943, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_first_label_indexed); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 980, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":944
+  /* "ext/skeletontricks/skeletontricks.pyx":981
  *     """
  *     first_positive_index = self.first_label_indexed(
  *       mask.ravel(order='F'), self.daf_indices             # <<<<<<<<<<<<<<
  *     )
  *     if first_positive_index is None:
  */
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_ravel); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 944, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_ravel); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 981, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 944, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 981, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 944, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 944, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 981, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 981, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 944, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 981, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = NULL;
   __pyx_t_6 = 0;
   #if CYTHON_UNPACK_METHODS
   if (likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
@@ -79259,128 +80472,128 @@
   #endif
   {
     PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_t_5, __pyx_t_4};
     __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 943, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 980, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
   __pyx_v_first_positive_index = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":946
+  /* "ext/skeletontricks/skeletontricks.pyx":983
  *       mask.ravel(order='F'), self.daf_indices
  *     )
  *     if first_positive_index is None:             # <<<<<<<<<<<<<<
  *       self.daf_indices = self.daf_indices[self.daf_indices.size:]  # Clear it.
  *       return None
  */
   __pyx_t_7 = (__pyx_v_first_positive_index == Py_None);
   if (__pyx_t_7) {
 
-    /* "ext/skeletontricks/skeletontricks.pyx":947
+    /* "ext/skeletontricks/skeletontricks.pyx":984
  *     )
  *     if first_positive_index is None:
  *       self.daf_indices = self.daf_indices[self.daf_indices.size:]  # Clear it.             # <<<<<<<<<<<<<<
  *       return None
  * 
  */
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 947, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 984, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 947, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 984, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 947, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_size); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 984, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_GetSlice(__pyx_t_1, 0, 0, &__pyx_t_4, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 947, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetSlice(__pyx_t_1, 0, 0, &__pyx_t_4, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 984, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices, __pyx_t_2) < 0) __PYX_ERR(0, 947, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices, __pyx_t_2) < 0) __PYX_ERR(0, 984, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":948
+    /* "ext/skeletontricks/skeletontricks.pyx":985
  *     if first_positive_index is None:
  *       self.daf_indices = self.daf_indices[self.daf_indices.size:]  # Clear it.
  *       return None             # <<<<<<<<<<<<<<
  * 
  *     # This tells us mask positions daf_indices[0:first_positive_index] are now
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":946
+    /* "ext/skeletontricks/skeletontricks.pyx":983
  *       mask.ravel(order='F'), self.daf_indices
  *     )
  *     if first_positive_index is None:             # <<<<<<<<<<<<<<
  *       self.daf_indices = self.daf_indices[self.daf_indices.size:]  # Clear it.
  *       return None
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":953
+  /* "ext/skeletontricks/skeletontricks.pyx":990
  *     # zeroed out. We assume that this is permanent, so we don't need to search
  *     # those positions again next time.
  *     self.daf_indices = self.daf_indices[first_positive_index:]             # <<<<<<<<<<<<<<
  * 
  *     return np.unravel_index(self.daf_indices[0], mask.shape, order='F')
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 953, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 990, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_t_2, 0, 0, &__pyx_v_first_positive_index, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 953, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_t_2, 0, 0, &__pyx_v_first_positive_index, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 990, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices, __pyx_t_4) < 0) __PYX_ERR(0, 953, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices, __pyx_t_4) < 0) __PYX_ERR(0, 990, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":955
+  /* "ext/skeletontricks/skeletontricks.pyx":992
  *     self.daf_indices = self.daf_indices[first_positive_index:]
  * 
  *     return np.unravel_index(self.daf_indices[0], mask.shape, order='F')             # <<<<<<<<<<<<<<
  * 
  *   @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 955, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 992, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_unravel_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 955, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_unravel_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 992, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 955, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_daf_indices); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 992, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 955, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 992, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 955, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_mask, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 992, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 955, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 992, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1)) __PYX_ERR(0, 955, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1)) __PYX_ERR(0, 992, __pyx_L1_error);
   __Pyx_GIVEREF(__pyx_t_4);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4)) __PYX_ERR(0, 955, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4)) __PYX_ERR(0, 992, __pyx_L1_error);
   __pyx_t_1 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 955, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 992, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 955, __pyx_L1_error)
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 955, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 992, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 992, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":936
+  /* "ext/skeletontricks/skeletontricks.pyx":973
  *     self.daf_indices = mask_indices[daf_sort]
  * 
  *   def find_target(self, mask: np.ndarray):             # <<<<<<<<<<<<<<
  *     """
  *     Find the coordinate of a voxel corresponding
  */
 
@@ -79396,15 +80609,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_first_positive_index);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":957
+/* "ext/skeletontricks/skeletontricks.pyx":994
  *     return np.unravel_index(self.daf_indices[0], mask.shape, order='F')
  * 
  *   @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  *   @cython.wraparound(False)  # turn off negative index wrapping for entire function
  *   @cython.nonecheck(False)
  */
 
@@ -79464,55 +80677,55 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_self)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 957, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 994, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 957, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 994, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("first_label_indexed", 1, 3, 3, 1); __PYX_ERR(0, 957, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("first_label_indexed", 1, 3, 3, 1); __PYX_ERR(0, 994, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_indices)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 957, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 994, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("first_label_indexed", 1, 3, 3, 2); __PYX_ERR(0, 957, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("first_label_indexed", 1, 3, 3, 2); __PYX_ERR(0, 994, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "first_label_indexed") < 0)) __PYX_ERR(0, 957, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "first_label_indexed") < 0)) __PYX_ERR(0, 994, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 3)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
       values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
     }
     __pyx_v_self = values[0];
-    __pyx_v_labels = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint8_t(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_labels.memview)) __PYX_ERR(0, 960, __pyx_L3_error)
-    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_int64_t(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 960, __pyx_L3_error)
+    __pyx_v_labels = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_uint8_t(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_labels.memview)) __PYX_ERR(0, 997, __pyx_L3_error)
+    __pyx_v_indices = __Pyx_PyObject_to_MemoryviewSlice_ds_nn_int64_t(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_indices.memview)) __PYX_ERR(0, 997, __pyx_L3_error)
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("first_label_indexed", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 957, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("first_label_indexed", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 994, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
@@ -79521,18 +80734,18 @@
   __PYX_XCLEAR_MEMVIEW(&__pyx_v_labels, 1);
   __PYX_XCLEAR_MEMVIEW(&__pyx_v_indices, 1);
   __Pyx_AddTraceback("kimimaro.skeletontricks.CachedTargetFinder.first_label_indexed", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   if (unlikely(((PyObject *)__pyx_v_labels.memview) == Py_None)) {
-    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "labels"); __PYX_ERR(0, 960, __pyx_L1_error)
+    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "labels"); __PYX_ERR(0, 997, __pyx_L1_error)
   }
   if (unlikely(((PyObject *)__pyx_v_indices.memview) == Py_None)) {
-    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "indices"); __PYX_ERR(0, 960, __pyx_L1_error)
+    PyErr_Format(PyExc_TypeError, "Argument '%.200s' must not be None", "indices"); __PYX_ERR(0, 997, __pyx_L1_error)
   }
   __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_18CachedTargetFinder_4first_label_indexed(__pyx_self, __pyx_v_self, __pyx_v_labels, __pyx_v_indices);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
@@ -79564,108 +80777,108 @@
   Py_ssize_t __pyx_t_7;
   int __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("first_label_indexed", 1);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":965
+  /* "ext/skeletontricks/skeletontricks.pyx":1002
  *     Returns: first i for which labels[indices[i]] is non-zero.
  *     """
  *     cdef size_t length = indices.size             # <<<<<<<<<<<<<<
  *     cdef size_t i = 0
  *     cdef int64_t label_index
  */
-  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn_int64_t, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 965, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn_int64_t, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1002, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_size); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 965, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_size); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1002, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_3 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 965, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_As_size_t(__pyx_t_2); if (unlikely((__pyx_t_3 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1002, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_length = __pyx_t_3;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":966
+  /* "ext/skeletontricks/skeletontricks.pyx":1003
  *     """
  *     cdef size_t length = indices.size
  *     cdef size_t i = 0             # <<<<<<<<<<<<<<
  *     cdef int64_t label_index
  * 
  */
   __pyx_v_i = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":969
+  /* "ext/skeletontricks/skeletontricks.pyx":1006
  *     cdef int64_t label_index
  * 
  *     for i in range(length):             # <<<<<<<<<<<<<<
  *       label_index = indices[i]
  *       if labels[label_index]:
  */
   __pyx_t_3 = __pyx_v_length;
   __pyx_t_4 = __pyx_t_3;
   for (__pyx_t_5 = 0; __pyx_t_5 < __pyx_t_4; __pyx_t_5+=1) {
     __pyx_v_i = __pyx_t_5;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":970
+    /* "ext/skeletontricks/skeletontricks.pyx":1007
  * 
  *     for i in range(length):
  *       label_index = indices[i]             # <<<<<<<<<<<<<<
  *       if labels[label_index]:
  *         return i
  */
     __pyx_t_6 = __pyx_v_i;
     __pyx_v_label_index = (*((int64_t *) ( /* dim=0 */ (__pyx_v_indices.data + __pyx_t_6 * __pyx_v_indices.strides[0]) )));
 
-    /* "ext/skeletontricks/skeletontricks.pyx":971
+    /* "ext/skeletontricks/skeletontricks.pyx":1008
  *     for i in range(length):
  *       label_index = indices[i]
  *       if labels[label_index]:             # <<<<<<<<<<<<<<
  *         return i
  * 
  */
     __pyx_t_7 = __pyx_v_label_index;
     __pyx_t_8 = ((*((uint8_t *) ( /* dim=0 */ (__pyx_v_labels.data + __pyx_t_7 * __pyx_v_labels.strides[0]) ))) != 0);
     if (__pyx_t_8) {
 
-      /* "ext/skeletontricks/skeletontricks.pyx":972
+      /* "ext/skeletontricks/skeletontricks.pyx":1009
  *       label_index = indices[i]
  *       if labels[label_index]:
  *         return i             # <<<<<<<<<<<<<<
  * 
  *     return None
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 972, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyInt_FromSize_t(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1009, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_r = __pyx_t_2;
       __pyx_t_2 = 0;
       goto __pyx_L0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":971
+      /* "ext/skeletontricks/skeletontricks.pyx":1008
  *     for i in range(length):
  *       label_index = indices[i]
  *       if labels[label_index]:             # <<<<<<<<<<<<<<
  *         return i
  * 
  */
     }
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":974
+  /* "ext/skeletontricks/skeletontricks.pyx":1011
  *         return i
  * 
  *     return None             # <<<<<<<<<<<<<<
  * 
  * def extract_edges_from_binary_image(uint8_t[:,:,:] binimg, int connectivity = 26):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":957
+  /* "ext/skeletontricks/skeletontricks.pyx":994
  *     return np.unravel_index(self.daf_indices[0], mask.shape, order='F')
  * 
  *   @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  *   @cython.wraparound(False)  # turn off negative index wrapping for entire function
  *   @cython.nonecheck(False)
  */
 
@@ -79677,32 +80890,32 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "ext/skeletontricks/skeletontricks.pyx":976
+/* "ext/skeletontricks/skeletontricks.pyx":1013
  *     return None
  * 
  * def extract_edges_from_binary_image(uint8_t[:,:,:] binimg, int connectivity = 26):             # <<<<<<<<<<<<<<
  *   cdef uint64_t sx, sy, sz
  *   sx, sy, sz = tuple(binimg.shape)[:3]
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_35extract_edges_from_binary_image(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_37extract_edges_from_binary_image(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_35extract_edges_from_binary_image = {"extract_edges_from_binary_image", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_35extract_edges_from_binary_image, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8kimimaro_14skeletontricks_35extract_edges_from_binary_image(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_8kimimaro_14skeletontricks_37extract_edges_from_binary_image = {"extract_edges_from_binary_image", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8kimimaro_14skeletontricks_37extract_edges_from_binary_image, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8kimimaro_14skeletontricks_37extract_edges_from_binary_image(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   __Pyx_memviewslice __pyx_v_binimg = { 0, 0, { 0 }, { 0 }, { 0 } };
@@ -79741,76 +80954,76 @@
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_binimg)) != 0)) {
           (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
           kw_args--;
         }
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 976, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1013, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_connectivity);
           if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 976, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1013, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "extract_edges_from_binary_image") < 0)) __PYX_ERR(0, 976, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "extract_edges_from_binary_image") < 0)) __PYX_ERR(0, 1013, __pyx_L3_error)
       }
     } else {
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
-    __pyx_v_binimg = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint8_t(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_binimg.memview)) __PYX_ERR(0, 976, __pyx_L3_error)
+    __pyx_v_binimg = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint8_t(values[0], PyBUF_WRITABLE); if (unlikely(!__pyx_v_binimg.memview)) __PYX_ERR(0, 1013, __pyx_L3_error)
     if (values[1]) {
-      __pyx_v_connectivity = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_connectivity == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 976, __pyx_L3_error)
+      __pyx_v_connectivity = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_connectivity == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1013, __pyx_L3_error)
     } else {
       __pyx_v_connectivity = ((int)((int)26));
     }
   }
   goto __pyx_L6_skip;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("extract_edges_from_binary_image", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 976, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("extract_edges_from_binary_image", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 1013, __pyx_L3_error)
   __pyx_L6_skip:;
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __PYX_XCLEAR_MEMVIEW(&__pyx_v_binimg, 1);
   __Pyx_AddTraceback("kimimaro.skeletontricks.extract_edges_from_binary_image", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_34extract_edges_from_binary_image(__pyx_self, __pyx_v_binimg, __pyx_v_connectivity);
+  __pyx_r = __pyx_pf_8kimimaro_14skeletontricks_36extract_edges_from_binary_image(__pyx_self, __pyx_v_binimg, __pyx_v_connectivity);
 
   /* function exit code */
   __PYX_XCLEAR_MEMVIEW(&__pyx_v_binimg, 1);
   {
     Py_ssize_t __pyx_temp;
     for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
       __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
     }
   }
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8kimimaro_14skeletontricks_34extract_edges_from_binary_image(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_binimg, int __pyx_v_connectivity) {
+static PyObject *__pyx_pf_8kimimaro_14skeletontricks_36extract_edges_from_binary_image(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_binimg, int __pyx_v_connectivity) {
   uint64_t __pyx_v_sx;
   uint64_t __pyx_v_sy;
   uint64_t __pyx_v_sz;
   uint64_t __pyx_v_sxy;
   std::unordered_set<std::pair<uint64_t,uint64_t> ,struct skeletontricks::pair_hash>  __pyx_v_edges;
   PyObject *__pyx_v_numbering = NULL;
   int64_t __pyx_v_i;
@@ -79821,16 +81034,16 @@
   uint64_t __pyx_v_loc;
   uint64_t __pyx_v_x;
   uint64_t __pyx_v_y;
   uint64_t __pyx_v_z;
   PyObject *__pyx_v_int_edges = NULL;
   PyObject *__pyx_v_v1 = NULL;
   PyObject *__pyx_v_v2 = NULL;
-  PyObject *__pyx_9genexpr10__pyx_v_k = NULL;
-  PyObject *__pyx_9genexpr10__pyx_v_v = NULL;
+  PyObject *__pyx_9genexpr12__pyx_v_k = NULL;
+  PyObject *__pyx_9genexpr12__pyx_v_v = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   uint64_t __pyx_t_5;
@@ -79853,86 +81066,86 @@
   PyObject *__pyx_t_22 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_edges_from_binary_image", 1);
   __PYX_INC_MEMVIEW(&__pyx_v_binimg, 1);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":978
+  /* "ext/skeletontricks/skeletontricks.pyx":1015
  * def extract_edges_from_binary_image(uint8_t[:,:,:] binimg, int connectivity = 26):
  *   cdef uint64_t sx, sy, sz
  *   sx, sy, sz = tuple(binimg.shape)[:3]             # <<<<<<<<<<<<<<
  * 
  *   cdef uint64_t sxy = sx * sy
  */
-  __pyx_t_1 = __Pyx_carray_to_py_Py_ssize_t(__pyx_v_binimg.shape, 8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 978, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_carray_to_py_Py_ssize_t(__pyx_v_binimg.shape, 8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1015, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 978, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1015, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyTuple_GetSlice(__pyx_t_2, 0, 3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 978, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyTuple_GetSlice(__pyx_t_2, 0, 3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1015, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (1) {
     PyObject* sequence = __pyx_t_1;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 3)) {
       if (size > 3) __Pyx_RaiseTooManyValuesError(3);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 978, __pyx_L1_error)
+      __PYX_ERR(0, 1015, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
     __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
     __pyx_t_4 = PyTuple_GET_ITEM(sequence, 2); 
     __Pyx_INCREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_t_4);
     #else
-    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 978, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1015, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 978, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1015, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 978, __pyx_L1_error)
+    __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1015, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     #endif
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
-  __pyx_t_5 = __Pyx_PyInt_As_uint64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 978, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_As_uint64_t(__pyx_t_2); if (unlikely((__pyx_t_5 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1015, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_6 = __Pyx_PyInt_As_uint64_t(__pyx_t_3); if (unlikely((__pyx_t_6 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 978, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_As_uint64_t(__pyx_t_3); if (unlikely((__pyx_t_6 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1015, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_7 = __Pyx_PyInt_As_uint64_t(__pyx_t_4); if (unlikely((__pyx_t_7 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 978, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_As_uint64_t(__pyx_t_4); if (unlikely((__pyx_t_7 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1015, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_sx = __pyx_t_5;
   __pyx_v_sy = __pyx_t_6;
   __pyx_v_sz = __pyx_t_7;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":980
+  /* "ext/skeletontricks/skeletontricks.pyx":1017
  *   sx, sy, sz = tuple(binimg.shape)[:3]
  * 
  *   cdef uint64_t sxy = sx * sy             # <<<<<<<<<<<<<<
  * 
  *   binimg = np.asfortranarray(binimg)
  */
   __pyx_v_sxy = (__pyx_v_sx * __pyx_v_sy);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":982
+  /* "ext/skeletontricks/skeletontricks.pyx":1019
  *   cdef uint64_t sxy = sx * sy
  * 
  *   binimg = np.asfortranarray(binimg)             # <<<<<<<<<<<<<<
  *   cdef unordered_set[cpp_pair[uint64_t,uint64_t], pair_hash] edges = _extract_edges_from_binary_image(
  *     &binimg[0,0,0],
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 982, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1019, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asfortranarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 982, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asfortranarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1019, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_binimg, 3, (PyObject *(*)(char *)) __pyx_memview_get_nn_uint8_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn_uint8_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 982, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_binimg, 3, (PyObject *(*)(char *)) __pyx_memview_get_nn_uint8_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn_uint8_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1019, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_2 = NULL;
   __pyx_t_8 = 0;
   #if CYTHON_UNPACK_METHODS
   if (unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
@@ -79945,26 +81158,26 @@
   }
   #endif
   {
     PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_4};
     __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 982, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1019, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint8_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 982, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_nn_uint8_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 1019, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_XCLEAR_MEMVIEW(&__pyx_v_binimg, 1);
   __pyx_v_binimg = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":984
+  /* "ext/skeletontricks/skeletontricks.pyx":1021
  *   binimg = np.asfortranarray(binimg)
  *   cdef unordered_set[cpp_pair[uint64_t,uint64_t], pair_hash] edges = _extract_edges_from_binary_image(
  *     &binimg[0,0,0],             # <<<<<<<<<<<<<<
  *     sx, sy, sz,
  *     connectivity
  */
   __pyx_t_10 = 0;
@@ -79981,495 +81194,495 @@
   } else if (unlikely(__pyx_t_11 >= __pyx_v_binimg.shape[1])) __pyx_t_8 = 1;
   if (__pyx_t_12 < 0) {
     __pyx_t_12 += __pyx_v_binimg.shape[2];
     if (unlikely(__pyx_t_12 < 0)) __pyx_t_8 = 2;
   } else if (unlikely(__pyx_t_12 >= __pyx_v_binimg.shape[2])) __pyx_t_8 = 2;
   if (unlikely(__pyx_t_8 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_8);
-    __PYX_ERR(0, 984, __pyx_L1_error)
+    __PYX_ERR(0, 1021, __pyx_L1_error)
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":983
+  /* "ext/skeletontricks/skeletontricks.pyx":1020
  * 
  *   binimg = np.asfortranarray(binimg)
  *   cdef unordered_set[cpp_pair[uint64_t,uint64_t], pair_hash] edges = _extract_edges_from_binary_image(             # <<<<<<<<<<<<<<
  *     &binimg[0,0,0],
  *     sx, sy, sz,
  */
   __pyx_v_edges = skeletontricks::_extract_edges_from_binary_image((&(*((uint8_t *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_binimg.data + __pyx_t_10 * __pyx_v_binimg.strides[0]) ) + __pyx_t_11 * __pyx_v_binimg.strides[1]) ) + __pyx_t_12 * __pyx_v_binimg.strides[2]) )))), __pyx_v_sx, __pyx_v_sy, __pyx_v_sz, __pyx_v_connectivity);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":989
+  /* "ext/skeletontricks/skeletontricks.pyx":1026
  *   )
  * 
  *   numbering = {}             # <<<<<<<<<<<<<<
  *   cdef int64_t i = 0
  *   for edge in edges:
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 989, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_numbering = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":990
+  /* "ext/skeletontricks/skeletontricks.pyx":1027
  * 
  *   numbering = {}
  *   cdef int64_t i = 0             # <<<<<<<<<<<<<<
  *   for edge in edges:
  *     for v in (edge.first, edge.second):
  */
   __pyx_v_i = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":991
+  /* "ext/skeletontricks/skeletontricks.pyx":1028
  *   numbering = {}
  *   cdef int64_t i = 0
  *   for edge in edges:             # <<<<<<<<<<<<<<
  *     for v in (edge.first, edge.second):
  *       if v not in numbering:
  */
   __pyx_t_13 = __pyx_v_edges.begin();
   for (;;) {
     if (!(__pyx_t_13 != __pyx_v_edges.end())) break;
     __pyx_t_14 = *__pyx_t_13;
     ++__pyx_t_13;
     __pyx_v_edge = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_14);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":992
+    /* "ext/skeletontricks/skeletontricks.pyx":1029
  *   cdef int64_t i = 0
  *   for edge in edges:
  *     for v in (edge.first, edge.second):             # <<<<<<<<<<<<<<
  *       if v not in numbering:
  *         numbering[v] = i
  */
-    __pyx_t_1 = __Pyx_PyInt_From_uint64_t(__pyx_v_edge.first); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 992, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_From_uint64_t(__pyx_v_edge.first); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1029, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_edge.second); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 992, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_edge.second); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1029, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 992, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1029, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_1);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 992, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 1029, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_3);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3)) __PYX_ERR(0, 992, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3)) __PYX_ERR(0, 1029, __pyx_L1_error);
     __pyx_t_1 = 0;
     __pyx_t_3 = 0;
     __pyx_t_3 = __pyx_t_4; __Pyx_INCREF(__pyx_t_3);
     __pyx_t_15 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     for (;;) {
       if (__pyx_t_15 >= 2) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_15); __Pyx_INCREF(__pyx_t_4); __pyx_t_15++; if (unlikely((0 < 0))) __PYX_ERR(0, 992, __pyx_L1_error)
+      __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_15); __Pyx_INCREF(__pyx_t_4); __pyx_t_15++; if (unlikely((0 < 0))) __PYX_ERR(0, 1029, __pyx_L1_error)
       #else
-      __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_15); __pyx_t_15++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 992, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_15); __pyx_t_15++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1029, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "ext/skeletontricks/skeletontricks.pyx":993
+      /* "ext/skeletontricks/skeletontricks.pyx":1030
  *   for edge in edges:
  *     for v in (edge.first, edge.second):
  *       if v not in numbering:             # <<<<<<<<<<<<<<
  *         numbering[v] = i
  *         i += 1
  */
-      __pyx_t_16 = (__Pyx_PyDict_ContainsTF(__pyx_v_v, __pyx_v_numbering, Py_NE)); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 993, __pyx_L1_error)
+      __pyx_t_16 = (__Pyx_PyDict_ContainsTF(__pyx_v_v, __pyx_v_numbering, Py_NE)); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 1030, __pyx_L1_error)
       if (__pyx_t_16) {
 
-        /* "ext/skeletontricks/skeletontricks.pyx":994
+        /* "ext/skeletontricks/skeletontricks.pyx":1031
  *     for v in (edge.first, edge.second):
  *       if v not in numbering:
  *         numbering[v] = i             # <<<<<<<<<<<<<<
  *         i += 1
  * 
  */
-        __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 994, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1031, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        if (unlikely((PyDict_SetItem(__pyx_v_numbering, __pyx_v_v, __pyx_t_4) < 0))) __PYX_ERR(0, 994, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_numbering, __pyx_v_v, __pyx_t_4) < 0))) __PYX_ERR(0, 1031, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-        /* "ext/skeletontricks/skeletontricks.pyx":995
+        /* "ext/skeletontricks/skeletontricks.pyx":1032
  *       if v not in numbering:
  *         numbering[v] = i
  *         i += 1             # <<<<<<<<<<<<<<
  * 
  *   inumbering = { v:k for k,v in numbering.items() }
  */
         __pyx_v_i = (__pyx_v_i + 1);
 
-        /* "ext/skeletontricks/skeletontricks.pyx":993
+        /* "ext/skeletontricks/skeletontricks.pyx":1030
  *   for edge in edges:
  *     for v in (edge.first, edge.second):
  *       if v not in numbering:             # <<<<<<<<<<<<<<
  *         numbering[v] = i
  *         i += 1
  */
       }
 
-      /* "ext/skeletontricks/skeletontricks.pyx":992
+      /* "ext/skeletontricks/skeletontricks.pyx":1029
  *   cdef int64_t i = 0
  *   for edge in edges:
  *     for v in (edge.first, edge.second):             # <<<<<<<<<<<<<<
  *       if v not in numbering:
  *         numbering[v] = i
  */
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":991
+    /* "ext/skeletontricks/skeletontricks.pyx":1028
  *   numbering = {}
  *   cdef int64_t i = 0
  *   for edge in edges:             # <<<<<<<<<<<<<<
  *     for v in (edge.first, edge.second):
  *       if v not in numbering:
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":997
+  /* "ext/skeletontricks/skeletontricks.pyx":1034
  *         i += 1
  * 
  *   inumbering = { v:k for k,v in numbering.items() }             # <<<<<<<<<<<<<<
  *   vertices = []
  * 
  */
   { /* enter inner scope */
-    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 997, __pyx_L12_error)
+    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1034, __pyx_L12_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_15 = 0;
-    __pyx_t_1 = __Pyx_dict_iterator(__pyx_v_numbering, 1, __pyx_n_s_items, (&__pyx_t_17), (&__pyx_t_8)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 997, __pyx_L12_error)
+    __pyx_t_1 = __Pyx_dict_iterator(__pyx_v_numbering, 1, __pyx_n_s_items, (&__pyx_t_17), (&__pyx_t_8)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1034, __pyx_L12_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF(__pyx_t_4);
     __pyx_t_4 = __pyx_t_1;
     __pyx_t_1 = 0;
     while (1) {
       __pyx_t_18 = __Pyx_dict_iter_next(__pyx_t_4, __pyx_t_17, &__pyx_t_15, &__pyx_t_1, &__pyx_t_2, NULL, __pyx_t_8);
       if (unlikely(__pyx_t_18 == 0)) break;
-      if (unlikely(__pyx_t_18 == -1)) __PYX_ERR(0, 997, __pyx_L12_error)
+      if (unlikely(__pyx_t_18 == -1)) __PYX_ERR(0, 1034, __pyx_L12_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_XDECREF_SET(__pyx_9genexpr10__pyx_v_k, __pyx_t_1);
+      __Pyx_XDECREF_SET(__pyx_9genexpr12__pyx_v_k, __pyx_t_1);
       __pyx_t_1 = 0;
-      __Pyx_XDECREF_SET(__pyx_9genexpr10__pyx_v_v, __pyx_t_2);
+      __Pyx_XDECREF_SET(__pyx_9genexpr12__pyx_v_v, __pyx_t_2);
       __pyx_t_2 = 0;
-      if (unlikely(PyDict_SetItem(__pyx_t_3, (PyObject*)__pyx_9genexpr10__pyx_v_v, (PyObject*)__pyx_9genexpr10__pyx_v_k))) __PYX_ERR(0, 997, __pyx_L12_error)
+      if (unlikely(PyDict_SetItem(__pyx_t_3, (PyObject*)__pyx_9genexpr12__pyx_v_v, (PyObject*)__pyx_9genexpr12__pyx_v_k))) __PYX_ERR(0, 1034, __pyx_L12_error)
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_k); __pyx_9genexpr10__pyx_v_k = 0;
-    __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_v); __pyx_9genexpr10__pyx_v_v = 0;
+    __Pyx_XDECREF(__pyx_9genexpr12__pyx_v_k); __pyx_9genexpr12__pyx_v_k = 0;
+    __Pyx_XDECREF(__pyx_9genexpr12__pyx_v_v); __pyx_9genexpr12__pyx_v_v = 0;
     goto __pyx_L15_exit_scope;
     __pyx_L12_error:;
-    __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_k); __pyx_9genexpr10__pyx_v_k = 0;
-    __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_v); __pyx_9genexpr10__pyx_v_v = 0;
+    __Pyx_XDECREF(__pyx_9genexpr12__pyx_v_k); __pyx_9genexpr12__pyx_v_k = 0;
+    __Pyx_XDECREF(__pyx_9genexpr12__pyx_v_v); __pyx_9genexpr12__pyx_v_v = 0;
     goto __pyx_L1_error;
     __pyx_L15_exit_scope:;
   } /* exit inner scope */
   __pyx_v_inumbering = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":998
+  /* "ext/skeletontricks/skeletontricks.pyx":1035
  * 
  *   inumbering = { v:k for k,v in numbering.items() }
  *   vertices = []             # <<<<<<<<<<<<<<
  * 
  *   cdef uint64_t loc, x, y, z
  */
-  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 998, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1035, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_v_vertices = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":1001
+  /* "ext/skeletontricks/skeletontricks.pyx":1038
  * 
  *   cdef uint64_t loc, x, y, z
  *   for i in range(len(inumbering)):             # <<<<<<<<<<<<<<
  *     loc = inumbering[i]
  *     z = loc // sxy
  */
-  __pyx_t_17 = PyDict_Size(__pyx_v_inumbering); if (unlikely(__pyx_t_17 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1001, __pyx_L1_error)
+  __pyx_t_17 = PyDict_Size(__pyx_v_inumbering); if (unlikely(__pyx_t_17 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1038, __pyx_L1_error)
   __pyx_t_15 = __pyx_t_17;
   for (__pyx_t_19 = 0; __pyx_t_19 < __pyx_t_15; __pyx_t_19+=1) {
     __pyx_v_i = __pyx_t_19;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":1002
+    /* "ext/skeletontricks/skeletontricks.pyx":1039
  *   cdef uint64_t loc, x, y, z
  *   for i in range(len(inumbering)):
  *     loc = inumbering[i]             # <<<<<<<<<<<<<<
  *     z = loc // sxy
  *     y = (loc - z * sxy) // sx
  */
-    __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1002, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_From_int64_t(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1039, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyDict_GetItem(__pyx_v_inumbering, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1002, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_GetItem(__pyx_v_inumbering, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1039, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_7 = __Pyx_PyInt_As_uint64_t(__pyx_t_4); if (unlikely((__pyx_t_7 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1002, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_As_uint64_t(__pyx_t_4); if (unlikely((__pyx_t_7 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1039, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_v_loc = __pyx_t_7;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":1003
+    /* "ext/skeletontricks/skeletontricks.pyx":1040
  *   for i in range(len(inumbering)):
  *     loc = inumbering[i]
  *     z = loc // sxy             # <<<<<<<<<<<<<<
  *     y = (loc - z * sxy) // sx
  *     x = loc - z * sxy - y * sx
  */
     if (unlikely(__pyx_v_sxy == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "integer division or modulo by zero");
-      __PYX_ERR(0, 1003, __pyx_L1_error)
+      __PYX_ERR(0, 1040, __pyx_L1_error)
     }
     __pyx_v_z = (__pyx_v_loc / __pyx_v_sxy);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":1004
+    /* "ext/skeletontricks/skeletontricks.pyx":1041
  *     loc = inumbering[i]
  *     z = loc // sxy
  *     y = (loc - z * sxy) // sx             # <<<<<<<<<<<<<<
  *     x = loc - z * sxy - y * sx
  *     vertices.append((x,y,z))
  */
     __pyx_t_7 = (__pyx_v_loc - (__pyx_v_z * __pyx_v_sxy));
     if (unlikely(__pyx_v_sx == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "integer division or modulo by zero");
-      __PYX_ERR(0, 1004, __pyx_L1_error)
+      __PYX_ERR(0, 1041, __pyx_L1_error)
     }
     __pyx_v_y = (__pyx_t_7 / __pyx_v_sx);
 
-    /* "ext/skeletontricks/skeletontricks.pyx":1005
+    /* "ext/skeletontricks/skeletontricks.pyx":1042
  *     z = loc // sxy
  *     y = (loc - z * sxy) // sx
  *     x = loc - z * sxy - y * sx             # <<<<<<<<<<<<<<
  *     vertices.append((x,y,z))
  * 
  */
     __pyx_v_x = ((__pyx_v_loc - (__pyx_v_z * __pyx_v_sxy)) - (__pyx_v_y * __pyx_v_sx));
 
-    /* "ext/skeletontricks/skeletontricks.pyx":1006
+    /* "ext/skeletontricks/skeletontricks.pyx":1043
  *     y = (loc - z * sxy) // sx
  *     x = loc - z * sxy - y * sx
  *     vertices.append((x,y,z))             # <<<<<<<<<<<<<<
  * 
  *   int_edges = []
  */
-    __pyx_t_4 = __Pyx_PyInt_From_uint64_t(__pyx_v_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyInt_From_uint64_t(__pyx_v_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1043, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_From_uint64_t(__pyx_v_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1043, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = __Pyx_PyInt_From_uint64_t(__pyx_v_z); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_From_uint64_t(__pyx_v_z); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1043, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1043, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_4);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 1006, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 1043, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_3);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3)) __PYX_ERR(0, 1006, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3)) __PYX_ERR(0, 1043, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_2);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_2)) __PYX_ERR(0, 1006, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_2)) __PYX_ERR(0, 1043, __pyx_L1_error);
     __pyx_t_4 = 0;
     __pyx_t_3 = 0;
     __pyx_t_2 = 0;
-    __pyx_t_20 = __Pyx_PyObject_Append(__pyx_v_vertices, __pyx_t_1); if (unlikely(__pyx_t_20 == ((int)-1))) __PYX_ERR(0, 1006, __pyx_L1_error)
+    __pyx_t_20 = __Pyx_PyObject_Append(__pyx_v_vertices, __pyx_t_1); if (unlikely(__pyx_t_20 == ((int)-1))) __PYX_ERR(0, 1043, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":1008
+  /* "ext/skeletontricks/skeletontricks.pyx":1045
  *     vertices.append((x,y,z))
  * 
  *   int_edges = []             # <<<<<<<<<<<<<<
  *   for v1,v2 in edges:
  *     int_edges.append((numbering[v1], numbering[v2]))
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1008, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_int_edges = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":1009
+  /* "ext/skeletontricks/skeletontricks.pyx":1046
  * 
  *   int_edges = []
  *   for v1,v2 in edges:             # <<<<<<<<<<<<<<
  *     int_edges.append((numbering[v1], numbering[v2]))
  * 
  */
   __pyx_t_13 = __pyx_v_edges.begin();
   for (;;) {
     if (!(__pyx_t_13 != __pyx_v_edges.end())) break;
     __pyx_t_14 = *__pyx_t_13;
     ++__pyx_t_13;
-    __pyx_t_1 = __pyx_convert_pair_to_py_uint64_t____uint64_t(__pyx_t_14); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
+    __pyx_t_1 = __pyx_convert_pair_to_py_uint64_t____uint64_t(__pyx_t_14); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1046, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
       PyObject* sequence = __pyx_t_1;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 2)) {
         if (size > 2) __Pyx_RaiseTooManyValuesError(2);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 1009, __pyx_L1_error)
+        __PYX_ERR(0, 1046, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
       } else {
         __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
         __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
       }
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       #else
-      __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1009, __pyx_L1_error)
+      __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1046, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1009, __pyx_L1_error)
+      __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1046, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1009, __pyx_L1_error)
+      __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1046, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_t_21 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
       index = 0; __pyx_t_2 = __pyx_t_21(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L20_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_2);
       index = 1; __pyx_t_3 = __pyx_t_21(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L20_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_3);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_21(__pyx_t_4), 2) < 0) __PYX_ERR(0, 1009, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_21(__pyx_t_4), 2) < 0) __PYX_ERR(0, 1046, __pyx_L1_error)
       __pyx_t_21 = NULL;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       goto __pyx_L21_unpacking_done;
       __pyx_L20_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_t_21 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 1009, __pyx_L1_error)
+      __PYX_ERR(0, 1046, __pyx_L1_error)
       __pyx_L21_unpacking_done:;
     }
     __Pyx_XDECREF_SET(__pyx_v_v1, __pyx_t_2);
     __pyx_t_2 = 0;
     __Pyx_XDECREF_SET(__pyx_v_v2, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":1010
+    /* "ext/skeletontricks/skeletontricks.pyx":1047
  *   int_edges = []
  *   for v1,v2 in edges:
  *     int_edges.append((numbering[v1], numbering[v2]))             # <<<<<<<<<<<<<<
  * 
  *   vertices = np.array(vertices, dtype=np.uint32)
  */
-    __pyx_t_1 = __Pyx_PyDict_GetItem(__pyx_v_numbering, __pyx_v_v1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1010, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_GetItem(__pyx_v_numbering, __pyx_v_v1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1047, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_numbering, __pyx_v_v2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1010, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_GetItem(__pyx_v_numbering, __pyx_v_v2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1047, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1010, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1047, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_1);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 1010, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 1047, __pyx_L1_error);
     __Pyx_GIVEREF(__pyx_t_3);
-    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 1010, __pyx_L1_error);
+    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 1047, __pyx_L1_error);
     __pyx_t_1 = 0;
     __pyx_t_3 = 0;
-    __pyx_t_20 = __Pyx_PyObject_Append(__pyx_v_int_edges, __pyx_t_2); if (unlikely(__pyx_t_20 == ((int)-1))) __PYX_ERR(0, 1010, __pyx_L1_error)
+    __pyx_t_20 = __Pyx_PyObject_Append(__pyx_v_int_edges, __pyx_t_2); if (unlikely(__pyx_t_20 == ((int)-1))) __PYX_ERR(0, 1047, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "ext/skeletontricks/skeletontricks.pyx":1009
+    /* "ext/skeletontricks/skeletontricks.pyx":1046
  * 
  *   int_edges = []
  *   for v1,v2 in edges:             # <<<<<<<<<<<<<<
  *     int_edges.append((numbering[v1], numbering[v2]))
  * 
  */
   }
 
-  /* "ext/skeletontricks/skeletontricks.pyx":1012
+  /* "ext/skeletontricks/skeletontricks.pyx":1049
  *     int_edges.append((numbering[v1], numbering[v2]))
  * 
  *   vertices = np.array(vertices, dtype=np.uint32)             # <<<<<<<<<<<<<<
  *   int_edges = np.array(int_edges, dtype=np.uint32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1012, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1012, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1012, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_v_vertices);
   __Pyx_GIVEREF(__pyx_v_vertices);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_vertices)) __PYX_ERR(0, 1012, __pyx_L1_error);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1012, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_vertices)) __PYX_ERR(0, 1049, __pyx_L1_error);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1012, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_22 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 1012, __pyx_L1_error)
+  __pyx_t_22 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_uint32); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 1049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_22);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_22) < 0) __PYX_ERR(0, 1012, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_22) < 0) __PYX_ERR(0, 1049, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
-  __pyx_t_22 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 1012, __pyx_L1_error)
+  __pyx_t_22 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 1049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_22);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF_SET(__pyx_v_vertices, __pyx_t_22);
   __pyx_t_22 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":1013
+  /* "ext/skeletontricks/skeletontricks.pyx":1050
  * 
  *   vertices = np.array(vertices, dtype=np.uint32)
  *   int_edges = np.array(int_edges, dtype=np.uint32)             # <<<<<<<<<<<<<<
  * 
  *   return (vertices, int_edges)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_22, __pyx_n_s_np); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 1013, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_22, __pyx_n_s_np); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 1050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_22);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_22, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1013, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_22, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
-  __pyx_t_22 = PyTuple_New(1); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 1013, __pyx_L1_error)
+  __pyx_t_22 = PyTuple_New(1); if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 1050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_22);
   __Pyx_INCREF(__pyx_v_int_edges);
   __Pyx_GIVEREF(__pyx_v_int_edges);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_22, 0, __pyx_v_int_edges)) __PYX_ERR(0, 1013, __pyx_L1_error);
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1013, __pyx_L1_error)
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_22, 0, __pyx_v_int_edges)) __PYX_ERR(0, 1050, __pyx_L1_error);
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1013, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_uint32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1013, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_uint32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 1013, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 1050, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_22, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1013, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_22, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_22); __pyx_t_22 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF_SET(__pyx_v_int_edges, __pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":1015
+  /* "ext/skeletontricks/skeletontricks.pyx":1052
  *   int_edges = np.array(int_edges, dtype=np.uint32)
  * 
  *   return (vertices, int_edges)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1015, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1052, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_INCREF(__pyx_v_vertices);
   __Pyx_GIVEREF(__pyx_v_vertices);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_vertices)) __PYX_ERR(0, 1015, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_vertices)) __PYX_ERR(0, 1052, __pyx_L1_error);
   __Pyx_INCREF(__pyx_v_int_edges);
   __Pyx_GIVEREF(__pyx_v_int_edges);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_int_edges)) __PYX_ERR(0, 1015, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_int_edges)) __PYX_ERR(0, 1052, __pyx_L1_error);
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":976
+  /* "ext/skeletontricks/skeletontricks.pyx":1013
  *     return None
  * 
  * def extract_edges_from_binary_image(uint8_t[:,:,:] binimg, int connectivity = 26):             # <<<<<<<<<<<<<<
  *   cdef uint64_t sx, sy, sz
  *   sx, sy, sz = tuple(binimg.shape)[:3]
  */
 
@@ -80487,16 +81700,16 @@
   __Pyx_XDECREF(__pyx_v_numbering);
   __Pyx_XDECREF(__pyx_v_v);
   __Pyx_XDECREF(__pyx_v_inumbering);
   __Pyx_XDECREF(__pyx_v_vertices);
   __Pyx_XDECREF(__pyx_v_int_edges);
   __Pyx_XDECREF(__pyx_v_v1);
   __Pyx_XDECREF(__pyx_v_v2);
-  __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_k);
-  __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_v);
+  __Pyx_XDECREF(__pyx_9genexpr12__pyx_v_k);
+  __Pyx_XDECREF(__pyx_9genexpr12__pyx_v_v);
   __PYX_XCLEAR_MEMVIEW(&__pyx_v_binimg, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static struct __pyx_vtabstruct_array __pyx_vtable_array;
 
@@ -81507,17 +82720,17 @@
     {&__pyx_n_s_View_MemoryView, __pyx_k_View_MemoryView, sizeof(__pyx_k_View_MemoryView), 0, 0, 1, 1},
     {&__pyx_kp_s__13, __pyx_k__13, sizeof(__pyx_k__13), 0, 0, 1, 0},
     {&__pyx_kp_s__14, __pyx_k__14, sizeof(__pyx_k__14), 0, 0, 1, 0},
     {&__pyx_kp_u__14, __pyx_k__14, sizeof(__pyx_k__14), 0, 1, 0, 0},
     {&__pyx_kp_u__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 1, 0, 0},
     {&__pyx_n_s__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 0, 1, 1},
     {&__pyx_kp_u__6, __pyx_k__6, sizeof(__pyx_k__6), 0, 1, 0, 0},
-    {&__pyx_n_s__60, __pyx_k__60, sizeof(__pyx_k__60), 0, 0, 1, 1},
+    {&__pyx_n_s__63, __pyx_k__63, sizeof(__pyx_k__63), 0, 0, 1, 1},
     {&__pyx_kp_u__7, __pyx_k__7, sizeof(__pyx_k__7), 0, 1, 0, 0},
-    {&__pyx_n_s__71, __pyx_k__71, sizeof(__pyx_k__71), 0, 0, 1, 1},
+    {&__pyx_n_s__74, __pyx_k__74, sizeof(__pyx_k__74), 0, 0, 1, 1},
     {&__pyx_n_s_abc, __pyx_k_abc, sizeof(__pyx_k_abc), 0, 0, 1, 1},
     {&__pyx_n_s_add, __pyx_k_add, sizeof(__pyx_k_add), 0, 0, 1, 1},
     {&__pyx_n_s_allocate_buffer, __pyx_k_allocate_buffer, sizeof(__pyx_k_allocate_buffer), 0, 0, 1, 1},
     {&__pyx_n_s_allowed_differences, __pyx_k_allowed_differences, sizeof(__pyx_k_allowed_differences), 0, 0, 1, 1},
     {&__pyx_kp_u_and, __pyx_k_and, sizeof(__pyx_k_and), 0, 1, 0, 0},
     {&__pyx_n_s_anisotropy, __pyx_k_anisotropy, sizeof(__pyx_k_anisotropy), 0, 0, 1, 1},
     {&__pyx_n_s_append, __pyx_k_append, sizeof(__pyx_k_append), 0, 0, 1, 1},
@@ -81546,14 +82759,15 @@
     {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
     {&__pyx_n_s_collections, __pyx_k_collections, sizeof(__pyx_k_collections), 0, 0, 1, 1},
     {&__pyx_kp_s_collections_abc, __pyx_k_collections_abc, sizeof(__pyx_k_collections_abc), 0, 0, 1, 0},
     {&__pyx_n_s_compute_centroids, __pyx_k_compute_centroids, sizeof(__pyx_k_compute_centroids), 0, 0, 1, 1},
     {&__pyx_n_s_compute_tiebreaker_maxima, __pyx_k_compute_tiebreaker_maxima, sizeof(__pyx_k_compute_tiebreaker_maxima), 0, 0, 1, 1},
     {&__pyx_n_s_connectivity, __pyx_k_connectivity, sizeof(__pyx_k_connectivity), 0, 0, 1, 1},
     {&__pyx_n_s_const, __pyx_k_const, sizeof(__pyx_k_const), 0, 0, 1, 1},
+    {&__pyx_n_s_constant, __pyx_k_constant, sizeof(__pyx_k_constant), 0, 0, 1, 1},
     {&__pyx_kp_s_contiguous_and_direct, __pyx_k_contiguous_and_direct, sizeof(__pyx_k_contiguous_and_direct), 0, 0, 1, 0},
     {&__pyx_kp_s_contiguous_and_indirect, __pyx_k_contiguous_and_indirect, sizeof(__pyx_k_contiguous_and_indirect), 0, 0, 1, 0},
     {&__pyx_n_s_coord, __pyx_k_coord, sizeof(__pyx_k_coord), 0, 0, 1, 1},
     {&__pyx_n_s_count, __pyx_k_count, sizeof(__pyx_k_count), 0, 0, 1, 1},
     {&__pyx_n_s_create_distance_graph, __pyx_k_create_distance_graph, sizeof(__pyx_k_create_distance_graph), 0, 0, 1, 1},
     {&__pyx_n_s_critical_points, __pyx_k_critical_points, sizeof(__pyx_k_critical_points), 0, 0, 1, 1},
     {&__pyx_n_s_cts, __pyx_k_cts, sizeof(__pyx_k_cts), 0, 0, 1, 1},
@@ -81668,14 +82882,15 @@
     {&__pyx_n_s_last_label, __pyx_k_last_label, sizeof(__pyx_k_last_label), 0, 0, 1, 1},
     {&__pyx_n_s_leave_alone, __pyx_k_leave_alone, sizeof(__pyx_k_leave_alone), 0, 0, 1, 1},
     {&__pyx_n_s_length, __pyx_k_length, sizeof(__pyx_k_length), 0, 0, 1, 1},
     {&__pyx_n_s_loc, __pyx_k_loc, sizeof(__pyx_k_loc), 0, 0, 1, 1},
     {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
     {&__pyx_n_s_mask, __pyx_k_mask, sizeof(__pyx_k_mask), 0, 0, 1, 1},
     {&__pyx_n_s_mask_indices, __pyx_k_mask_indices, sizeof(__pyx_k_mask_indices), 0, 0, 1, 1},
+    {&__pyx_n_s_max_distances, __pyx_k_max_distances, sizeof(__pyx_k_max_distances), 0, 0, 1, 1},
     {&__pyx_n_s_maximum, __pyx_k_maximum, sizeof(__pyx_k_maximum), 0, 0, 1, 1},
     {&__pyx_n_s_maxpdrf, __pyx_k_maxpdrf, sizeof(__pyx_k_maxpdrf), 0, 0, 1, 1},
     {&__pyx_n_s_maxx, __pyx_k_maxx, sizeof(__pyx_k_maxx), 0, 0, 1, 1},
     {&__pyx_n_s_maxy, __pyx_k_maxy, sizeof(__pyx_k_maxy), 0, 0, 1, 1},
     {&__pyx_n_s_maxz, __pyx_k_maxz, sizeof(__pyx_k_maxz), 0, 0, 1, 1},
     {&__pyx_n_s_memview, __pyx_k_memview, sizeof(__pyx_k_memview), 0, 0, 1, 1},
     {&__pyx_n_s_metaclass, __pyx_k_metaclass, sizeof(__pyx_k_metaclass), 0, 0, 1, 1},
@@ -81687,14 +82902,15 @@
     {&__pyx_n_s_module, __pyx_k_module, sizeof(__pyx_k_module), 0, 0, 1, 1},
     {&__pyx_kp_u_must_be_be_contained_within_sha, __pyx_k_must_be_be_contained_within_sha, sizeof(__pyx_k_must_be_be_contained_within_sha), 0, 1, 0, 0},
     {&__pyx_n_s_mx, __pyx_k_mx, sizeof(__pyx_k_mx), 0, 0, 1, 1},
     {&__pyx_n_s_my, __pyx_k_my, sizeof(__pyx_k_my), 0, 0, 1, 1},
     {&__pyx_n_s_mz, __pyx_k_mz, sizeof(__pyx_k_mz), 0, 0, 1, 1},
     {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
     {&__pyx_n_s_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
+    {&__pyx_n_s_ndarray, __pyx_k_ndarray, sizeof(__pyx_k_ndarray), 0, 0, 1, 1},
     {&__pyx_n_s_ndim, __pyx_k_ndim, sizeof(__pyx_k_ndim), 0, 0, 1, 1},
     {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
     {&__pyx_kp_s_no_default___reduce___due_to_non, __pyx_k_no_default___reduce___due_to_non, sizeof(__pyx_k_no_default___reduce___due_to_non), 0, 0, 1, 0},
     {&__pyx_n_s_node, __pyx_k_node, sizeof(__pyx_k_node), 0, 0, 1, 1},
     {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
     {&__pyx_kp_s_np_ndarray, __pyx_k_np_ndarray, sizeof(__pyx_k_np_ndarray), 0, 0, 1, 0},
     {&__pyx_n_s_numbering, __pyx_k_numbering, sizeof(__pyx_k_numbering), 0, 0, 1, 1},
@@ -81732,14 +82948,15 @@
     {&__pyx_n_s_reduce_ex, __pyx_k_reduce_ex, sizeof(__pyx_k_reduce_ex), 0, 0, 1, 1},
     {&__pyx_n_s_register, __pyx_k_register, sizeof(__pyx_k_register), 0, 0, 1, 1},
     {&__pyx_n_s_remap, __pyx_k_remap, sizeof(__pyx_k_remap), 0, 0, 1, 1},
     {&__pyx_n_s_res, __pyx_k_res, sizeof(__pyx_k_res), 0, 0, 1, 1},
     {&__pyx_n_s_result, __pyx_k_result, sizeof(__pyx_k_result), 0, 0, 1, 1},
     {&__pyx_n_s_return_counts, __pyx_k_return_counts, sizeof(__pyx_k_return_counts), 0, 0, 1, 1},
     {&__pyx_n_s_roll_invalidation_ball, __pyx_k_roll_invalidation_ball, sizeof(__pyx_k_roll_invalidation_ball), 0, 0, 1, 1},
+    {&__pyx_n_s_roll_invalidation_ball_inside_co, __pyx_k_roll_invalidation_ball_inside_co, sizeof(__pyx_k_roll_invalidation_ball_inside_co), 0, 0, 1, 1},
     {&__pyx_n_s_roll_invalidation_cube, __pyx_k_roll_invalidation_cube, sizeof(__pyx_k_roll_invalidation_cube), 0, 0, 1, 1},
     {&__pyx_n_s_root, __pyx_k_root, sizeof(__pyx_k_root), 0, 0, 1, 1},
     {&__pyx_n_s_s, __pyx_k_s, sizeof(__pyx_k_s), 0, 0, 1, 1},
     {&__pyx_n_s_scale, __pyx_k_scale, sizeof(__pyx_k_scale), 0, 0, 1, 1},
     {&__pyx_n_s_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
     {&__pyx_n_s_set_name, __pyx_k_set_name, sizeof(__pyx_k_set_name), 0, 0, 1, 1},
     {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
@@ -81810,17 +83027,20 @@
     {&__pyx_kp_s_unsigned_char_uint8_t, __pyx_k_unsigned_char_uint8_t, sizeof(__pyx_k_unsigned_char_uint8_t), 0, 0, 1, 0},
     {&__pyx_kp_s_unsigned_char_unsigned_char, __pyx_k_unsigned_char_unsigned_char, sizeof(__pyx_k_unsigned_char_unsigned_char), 0, 0, 1, 0},
     {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
     {&__pyx_n_s_v, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
     {&__pyx_n_s_v1, __pyx_k_v1, sizeof(__pyx_k_v1), 0, 0, 1, 1},
     {&__pyx_n_s_v2, __pyx_k_v2, sizeof(__pyx_k_v2), 0, 0, 1, 1},
     {&__pyx_n_s_values, __pyx_k_values, sizeof(__pyx_k_values), 0, 0, 1, 1},
+    {&__pyx_n_s_vcg, __pyx_k_vcg, sizeof(__pyx_k_vcg), 0, 0, 1, 1},
+    {&__pyx_n_s_vcg_arr, __pyx_k_vcg_arr, sizeof(__pyx_k_vcg_arr), 0, 0, 1, 1},
     {&__pyx_n_s_version_info, __pyx_k_version_info, sizeof(__pyx_k_version_info), 0, 0, 1, 1},
     {&__pyx_n_s_vertices, __pyx_k_vertices, sizeof(__pyx_k_vertices), 0, 0, 1, 1},
     {&__pyx_n_s_visited, __pyx_k_visited, sizeof(__pyx_k_visited), 0, 0, 1, 1},
+    {&__pyx_n_s_voxel_connectivity_graph, __pyx_k_voxel_connectivity_graph, sizeof(__pyx_k_voxel_connectivity_graph), 0, 0, 1, 1},
     {&__pyx_n_s_voxels, __pyx_k_voxels, sizeof(__pyx_k_voxels), 0, 0, 1, 1},
     {&__pyx_n_s_wx, __pyx_k_wx, sizeof(__pyx_k_wx), 0, 0, 1, 1},
     {&__pyx_n_s_wy, __pyx_k_wy, sizeof(__pyx_k_wy), 0, 0, 1, 1},
     {&__pyx_n_s_wz, __pyx_k_wz, sizeof(__pyx_k_wz), 0, 0, 1, 1},
     {&__pyx_n_s_x, __pyx_k_x, sizeof(__pyx_k_x), 0, 0, 1, 1},
     {&__pyx_n_s_x0, __pyx_k_x0, sizeof(__pyx_k_x0), 0, 0, 1, 1},
     {&__pyx_n_s_xsum, __pyx_k_xsum, sizeof(__pyx_k_xsum), 0, 0, 1, 1},
@@ -81834,17 +83054,17 @@
     {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
     {0, 0, 0, 0, 0, 0, 0}
   };
   return __Pyx_InitStrings(__pyx_string_tab);
 }
 /* #### Code section: cached_builtins ### */
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 180, __pyx_L1_error)
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 214, __pyx_L1_error)
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 191, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 225, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 225, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 68, __pyx_L1_error)
   __pyx_builtin___import__ = __Pyx_GetBuiltinName(__pyx_n_s_import); if (!__pyx_builtin___import__) __PYX_ERR(1, 100, __pyx_L1_error)
   __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(1, 159, __pyx_L1_error)
   __pyx_builtin_AssertionError = __Pyx_GetBuiltinName(__pyx_n_s_AssertionError); if (!__pyx_builtin_AssertionError) __PYX_ERR(1, 373, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(1, 408, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(1, 618, __pyx_L1_error)
   __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(1, 914, __pyx_L1_error)
@@ -81891,72 +83111,72 @@
  *         from pickle import PickleError as __pyx_PickleError
  *         raise __pyx_PickleError, "Incompatible checksums (0x%x vs (0x82a3537, 0x6ae9995, 0xb068931) = (name))" % __pyx_checksum
  */
   __pyx_tuple__8 = PyTuple_Pack(3, __pyx_int_136983863, __pyx_int_112105877, __pyx_int_184977713); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__8);
   __Pyx_GIVEREF(__pyx_tuple__8);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":986
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":986
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
   __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(4, 986, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__9);
   __Pyx_GIVEREF(__pyx_tuple__9);
 
-  /* "../../../../private/var/folders/w5/99_dvybs2zd1g4mrt3lhm1h40000gn/T/pip-build-env-0oj8lqxx/overlay/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":992
+  /* "../../.virtualenvs/kimi/lib/python3.11/site-packages/numpy/__init__.cython-30.pxd":992
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
   __pyx_tuple__10 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(4, 992, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__10);
   __Pyx_GIVEREF(__pyx_tuple__10);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":98
+  /* "ext/skeletontricks/skeletontricks.pyx":109
  *   """
  *   if edges.size == 0:
  *     return np.zeros((0,), dtype=np.uint32)             # <<<<<<<<<<<<<<
  * 
  *   edges = np.ascontiguousarray(edges)
  */
-  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_int_0); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 98, __pyx_L1_error)
+  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_int_0); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__11);
   __Pyx_GIVEREF(__pyx_tuple__11);
-  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_tuple__11); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 98, __pyx_L1_error)
+  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_tuple__11); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__12);
   __Pyx_GIVEREF(__pyx_tuple__12);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_kp_s_No_matching_signature_found); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__15);
   __Pyx_GIVEREF(__pyx_tuple__15);
-  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_kp_s_Function_call_with_ambiguous_arg); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__16);
   __Pyx_GIVEREF(__pyx_tuple__16);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":365
+  /* "ext/skeletontricks/skeletontricks.pyx":427
  *     cnp.ndarray[float, ndim=3] DBF,
  *     path, float scale, float const,
  *     anisotropy=(1,1,1),             # <<<<<<<<<<<<<<
  *     invalid_vertices={},
  *   ):
  */
-  __pyx_tuple__17 = PyTuple_Pack(3, __pyx_int_1, __pyx_int_1, __pyx_int_1); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 365, __pyx_L1_error)
+  __pyx_tuple__17 = PyTuple_Pack(3, __pyx_int_1, __pyx_int_1, __pyx_int_1); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 427, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__17);
   __Pyx_GIVEREF(__pyx_tuple__17);
 
   /* "View.MemoryView":100
  * cdef object __pyx_collections_abc_Sequence "__pyx_collections_abc_Sequence"
  * try:
  *     if __import__("sys").version_info >= (3, 3):             # <<<<<<<<<<<<<<
@@ -82053,262 +83273,277 @@
  *     cdef object __pyx_result
  */
   __pyx_tuple__27 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__27);
   __Pyx_GIVEREF(__pyx_tuple__27);
   __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle_Enum, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(1, 1, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":90
+  /* "ext/skeletontricks/skeletontricks.pyx":101
  *   )
  * 
  * def find_cycle(cnp.ndarray[int32_t, ndim=2] edges):             # <<<<<<<<<<<<<<
  *   """
  *   Given a graph of edges that are a single connected component,
  */
-  __pyx_tuple__29 = PyTuple_Pack(2, __pyx_n_s_edges, __pyx_n_s_elist); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 90, __pyx_L1_error)
+  __pyx_tuple__29 = PyTuple_Pack(2, __pyx_n_s_edges, __pyx_n_s_elist); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 101, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__29);
   __Pyx_GIVEREF(__pyx_tuple__29);
-  __pyx_codeobj__30 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_cycle, 90, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 90, __pyx_L1_error)
+  __pyx_codeobj__30 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_cycle, 101, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 101, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":110
+  /* "ext/skeletontricks/skeletontricks.pyx":121
  *   return elist
  * 
  * def create_distance_graph(skeleton):             # <<<<<<<<<<<<<<
  *   """
  *   Creates the distance "supergraph" from a single connected component
  */
-  __pyx_tuple__31 = PyTuple_Pack(14, __pyx_n_s_skeleton, __pyx_n_s_vertices, __pyx_n_s_edges, __pyx_n_s_unique_nodes, __pyx_n_s_unique_counts, __pyx_n_s_terminal_nodes, __pyx_n_s_branch_nodes, __pyx_n_s_critical_points, __pyx_n_s_res, __pyx_n_s_supergraph, __pyx_n_s_real_supergraph, __pyx_n_s_key, __pyx_n_s_e1, __pyx_n_s_e2); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_tuple__31 = PyTuple_Pack(14, __pyx_n_s_skeleton, __pyx_n_s_vertices, __pyx_n_s_edges, __pyx_n_s_unique_nodes, __pyx_n_s_unique_counts, __pyx_n_s_terminal_nodes, __pyx_n_s_branch_nodes, __pyx_n_s_critical_points, __pyx_n_s_res, __pyx_n_s_supergraph, __pyx_n_s_real_supergraph, __pyx_n_s_key, __pyx_n_s_e1, __pyx_n_s_e2); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 121, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__31);
   __Pyx_GIVEREF(__pyx_tuple__31);
-  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_create_distance_graph, 110, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_create_distance_graph, 121, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 121, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":162
+  /* "ext/skeletontricks/skeletontricks.pyx":173
  * 
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__33 = PyTuple_Pack(7, __pyx_n_s_field, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 162, __pyx_L1_error)
+  __pyx_tuple__33 = PyTuple_Pack(7, __pyx_n_s_field, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 173, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__33);
   __Pyx_GIVEREF(__pyx_tuple__33);
-  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_inf2zero, 162, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 162, __pyx_L1_error)
+  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_inf2zero, 173, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 173, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":188
+  /* "ext/skeletontricks/skeletontricks.pyx":199
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_codeobj__35 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_zero2inf, 188, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__35)) __PYX_ERR(0, 188, __pyx_L1_error)
+  __pyx_codeobj__35 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_zero2inf, 199, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__35)) __PYX_ERR(0, 199, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__36 = PyTuple_Pack(8, __pyx_n_s_field, __pyx_n_s_leave_alone, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_tuple__36 = PyTuple_Pack(8, __pyx_n_s_field, __pyx_n_s_leave_alone, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__36);
   __Pyx_GIVEREF(__pyx_tuple__36);
-  __pyx_codeobj__37 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__36, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_zero_out_all_except, 214, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__37)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_codeobj__37 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__36, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_zero_out_all_except, 225, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__37)) __PYX_ERR(0, 225, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":240
+  /* "ext/skeletontricks/skeletontricks.pyx":251
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__38 = PyTuple_Pack(8, __pyx_n_s_field, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_maximum); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 240, __pyx_L1_error)
+  __pyx_tuple__38 = PyTuple_Pack(8, __pyx_n_s_field, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_maximum); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 251, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__38);
   __Pyx_GIVEREF(__pyx_tuple__38);
-  __pyx_codeobj__39 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_finite_max, 240, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__39)) __PYX_ERR(0, 240, __pyx_L1_error)
+  __pyx_codeobj__39 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_finite_max, 251, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__39)) __PYX_ERR(0, 251, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":266
+  /* "ext/skeletontricks/skeletontricks.pyx":277
  *   return maximum
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__40 = PyTuple_Pack(8, __pyx_n_s_field, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_minimum); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 266, __pyx_L1_error)
+  __pyx_tuple__40 = PyTuple_Pack(8, __pyx_n_s_field, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_minimum); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 277, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__40);
   __Pyx_GIVEREF(__pyx_tuple__40);
-  __pyx_codeobj__41 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_finite_min, 266, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__41)) __PYX_ERR(0, 266, __pyx_L1_error)
+  __pyx_codeobj__41 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_finite_min, 277, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__41)) __PYX_ERR(0, 277, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":292
+  /* "ext/skeletontricks/skeletontricks.pyx":303
  *   return minimum
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__42 = PyTuple_Pack(7, __pyx_n_s_labels, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 292, __pyx_L1_error)
+  __pyx_tuple__42 = PyTuple_Pack(7, __pyx_n_s_labels, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 303, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__42);
   __Pyx_GIVEREF(__pyx_tuple__42);
-  __pyx_codeobj__43 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__42, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_first_label, 292, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__43)) __PYX_ERR(0, 292, __pyx_L1_error)
+  __pyx_codeobj__43 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__42, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_first_label, 303, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__43)) __PYX_ERR(0, 303, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":316
+  /* "ext/skeletontricks/skeletontricks.pyx":327
  *   return None
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__44 = PyTuple_Pack(12, __pyx_n_s_labels, __pyx_n_s_PDRF, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_mx, __pyx_n_s_my, __pyx_n_s_mz, __pyx_n_s_maxpdrf); if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 316, __pyx_L1_error)
+  __pyx_tuple__44 = PyTuple_Pack(12, __pyx_n_s_labels, __pyx_n_s_PDRF, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_mx, __pyx_n_s_my, __pyx_n_s_mz, __pyx_n_s_maxpdrf); if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__44);
   __Pyx_GIVEREF(__pyx_tuple__44);
-  __pyx_codeobj__45 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__44, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_target, 316, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__45)) __PYX_ERR(0, 316, __pyx_L1_error)
+  __pyx_codeobj__45 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__44, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_target, 327, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__45)) __PYX_ERR(0, 327, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":358
- * 
+  /* "ext/skeletontricks/skeletontricks.pyx":368
+ *   return (mx, my, mz)
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__46 = PyTuple_Pack(29, __pyx_n_s_labels, __pyx_n_s_DBF, __pyx_n_s_path, __pyx_n_s_scale, __pyx_n_s_const, __pyx_n_s_anisotropy, __pyx_n_s_invalid_vertices, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_wz, __pyx_n_s_radius, __pyx_n_s_dist, __pyx_n_s_minx, __pyx_n_s_maxx, __pyx_n_s_miny, __pyx_n_s_maxy, __pyx_n_s_minz, __pyx_n_s_maxz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_x0, __pyx_n_s_y0, __pyx_n_s_z0, __pyx_n_s_invalidated, __pyx_n_s_coord); if (unlikely(!__pyx_tuple__46)) __PYX_ERR(0, 358, __pyx_L1_error)
+  __pyx_tuple__46 = PyTuple_Pack(23, __pyx_n_s_labels, __pyx_n_s_DBF, __pyx_n_s_scale, __pyx_n_s_constant, __pyx_n_s_anisotropy, __pyx_n_s_path, __pyx_n_s_voxel_connectivity_graph, __pyx_n_s_connectivity, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_sxy, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_wz, __pyx_n_s_max_distances, __pyx_n_s_vcg, __pyx_n_s_vcg_arr, __pyx_n_s_invalidated, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_coord); if (unlikely(!__pyx_tuple__46)) __PYX_ERR(0, 368, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__46);
   __Pyx_GIVEREF(__pyx_tuple__46);
-  __pyx_codeobj__47 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 29, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__46, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_roll_invalidation_ball, 358, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__47)) __PYX_ERR(0, 358, __pyx_L1_error)
+  __pyx_codeobj__47 = (PyObject*)__Pyx_PyCode_New(8, 0, 0, 23, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__46, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_roll_invalidation_ball_inside_co, 368, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__47)) __PYX_ERR(0, 368, __pyx_L1_error)
+  __pyx_tuple__48 = PyTuple_Pack(2, Py_None, ((PyObject *)__pyx_int_26)); if (unlikely(!__pyx_tuple__48)) __PYX_ERR(0, 368, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__48);
+  __Pyx_GIVEREF(__pyx_tuple__48);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":419
+ *   return (invalidated, labels)
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
+ * @cython.wraparound(False)  # turn off negative index wrapping for entire function
+ * @cython.nonecheck(False)
+ */
+  __pyx_tuple__49 = PyTuple_Pack(29, __pyx_n_s_labels, __pyx_n_s_DBF, __pyx_n_s_path, __pyx_n_s_scale, __pyx_n_s_const, __pyx_n_s_anisotropy, __pyx_n_s_invalid_vertices, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_wz, __pyx_n_s_radius, __pyx_n_s_dist, __pyx_n_s_minx, __pyx_n_s_maxx, __pyx_n_s_miny, __pyx_n_s_maxy, __pyx_n_s_minz, __pyx_n_s_maxz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_x0, __pyx_n_s_y0, __pyx_n_s_z0, __pyx_n_s_invalidated, __pyx_n_s_coord); if (unlikely(!__pyx_tuple__49)) __PYX_ERR(0, 419, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__49);
+  __Pyx_GIVEREF(__pyx_tuple__49);
+  __pyx_codeobj__50 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 29, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__49, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_roll_invalidation_ball, 419, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__50)) __PYX_ERR(0, 419, __pyx_L1_error)
+
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__48 = PyTuple_Pack(10, __pyx_n_s_orig_labels, __pyx_n_s_cc_labels, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_remap, __pyx_n_s_last_label); if (unlikely(!__pyx_tuple__48)) __PYX_ERR(0, 428, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__48);
-  __Pyx_GIVEREF(__pyx_tuple__48);
-  __pyx_codeobj__49 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__48, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_get_mapping, 428, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__49)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_tuple__51 = PyTuple_Pack(10, __pyx_n_s_orig_labels, __pyx_n_s_cc_labels, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_remap, __pyx_n_s_last_label); if (unlikely(!__pyx_tuple__51)) __PYX_ERR(0, 485, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__51);
+  __Pyx_GIVEREF(__pyx_tuple__51);
+  __pyx_codeobj__52 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__51, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_get_mapping, 485, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__52)) __PYX_ERR(0, 485, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":473
+  /* "ext/skeletontricks/skeletontricks.pyx":526
  *   return remap
  * 
- * def compute_centroids(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def compute_centroids(
  *     cnp.ndarray[UINT, ndim=2] labels,
- *     float wx, float wy
  */
-  __pyx_tuple__50 = PyTuple_Pack(16, __pyx_n_s_labels, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_xsum, __pyx_n_s_ysum, __pyx_n_s_labelct, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_label, __pyx_n_s_result, __pyx_n_s_cx, __pyx_n_s_cy, __pyx_n_s_px, __pyx_n_s_py); if (unlikely(!__pyx_tuple__50)) __PYX_ERR(0, 473, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__50);
-  __Pyx_GIVEREF(__pyx_tuple__50);
-  __pyx_codeobj__51 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__50, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_compute_centroids, 473, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__51)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_tuple__53 = PyTuple_Pack(16, __pyx_n_s_labels, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_xsum, __pyx_n_s_ysum, __pyx_n_s_labelct, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_label, __pyx_n_s_result, __pyx_n_s_cx, __pyx_n_s_cy, __pyx_n_s_px, __pyx_n_s_py); if (unlikely(!__pyx_tuple__53)) __PYX_ERR(0, 526, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__53);
+  __Pyx_GIVEREF(__pyx_tuple__53);
+  __pyx_codeobj__54 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__53, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_compute_centroids, 526, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__54)) __PYX_ERR(0, 526, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":540
+  /* "ext/skeletontricks/skeletontricks.pyx":589
  *   return result
  * 
- * def find_border_targets(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def find_border_targets(
  *     cnp.ndarray[float, ndim=2] dt,
- *     cnp.ndarray[UINT, ndim=2] cc_labels,
  */
-  __pyx_tuple__52 = PyTuple_Pack(16, __pyx_n_s_dt, __pyx_n_s_cc_labels, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_mx, __pyx_n_s_pts, __pyx_n_s_label, __pyx_n_s_centroids, __pyx_n_s_px, __pyx_n_s_py, __pyx_n_s_centx, __pyx_n_s_centy); if (unlikely(!__pyx_tuple__52)) __PYX_ERR(0, 540, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__52);
-  __Pyx_GIVEREF(__pyx_tuple__52);
-  __pyx_codeobj__53 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__52, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_border_targets, 540, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__53)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_tuple__55 = PyTuple_Pack(16, __pyx_n_s_dt, __pyx_n_s_cc_labels, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_mx, __pyx_n_s_pts, __pyx_n_s_label, __pyx_n_s_centroids, __pyx_n_s_px, __pyx_n_s_py, __pyx_n_s_centx, __pyx_n_s_centy); if (unlikely(!__pyx_tuple__55)) __PYX_ERR(0, 589, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__55);
+  __Pyx_GIVEREF(__pyx_tuple__55);
+  __pyx_codeobj__56 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__55, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_border_targets, 589, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__56)) __PYX_ERR(0, 589, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":605
+  /* "ext/skeletontricks/skeletontricks.pyx":649
  *   return pts
  * 
  * def compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *     float px, float py,
  *     float x, float y,
  */
-  __pyx_tuple__54 = PyTuple_Pack(14, __pyx_n_s_px, __pyx_n_s_py, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_centx, __pyx_n_s_centy, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_cx, __pyx_n_s_cy, __pyx_n_s_dist1, __pyx_n_s_dist2); if (unlikely(!__pyx_tuple__54)) __PYX_ERR(0, 605, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__54);
-  __Pyx_GIVEREF(__pyx_tuple__54);
-  __pyx_codeobj__55 = (PyObject*)__Pyx_PyCode_New(10, 0, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__54, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_compute_tiebreaker_maxima, 605, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__55)) __PYX_ERR(0, 605, __pyx_L1_error)
+  __pyx_tuple__57 = PyTuple_Pack(14, __pyx_n_s_px, __pyx_n_s_py, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_centx, __pyx_n_s_centy, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_cx, __pyx_n_s_cy, __pyx_n_s_dist1, __pyx_n_s_dist2); if (unlikely(!__pyx_tuple__57)) __PYX_ERR(0, 649, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__57);
+  __Pyx_GIVEREF(__pyx_tuple__57);
+  __pyx_codeobj__58 = (PyObject*)__Pyx_PyCode_New(10, 0, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__57, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_compute_tiebreaker_maxima, 649, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__58)) __PYX_ERR(0, 649, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":717
+  /* "ext/skeletontricks/skeletontricks.pyx":761
  *   return p1x * p1x + p1y * p1y
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__56 = PyTuple_Pack(17, __pyx_n_s_labels, __pyx_n_s_DBF, __pyx_n_s_path, __pyx_n_s_scale, __pyx_n_s_const, __pyx_n_s_anisotropy, __pyx_n_s_invalid_vertices, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_sxy, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_wz, __pyx_n_s_pathview, __pyx_n_s_invalidated, __pyx_n_s_coord); if (unlikely(!__pyx_tuple__56)) __PYX_ERR(0, 717, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__56);
-  __Pyx_GIVEREF(__pyx_tuple__56);
-  __pyx_codeobj__57 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__56, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_roll_invalidation_cube, 717, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__57)) __PYX_ERR(0, 717, __pyx_L1_error)
+  __pyx_tuple__59 = PyTuple_Pack(17, __pyx_n_s_labels, __pyx_n_s_DBF, __pyx_n_s_path, __pyx_n_s_scale, __pyx_n_s_const, __pyx_n_s_anisotropy, __pyx_n_s_invalid_vertices, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_sxy, __pyx_n_s_wx, __pyx_n_s_wy, __pyx_n_s_wz, __pyx_n_s_pathview, __pyx_n_s_invalidated, __pyx_n_s_coord); if (unlikely(!__pyx_tuple__59)) __PYX_ERR(0, 761, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__59);
+  __Pyx_GIVEREF(__pyx_tuple__59);
+  __pyx_codeobj__60 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__59, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_roll_invalidation_cube, 761, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__60)) __PYX_ERR(0, 761, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":769
+  /* "ext/skeletontricks/skeletontricks.pyx":806
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_tuple__58 = PyTuple_Pack(15, __pyx_n_s_edges, __pyx_n_s_index, __pyx_n_s_visited, __pyx_n_s_e1, __pyx_n_s_e2, __pyx_n_s_root, __pyx_n_s_node, __pyx_n_s_child, __pyx_n_s_parent, __pyx_n_s_depth, __pyx_n_s_i, __pyx_n_s_stack, __pyx_n_s_parents, __pyx_n_s_depth_stack, __pyx_n_s_path); if (unlikely(!__pyx_tuple__58)) __PYX_ERR(0, 769, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__58);
-  __Pyx_GIVEREF(__pyx_tuple__58);
-  __pyx_codeobj__59 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__58, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_cycle_cython, 769, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__59)) __PYX_ERR(0, 769, __pyx_L1_error)
+  __pyx_tuple__61 = PyTuple_Pack(15, __pyx_n_s_edges, __pyx_n_s_index, __pyx_n_s_visited, __pyx_n_s_e1, __pyx_n_s_e2, __pyx_n_s_root, __pyx_n_s_node, __pyx_n_s_child, __pyx_n_s_parent, __pyx_n_s_depth, __pyx_n_s_i, __pyx_n_s_stack, __pyx_n_s_parents, __pyx_n_s_depth_stack, __pyx_n_s_path); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 806, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__61);
+  __Pyx_GIVEREF(__pyx_tuple__61);
+  __pyx_codeobj__62 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__61, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_cycle_cython, 806, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__62)) __PYX_ERR(0, 806, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
-  __pyx_tuple__61 = PyTuple_Pack(20, __pyx_n_s_labels, __pyx_n_s_cx, __pyx_n_s_cy, __pyx_n_s_cz, __pyx_n_s_background, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_voxels, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_label, __pyx_n_s_changes, __pyx_n_s_allowed_differences, __pyx_n_s_uniq, __pyx_n_s_cts, __pyx_n_s_candidate_fruit_index, __pyx_n_s_differences, __pyx_n_s__60); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 836, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__61);
-  __Pyx_GIVEREF(__pyx_tuple__61);
-  __pyx_codeobj__62 = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 20, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__61, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_avocado_fruit, 836, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__62)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_tuple__64 = PyTuple_Pack(20, __pyx_n_s_labels, __pyx_n_s_cx, __pyx_n_s_cy, __pyx_n_s_cz, __pyx_n_s_background, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_voxels, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_label, __pyx_n_s_changes, __pyx_n_s_allowed_differences, __pyx_n_s_uniq, __pyx_n_s_cts, __pyx_n_s_candidate_fruit_index, __pyx_n_s_differences, __pyx_n_s__63); if (unlikely(!__pyx_tuple__64)) __PYX_ERR(0, 873, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__64);
+  __Pyx_GIVEREF(__pyx_tuple__64);
+  __pyx_codeobj__65 = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 20, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__64, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_avocado_fruit, 873, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__65)) __PYX_ERR(0, 873, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":927
+  /* "ext/skeletontricks/skeletontricks.pyx":964
  * 
  * class CachedTargetFinder:
  *   def __init__(self, mask: np.ndarray, daf: np.ndarray):             # <<<<<<<<<<<<<<
  *     """
  *     From DAF, compute a sorted list of the maximum values
  */
-  __pyx_tuple__63 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_mask, __pyx_n_s_daf, __pyx_n_s_mask_indices, __pyx_n_s_daf_sort); if (unlikely(!__pyx_tuple__63)) __PYX_ERR(0, 927, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__63);
-  __Pyx_GIVEREF(__pyx_tuple__63);
-  __pyx_codeobj__64 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__63, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_init, 927, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__64)) __PYX_ERR(0, 927, __pyx_L1_error)
+  __pyx_tuple__66 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_mask, __pyx_n_s_daf, __pyx_n_s_mask_indices, __pyx_n_s_daf_sort); if (unlikely(!__pyx_tuple__66)) __PYX_ERR(0, 964, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__66);
+  __Pyx_GIVEREF(__pyx_tuple__66);
+  __pyx_codeobj__67 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__66, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_init, 964, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__67)) __PYX_ERR(0, 964, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":936
+  /* "ext/skeletontricks/skeletontricks.pyx":973
  *     self.daf_indices = mask_indices[daf_sort]
  * 
  *   def find_target(self, mask: np.ndarray):             # <<<<<<<<<<<<<<
  *     """
  *     Find the coordinate of a voxel corresponding
  */
-  __pyx_tuple__65 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_mask, __pyx_n_s_first_positive_index); if (unlikely(!__pyx_tuple__65)) __PYX_ERR(0, 936, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__65);
-  __Pyx_GIVEREF(__pyx_tuple__65);
-  __pyx_codeobj__66 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__65, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_target, 936, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__66)) __PYX_ERR(0, 936, __pyx_L1_error)
+  __pyx_tuple__68 = PyTuple_Pack(3, __pyx_n_s_self, __pyx_n_s_mask, __pyx_n_s_first_positive_index); if (unlikely(!__pyx_tuple__68)) __PYX_ERR(0, 973, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__68);
+  __Pyx_GIVEREF(__pyx_tuple__68);
+  __pyx_codeobj__69 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__68, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_find_target, 973, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__69)) __PYX_ERR(0, 973, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":957
+  /* "ext/skeletontricks/skeletontricks.pyx":994
  *     return np.unravel_index(self.daf_indices[0], mask.shape, order='F')
  * 
  *   @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  *   @cython.wraparound(False)  # turn off negative index wrapping for entire function
  *   @cython.nonecheck(False)
  */
-  __pyx_tuple__67 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_labels, __pyx_n_s_indices, __pyx_n_s_length, __pyx_n_s_i, __pyx_n_s_label_index); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 957, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__67);
-  __Pyx_GIVEREF(__pyx_tuple__67);
-  __pyx_codeobj__68 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__67, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_first_label_indexed, 957, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__68)) __PYX_ERR(0, 957, __pyx_L1_error)
+  __pyx_tuple__70 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_labels, __pyx_n_s_indices, __pyx_n_s_length, __pyx_n_s_i, __pyx_n_s_label_index); if (unlikely(!__pyx_tuple__70)) __PYX_ERR(0, 994, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__70);
+  __Pyx_GIVEREF(__pyx_tuple__70);
+  __pyx_codeobj__71 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__70, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_first_label_indexed, 994, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__71)) __PYX_ERR(0, 994, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":976
+  /* "ext/skeletontricks/skeletontricks.pyx":1013
  *     return None
  * 
  * def extract_edges_from_binary_image(uint8_t[:,:,:] binimg, int connectivity = 26):             # <<<<<<<<<<<<<<
  *   cdef uint64_t sx, sy, sz
  *   sx, sy, sz = tuple(binimg.shape)[:3]
  */
-  __pyx_tuple__69 = PyTuple_Pack(22, __pyx_n_s_binimg, __pyx_n_s_connectivity, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_sxy, __pyx_n_s_edges, __pyx_n_s_numbering, __pyx_n_s_i, __pyx_n_s_edge, __pyx_n_s_v, __pyx_n_s_inumbering, __pyx_n_s_vertices, __pyx_n_s_loc, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_int_edges, __pyx_n_s_v1, __pyx_n_s_v2, __pyx_n_s_k, __pyx_n_s_v); if (unlikely(!__pyx_tuple__69)) __PYX_ERR(0, 976, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__69);
-  __Pyx_GIVEREF(__pyx_tuple__69);
-  __pyx_codeobj__70 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 22, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__69, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_extract_edges_from_binary_image, 976, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__70)) __PYX_ERR(0, 976, __pyx_L1_error)
+  __pyx_tuple__72 = PyTuple_Pack(22, __pyx_n_s_binimg, __pyx_n_s_connectivity, __pyx_n_s_sx, __pyx_n_s_sy, __pyx_n_s_sz, __pyx_n_s_sxy, __pyx_n_s_edges, __pyx_n_s_numbering, __pyx_n_s_i, __pyx_n_s_edge, __pyx_n_s_v, __pyx_n_s_inumbering, __pyx_n_s_vertices, __pyx_n_s_loc, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_z, __pyx_n_s_int_edges, __pyx_n_s_v1, __pyx_n_s_v2, __pyx_n_s_k, __pyx_n_s_v); if (unlikely(!__pyx_tuple__72)) __PYX_ERR(0, 1013, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__72);
+  __Pyx_GIVEREF(__pyx_tuple__72);
+  __pyx_codeobj__73 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 22, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__72, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_ext_skeletontricks_skeletontrick, __pyx_n_s_extract_edges_from_binary_image, 1013, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__73)) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 /* #### Code section: init_constants ### */
@@ -82324,14 +83559,15 @@
   __pyx_umethod_PySet_Type_update.method_name = &__pyx_n_s_update;
   if (__Pyx_CreateStringTabAndInitStrings() < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_3 = PyInt_FromLong(3); if (unlikely(!__pyx_int_3)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_4 = PyInt_FromLong(4); if (unlikely(!__pyx_int_4)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_26 = PyInt_FromLong(26); if (unlikely(!__pyx_int_26)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_112105877 = PyInt_FromLong(112105877L); if (unlikely(!__pyx_int_112105877)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_136983863 = PyInt_FromLong(136983863L); if (unlikely(!__pyx_int_136983863)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_184977713 = PyInt_FromLong(184977713L); if (unlikely(!__pyx_int_184977713)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_4294967295 = PyInt_FromString((char *)"4294967295", 0, 0); if (unlikely(!__pyx_int_4294967295)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
@@ -82570,53 +83806,53 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(5, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_3_0_10(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_3_0_8(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyTypeObject),
   #elif CYTHON_COMPILING_IN_LIMITED_API
-  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(5, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(5, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(6, 8, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4bool_bool = __Pyx_ImportType_3_0_10(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "bool", sizeof(PyBoolObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyBoolObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_7cpython_4bool_bool) __PYX_ERR(6, 8, __pyx_L1_error)
+  __pyx_ptype_7cpython_4bool_bool = __Pyx_ImportType_3_0_8(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "bool", sizeof(PyBoolObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyBoolObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_7cpython_4bool_bool) __PYX_ERR(6, 8, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(7, 15, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_7complex_complex = __Pyx_ImportType_3_0_10(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "complex", sizeof(PyComplexObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyComplexObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_7cpython_7complex_complex) __PYX_ERR(7, 15, __pyx_L1_error)
+  __pyx_ptype_7cpython_7complex_complex = __Pyx_ImportType_3_0_8(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "complex", sizeof(PyComplexObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyComplexObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_7cpython_7complex_complex) __PYX_ERR(7, 15, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("array"); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 69, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_5array_array = __Pyx_ImportType_3_0_10(__pyx_t_1, "array", "array", sizeof(arrayobject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(arrayobject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_7cpython_5array_array) __PYX_ERR(3, 69, __pyx_L1_error)
+  __pyx_ptype_7cpython_5array_array = __Pyx_ImportType_3_0_8(__pyx_t_1, "array", "array", sizeof(arrayobject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(arrayobject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_7cpython_5array_array) __PYX_ERR(3, 69, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 202, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_3_0_10); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(4, 202, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_3_0_10); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(4, 225, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_3_0_10); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(4, 229, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_3_0_10); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(4, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(4, 812, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_number) __PYX_ERR(4, 814, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(4, 816, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(4, 818, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(4, 820, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(4, 822, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(4, 824, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(4, 826, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(4, 828, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_10); if (!__pyx_ptype_5numpy_character) __PYX_ERR(4, 830, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_3_0_10(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_10(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_3_0_10); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(4, 868, __pyx_L1_error)
+  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_3_0_8); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(4, 202, __pyx_L1_error)
+  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_3_0_8); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(4, 225, __pyx_L1_error)
+  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_3_0_8); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(4, 229, __pyx_L1_error)
+  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_3_0_8); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(4, 238, __pyx_L1_error)
+  __pyx_ptype_5numpy_generic = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(4, 812, __pyx_L1_error)
+  __pyx_ptype_5numpy_number = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_number) __PYX_ERR(4, 814, __pyx_L1_error)
+  __pyx_ptype_5numpy_integer = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(4, 816, __pyx_L1_error)
+  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(4, 818, __pyx_L1_error)
+  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(4, 820, __pyx_L1_error)
+  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(4, 822, __pyx_L1_error)
+  __pyx_ptype_5numpy_floating = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(4, 824, __pyx_L1_error)
+  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(4, 826, __pyx_L1_error)
+  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(4, 828, __pyx_L1_error)
+  __pyx_ptype_5numpy_character = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_8); if (!__pyx_ptype_5numpy_character) __PYX_ERR(4, 830, __pyx_L1_error)
+  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_3_0_8(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_8(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_3_0_8); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(4, 868, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -83488,762 +84724,775 @@
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_7 = __Pyx_ImportFrom(__pyx_t_4, __pyx_n_s_defaultdict); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 46, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_defaultdict, __pyx_t_7) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":90
+  /* "ext/skeletontricks/skeletontricks.pyx":101
  *   )
  * 
  * def find_cycle(cnp.ndarray[int32_t, ndim=2] edges):             # <<<<<<<<<<<<<<
  *   """
  *   Given a graph of edges that are a single connected component,
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_1find_cycle, 0, __pyx_n_s_find_cycle, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 90, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_1find_cycle, 0, __pyx_n_s_find_cycle, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 101, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_cycle, __pyx_t_4) < 0) __PYX_ERR(0, 90, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_cycle, __pyx_t_4) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":110
+  /* "ext/skeletontricks/skeletontricks.pyx":121
  *   return elist
  * 
  * def create_distance_graph(skeleton):             # <<<<<<<<<<<<<<
  *   """
  *   Creates the distance "supergraph" from a single connected component
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_3create_distance_graph, 0, __pyx_n_s_create_distance_graph, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_3create_distance_graph, 0, __pyx_n_s_create_distance_graph, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 121, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_create_distance_graph, __pyx_t_4) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_create_distance_graph, __pyx_t_4) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":162
+  /* "ext/skeletontricks/skeletontricks.pyx":173
  * 
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_5inf2zero, 0, __pyx_n_s_inf2zero, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 162, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_5inf2zero, 0, __pyx_n_s_inf2zero, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 173, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_inf2zero, __pyx_t_4) < 0) __PYX_ERR(0, 162, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_inf2zero, __pyx_t_4) < 0) __PYX_ERR(0, 173, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":188
+  /* "ext/skeletontricks/skeletontricks.pyx":199
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_7zero2inf, 0, __pyx_n_s_zero2inf, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 188, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_7zero2inf, 0, __pyx_n_s_zero2inf, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_zero2inf, __pyx_t_4) < 0) __PYX_ERR(0, 188, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_zero2inf, __pyx_t_4) < 0) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":214
+  /* "ext/skeletontricks/skeletontricks.pyx":225
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_37zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_39zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int8_t, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int8_t, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_39zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_41zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int16_t, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int16_t, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_41zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_43zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int32_t, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int32_t, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_43zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_45zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int64_t, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int64_t, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_45zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_47zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint8_t, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint8_t, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_5__pyx_mdef_8kimimaro_14skeletontricks_47zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_5__pyx_mdef_8kimimaro_14skeletontricks_49zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint16_t, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint16_t, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_6__pyx_mdef_8kimimaro_14skeletontricks_49zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_6__pyx_mdef_8kimimaro_14skeletontricks_51zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint32_t, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint32_t, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_7__pyx_mdef_8kimimaro_14skeletontricks_51zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_7__pyx_mdef_8kimimaro_14skeletontricks_53zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint64_t, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint64_t, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_8__pyx_mdef_8kimimaro_14skeletontricks_53zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_8__pyx_mdef_8kimimaro_14skeletontricks_55zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_kp_s_unsigned_char, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_kp_s_unsigned_char, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_9zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_9zero_out_all_except, 0, __pyx_n_s_zero_out_all_except, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_7, sizeof(__pyx_defaults), 1)) __PYX_ERR(0, 214, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_7, sizeof(__pyx_defaults), 1)) __PYX_ERR(0, 225, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_t_7)->__pyx_arg__fused_sigindex = __pyx_t_5;
   __Pyx_GIVEREF(__pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_7)->__signatures__ = __pyx_t_4;
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_zero_out_all_except, __pyx_t_7) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_zero_out_all_except, __pyx_t_7) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":240
+  /* "ext/skeletontricks/skeletontricks.pyx":251
  *   return field
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_11finite_max, 0, __pyx_n_s_finite_max, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 240, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_11finite_max, 0, __pyx_n_s_finite_max, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 251, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_finite_max, __pyx_t_7) < 0) __PYX_ERR(0, 240, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_finite_max, __pyx_t_7) < 0) __PYX_ERR(0, 251, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":266
+  /* "ext/skeletontricks/skeletontricks.pyx":277
  *   return maximum
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_13finite_min, 0, __pyx_n_s_finite_min, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__41)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 266, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_13finite_min, 0, __pyx_n_s_finite_min, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__41)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 277, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_finite_min, __pyx_t_7) < 0) __PYX_ERR(0, 266, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_finite_min, __pyx_t_7) < 0) __PYX_ERR(0, 277, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":292
+  /* "ext/skeletontricks/skeletontricks.pyx":303
  *   return minimum
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_15first_label, 0, __pyx_n_s_first_label, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__43)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 292, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_15first_label, 0, __pyx_n_s_first_label, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__43)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 303, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_first_label, __pyx_t_7) < 0) __PYX_ERR(0, 292, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_first_label, __pyx_t_7) < 0) __PYX_ERR(0, 303, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":316
+  /* "ext/skeletontricks/skeletontricks.pyx":327
  *   return None
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_17find_target, 0, __pyx_n_s_find_target, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__45)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 316, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_17find_target, 0, __pyx_n_s_find_target, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__45)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_target, __pyx_t_7) < 0) __PYX_ERR(0, 316, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_target, __pyx_t_7) < 0) __PYX_ERR(0, 327, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":358
+  /* "ext/skeletontricks/skeletontricks.pyx":368
+ *   return (mx, my, mz)
  * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
+ * @cython.wraparound(False)  # turn off negative index wrapping for entire function
+ * @cython.nonecheck(False)
+ */
+  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_19roll_invalidation_ball_inside_component, 0, __pyx_n_s_roll_invalidation_ball_inside_co, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__47)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 368, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__48);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_roll_invalidation_ball_inside_co, __pyx_t_7) < 0) __PYX_ERR(0, 368, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+
+  /* "ext/skeletontricks/skeletontricks.pyx":419
+ *   return (invalidated, labels)
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_19roll_invalidation_ball, 0, __pyx_n_s_roll_invalidation_ball, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__47)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 358, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_21roll_invalidation_ball, 0, __pyx_n_s_roll_invalidation_ball, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__50)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 419, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_7, sizeof(__pyx_defaults1), 1)) __PYX_ERR(0, 358, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_7, sizeof(__pyx_defaults1), 1)) __PYX_ERR(0, 419, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":366
+  /* "ext/skeletontricks/skeletontricks.pyx":428
  *     path, float scale, float const,
  *     anisotropy=(1,1,1),
  *     invalid_vertices={},             # <<<<<<<<<<<<<<
  *   ):
  *   """
  */
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 366, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_t_7)->__pyx_arg_invalid_vertices = __pyx_t_4;
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_t_4 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_7, __pyx_pf_8kimimaro_14skeletontricks_192__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_roll_invalidation_ball, __pyx_t_7) < 0) __PYX_ERR(0, 358, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_7, __pyx_pf_8kimimaro_14skeletontricks_194__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_roll_invalidation_ball, __pyx_t_7) < 0) __PYX_ERR(0, 419, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":428
+  /* "ext/skeletontricks/skeletontricks.pyx":485
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(45); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(45); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_8kimimaro_14skeletontricks_57get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_0__pyx_mdef_8kimimaro_14skeletontricks_59get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_8kimimaro_14skeletontricks_59get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_1__pyx_mdef_8kimimaro_14skeletontricks_61get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_8kimimaro_14skeletontricks_61get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_2__pyx_mdef_8kimimaro_14skeletontricks_63get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_8kimimaro_14skeletontricks_63get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_3__pyx_mdef_8kimimaro_14skeletontricks_65get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_4__pyx_mdef_8kimimaro_14skeletontricks_65get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0_4__pyx_mdef_8kimimaro_14skeletontricks_67get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int8_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_8kimimaro_14skeletontricks_67get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_0__pyx_mdef_8kimimaro_14skeletontricks_69get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_8kimimaro_14skeletontricks_69get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_1__pyx_mdef_8kimimaro_14skeletontricks_71get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_8kimimaro_14skeletontricks_71get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_2__pyx_mdef_8kimimaro_14skeletontricks_73get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_8kimimaro_14skeletontricks_73get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_3__pyx_mdef_8kimimaro_14skeletontricks_75get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_4__pyx_mdef_8kimimaro_14skeletontricks_75get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1_4__pyx_mdef_8kimimaro_14skeletontricks_77get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int16_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_0__pyx_mdef_8kimimaro_14skeletontricks_77get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_0__pyx_mdef_8kimimaro_14skeletontricks_79get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_1__pyx_mdef_8kimimaro_14skeletontricks_79get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_1__pyx_mdef_8kimimaro_14skeletontricks_81get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_2__pyx_mdef_8kimimaro_14skeletontricks_81get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_2__pyx_mdef_8kimimaro_14skeletontricks_83get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_3__pyx_mdef_8kimimaro_14skeletontricks_83get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_3__pyx_mdef_8kimimaro_14skeletontricks_85get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_4__pyx_mdef_8kimimaro_14skeletontricks_85get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2_4__pyx_mdef_8kimimaro_14skeletontricks_87get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int32_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_0__pyx_mdef_8kimimaro_14skeletontricks_87get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_0__pyx_mdef_8kimimaro_14skeletontricks_89get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_1__pyx_mdef_8kimimaro_14skeletontricks_89get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_1__pyx_mdef_8kimimaro_14skeletontricks_91get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_2__pyx_mdef_8kimimaro_14skeletontricks_91get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_2__pyx_mdef_8kimimaro_14skeletontricks_93get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_3__pyx_mdef_8kimimaro_14skeletontricks_93get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_3__pyx_mdef_8kimimaro_14skeletontricks_95get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_4__pyx_mdef_8kimimaro_14skeletontricks_95get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3_4__pyx_mdef_8kimimaro_14skeletontricks_97get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_int64_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_0__pyx_mdef_8kimimaro_14skeletontricks_97get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_0__pyx_mdef_8kimimaro_14skeletontricks_99get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_1__pyx_mdef_8kimimaro_14skeletontricks_99get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_1__pyx_mdef_8kimimaro_14skeletontricks_101get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_2__pyx_mdef_8kimimaro_14skeletontricks_101get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_2__pyx_mdef_8kimimaro_14skeletontricks_103get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_3__pyx_mdef_8kimimaro_14skeletontricks_103get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_3__pyx_mdef_8kimimaro_14skeletontricks_105get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_4__pyx_mdef_8kimimaro_14skeletontricks_105get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4_4__pyx_mdef_8kimimaro_14skeletontricks_107get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint8_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_0__pyx_mdef_8kimimaro_14skeletontricks_107get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_0__pyx_mdef_8kimimaro_14skeletontricks_109get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_1__pyx_mdef_8kimimaro_14skeletontricks_109get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_1__pyx_mdef_8kimimaro_14skeletontricks_111get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_2__pyx_mdef_8kimimaro_14skeletontricks_111get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_2__pyx_mdef_8kimimaro_14skeletontricks_113get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_3__pyx_mdef_8kimimaro_14skeletontricks_113get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_3__pyx_mdef_8kimimaro_14skeletontricks_115get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_4__pyx_mdef_8kimimaro_14skeletontricks_115get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_5_4__pyx_mdef_8kimimaro_14skeletontricks_117get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint16_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_0__pyx_mdef_8kimimaro_14skeletontricks_117get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_0__pyx_mdef_8kimimaro_14skeletontricks_119get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_1__pyx_mdef_8kimimaro_14skeletontricks_119get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_1__pyx_mdef_8kimimaro_14skeletontricks_121get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_2__pyx_mdef_8kimimaro_14skeletontricks_121get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_2__pyx_mdef_8kimimaro_14skeletontricks_123get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_3__pyx_mdef_8kimimaro_14skeletontricks_123get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_3__pyx_mdef_8kimimaro_14skeletontricks_125get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_4__pyx_mdef_8kimimaro_14skeletontricks_125get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_6_4__pyx_mdef_8kimimaro_14skeletontricks_127get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint32_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_0__pyx_mdef_8kimimaro_14skeletontricks_127get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_0__pyx_mdef_8kimimaro_14skeletontricks_129get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_1__pyx_mdef_8kimimaro_14skeletontricks_129get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_1__pyx_mdef_8kimimaro_14skeletontricks_131get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_2__pyx_mdef_8kimimaro_14skeletontricks_131get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_2__pyx_mdef_8kimimaro_14skeletontricks_133get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_3__pyx_mdef_8kimimaro_14skeletontricks_133get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_3__pyx_mdef_8kimimaro_14skeletontricks_135get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_4__pyx_mdef_8kimimaro_14skeletontricks_135get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_7_4__pyx_mdef_8kimimaro_14skeletontricks_137get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_uint64_t_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_0__pyx_mdef_8kimimaro_14skeletontricks_137get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_0__pyx_mdef_8kimimaro_14skeletontricks_139get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_1__pyx_mdef_8kimimaro_14skeletontricks_139get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_1__pyx_mdef_8kimimaro_14skeletontricks_141get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_2__pyx_mdef_8kimimaro_14skeletontricks_141get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_2__pyx_mdef_8kimimaro_14skeletontricks_143get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_3__pyx_mdef_8kimimaro_14skeletontricks_143get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_3__pyx_mdef_8kimimaro_14skeletontricks_145get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_4__pyx_mdef_8kimimaro_14skeletontricks_145get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_8_4__pyx_mdef_8kimimaro_14skeletontricks_147get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_21get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_23get_mapping, 0, __pyx_n_s_get_mapping, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_4, sizeof(__pyx_defaults2), 1)) __PYX_ERR(0, 428, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_4, sizeof(__pyx_defaults2), 1)) __PYX_ERR(0, 485, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_t_4)->__pyx_arg__fused_sigindex = __pyx_t_5;
   __Pyx_GIVEREF(__pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_4)->__signatures__ = __pyx_t_7;
   __Pyx_GIVEREF(__pyx_t_7);
   __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_mapping, __pyx_t_4) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_mapping, __pyx_t_4) < 0) __PYX_ERR(0, 485, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":473
+  /* "ext/skeletontricks/skeletontricks.pyx":526
  *   return remap
  * 
- * def compute_centroids(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def compute_centroids(
  *     cnp.ndarray[UINT, ndim=2] labels,
- *     float wx, float wy
  */
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_149compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__51)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_151compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__54)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint8_t, __pyx_t_7) < 0) __PYX_ERR(0, 473, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint8_t, __pyx_t_7) < 0) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_151compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__51)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_153compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__54)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint16_t, __pyx_t_7) < 0) __PYX_ERR(0, 473, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint16_t, __pyx_t_7) < 0) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_153compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__51)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_155compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__54)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint32_t, __pyx_t_7) < 0) __PYX_ERR(0, 473, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint32_t, __pyx_t_7) < 0) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_155compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__51)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_157compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__54)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint64_t, __pyx_t_7) < 0) __PYX_ERR(0, 473, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint64_t, __pyx_t_7) < 0) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_157compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__51)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_159compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__54)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_kp_s_unsigned_char, __pyx_t_7) < 0) __PYX_ERR(0, 473, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_kp_s_unsigned_char, __pyx_t_7) < 0) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_23compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__51)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_25compute_centroids, 0, __pyx_n_s_compute_centroids, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__54)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_7, sizeof(__pyx_defaults3), 1)) __PYX_ERR(0, 473, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 473, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_7, sizeof(__pyx_defaults3), 1)) __PYX_ERR(0, 526, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_t_7)->__pyx_arg__fused_sigindex = __pyx_t_5;
   __Pyx_GIVEREF(__pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_7)->__signatures__ = __pyx_t_4;
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_centroids, __pyx_t_7) < 0) __PYX_ERR(0, 473, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_centroids, __pyx_t_7) < 0) __PYX_ERR(0, 526, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":540
+  /* "ext/skeletontricks/skeletontricks.pyx":589
  *   return result
  * 
- * def find_border_targets(             # <<<<<<<<<<<<<<
+ * @cython.binding(True)             # <<<<<<<<<<<<<<
+ * def find_border_targets(
  *     cnp.ndarray[float, ndim=2] dt,
- *     cnp.ndarray[UINT, ndim=2] cc_labels,
  */
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_161find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__53)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_163find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__56)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 540, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_uint8_t, __pyx_t_4) < 0) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_163find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__53)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_165find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__56)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 540, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_uint16_t, __pyx_t_4) < 0) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_165find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__53)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_167find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__56)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 540, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_uint32_t, __pyx_t_4) < 0) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_167find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__53)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_169find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__56)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 540, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_uint64_t, __pyx_t_4) < 0) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_169find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__53)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_171find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__56)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
-  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 540, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_kp_s_unsigned_char, __pyx_t_4) < 0) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_25find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__53)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_4 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_27find_border_targets, 0, __pyx_n_s_find_border_targets, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__56)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_4, sizeof(__pyx_defaults4), 1)) __PYX_ERR(0, 540, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 540, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_4, sizeof(__pyx_defaults4), 1)) __PYX_ERR(0, 589, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_CyFunction_Defaults(__pyx_defaults4, __pyx_t_4)->__pyx_arg__fused_sigindex = __pyx_t_5;
   __Pyx_GIVEREF(__pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_empty_tuple);
   ((__pyx_FusedFunctionObject *) __pyx_t_4)->__signatures__ = __pyx_t_7;
   __Pyx_GIVEREF(__pyx_t_7);
   __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_border_targets, __pyx_t_4) < 0) __PYX_ERR(0, 540, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_border_targets, __pyx_t_4) < 0) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":605
+  /* "ext/skeletontricks/skeletontricks.pyx":649
  *   return pts
  * 
  * def compute_tiebreaker_maxima(             # <<<<<<<<<<<<<<
  *     float px, float py,
  *     float x, float y,
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_27compute_tiebreaker_maxima, 0, __pyx_n_s_compute_tiebreaker_maxima, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__55)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 605, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_29compute_tiebreaker_maxima, 0, __pyx_n_s_compute_tiebreaker_maxima, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__58)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 649, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_tiebreaker_maxima, __pyx_t_4) < 0) __PYX_ERR(0, 605, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_tiebreaker_maxima, __pyx_t_4) < 0) __PYX_ERR(0, 649, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":717
+  /* "ext/skeletontricks/skeletontricks.pyx":761
  *   return p1x * p1x + p1y * p1y
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_29roll_invalidation_cube, 0, __pyx_n_s_roll_invalidation_cube, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__57)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 717, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_31roll_invalidation_cube, 0, __pyx_n_s_roll_invalidation_cube, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__60)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 761, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_4, sizeof(__pyx_defaults5), 1)) __PYX_ERR(0, 717, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_4, sizeof(__pyx_defaults5), 1)) __PYX_ERR(0, 761, __pyx_L1_error)
 
-  /* "ext/skeletontricks/skeletontricks.pyx":725
+  /* "ext/skeletontricks/skeletontricks.pyx":770
  *     path, float scale, float const,
  *     anisotropy=(1,1,1),
  *     invalid_vertices={},             # <<<<<<<<<<<<<<
  *   ):
  *   """
  */
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 725, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_t_4)->__pyx_arg_invalid_vertices = __pyx_t_7;
   __Pyx_GIVEREF(__pyx_t_7);
   __pyx_t_7 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_4, __pyx_pf_8kimimaro_14skeletontricks_194__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_roll_invalidation_cube, __pyx_t_4) < 0) __PYX_ERR(0, 717, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_4, __pyx_pf_8kimimaro_14skeletontricks_196__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_roll_invalidation_cube, __pyx_t_4) < 0) __PYX_ERR(0, 761, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":769
+  /* "ext/skeletontricks/skeletontricks.pyx":806
  *   return invalidated, labels
  * 
  * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)  # turn off negative index wrapping for entire function
  * @cython.nonecheck(False)
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_31find_cycle_cython, 0, __pyx_n_s_find_cycle_cython, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__59)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 769, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_33find_cycle_cython, 0, __pyx_n_s_find_cycle_cython, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 806, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_cycle_cython, __pyx_t_4) < 0) __PYX_ERR(0, 769, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_cycle_cython, __pyx_t_4) < 0) __PYX_ERR(0, 806, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":836
+  /* "ext/skeletontricks/skeletontricks.pyx":873
  *   return np.array(path, dtype=np.int32)
  * 
  * def find_avocado_fruit(             # <<<<<<<<<<<<<<
  *   cnp.ndarray[INTEGER, ndim=3] labels,
  *   size_t cx, size_t cy, size_t cz,
  */
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_173find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_0__pyx_mdef_8kimimaro_14skeletontricks_175find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int8_t, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int8_t, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_175find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_1__pyx_mdef_8kimimaro_14skeletontricks_177find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int16_t, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int16_t, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_177find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_2__pyx_mdef_8kimimaro_14skeletontricks_179find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int32_t, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int32_t, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_179find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_3__pyx_mdef_8kimimaro_14skeletontricks_181find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int64_t, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_int64_t, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_181find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_4__pyx_mdef_8kimimaro_14skeletontricks_183find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint8_t, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint8_t, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_5__pyx_mdef_8kimimaro_14skeletontricks_183find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_5__pyx_mdef_8kimimaro_14skeletontricks_185find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint16_t, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint16_t, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_6__pyx_mdef_8kimimaro_14skeletontricks_185find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_6__pyx_mdef_8kimimaro_14skeletontricks_187find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint32_t, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint32_t, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_7__pyx_mdef_8kimimaro_14skeletontricks_187find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_7__pyx_mdef_8kimimaro_14skeletontricks_189find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint64_t, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_uint64_t, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_8__pyx_mdef_8kimimaro_14skeletontricks_189find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_fuse_8__pyx_mdef_8kimimaro_14skeletontricks_191find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_kp_s_unsigned_char, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_kp_s_unsigned_char, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_33find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__62)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 836, __pyx_L1_error)
+  __pyx_t_7 = __pyx_FusedFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_35find_avocado_fruit, 0, __pyx_n_s_find_avocado_fruit, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__65)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_7, sizeof(__pyx_defaults6), 1)) __PYX_ERR(0, 836, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_7, sizeof(__pyx_defaults6), 1)) __PYX_ERR(0, 873, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_CyFunction_Defaults(__pyx_defaults6, __pyx_t_7)->__pyx_arg__fused_sigindex = __pyx_t_5;
   __Pyx_GIVEREF(__pyx_t_5);
   __pyx_t_5 = 0;
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_tuple__11);
   ((__pyx_FusedFunctionObject *) __pyx_t_7)->__signatures__ = __pyx_t_4;
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_avocado_fruit, __pyx_t_7) < 0) __PYX_ERR(0, 836, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_avocado_fruit, __pyx_t_7) < 0) __PYX_ERR(0, 873, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":926
+  /* "ext/skeletontricks/skeletontricks.pyx":963
  *   return (label, uniq[candidate_fruit_index])
  * 
  * class CachedTargetFinder:             # <<<<<<<<<<<<<<
  *   def __init__(self, mask: np.ndarray, daf: np.ndarray):
  *     """
  */
-  __pyx_t_7 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_CachedTargetFinder, __pyx_n_s_CachedTargetFinder, (PyObject *) NULL, __pyx_n_s_kimimaro_skeletontricks, (PyObject *) NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 926, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_CachedTargetFinder, __pyx_n_s_CachedTargetFinder, (PyObject *) NULL, __pyx_n_s_kimimaro_skeletontricks, (PyObject *) NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
 
-  /* "ext/skeletontricks/skeletontricks.pyx":927
+  /* "ext/skeletontricks/skeletontricks.pyx":964
  * 
  * class CachedTargetFinder:
  *   def __init__(self, mask: np.ndarray, daf: np.ndarray):             # <<<<<<<<<<<<<<
  *     """
  *     From DAF, compute a sorted list of the maximum values
  */
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 927, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 964, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_mask, __pyx_kp_s_np_ndarray) < 0) __PYX_ERR(0, 927, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_daf, __pyx_kp_s_np_ndarray) < 0) __PYX_ERR(0, 927, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_18CachedTargetFinder_1__init__, 0, __pyx_n_s_CachedTargetFinder___init, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__64)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 927, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_mask, __pyx_kp_s_np_ndarray) < 0) __PYX_ERR(0, 964, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_daf, __pyx_kp_s_np_ndarray) < 0) __PYX_ERR(0, 964, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_18CachedTargetFinder_1__init__, 0, __pyx_n_s_CachedTargetFinder___init, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__67)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 964, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_5, __pyx_t_4);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_init, __pyx_t_5) < 0) __PYX_ERR(0, 927, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_init, __pyx_t_5) < 0) __PYX_ERR(0, 964, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":936
+  /* "ext/skeletontricks/skeletontricks.pyx":973
  *     self.daf_indices = mask_indices[daf_sort]
  * 
  *   def find_target(self, mask: np.ndarray):             # <<<<<<<<<<<<<<
  *     """
  *     Find the coordinate of a voxel corresponding
  */
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 936, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 973, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_mask, __pyx_kp_s_np_ndarray) < 0) __PYX_ERR(0, 936, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_18CachedTargetFinder_3find_target, 0, __pyx_n_s_CachedTargetFinder_find_target, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__66)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 936, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_mask, __pyx_kp_s_np_ndarray) < 0) __PYX_ERR(0, 973, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_18CachedTargetFinder_3find_target, 0, __pyx_n_s_CachedTargetFinder_find_target, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__69)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 973, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_4, __pyx_t_5);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_find_target, __pyx_t_4) < 0) __PYX_ERR(0, 936, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_find_target, __pyx_t_4) < 0) __PYX_ERR(0, 973, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":957
+  /* "ext/skeletontricks/skeletontricks.pyx":994
  *     return np.unravel_index(self.daf_indices[0], mask.shape, order='F')
  * 
  *   @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  *   @cython.wraparound(False)  # turn off negative index wrapping for entire function
  *   @cython.nonecheck(False)
  */
-  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_18CachedTargetFinder_5first_label_indexed, 0, __pyx_n_s_CachedTargetFinder_first_label_i, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__68)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 957, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_18CachedTargetFinder_5first_label_indexed, 0, __pyx_n_s_CachedTargetFinder_first_label_i, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__71)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 994, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_first_label_indexed, __pyx_t_4) < 0) __PYX_ERR(0, 957, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_7, __pyx_n_s_first_label_indexed, __pyx_t_4) < 0) __PYX_ERR(0, 994, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":926
+  /* "ext/skeletontricks/skeletontricks.pyx":963
  *   return (label, uniq[candidate_fruit_index])
  * 
  * class CachedTargetFinder:             # <<<<<<<<<<<<<<
  *   def __init__(self, mask: np.ndarray, daf: np.ndarray):
  *     """
  */
-  __pyx_t_4 = __Pyx_Py3ClassCreate(((PyObject*)&PyType_Type), __pyx_n_s_CachedTargetFinder, __pyx_empty_tuple, __pyx_t_7, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 926, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_Py3ClassCreate(((PyObject*)&PyType_Type), __pyx_n_s_CachedTargetFinder, __pyx_empty_tuple, __pyx_t_7, NULL, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_CachedTargetFinder, __pyx_t_4) < 0) __PYX_ERR(0, 926, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_CachedTargetFinder, __pyx_t_4) < 0) __PYX_ERR(0, 963, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "ext/skeletontricks/skeletontricks.pyx":976
+  /* "ext/skeletontricks/skeletontricks.pyx":1013
  *     return None
  * 
  * def extract_edges_from_binary_image(uint8_t[:,:,:] binimg, int connectivity = 26):             # <<<<<<<<<<<<<<
  *   cdef uint64_t sx, sy, sz
  *   sx, sy, sz = tuple(binimg.shape)[:3]
  */
-  __pyx_t_7 = __Pyx_PyInt_From_int(((int)26)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 976, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_From_int(((int)26)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 976, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_7);
-  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7)) __PYX_ERR(0, 976, __pyx_L1_error);
+  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7)) __PYX_ERR(0, 1013, __pyx_L1_error);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_35extract_edges_from_binary_image, 0, __pyx_n_s_extract_edges_from_binary_image, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__70)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 976, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_CyFunction_New(&__pyx_mdef_8kimimaro_14skeletontricks_37extract_edges_from_binary_image, 0, __pyx_n_s_extract_edges_from_binary_image, NULL, __pyx_n_s_kimimaro_skeletontricks, __pyx_d, ((PyObject *)__pyx_codeobj__73)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_7, __pyx_t_4);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extract_edges_from_binary_image, __pyx_t_7) < 0) __PYX_ERR(0, 976, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extract_edges_from_binary_image, __pyx_t_7) < 0) __PYX_ERR(0, 1013, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
   /* "ext/skeletontricks/skeletontricks.pyx":1
  * # cython: language_level=3             # <<<<<<<<<<<<<<
  * """
  * Certain operations have to be fast for the skeletonization
  */
@@ -88854,18 +90103,18 @@
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 #endif
 
 /* TypeImport */
-  #ifndef __PYX_HAVE_RT_ImportType_3_0_10
-#define __PYX_HAVE_RT_ImportType_3_0_10
-static PyTypeObject *__Pyx_ImportType_3_0_10(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_10 check_size)
+  #ifndef __PYX_HAVE_RT_ImportType_3_0_8
+#define __PYX_HAVE_RT_ImportType_3_0_8
+static PyTypeObject *__Pyx_ImportType_3_0_8(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_8 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
     Py_ssize_t itemsize;
 #if CYTHON_COMPILING_IN_LIMITED_API
     PyObject *py_basicsize;
@@ -88911,23 +90160,23 @@
     if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize+itemsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error_3_0_10 &&
+    if (check_size == __Pyx_ImportType_CheckSize_Error_3_0_8 &&
             ((size_t)basicsize > size || (size_t)(basicsize + itemsize) < size)) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd-%zd from PyObject",
             module_name, class_name, size, basicsize, basicsize+itemsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn_3_0_10 && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_3_0_8 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
@@ -89919,15 +91168,15 @@
         break;
     case 0:
         self = ((PyCFunctionObject*)cyfunc)->m_self;
         break;
     default:
         return NULL;
     }
-    return ((__Pyx_PyCFunctionFastWithKeywords)(void(*)(void))def->ml_meth)(self, args, nargs, kwnames);
+    return ((_PyCFunctionFastWithKeywords)(void(*)(void))def->ml_meth)(self, args, nargs, kwnames);
 }
 static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
 {
     __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
     PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
     PyTypeObject *cls = (PyTypeObject *) __Pyx_CyFunction_GetClassObj(cyfunc);
 #if CYTHON_BACKPORT_VECTORCALL
@@ -96727,15 +97976,15 @@
 __Pyx_PyType_GetName(PyTypeObject* tp)
 {
     PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
                                                __pyx_n_s_name_2);
     if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
         PyErr_Clear();
         Py_XDECREF(name);
-        name = __Pyx_NewRef(__pyx_n_s__71);
+        name = __Pyx_NewRef(__pyx_n_s__74);
     }
     return name;
 }
 #endif
 
 /* CheckBinaryVersion */
   static unsigned long __Pyx_get_runtime_version(void) {
```

### Comparing `kimimaro-3.7.0/ext/skeletontricks/skeletontricks.hpp` & `kimimaro-4.0.0/ext/skeletontricks/skeletontricks.hpp`

 * *Files 0% similar despite different names*

```diff
@@ -38,15 +38,16 @@
 namespace skeletontricks {
 
 size_t _roll_invalidation_cube(
   uint8_t* labels, float* DBF,
   const int64_t sx, const int64_t sy, const int64_t sz,
   const float wx, const float wy, const float wz,
   size_t* path, const size_t path_size,
-  const float scale, const float constant) {
+  const float scale, const float constant
+) {
 
   if (path_size == 0) {
     return 0;
   }
 
   const size_t sxy = sx * sy;
   const size_t voxels = sxy * sz;
@@ -470,12 +471,10 @@
       }
     }
   }
 
   return edges;
 }
 
-
-
 };
 
 #endif
```

### Comparing `kimimaro-3.7.0/ext/skeletontricks/skeletontricks.pxd` & `kimimaro-4.0.0/ext/skeletontricks/skeletontricks.pxd`

 * *Files identical despite different names*

### Comparing `kimimaro-3.7.0/ext/skeletontricks/skeletontricks.pyx` & `kimimaro-4.0.0/ext/skeletontricks/skeletontricks.pyx`

 * *Files 3% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 # cython: language_level=3
 """
 Certain operations have to be fast for the skeletonization
 procedure. The ones that didn't fit elsewhere have a home here.
 
 Author: William Silversmith
 Affiliation: Seung Lab, Princeton Neuroscience Institute
-Date: August 2018 - August 2021
+Date: August 2018 - May 2024
 
 *****************************************************************
 This file is part of Kimimaro.
 
 Kimimaro is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
@@ -58,14 +58,25 @@
 ctypedef fused INTEGER: 
   int8_t
   int16_t
   int32_t
   int64_t
   UINT
 
+cdef extern from "dijkstra_invalidation.hpp" namespace "dijkstra_invalidation":
+  cdef int64_t _roll_invalidation_ball(
+    uint8_t* field,
+    uint64_t sx, uint64_t sy, uint64_t sz, 
+    float wx, float wy, float wz, 
+    vector[uint64_t] sources,
+    vector[float] max_distances,
+    int connectivity,
+    uint32_t* voxel_connectivity_graph
+  )
+
 cdef extern from "skeletontricks.hpp" namespace "skeletontricks":
   cdef size_t _roll_invalidation_cube(
     uint8_t* labels, float* DBF,
     int64_t sx, int64_t sy, int64_t sz,
     float wx, float wy, float wz,
     size_t* path, size_t path_size,
     float scale, float constant
@@ -350,31 +361,77 @@
           maxpdrf = PDRF[x,y,z]
           mx = x
           my = y
           mz = z
 
   return (mx, my, mz)
 
+@cython.boundscheck(False)
+@cython.wraparound(False)  # turn off negative index wrapping for entire function
+@cython.nonecheck(False)
+@cython.binding(True)
+def roll_invalidation_ball_inside_component(
+    cnp.ndarray[uint8_t, cast=True, ndim=3] labels, 
+    cnp.ndarray[float, ndim=3] DBF, 
+    float scale, 
+    float constant,
+    anisotropy,
+    path,
+    voxel_connectivity_graph = None,
+    connectivity = 26,
+):
+  cdef int64_t sx, sy, sz 
+  sx = labels.shape[0]
+  sy = labels.shape[1]
+  sz = labels.shape[2]
+
+  cdef size_t sxy = sx * sy
+
+  cdef float wx, wy, wz
+  (wx, wy, wz) = anisotropy
+
+  max_distances = [ 
+    (scale * DBF[x,y,z] + constant) for (x,y,z) in path 
+  ]
+
+  path = [ 
+    coord[0] + sx * coord[1] + sxy * coord[2] 
+    for coord in path if tuple(coord)
+  ]
+
+  cdef uint32_t* vcg = NULL
+  cdef cnp.ndarray[uint32_t, ndim=3] vcg_arr
+
+  if isinstance(voxel_connectivity_graph, np.ndarray):
+    vcg_arr = voxel_connectivity_graph
+    vcg = <uint32_t*>&vcg_arr[0,0,0]
+
+  invalidated = _roll_invalidation_ball(
+    <uint8_t*>&labels[0,0,0],
+    sx, sy, sz, 
+    wx, wy, wz,
+    path, max_distances,
+    connectivity, 
+    vcg
+  )
+
+  return (invalidated, labels)
 
 @cython.boundscheck(False)
 @cython.wraparound(False)  # turn off negative index wrapping for entire function
 @cython.nonecheck(False)
+@cython.binding(True)
 def roll_invalidation_ball(
     cnp.ndarray[uint8_t, cast=True, ndim=3] labels, 
     cnp.ndarray[float, ndim=3] DBF, 
     path, float scale, float const,
     anisotropy=(1,1,1),
     invalid_vertices={},
   ):
   """
-  roll_invalidation_ball(
-    ndarray[uint8_t, cast=True, ndim=3] labels, ndarray[float, ndim=3] DBF, 
-    path, float scale, float const, anisotropy=(1,1,1), invalid_vertices={}
-  )
-
   Given an anisotropic binary image, its distance transform, and a path 
   traversing the binary image, erase the voxels surrounding the path
   in a sphere around each vertex on the path corresponding to the 
   equation: 
 
   r = scale * DBF[x,y,z] + const
 
@@ -424,24 +481,20 @@
             labels[x,y,z] = 0
 
   return invalidated, labels
 
 @cython.boundscheck(False)
 @cython.wraparound(False)  # turn off negative index wrapping for entire function
 @cython.nonecheck(False)
+@cython.binding(True)
 def get_mapping(
     cnp.ndarray[INTEGER, ndim=3] orig_labels, 
     cnp.ndarray[UINT, ndim=3] cc_labels
   ):
   """
-  get_mapping(
-    ndarray[INTEGER, ndim=3] orig_labels, 
-    ndarray[UINT, ndim=3] cc_labels
-  )
-
   Given a set of possibly not connected labels 
   and an image containing their labeled connected components, 
   produce a dictionary containing the inverse of this mapping.
 
   Returns: { $CC_LABEL: $ORIGINAL_LABEL }
   """
 
@@ -466,24 +519,20 @@
         if last_label == cc_labels[x,y,z]:
           continue
         remap[cc_labels[x,y,z]] = orig_labels[x,y,z]
         last_label = cc_labels[x,y,z]
 
   return remap
 
+@cython.binding(True)
 def compute_centroids(
     cnp.ndarray[UINT, ndim=2] labels,
     float wx, float wy
   ):
   """
-  compute_centroids(
-    cnp.ndarray[UINT, ndim=2] labels,
-    float wx, float wy
-  )
-
   Compute the centroid for every label on a 2D image at once.
 
   Returns: { $segid: (x, y), ... }
   """
 
   cdef float[:] xsum = np.zeros( (labels.size,), dtype=np.float32)
   cdef float[:] ysum = np.zeros( (labels.size,), dtype=np.float32)
@@ -533,26 +582,21 @@
     else:
       py = py + wy
 
     result[label] = (<int>(px / wx), <int>(py / wy))
 
   return result
 
+@cython.binding(True)
 def find_border_targets(
     cnp.ndarray[float, ndim=2] dt,
     cnp.ndarray[UINT, ndim=2] cc_labels,
     float wx, float wy
   ):
   """
-  find_border_targets(
-    ndarray[float, ndim=2] dt, 
-    ndarray[UINT, ndim=2] cc_labels,
-    float wx, float wy
-  )
-
   Given a set of connected components that line within 
   a plane and their distance transform, return a map of
   label ID to the coordinate of its maximum distance 
   transform value. If there are multiple maxima, we 
   disambiguate based on topological criteria that are
   coordinate frame independent in order to avoid dealing
   with issues that come from the six rotated frames and
@@ -713,30 +757,23 @@
   p1x = wx * (p1x - p2x)
   p1y = wy * (p1y - p2y)
   return p1x * p1x + p1y * p1y 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)  # turn off negative index wrapping for entire function
 @cython.nonecheck(False)
+@cython.binding(True)
 def roll_invalidation_cube(
     cnp.ndarray[uint8_t, cast=True, ndim=3] labels, 
     cnp.ndarray[float, ndim=3] DBF, 
     path, float scale, float const,
     anisotropy=(1,1,1),
     invalid_vertices={},
   ):
   """
-  roll_invalidation_cube(
-    ndarray[uint8_t, cast=True, ndim=3] labels, 
-    ndarray[float, ndim=3] DBF, 
-    path, float scale, float const,
-    anisotropy=(1,1,1),
-    invalid_vertices={},
-  )
-
   Given an anisotropic binary image, its distance transform, and a path 
   traversing the binary image, erase the voxels surrounding the path
   in a cube around each vertex. In contrast to `roll_invalidation_ball`,
   this function runs in time linear in the number of image pixels.
   """
   cdef int64_t sx, sy, sz 
   sx = labels.shape[0]
```

### Comparing `kimimaro-3.7.0/kimimaro/__init__.py` & `kimimaro-4.0.0/kimimaro/__init__.py`

 * *Files identical despite different names*

### Comparing `kimimaro-3.7.0/kimimaro/intake.py` & `kimimaro-4.0.0/kimimaro/intake.py`

 * *Files 0% similar despite different names*

```diff
@@ -151,15 +151,15 @@
     return {}
   
   minlabel, maxlabel = fastremap.minmax(all_labels)
 
   if minlabel == 0 and maxlabel == 0:
     return {}
 
-  cc_labels, remapping = compute_cc_labels(all_labels)
+  cc_labels, remapping = compute_cc_labels(all_labels, voxel_graph)
   del all_labels
 
   if fill_holes:
     cc_labels = fill_all_holes(cc_labels, progress)
 
   extra_targets_before = points_to_labels(extra_targets_before, cc_labels)
   extra_targets_after = points_to_labels(extra_targets_after, cc_labels)
@@ -170,15 +170,15 @@
       black_border=(minlabel == maxlabel),
       order='F',
       parallel=parallel,
       voxel_graph=voxel_graph,
     )
 
   all_dbf = edtfn(cc_labels)
- 
+  
   if fix_avocados:
     cc_labels, all_dbf, remapping = engage_avocado_protection(
       cc_labels, all_dbf, remapping,
       soma_detection_threshold=teasar_params.get('soma_detection_threshold', 0),
       edtfn=edtfn,
       progress=progress,
     )
```

### Comparing `kimimaro-3.7.0/kimimaro/postprocess.py` & `kimimaro-4.0.0/kimimaro/postprocess.py`

 * *Files identical despite different names*

### Comparing `kimimaro-3.7.0/kimimaro/trace.py` & `kimimaro-4.0.0/kimimaro/trace.py`

 * *Files 6% similar despite different names*

```diff
@@ -107,29 +107,32 @@
   # For somata: specially handle the root by 
   # placing it at the approximate center of the soma
   if dbf_max > soma_detection_threshold:
     labels, num_voxels_filled = fill_voids.fill(labels, in_place=True, return_fill_count=True)
     if num_voxels_filled > 0:
       del DBF
       DBF = edt.edt(
-        labels, anisotropy=anisotropy, order='F',
-        black_border=np.all(labels)
+        labels, 
+        anisotropy=anisotropy, 
+        order='F',
+        black_border=np.all(labels),
+        voxel_graph=voxel_graph,
       )
     dbf_max = np.max(DBF) 
     soma_mode = dbf_max > soma_acceptance_threshold
 
   soma_radius = 0.0
 
   if soma_mode:
     if root is not None:
       manual_targets_before.insert(0, root)
     root = find_soma_root(DBF, dbf_max)    
     soma_radius = dbf_max * soma_invalidation_scale + soma_invalidation_const
   elif root is None:
-    root = find_root(labels, anisotropy)
+    root = find_root(labels, anisotropy, voxel_graph)
   
   if root is None:
     return PrecomputedSkeleton()
  
   free_space_radius = 0 if not soma_mode else DBF[root]
   # DBF: Distance to Boundary Field
   # DAF: Distance from any voxel Field (distance from root field)
@@ -151,19 +154,21 @@
   if not fix_branching:
     parents = dijkstra3d.parental_field(PDRF, root, voxel_graph)
     del PDRF
   else:
     parents = PDRF
 
   if soma_mode:
-    invalidated, labels = kimimaro.skeletontricks.roll_invalidation_ball(
-      labels, DBF, np.array([root], dtype=np.uint32),
+    invalidated, labels = kimimaro.skeletontricks.roll_invalidation_ball_inside_component(
+      labels, DBF, 
+      path=[root],
       scale=soma_invalidation_scale,
       const=soma_invalidation_const, 
-      anisotropy=anisotropy
+      anisotropy=anisotropy,
+      voxel_connectivity_graph=voxel_graph,
     )
   # This target is only valid if no 
   # invalidations have occured yet.
   elif len(manual_targets_before) == 0:
     manual_targets_before.append(target)
 
   # delete reference to DAF and place it in
@@ -198,22 +203,18 @@
   """
   Given the labels, DBF, DAF, dijkstra parents,
   and associated invalidation knobs, find the set of paths 
   that cover the object. Somas are given special treatment
   in that we attempt to cull vertices within a radius of the
   root vertex.
   """
-  invalid_vertices = {}
   paths = []
   valid_labels = np.count_nonzero(labels)
   root = tuple(root)
 
-  if soma_mode:
-    invalid_vertices[root] = True
-
   if max_paths is None:
     max_paths = valid_labels
 
   if len(manual_targets_before) + len(manual_targets_after) >= max_paths:
     return []
 
   target_finder = None
@@ -254,22 +255,22 @@
       dist_to_soma_root = np.linalg.norm(anisotropy * (path - root), axis=1)
       # remove all path points which are within soma_radius of root
       path = np.concatenate(
         (path[:1,:], path[dist_to_soma_root > soma_radius, :])
       )
 
     if valid_labels > 0:
-      invalidated, labels = kimimaro.skeletontricks.roll_invalidation_cube(
-        labels, DBF, path, scale, const, 
-        anisotropy=anisotropy, invalid_vertices=invalid_vertices,
-      )
+      invalidated, labels = kimimaro.skeletontricks.roll_invalidation_ball_inside_component(
+        labels, DBF, scale, const, 
+        anisotropy=anisotropy, path=path,
+        voxel_connectivity_graph=voxel_graph,
+      )      
       valid_labels -= invalidated
 
     for vertex in path:
-      invalid_vertices[tuple(vertex)] = True
       if fix_branching:
         parents[tuple(vertex)] = 0.0
 
     paths.append(path)
 
   return paths
 
@@ -291,29 +292,30 @@
   coords = np.vstack( coords ).T
   root = np.argmin(
     np.sum((coords - com) ** 2, axis=1)
   )
 
   return tuple(coords[root].astype(np.uint32))
 
-def find_root(labels, anisotropy):
+def find_root(labels, anisotropy, voxel_graph):
   """
   "4.4 DAF:  Compute distance from any voxel field"
   Compute DAF, but we immediately convert to the PDRF
   The extremal point of the PDRF is a valid root node
   even if the DAF is computed from an arbitrary pixel.
   """
   any_voxel = kimimaro.skeletontricks.first_label(labels)   
   if any_voxel is None: 
     return None
 
   DAF, target = dijkstra3d.euclidean_distance_field(
-    np.asfortranarray(labels), any_voxel, 
+    labels, any_voxel, 
     anisotropy=anisotropy,
     return_max_location=True,
+    voxel_graph=voxel_graph,
   )
   return target
 
 def is_power_of_two(num):
   if int(num) != num:
     return False
   return num != 0 and ((num & (num - 1)) == 0)
```

### Comparing `kimimaro-3.7.0/kimimaro/utility.py` & `kimimaro-4.0.0/kimimaro/utility.py`

 * *Files 2% similar despite different names*

```diff
@@ -16,20 +16,25 @@
 import fill_voids
 import xs3d
 
 def extract_skeleton_from_binary_image(image):
   verts, edges = kimimaro.skeletontricks.extract_edges_from_binary_image(image)
   return Skeleton(verts, edges)
 
-def compute_cc_labels(all_labels):
+def compute_cc_labels(all_labels, voxel_graph = None):
   tmp_labels = all_labels
   if np.dtype(all_labels.dtype).itemsize > 1:
     tmp_labels, remapping = fastremap.renumber(all_labels, in_place=False)
 
-  cc_labels = cc3d.connected_components(tmp_labels)
+  if voxel_graph is not None:
+    cc_labels = cc3d.color_connectivity_graph(voxel_graph, connectivity=26)
+    cc_labels *= all_labels > 0
+  else:
+    cc_labels = cc3d.connected_components(tmp_labels)
+  
   cc_labels = fastremap.refit(cc_labels)
 
   del tmp_labels
   remapping = kimimaro.skeletontricks.get_mapping(all_labels, cc_labels) 
   return cc_labels, remapping
 
 def find_objects(labels):
```

### Comparing `kimimaro-3.7.0/kimimaro.egg-info/PKG-INFO` & `kimimaro-4.0.0/kimimaro.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: kimimaro
-Version: 3.7.0
+Version: 4.0.0
 Summary: Skeletonize densely labeled image volumes.
 Home-page: https://github.com/seung-lab/kimimaro/
 Author: William Silversmith, Alex Bae, Forrest Collman, Peter Li
 Author-email: ws9@princeton.edu
 License: License :: OSI Approved :: GNU General Public License v3 or later (GPLv3+)
 Keywords: volumetric-data numpy teasar skeletonization centerline medial-axis-transform centerline-extraction computer-vision-alogithms connectomics image-processing biomedical-image-processing voxel
 Classifier: Intended Audience :: Developers
@@ -18,30 +18,31 @@
 Classifier: Programming Language :: Python :: 3.11
 Classifier: Programming Language :: Python :: 3.12
 Classifier: Topic :: Scientific/Engineering
 Classifier: Intended Audience :: Science/Research
 Classifier: Operating System :: POSIX
 Classifier: Operating System :: MacOS
 Classifier: Operating System :: Microsoft :: Windows :: Windows 10
-Requires-Python: >=3.6.0,<4.0.0
+Requires-Python: >=3.8.0,<4.0.0
 Description-Content-Type: text/markdown
 License-File: LICENSE
 License-File: AUTHORS
 Requires-Dist: click
-Requires-Dist: connected-components-3d>=1.5.0
+Requires-Dist: connected-components-3d>=3.16.0
 Requires-Dist: cloud-volume>=0.57.6
-Requires-Dist: dijkstra3d>=1.9.0
+Requires-Dist: dijkstra3d>=1.15.0
 Requires-Dist: fill-voids>=2.0.0
 Requires-Dist: edt>=2.1.0
 Requires-Dist: fastremap>=1.10.2
 Requires-Dist: networkx
 Requires-Dist: numpy>=1.16.1
 Requires-Dist: pathos
+Requires-Dist: pytest
 Requires-Dist: scipy>=1.1.0
-Requires-Dist: xs3d>=0.2.0
+Requires-Dist: xs3d<2,>=1.2.0
 Provides-Extra: tif
 Requires-Dist: tifffile; extra == "tif"
 
 [![Build Status](https://travis-ci.org/seung-lab/kimimaro.svg?branch=master)](https://travis-ci.org/seung-lab/kimimaro) [![PyPI version](https://badge.fury.io/py/kimimaro.svg)](https://badge.fury.io/py/kimimaro)  
 
 # Kimimaro: Skeletonize Densely Labeled Images
```

### Comparing `kimimaro-3.7.0/kimimaro.egg-info/SOURCES.txt` & `kimimaro-4.0.0/kimimaro.egg-info/SOURCES.txt`

 * *Files 26% similar despite different names*

```diff
@@ -1,21 +1,21 @@
 AUTHORS
 LICENSE
 MANIFEST.in
 README.md
 pyproject.toml
 setup.py
-./ext/skeletontricks/skeletontricks.cpp
 ./ext/skeletontricks/skeletontricks.pyx
+ext/skeletontricks/dijkstra_invalidation.hpp
+ext/skeletontricks/libdivide.h
 ext/skeletontricks/robinhood.hpp
 ext/skeletontricks/skeletontricks.cpp
 ext/skeletontricks/skeletontricks.hpp
 ext/skeletontricks/skeletontricks.pxd
 ext/skeletontricks/skeletontricks.pyx
-ext/skeletontricks/test.cpp
 kimimaro/__init__.py
 kimimaro/intake.py
 kimimaro/postprocess.py
 kimimaro/trace.py
 kimimaro/utility.py
 kimimaro.egg-info/PKG-INFO
 kimimaro.egg-info/SOURCES.txt
```

### Comparing `kimimaro-3.7.0/kimimaro_cli/__init__.py` & `kimimaro-4.0.0/kimimaro_cli/__init__.py`

 * *Files identical despite different names*

### Comparing `kimimaro-3.7.0/setup.py` & `kimimaro-4.0.0/setup.py`

 * *Files 3% similar despite different names*

```diff
@@ -16,34 +16,35 @@
     return f.read()
 
 # NOTE: If skeletontricks.cpp does not exist, you must run
 # cython -3 --cplus ./ext/skeletontricks/skeletontricks.pyx
 
 setuptools.setup(
   name="kimimaro",
-  version="3.7.0",
+  version="4.0.0",
   setup_requires=["numpy", "cython"],
   install_requires=[
     "click",
-    "connected-components-3d>=1.5.0",
+    "connected-components-3d>=3.16.0",
     "cloud-volume>=0.57.6",
-    "dijkstra3d>=1.9.0",
+    "dijkstra3d>=1.15.0",
     "fill-voids>=2.0.0",
     "edt>=2.1.0",
     "fastremap>=1.10.2",
     "networkx",
     "numpy>=1.16.1",
     "pathos",
+    "pytest",
     "scipy>=1.1.0",
-    "xs3d>=0.2.0",
+    "xs3d>=1.2.0,<2",
   ],
   extras_require={
     'tif': [ 'tifffile' ],
   },
-  python_requires=">=3.6.0,<4.0.0",
+  python_requires=">=3.8.0,<4.0.0",
   ext_modules=[
     setuptools.Extension(
       'kimimaro.skeletontricks',
       sources=[ './ext/skeletontricks/skeletontricks.pyx' ],
       language='c++',
       include_dirs=[ str(NumpyImport()) ],
       extra_compile_args=[
```

